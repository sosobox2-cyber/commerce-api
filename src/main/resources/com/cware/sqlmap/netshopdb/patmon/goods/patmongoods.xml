<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"
        "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">
        
<mapper namespace="patmon.goods">  
  
	<select id="selectPaTmonEntpSlip" parameterType="hashMap" resultType="com.cware.netshopping.domain.model.PaEntpSlip">
        SELECT /* patmongoods.xml : patmon.patmongoods.selectPaTmonEntpSlip by PaTmonGoodsController-goodsInsert */
               distinct TE.ENTP_CODE
             , TE.ENTP_MAN_SEQ 
             , TE.ENTP_MAN_GB AS PA_ADDR_GB
             , PG.PA_CODE
          FROM TPAPRODUCT TG
             , TENTPUSER TE
             , TPATMONGOODS PG
             , TGOODS GD
         WHERE DECODE(GD.DELY_TYPE,'10','100001',TG.ENTP_CODE) = TE.ENTP_CODE
           AND PG.GOODS_CODE = TG.GOODS_CODE
           AND PG.GOODS_CODE = GD.GOODS_CODE
           AND ( DECODE(GD.DELY_TYPE, '10', '002', TG.RETURN_MAN_SEQ) = TE.ENTP_MAN_SEQ
			 OR  DECODE(GD.DELY_TYPE, '10', '003', TG.SHIP_MAN_SEQ) = TE.ENTP_MAN_SEQ )
           <if test ='modCase =="MODIFY"'>
           AND PG.TRANS_TARGET_YN = '1'
           </if>
           <if test='paCode != null and paCode != ""'>
           AND PG.PA_CODE = #{paCode, jdbcType=VARCHAR}
           </if>
           <if test='goodsCode != null and goodsCode != ""'>
           AND TG.GOODS_CODE = #{goodsCode, jdbcType=VARCHAR}
           </if>
           AND NOT EXISTS ( SELECT 'X'
                              FROM TPAENTPSLIP PS
                             WHERE PS.ENTP_CODE = TE.ENTP_CODE
                               AND PS.ENTP_MAN_SEQ = TE.ENTP_MAN_SEQ
                               AND PS.PA_CODE = PG.PA_CODE
                          )
    </select>
    
    <resultMap id="paTmongoodsVOMap" type="com.cware.netshopping.domain.PaTmonGoodsVO">
		<result property="describeExt" column="DESCRIBE_EXT" jdbcType="CLOB" javaType="string" />
		<result property="noticeExt" column="NOTICE_EXT" jdbcType="CLOB" javaType="string" />
	</resultMap>
	
   <select id="selectPaTmonGoodsInfo" parameterType="hashMap" resultMap="paTmongoodsVOMap">
        SELECT /* patmongoods.xml : patmon.patmongoods.selectPaTmonGoodsInfo by PaTmonGoodsController-goodsInsert */
        	   PG.PA_CODE
        	 , PG.PA_GROUP_CODE
			 , PG.GOODS_CODE
			 , PG.DEAL_NO
			 , PC.PA_SHIP_POLICY_NO
			 , PC.PRODUCT_TYPE
			 , PG.MANAGED_TITLE
			 , PG.CATEGORY_NO
			 , TG.ORDER_MAX_QTY 
			 , TG.CUST_ORD_QTY_CHECK_TERM
			 , G.TERM_ORDER_QTY
             , G.CUST_ORD_QTY_CHECK_YN
			 , TG.ADULT_YN
			 , PG.TITLE
			 , PI.IMAGE_URL
			 , TI.IMAGE_G  AS IMAGE_P
             , TI.IMAGE_AG AS IMAGE_AP
             , TI.IMAGE_BG AS IMAGE_BP
             , TI.IMAGE_CG AS IMAGE_CP
             , TI.IMAGE_DG AS IMAGE_DP         
			 , (SELECT CODE_NAME
				  FROM TCODE C1
				 WHERE C1.CODE_LGROUP = 'O507'
				   AND C1.CODE_MGROUP = PG.PA_CODE) AS TOP_IMAGE
			 , (SELECT CODE_NAME
				  FROM TCODE C1
				 WHERE C1.CODE_LGROUP = 'O507'
				   AND C1.CODE_MGROUP = DECODE(PG.PA_CODE, '91', '93', '94')) AS BOTTOM_IMAGE
			 , PG.BRAND_NAME
			 , PG.PA_SALE_GB
			 , PG.PA_STATUS
			 , PP.SALE_PRICE
		     , PP.DC_AMT
		     , PP.LUMP_SUM_DC_AMT
		     , PP.LUMP_SUM_OWN_DC_AMT
		     , PP.LUMP_SUM_ENTP_DC_AMT
		     , PP.APPLY_DATE
		     , GK.PA_LGROUP
		     , G.ORIGIN_CODE
			 , TG.ORIGIN_NAME
             , NVL(CEIL(FUN_GET_ORDER_ABLE_QTY(PG.GOODS_CODE,'%', G.WH_CODE) * T1.CODE_GROUP), 0) AS TRANS_ORDER_ABLE_QTY
			 , NVL((SELECT D.PA_DELY_GB 
					  FROM TCODE C
						 , TPADELYGB D 
					 WHERE CODE_LGROUP = 'B005' 
					   AND C.CODE_MGROUP = TE.DELY_GB
					   AND D.DELY_GB = C.CODE_MGROUP
					   AND D.PA_CODE = '09'), '10008') AS DELY_GB
			 , G.COLLECT_YN
			 , (SELECT TSB.DESCRIBE_NOTE
			          FROM TDESCRIBE TSB
			         WHERE TSB.GOODS_CODE = TG.GOODS_CODE
			           AND TSB.DESCRIBE_CODE = '200') AS GOODS_COM
		     , NVL((SELECT REPLACE (DS.DESCRIBE_EXT, chr(10), '')
		              FROM TDESCRIBE DS
		             WHERE DS.DESCRIBE_CODE = '998'
		               AND DS.GOODS_CODE = TG.GOODS_CODE)
		          ,(SELECT DECODE(DS.WEB_FLAG, '1',  REPLACE(DS.DESCRIBE_EXT, chr(10), ''), DS.DESCRIBE_NOTE)
		              FROM TDESCRIBE DS
		             WHERE DS.DESCRIBE_CODE = '999'
		               AND DS.GOODS_CODE = TG.GOODS_CODE)) AS DESCRIBE_EXT
			 , (SELECT /*+ INDEX_DESC (TNM IDX_TPANOTICEM_03)*/
             			   TNM.NOTICE_EXT
					  FROM TPANOTICEM TNM
					     , TPANOTICETARGET TNT
					     , TPANOTICEAPPLY TNA
					 WHERE TNM.NOTICE_NO  = TNT.NOTICE_NO
					   AND TNT.GOODS_CODE = TG.GOODS_CODE
					   AND TNM.USE_CODE   = '00'
					   AND INSTR(TNM.PA_GROUP_CODE, PG.PA_GROUP_CODE) > 0
					   AND TNT.NOTICE_NO  = TNA.NOTICE_NO
					   AND TNT.GOODS_CODE = TNA.GOODS_CODE
					   AND TNA.PA_GROUP_CODE = PG.PA_GROUP_CODE
					   AND ROWNUM = 1) AS NOTICE_EXT
			 , DECODE(G.COLLECT_YN,'0','',(SELECT CODE_NAME
                                             FROM TCODE C1
                                            WHERE C1.CODE_LGROUP = 'O507'
                                              AND C1.CODE_MGROUP = '99')) AS COLLECT_IMAGE
			 , G.LGROUP
		  FROM TPAPRODUCT TG
			 , TPATMONGOODS PG
			 , TGOODS G
			 , TGOODSADDINFO AI
			 , TPAGOODSIMAGE PI
			 , TGOODSIMAGE   TI
			 , TPAGOODSPRICE PP
			 , TPATMONSHIPCOST PC
			 , TCODE T1
			 , TPAGOODSKINDS GK
			 , TENTERPRISE TE
		 WHERE TG.GOODS_CODE = PG.GOODS_CODE
		   AND PG.GOODS_CODE = G.GOODS_CODE
		   AND G.GOODS_CODE = AI.GOODS_CODE
		   AND PG.GOODS_CODE    = PI.GOODS_CODE
		   AND PG.PA_GROUP_CODE = PI.PA_GROUP_CODE
		   AND PG.GOODS_CODE    = TI.GOODS_CODE
		   AND PG.PA_CODE    = PP.PA_CODE
		   AND PG.GOODS_CODE = PP.GOODS_CODE
		   AND PP.ROWID = (SELECT /*+ INDEX_DESC (GP PK_TPAGOODSPRICE)*/
								  GP.ROWID
							FROM TPAGOODSPRICE GP
						   WHERE GP.GOODS_CODE = PG.GOODS_CODE
							 AND GP.APPLY_DATE &lt; SYSDATE
							 AND GP.PA_CODE = PG.PA_CODE
							 AND ROWNUM = 1)
		   AND PG.PA_CODE = PC.PA_CODE
		   AND DECODE(G.DELY_TYPE, '10', '100001', G.ENTP_CODE) = PC.ENTP_CODE
		   AND DECODE(G.INSTALL_YN, '1', 'DP04', DECODE(AI.ORDER_CREATE_YN, '1', 'DP05', 'DP07')) = PC.PRODUCT_TYPE
		   AND DECODE(G.DELY_TYPE, '10', '003', G.SHIP_MAN_SEQ) = PC.SHIP_MAN_SEQ
		   AND DECODE(G.DELY_TYPE, '10', '002', G.RETURN_MAN_SEQ) = PC.RETURN_MAN_SEQ
		   AND PC.SHIP_COST_CODE	= G.SHIP_COST_CODE
		   AND PC.NO_SHIP_ISLAND	= NVL((SELECT '1' FROM TDELYNOAREA DA WHERE DA.GOODS_CODE = G.GOODS_CODE AND DA.AREA_GB IN ('20','30') AND ROWNUM = 1), 0)
		   AND PC.APPLY_DATE = ( SELECT MAX(PC2.APPLY_DATE)
								   FROM TPATMONSHIPCOST PC2
								  WHERE PC2.PA_CODE = PC.PA_CODE
									AND PC2.ENTP_CODE = PC.ENTP_CODE
									AND PC2.PRODUCT_TYPE = PC.PRODUCT_TYPE
									AND PC2.SHIP_MAN_SEQ = PC.SHIP_MAN_SEQ
									AND PC2.RETURN_MAN_SEQ = PC.RETURN_MAN_SEQ
									AND PC2.SHIP_COST_CODE = PC.SHIP_COST_CODE
									AND PC2.NO_SHIP_ISLAND = PC.NO_SHIP_ISLAND
									AND SYSDATE > PC2.APPLY_DATE
							   )
		   AND PC.PA_SHIP_POLICY_NO IS NOT NULL
		   AND T1.CODE_LGROUP 	 = 'O505'
		   AND T1.CODE_MGROUP 	 = PG.PA_CODE
		   AND NVL(G.SALE_END_DATE, SYSDATE + 1) > SYSDATE
		   AND PG.PA_GROUP_CODE = GK.PA_GROUP_CODE
		   AND PG.CATEGORY_NO = GK.PA_LMSD_KEY
		   AND TE.ENTP_CODE = TG.ENTP_CODE
		<if test='goodsCode != null and goodsCode != ""'>
		   AND PG.GOODS_CODE = #{goodsCode, jdbcType=VARCHAR}
		</if>
		<if test='paCode != null and paCode != ""'>
		   AND PG.PA_CODE = #{paCode, jdbcType=VARCHAR}
		</if>
		<if test='modCase == "MODIFY"'>
		   AND ( PG.TRANS_TARGET_YN = '1' OR PP.TRANS_DATE IS NULL )
		   AND PG.PA_SALE_GB = '20'
		   AND PG.PA_STATUS = '30'
		</if>
		<if test='modCase == "INSERT"'>
		   AND PG.PA_STATUS IN ('10', '20')
		   AND TG.SALE_GB = '00'
		</if>
		ORDER BY PG.MODIFY_DATE
    </select>
    
     <select id="selectPaTmonGoodsOfferList" parameterType="hashMap" resultType="com.cware.netshopping.domain.PaGoodsOfferVO">
        SELECT /* patmongoods.xml : patmon.patmongoods.selectPaTmonGoodsOfferList by PaTmonGoodsController-goodsInsert */
               PO.GOODS_CODE
             , PO.PA_GROUP_CODE
             , PO.PA_OFFER_TYPE
             , PO.PA_OFFER_CODE 
             , PO.PA_OFFER_EXT
             , PC.PA_OFFER_TYPE_NAME
             , PC.PA_OFFER_CODE_NAME
          FROM TPAGOODSOFFER PO
             , TPAOFFERCODE PC
         WHERE PO.PA_GROUP_CODE = PC.PA_GROUP_CODE  
           AND PO.PA_OFFER_TYPE = PC.PA_OFFER_TYPE 
           AND PO.PA_OFFER_CODE = PC.PA_OFFER_CODE  
           AND PO.GOODS_CODE    = #{goodsCode,   jdbcType=VARCHAR}
           AND PO.PA_GROUP_CODE = #{paGroupCode, jdbcType=VARCHAR}
           AND PO.USE_YN = '1'
    </select>
    
    <select id="selectPaTmonGoodsdtInfoList" parameterType="hashMap" resultType="com.cware.netshopping.domain.model.PaGoodsdtMapping">
        SELECT /* patmongoods.xml : patmon.patmongoods.selectPaTmonGoodsdtInfoList by PaTmonGoodsController-goodsInsert */ 
               PD.GOODS_CODE 
             , DM.PA_CODE
             , PD.GOODSDT_CODE
             , DECODE(PD.GOODSDT_INFO,'없음','단일상품',PD.GOODSDT_INFO) AS GOODSDT_INFO
          <if test='modCase == "INSERT"'>
             , DECODE(DT.SALE_GB, '00', NVL(CEIL(FUN_GET_ORDER_ABLE_QTY(PD.GOODS_CODE, PD.GOODSDT_CODE, GD.WH_CODE) * TC.CODE_GROUP),0), 0) AS TRANS_ORDER_ABLE_QTY
          </if>
             , DM.PA_OPTION_CODE
             , DM.TRANS_TARGET_YN
          FROM TGOODSDT PD
             , TPAGOODSDTMAPPING DM
             , TGOODS GD
             , TCODE TC
             , TGOODSDT DT
         WHERE PD.GOODS_CODE = DM.GOODS_CODE
           AND PD.GOODSDT_CODE = DM.GOODSDT_CODE
           AND PD.GOODS_CODE = GD.GOODS_CODE
           AND TC.CODE_LGROUP = 'O505'
           AND TC.CODE_MGROUP = DM.PA_CODE
           AND DT.GOODS_CODE = PD.GOODS_CODE
           AND DT.GOODSDT_CODE = PD.GOODSDT_CODE
           AND DM.PA_CODE = #{paCode, jdbcType=VARCHAR}
           AND GD.GOODS_CODE = #{goodsCode, jdbcType=VARCHAR}
          <if test='modCase == "INSERT"'>
          	AND PD.SALE_GB = '00'
          </if>
           <if test='modCase == "MODIFY"'>
             AND PA_OPTION_CODE IS NOT NULL
          </if>
         ORDER BY PD.GOODS_CODE
                , PD.GOODSDT_CODE
    </select>
     
	<update id="updatePaTmonGoodsdt"  parameterType="com.cware.netshopping.domain.model.PaGoodsdtMapping">
        UPDATE /* patmongoods.xml : patmon.patmongoods.updatePaTmonGoodsdt by PaTmonGoodsController-goodsInsert */
               TPAGOODSDTMAPPING PD
           SET PD.TRANS_TARGET_YN = '0'
             , PD.MODIFY_ID = #{modifyId, jdbcType=VARCHAR}
             , PD.MODIFY_DATE = #{modifyDate, jdbcType=TIMESTAMP}
             <if test='paOptionCode != null and paOptionCode != ""'>
             , PD.PA_OPTION_CODE = #{paOptionCode, jdbcType=VARCHAR}
             </if>
             <if test='transOrderAbleQty != null and transOrderAbleQty != ""'>
             , PD.TRANS_ORDER_ABLE_QTY = #{transOrderAbleQty, jdbcType=NUMERIC}
              </if>
         WHERE PD.GOODS_CODE = #{goodsCode, jdbcType=VARCHAR}
           AND PD.GOODSDT_CODE = #{goodsdtCode, jdbcType=VARCHAR}
           AND PD.PA_CODE = #{paCode, jdbcType=VARCHAR} 
	</update>
	
	<update id="updatePaTmonGoods"  parameterType="com.cware.netshopping.domain.PaTmonGoodsVO">
        UPDATE /* patmongoods.xml : patmon.patmongoods.updatePaTmonGoods by PaTmonGoodsController */
               TPATMONGOODS PG
           SET PG.DEAL_NO    = #{dealNo, 	  jdbcType=VARCHAR}
             , PG.PA_STATUS = #{paStatus, jdbcType=VARCHAR}
             <if test='transOrderAbleQty > 0'>
             , PG.TRANS_ORDER_ABLE_QTY = #{transOrderAbleQty, jdbcType=NUMERIC}
             </if>
             , PG.RETURN_NOTE     = ''
             , PG.PA_SALE_GB      = #{paSaleGb,   jdbcType=VARCHAR}
             , PG.TRANS_TARGET_YN = '0'
             , PG.TRANS_SALE_YN   = '0'
             , PG.MODIFY_ID 	  = #{modifyId,   jdbcType=VARCHAR}
             , PG.MODIFY_DATE 	  = #{modifyDate, jdbcType=TIMESTAMP}
         WHERE PG.GOODS_CODE 	  = #{goodsCode,  jdbcType=VARCHAR}  
           AND PG.PA_CODE 		  = #{paCode,     jdbcType=VARCHAR}  
    </update>
    
	<insert id="insertNewPaPromoTargetAmt0"  parameterType="com.cware.netshopping.domain.model.PaPromoTarget">
		INSERT INTO /* patmongoods.xml : patmon.patmongoods.insertNewPaPromoTargetAmt0 by PaTmonGoodsController */
			   TPAPROMOTARGET PPMT
                             (PPMT.PROMO_NO
                            , PPMT.PA_CODE
                            , PPMT.GOODS_CODE
                            , PPMT.SEQ
                            , PPMT.DO_TYPE
                            , PPMT.COUPON_YN
                            , PPMT.IMMEDIATELY_YN
                            , PPMT.PROMO_BDATE
                            , PPMT.PROMO_EDATE
                            , PPMT.AMT_RATE_FLAG
                            , PPMT.DO_RATE
                            , PPMT.DO_AMT
                            , PPMT.STANDARD_APP_AMT
                            , PPMT.LIMIT_AMT
                            , PPMT.USE_CODE
                            , PPMT.OWN_COST
                            , PPMT.ENTP_COST
                            , PPMT.INSERT_ID
                            , PPMT.MODIFY_ID
                            , PPMT.PROC_GB
                            , PPMT.PA_GROUP_CODE
                            , PPMT.TRANS_DATE
                            , PPMT.INSERT_DATE
                            , PPMT.MODIFY_DATE
                            , PPMT.DO_COST
                            , PPMT.DO_OWN_COST
                            , PPMT.DO_ENTP_COST
                            )
                         SELECT PM.PROMO_NO
                              , PM.PA_CODE
                              , PM.GOODS_CODE
                              , LPAD((SELECT MAX(PM1.SEQ) + 1 
                              	   FROM TPAPROMOTARGET PM1 
                              	  WHERE PM1.GOODS_CODE 	= #{goodsCode	, jdbcType=VARCHAR}
                              	  	AND PM1.PA_CODE 	= #{paCode		, jdbcType=VARCHAR}
                              	  	AND PM1.PROMO_NO 	= #{promoNo		, jdbcType=VARCHAR}
                              	  	), 4 ,'0')   
                              , PM.DO_TYPE
                              , PM.COUPON_YN
                              , PM.IMMEDIATELY_YN
                              , PM.PROMO_BDATE
                              , PM.PROMO_EDATE
                              , PM.AMT_RATE_FLAG
                              , 0
                              , 0
                              , 0
                              , 0
                              , PM.USE_CODE
                              , 0
                              , 0
                              , PM.INSERT_ID
                              , 'BATCH'
                              , 'D'
                              , PM.PA_GROUP_CODE 
                              , SYSDATE
                              , SYSDATE
                              , SYSDATE
                              , 0
                              , 0
                              , 0                                
                           FROM TPAPROMOTARGET PM
                          WHERE PM.GOODS_CODE 	= #{goodsCode	, jdbcType=VARCHAR}
						    AND PM.PA_CODE 		= #{paCode		, jdbcType=VARCHAR}
							AND PM.PROMO_NO 	= #{promoNo		, jdbcType=VARCHAR}
					        AND PM.SEQ 			= #{seq			, jdbcType=VARCHAR}
     </insert>
     
     <update id="updatePaPromoTarget"  parameterType="com.cware.netshopping.domain.model.PaPromoTarget">
        UPDATE /* patmongoods.xml : patmon.patmongoods.updatePaCopnGoodsOffer by PaTmongoodsController */
               TPAPROMOTARGET PPMT
           SET PPMT.MODIFY_ID     = #{modifyId, jdbcType=VARCHAR}
			   <choose>
			   <when test='doCost != null and doCost == 0 '>
			 , PPMT.EXCEPT_REASON =  '마진률 초과  , 연동 예외 시간 : ' || TO_CHAR(SYSDATE , 'YYYY/MM/DD HH24:MI:SS')
			   </when>
			   <otherwise>
			 , PPMT.TRANS_DATE    = SYSDATE
			 , PPMT.EXCEPT_REASON = NULL
			   </otherwise>
			   </choose>
             , PPMT.MODIFY_DATE   = #{modifyDate, jdbcType=TIMESTAMP}
         WHERE PPMT.PROMO_NO      = #{promoNo, jdbcType=VARCHAR}
           AND PPMT.PA_CODE       = #{paCode, jdbcType=VARCHAR}
           AND PPMT.GOODS_CODE    = #{goodsCode, jdbcType=VARCHAR}
           AND PPMT.SEQ           = #{seq, jdbcType=VARCHAR}
    </update>
     
	<insert id="insertNewPaPromoTarget"  parameterType="com.cware.netshopping.domain.model.PaPromoTarget">
		INSERT INTO /* patmongoods.xml: patmon.patmongoods.insertPaPromoTarget by PaTmonGoodsController */
			   TPAPROMOTARGET PPMT
                             (PPMT.PROMO_NO
                            , PPMT.PA_CODE
                            , PPMT.GOODS_CODE
                            , PPMT.SEQ
                            , PPMT.DO_TYPE
                            , PPMT.COUPON_YN
                            , PPMT.IMMEDIATELY_YN
                            , PPMT.PROMO_BDATE
                            , PPMT.PROMO_EDATE
                            , PPMT.AMT_RATE_FLAG
                            , PPMT.DO_RATE
                            , PPMT.DO_AMT
                            , PPMT.STANDARD_APP_AMT
                            , PPMT.LIMIT_AMT
                            , PPMT.USE_CODE
                            , PPMT.OWN_COST
                            , PPMT.ENTP_COST
                            , PPMT.PROC_GB
                            , PPMT.PA_GROUP_CODE
                            , PPMT.INSERT_ID
                            , PPMT.MODIFY_ID
                            , PPMT.TRANS_DATE
                            , PPMT.INSERT_DATE
                            , PPMT.MODIFY_DATE
                            , PPMT.DO_COST
                            , PPMT.DO_OWN_COST
                            , PPMT.DO_ENTP_COST
                            , PPMT.EXCEPT_REASON
                            )
                         SELECT PM.PROMO_NO
                              , PM.PA_CODE
                              , PM.GOODS_CODE
                              , LPAD((SELECT MAX(PM1.SEQ) + 1 
                              	   FROM TPAPROMOTARGET PM1 
                              	  WHERE PM1.GOODS_CODE 	= #{goodsCode	, jdbcType=VARCHAR}
                              	  	AND PM1.PA_CODE 	= #{paCode		, jdbcType=VARCHAR}
                              	  	AND PM1.PROMO_NO 	= #{promoNo		, jdbcType=VARCHAR}
                              	  	), 4 ,'0')   
                              , PM.DO_TYPE
                              , PM.COUPON_YN
                              , PM.IMMEDIATELY_YN
                              , PM.PROMO_BDATE
                              , PM.PROMO_EDATE
                              , PM.AMT_RATE_FLAG
                              , PM.DO_RATE
                              , DECODE(#{doCost, jdbcType=NUMERIC}, 0 , 0 , PM.DO_AMT)
                              , PM.STANDARD_APP_AMT
                              , PM.LIMIT_AMT
                              , PM.USE_CODE
                              , DECODE(#{doCost, jdbcType=NUMERIC}, 0 , 0 , PM.OWN_COST)
                              , DECODE(#{doCost, jdbcType=NUMERIC}, 0 , 0 , PM.ENTP_COST)
                              , DECODE(PM.PROC_GB, 'I', 'U', PM.PROC_GB)
                              , PM.PA_GROUP_CODE 
                              , PM.INSERT_ID
                              , 'BATCH'
                              , SYSDATE
                              , SYSDATE
                              , SYSDATE
                              , DECODE(#{doCost, jdbcType=NUMERIC}, 0 , 0 , PM.DO_COST)
                              , DECODE(#{doCost, jdbcType=NUMERIC}, 0 , 0 , PM.DO_OWN_COST)
                              , DECODE(#{doCost, jdbcType=NUMERIC}, 0 , 0 , PM.DO_ENTP_COST)           
                              , DECODE(#{doCost, jdbcType=NUMERIC}, 0 , '마진률 초과  , 연동 예외 시간 : ' || TO_CHAR(SYSDATE , 'YYYY/MM/DD HH24:MI:SS') , '')                 
                           FROM TPAPROMOTARGET PM
                          WHERE PM.GOODS_CODE 	= #{goodsCode	, jdbcType=VARCHAR}
						    AND PM.PA_CODE 		= #{paCode		, jdbcType=VARCHAR}
							AND PM.PROMO_NO 	= #{promoNo		, jdbcType=VARCHAR}
					        AND PM.SEQ 			= #{seq			, jdbcType=VARCHAR}
     </insert>
     
     <update id="updatePaTmonGoodsImage"  parameterType="com.cware.netshopping.domain.PaTmonGoodsVO">
        UPDATE /* patmongoods.xml : patmon.patmongoods.updatePaTmonGoods by PaTmonGoodsController-goodsInsert */
               TPAGOODSIMAGE PI
           SET PI.TRANS_TARGET_YN = '0'
             , PI.MODIFY_ID = #{modifyId, jdbcType=VARCHAR}
             , PI.MODIFY_DATE = #{modifyDate, jdbcType=TIMESTAMP}
         WHERE PI.GOODS_CODE = #{goodsCode, jdbcType=VARCHAR}  
           AND PI.PA_GROUP_CODE = #{paGroupCode, jdbcType=VARCHAR}
    </update>
    
     <update id="updatePaTmonGoodsPrice"  parameterType="com.cware.netshopping.domain.PaTmonGoodsVO">
        UPDATE /* patmongoods.xml : patmon.patmongoods.updatePaTmonGoodsPrice by PaTmonGoodsController-goodsInsert */
               TPAGOODSPRICE PP
           SET PP.TRANS_ID = #{modifyId, jdbcType=VARCHAR}
             , PP.TRANS_DATE = SYSDATE 
             , PP.MODIFY_ID = #{modifyId, jdbcType=VARCHAR}
             , PP.MODIFY_DATE = #{modifyDate, jdbcType=TIMESTAMP}
         WHERE PP.GOODS_CODE = #{goodsCode, jdbcType=VARCHAR}  
           AND PP.PA_CODE = #{paCode, jdbcType=VARCHAR}
           AND PP.APPLY_DATE = #{applyDate, jdbcType=TIMESTAMP}
           AND PP.TRANS_DATE IS NULL
    </update>
     
	<update id="updatePaGoodsTarget" parameterType="com.cware.netshopping.domain.PaTmonGoodsVO">
        UPDATE TPAGOODSTARGET PGT /* patmongoods.xml : patmon.patmongoods.updatePaGoodsTarget by PaTmonGoodsController-goodsInsert */
           SET PGT.PA_GOODS_CODE = #{dealNo, jdbcType=VARCHAR}
             , PGT.PA_SALE_GB = #{paSaleGb, jdbcType=VARCHAR}
             , PGT.MODIFY_ID = #{modifyId, jdbcType=VARCHAR}
             , PGT.MODIFY_DATE = #{modifyDate, jdbcType=TIMESTAMP}
         WHERE PGT.PA_CODE = #{paCode, jdbcType=VARCHAR}
           AND PGT.GOODS_CODE = #{goodsCode, jdbcType=VARCHAR}
           AND PGT.PA_GOODS_CODE IS NULL
    </update>
    
	<update id="updatePaTmonGoodsOffer"  parameterType="com.cware.netshopping.domain.PaTmonGoodsVO">
        UPDATE /* patmongoods.xml : patmon.patmongoods.updatePaTmonGoodsOffer by PaTmonGoodsController */
               TPAGOODSOFFER PO
           SET PO.TRANS_TARGET_YN = '0'
             , PO.MODIFY_ID 	  = #{modifyId,    jdbcType=VARCHAR}
             , PO.MODIFY_DATE 	  = #{modifyDate,  jdbcType=TIMESTAMP}
         WHERE PO.GOODS_CODE 	  = #{goodsCode,   jdbcType=VARCHAR}  
           AND PO.PA_GROUP_CODE   = #{paGroupCode, jdbcType=VARCHAR}
    </update>
    
    <select id="selectPaTmonSellStateList" parameterType="hashMap" resultType="com.cware.netshopping.domain.PaTmonGoodsVO">
   		SELECT /* patmongoods.xml : patmon.patmongoods.selectPaTmonSellStateList by PaTmonGoodsController */
			   TG.PA_CODE
			 , TG.GOODS_CODE 
			 , TG.DEAL_NO
			 , TG.PA_SALE_GB
		  FROM TPATMONGOODS TG
		 WHERE TG.TRANS_SALE_YN = '1'
		   AND TG.DEAL_NO IS NOT NULL
		   AND TG.PA_STATUS IN ('30','90')
		   <if test='goodsCode != null and goodsCode != ""'>
           AND TG.GOODS_CODE    = #{goodsCode, jdbcType=VARCHAR}
           </if>
           <if test='paCode != null and paCode != ""'>
           AND TG.PA_CODE       = #{paCode, jdbcType=VARCHAR}
           </if>
	</select>
	
	<update id="updateTmonGoodsStatus"  parameterType="com.cware.netshopping.domain.PaTmonGoodsVO">
        UPDATE /* patmongoods.xml : patmon.patmongoods.updateTmonGoodsStatus by PaTmonGoodsController */
               TPATMONGOODS PD
           SET PD.MODIFY_ID   = #{modifyId,   jdbcType=VARCHAR}
             , PD.MODIFY_DATE = #{modifyDate, jdbcType=TIMESTAMP}
			 , PD.TRANS_SALE_YN = '0'
         WHERE PD.GOODS_CODE   = #{goodsCode,   jdbcType=VARCHAR}
           AND PD.PA_CODE      = #{paCode, 		jdbcType=VARCHAR}
    </update>
	
	<select id="selectPaTmonGoodsdtStockMappingList" parameterType="hashMap" resultType="com.cware.netshopping.domain.PaTmonGoodsdtMappingVO">
        SELECT /* patmongoods.xml : patmon.patmongoods.selectPaTmonGoodsdtStockMappingList by PaTmonGoodsController-goodsInsert */ 
               PD.GOODS_CODE
             , PD.GOODSDT_CODE
             , PD.GOODSDT_INFO_KIND
             , PD.GOODSDT_INFO
             , PM.PA_CODE
             , PM.PA_OPTION_CODE
             , DECODE(GT.SALE_GB, 00, CEIL(FUN_GET_ORDER_ABLE_QTY(PD.GOODS_CODE, PD.GOODSDT_CODE, GD.WH_CODE) * TC.CODE_GROUP), 0) AS TRANS_ORDER_ABLE_QTY
             , PG.DEAL_NO
          FROM TPAPRODUCTOPTION PD
             , TPAGOODSDTMAPPING PM
             , TPATMONGOODS PG
             , TGOODS GD
             , TCODE TC
             , TGOODSDT GT
             , TPAPRODUCT P
         WHERE PD.GOODS_CODE    = PM.GOODS_CODE
           AND PD.GOODSDT_CODE  = PM.GOODSDT_CODE
           AND PM.GOODS_CODE    = PG.GOODS_CODE
           AND PM.PA_CODE       = PG.PA_CODE
           AND GD.GOODS_CODE    = PG.GOODS_CODE
           AND TC.CODE_LGROUP   = 'O505'
           AND TC.CODE_MGROUP   = PG.PA_CODE
           AND PG.PA_SALE_GB    = '20'
           AND PG.PA_STATUS     = '30'
           AND GT.GOODS_CODE    = PD.GOODS_CODE
           AND GT.GOODSDT_CODE  = PD.GOODSDT_CODE
           AND PM.PA_OPTION_CODE IS NOT NULL
           AND PM.TRANS_ORDER_ABLE_QTY != DECODE(GT.SALE_GB, 00, CEIL(FUN_GET_ORDER_ABLE_QTY(PD.GOODS_CODE, PD.GOODSDT_CODE, GD.WH_CODE) * TC.CODE_GROUP), 0)
           <if test='goodsCode != null and goodsCode != ""'>
           AND PM.GOODS_CODE    = #{goodsCode, jdbcType=VARCHAR}
           </if>
           <if test='paCode != null and paCode != ""'>
           AND PM.PA_CODE       = #{paCode, jdbcType=VARCHAR}
           </if>
           AND P.GOODS_CODE = PG.GOODS_CODE
           AND P.SALE_GB = '00'
	  ORDER BY GT.GOODS_CODE, GT.GOODSDT_CODE
    </select>   
    
    <select id="selectPaTmonGoodsdtStockList" parameterType="hashMap" resultType="com.cware.netshopping.domain.PaTmonGoodsdtMappingVO">
        SELECT /* patmongoods.xml : patmon.patmongoods.selectPaTmonGoodsdtStockList by PaTmonGoodsController */
               DISTINCT PD.GOODS_CODE
             , PM.PA_CODE
             , PG.DEAL_NO
          FROM TPAPRODUCTOPTION PD
             , TPAGOODSDTMAPPING PM
             , TPATMONGOODS PG
             , TGOODS GD
             , TCODE TC
             , TGOODSDT GT
         WHERE PD.GOODS_CODE    = PM.GOODS_CODE
           AND PD.GOODSDT_CODE  = PM.GOODSDT_CODE
           AND PM.GOODS_CODE    = PG.GOODS_CODE
           AND PM.PA_CODE       = PG.PA_CODE
           AND GD.GOODS_CODE    = PG.GOODS_CODE
           AND TC.CODE_LGROUP   = 'O505'
           AND TC.CODE_MGROUP   = PG.PA_CODE
           AND PG.PA_SALE_GB    = '20'
           AND PG.PA_STATUS     = '30'
           AND GT.GOODS_CODE    = PD.GOODS_CODE
           AND GT.GOODSDT_CODE  = PD.GOODSDT_CODE
           AND PM.PA_OPTION_CODE IS NOT NULL 
           AND PM.TRANS_ORDER_ABLE_QTY != DECODE(GT.SALE_GB, 00, CEIL(FUN_GET_ORDER_ABLE_QTY(PD.GOODS_CODE, PD.GOODSDT_CODE, GD.WH_CODE) * TC.CODE_GROUP), 0)
           <if test='goodsCode != null and goodsCode != ""'>
           AND PM.GOODS_CODE    = #{goodsCode, jdbcType=VARCHAR}
           </if>
           <if test='paCode != null and paCode != ""'>
           AND PM.PA_CODE       = #{paCode, jdbcType=VARCHAR}
           </if>
           <if test='goodsCode == null or goodsCode == ""'>
   		   AND EXISTS ( SELECT 'X'
		                  FROM TPAPRODUCT P
		                 WHERE P.GOODS_CODE = PG.GOODS_CODE
		                   AND P.SALE_GB = '00')
   		   </if>
    </select>
    
     <update id="updatePaTmonGoodsdtMappingQty"  parameterType="com.cware.netshopping.domain.PaTmonGoodsdtMappingVO">
		UPDATE /* patmongoods.xml : patmon.patmongoods.updatePaTmonGoodsdtMappingQty by PaTmonGoodsController-goodsModify */
               TPAGOODSDTMAPPING PD
           SET PD.MODIFY_ID = #{modifyId, jdbcType=VARCHAR}
             , PD.MODIFY_DATE = #{modifyDate, jdbcType=VARCHAR}
             <if test='transOrderAbleQty != null and transOrderAbleQty != ""'>
             , PD.TRANS_ORDER_ABLE_QTY = #{transOrderAbleQty, jdbcType=VARCHAR}
             </if>
             <if test='transTargetYn != null and transTargetYn != ""'>
             , PD.TRANS_TARGET_YN = #{transTargetYn, jdbcType=VARCHAR}
             </if>
             <if test='paOptionCode != null and paOptionCode != ""'>
             , PD.PA_OPTION_CODE = #{paOptionCode, jdbcType=VARCHAR}
             </if>
         WHERE PD.GOODS_CODE = #{goodsCode, jdbcType=VARCHAR}
           AND PD.GOODSDT_CODE = #{goodsdtCode, jdbcType=VARCHAR}
           AND PD.PA_CODE = #{paCode, jdbcType=VARCHAR}
    </update>
    
    <select id="selectPaTmonGoodsdtAddedList" parameterType="hashMap" resultType="com.cware.netshopping.domain.PaTmonGoodsdtMappingVO">
		SELECT /* patmongoods.xml : patmon.patmongoods.selectPaTmonGoodsdtAddedList by PaTmonGoodsController-goodsInsert */ 
               PG.PA_CODE
			 , PG.GOODS_CODE
			 , DM.GOODSDT_CODE
             , DECODE(PD.GOODSDT_INFO,'없음','단일상품',PD.GOODSDT_INFO) AS GOODSDT_INFO
			 , DECODE(GD.SALE_GB, 00, NVL(CEIL(FUN_GET_ORDER_ABLE_QTY(PD.GOODS_CODE, PD.GOODSDT_CODE, GD.WH_CODE) * TC.CODE_GROUP), 0),0) AS TRANS_ORDER_ABLE_QTY
		  FROM TPATMONGOODS PG
			 , TPAGOODSDTMAPPING DM
			 , TGOODSDT PD
			 , TGOODS GD
			 , TCODE TC
		 WHERE PG.PA_CODE = DM.PA_CODE
		   AND PG.GOODS_CODE = DM.GOODS_CODE
		   AND DM.GOODS_CODE = PD.GOODS_CODE
		   AND DM.GOODSDT_CODE = PD.GOODSDT_CODE
		   AND PG.GOODS_CODE = GD.GOODS_CODE
		   AND TC.CODE_LGROUP   = 'O505'
		   AND TC.CODE_MGROUP   = PG.PA_CODE
		   AND DM.PA_OPTION_CODE IS NULL
		   AND PG.PA_CODE = #{paCode, jdbcType=VARCHAR}
		   AND PG.GOODS_CODE = #{goodsCode, jdbcType=VARCHAR}
		   AND PD.SALE_GB = '00'
	  ORDER BY DM.GOODS_CODE, DM.GOODSDT_CODE
    </select>
    
    <select id="selectPaTmonModifyOptionList" parameterType="hashMap" resultType="com.cware.netshopping.domain.PaTmonGoodsVO">
        SELECT /* patmongoods.xml : patmon.patmongoods.selectPaTmonModifyOptionList by PaTmonGoodsController-goodsModify */
        	   distinct PG.PA_CODE
        	 , PG.GOODS_CODE
        	 , PP.SALE_PRICE
        	 , PP.DC_AMT
        	 , PP.LUMP_SUM_DC_AMT
		  FROM TPATMONGOODS PG
			 , TPAGOODSDTMAPPING DM
			 , TPAGOODSPRICE PP
			 , TGOODS GD
			 , TCODE TC
		 WHERE PG.PA_SALE_GB = '20'
		   AND PG.PA_STATUS = '30'
		   AND PG.PA_CODE = DM.PA_CODE
		   AND PG.GOODS_CODE = DM.GOODS_CODE
		   AND PG.PA_CODE    = PP.PA_CODE
		   AND PG.GOODS_CODE = PP.GOODS_CODE
		   AND PP.ROWID = (SELECT /*+ INDEX_DESC (GP PK_TPAGOODSPRICE)*/
								  GP.ROWID
							 FROM TPAGOODSPRICE GP
							WHERE GP.GOODS_CODE = PG.GOODS_CODE
							  AND GP.APPLY_DATE &lt; SYSDATE
							  AND GP.PA_CODE = PG.PA_CODE
							  AND ROWNUM = 1)
		   AND DM.PA_OPTION_CODE IS NULL
		   AND PG.GOODS_CODE = GD.GOODS_CODE
		   AND TC.CODE_LGROUP   = 'O505'
		   AND TC.CODE_MGROUP   = PG.PA_CODE
		   AND DECODE(GD.SALE_GB, 00, CEIL(FUN_GET_ORDER_ABLE_QTY(DM.GOODS_CODE, DM.GOODSDT_CODE, GD.WH_CODE) * TC.CODE_GROUP), 0) > 0
    </select>
    
    <select id="selectPaPromoTarget" parameterType="hashMap" resultType="com.cware.netshopping.domain.model.PaPromoTarget">
	   SELECT /* patmongoods.xml: patmon.patmongoods.selectPaPromoTarget by PaTmonGoodsController */
	           PROC_GB 
		     , PROMO_NO
		     , PA_CODE
		     , GOODS_CODE
		     , SEQ
		     , TRANS_DATE
		     , DO_COST
		     , OWN_COST
		     , ENTP_COST
		     , INSERT_DATE
		     , ALCOUT_PROMO_YN
		     , PA_GROUP_CODE
         FROM (
		       SELECT PPMT.PROC_GB
		            , PPMT.PROMO_NO
		            , PPMT.PA_CODE
		            , PPMT.GOODS_CODE
		            , PPMT.SEQ
		            , PPMT.TRANS_DATE
		            , PPMT.DO_AMT AS DO_COST
		            , PPMT.OWN_COST
		            , PPMT.ENTP_COST
		            , PPMT.INSERT_DATE
		            , PM.ALCOUT_PROMO_YN
		            , PPMT.PA_GROUP_CODE
		         FROM TPAPROMOTARGET PPMT
		            , TPROMOM PM
		            , TPPROMOTARGET	 PT
		        WHERE PPMT.USE_CODE = '00'
		          AND PT.PROMO_NO 	= PM.PROMO_NO
		          AND PT.GOODS_CODE = PPMT.GOODS_CODE 
		          AND PT.GIFT_AMT	= DECODE(PPMT.AMT_RATE_FLAG ,1, PPMT.DO_AMT , PPMT.DO_RATE) 
		          AND SYSDATE BETWEEN PPMT.PROMO_BDATE AND PPMT.PROMO_EDATE
		          AND SYSDATE BETWEEN PM.PROMO_BDATE   AND PM.PROMO_EDATE
		          AND PPMT.GOODS_CODE 				= #{goodsCode		, jdbcType=VARCHAR}
		          AND PPMT.PA_CODE 					= #{paCode			, jdbcType=VARCHAR}
		          AND PPMT.PROMO_NO 				= PM.PROMO_NO
		          AND PM.COUPON_YN 					= '1'
		          AND PM.IMMEDIATELY_YN 			= '1'
		          AND NVL(PM.ALCOUT_PROMO_YN, '0') 	= #{alcoutPromoYn	, jdbcType=VARCHAR}
		          <if test='promoNo != null and promoNo != ""'>
		          AND PPMT.PROMO_NO					= #{promoNo			, jdbcType=VARCHAR}
		          </if>
		          AND PROC_GB 					   != 'D'         
				  AND PPMT.ROWID    				= (SELECT /*+INDEX_DESC (PTT IDX_TPAPROMOTARGET_02)*/
						          					   		  ROWID 
						          					     FROM TPAPROMOTARGET PTT
						          					    WHERE PTT.PROMO_NO    = PPMT.PROMO_NO
						          					      AND PTT.PA_CODE  	  = PPMT.PA_CODE
						          					      AND PTT.GOODS_CODE  = PPMT.GOODS_CODE
						          					      AND PTT.PROC_GB    != 'D'
						          					      AND PTT.USE_CODE    = '00'
						          					      AND PTT.DO_AMT  	  > 0
						          					      AND ROWNUM = 1 )
		          AND NOT EXISTS (
					        	   SELECT 'X'
					        		 FROM TPAPROMOTARGET PPMT3
					        	    WHERE PPMT3.PROMO_NO  		= PPMT.PROMO_NO
					        		  AND PPMT3.PA_CODE	 	 	= PPMT.PA_CODE
						              AND PPMT3.GOODS_CODE  	= PPMT.GOODS_CODE
					        	  	  AND PPMT3.INSERT_DATE 	> PPMT.INSERT_DATE
					        		  AND PPMT3.PROC_GB 	  	= 'D')
		          AND NOT EXISTS ( SELECT 'X'
		                             FROM TPAPROMOEXCEPTENTP PEE
		                            INNER JOIN TGOODS GD ON GD.ENTP_CODE = PEE.ENTP_CODE AND GD.GOODS_CODE = PPMT.GOODS_CODE
		                            LEFT OUTER JOIN TPAPROMOEXCEPTBRAND PEB ON PEE.ENTP_CODE = PEB.ENTP_CODE AND PEB.USE_YN = '1' AND PEB.BRAND_CODE = GD.BRAND_CODE
		                           WHERE (INSTR(PEE.PA_GROUP_CODE, '09') > 0  OR PEE.PA_GROUP_CODE_ALL_YN = 1)
		                             AND PEE.USE_YN = '1'
		                             AND ((PEE.ALL_BRAND_YN = '1' AND SYSDATE BETWEEN PEE.PA_EXCEPT_BDATE AND PEE.PA_EXCEPT_EDATE) 
		                             		OR (PEE.ALL_BRAND_YN = '0' AND SYSDATE BETWEEN PEB.PA_EXCEPT_BDATE AND PEB.PA_EXCEPT_EDATE)) )
		          AND NOT EXISTS ( SELECT 'X' 
		                     		 FROM TPAPROMOTARGETEXCEPT TPE
		                          		, TPAGOODSPRICE PGP
		                      		WHERE TPE.TARGET_CODE = PPMT.GOODS_CODE    
		                        	  AND TPE.USE_YN = '1'
		                       		  AND (INSTR(TPE.PA_GROUP_CODE, '09' ) > 0  OR TPE.PA_GROUP_CODE_ALL_YN = 1)
		                     		  AND SYSDATE BETWEEN TPE.PA_EXCEPT_BDATE AND TPE.PA_EXCEPT_EDATE 
		                     		  AND TPE.TARGET_GB = '00' 
		                     		  AND PGP.ROWID  = ( SELECT /*+ INDEX_DESC (GP PK_TPAGOODSPRICE)*/ 
		                                               			GP.ROWID
		                                				   FROM TPAGOODSPRICE GP
							                              WHERE GP.GOODS_CODE = PPMT.GOODS_CODE
							                                AND GP.APPLY_DATE &lt; SYSDATE
							                                AND GP.PA_CODE    = PPMT.PA_CODE
							                                AND ROWNUM = 1)            
		                       		  AND (PGP.SALE_PRICE - PGP.DC_AMT - PGP.LUMP_SUM_DC_AMT - PPMT.DO_AMT) >= TPE.PA_EXCEPT_MARGIN )
   	            ORDER BY PPMT.DO_AMT DESC )
	    WHERE ROWNUM = 1
    </select>
    
    <select id="selectPaPromoDeleteTarget" parameterType="hashMap" resultType="com.cware.netshopping.domain.model.PaPromoTarget">
        SELECT /* patmongoods.xml: patmon.patmongoods.selectPaPromoDeleteTarget by PaTmonGoodsController */
               /*+INDEX_DESC (PPMT IDX_TPAPROMOTARGET_02)*/
               PPMT.PROC_GB
             , PPMT.PROMO_NO
             , PPMT.PA_CODE
             , PPMT.GOODS_CODE
             , PPMT.SEQ
             , PPMT.TRANS_DATE
             , PPMT.DO_AMT AS DO_COST
             , PPMT.OWN_COST
             , PPMT.ENTP_COST
             , PPMT.INSERT_DATE
          FROM TPAPROMOTARGET PPMT
             , TPROMOM PM
         WHERE  PPMT.PROC_GB 				= 'D' 
           AND PPMT.TRANS_DATE 				IS NULL
           AND PPMT.PROMO_NO 				= PM.PROMO_NO
           AND PM.COUPON_YN 				= '1'
           AND PM.IMMEDIATELY_YN 			= '1'
           AND NVL(PM.ALCOUT_PROMO_YN, '0') = #{alcoutPromoYn	, jdbcType=VARCHAR}
           AND PPMT.GOODS_CODE 				= #{goodsCode		, jdbcType=VARCHAR}
           AND PPMT.PA_CODE 				= #{paCode			, jdbcType=VARCHAR}
           AND EXISTS 	  ( SELECT /*+INDEX_DESC (PPMT3 IDX_TPAPROMOTARGET_04)*/
          						   'X'
					          FROM TPAPROMOTARGET PPMT3
					         WHERE PPMT3.PROMO_NO  		= PPMT.PROMO_NO
					           AND PPMT3.PA_CODE	 	= PPMT.PA_CODE
						       AND PPMT3.GOODS_CODE     = PPMT.GOODS_CODE
					           AND PPMT3.INSERT_DATE &lt; PPMT.INSERT_DATE
					           AND PPMT3.TRANS_DATE    IS NOT NULL
					           AND PPMT3.PROC_GB 	   != 'D'
					           AND PPMT3.DO_AMT  	    > 0
					           AND ROWNUM 				= 1)
           AND ROWNUM = 1
    </select>
    
    <update id="updatePaTmonGoodsError"  parameterType="com.cware.netshopping.domain.PaTmonGoodsVO">
		UPDATE /* patmongoods.xml: patmon.patmongoods.updatePaTmonGoodsError by PaTmonGoodsController */
			   TPATMONGOODS TG 
		   SET TG.PA_SALE_GB  = #{paSaleGb, jdbcType=VARCHAR}
		     , TG.PA_STATUS	  = #{paStatus, jdbcType=VARCHAR}
		     , TG.RETURN_NOTE = #{returnNote, jdbcType=VARCHAR}
		     <if test='dealNo != null and dealNo != ""'>
             , TG.TRANS_SALE_YN = '1' 
             </if>
		 WHERE PA_CODE = #{paCode, jdbcType=VARCHAR} 
		   AND GOODS_CODE = #{goodsCode, jdbcType=VARCHAR} 
    </update>
    
     <select id="selectPaTmonExceptShipPolicy" parameterType="String" resultType="int">
		SELECT /* patmongoods.xml: patmon.patmongoods.selectPaOfferCheck by PaTmonGoodsController */
       		   COUNT(1)
          FROM TPATMONGOODSSHIPPOLICY TM
         WHERE TM.GOODS_CODE = #{goodsCode, jdbcType=VARCHAR}
	</select>
</mapper>
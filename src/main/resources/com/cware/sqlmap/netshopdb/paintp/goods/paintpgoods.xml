<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"
        "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">

<mapper namespace="paintp.goods">

    <select id="selectPaIntpEntpSlip" parameterType="hashMap" resultType="com.cware.netshopping.domain.model.PaEntpSlip">
        SELECT /* paIntpgoods.xml : paintp.paIntpgoods.selectPaIntpEntpSlip by PaIntpGoodsController-goodsInsert */
               distinct TE.ENTP_CODE
             , TE.ENTP_MAN_SEQ 
             , TE.ENTP_MAN_GB AS PA_ADDR_GB
             , PG.PA_CODE
          FROM TPAPRODUCT TG
             , TENTPUSER TE
             , TPAINTPGOODS PG
             , TGOODS GD
         WHERE DECODE(GD.DELY_TYPE,'10','100001',TG.ENTP_CODE) = TE.ENTP_CODE
           AND PG.GOODS_CODE = TG.GOODS_CODE
           AND PG.GOODS_CODE = GD.GOODS_CODE
           <if test ='paAddrGb == "20"'>
           AND DECODE(GD.DELY_TYPE,'10','002',TG.RETURN_MAN_SEQ) = TE.ENTP_MAN_SEQ
           </if>
           <if test ='modCase =="MODIFY"'>
           AND PG.TRANS_TARGET_YN = '1'
           </if>
           <if test='paCode != null and paCode != ""'>
           AND PG.PA_CODE = #{paCode, jdbcType=VARCHAR}
           </if>
           <if test='goodsCode != null and goodsCode != ""'>
           AND TG.GOODS_CODE = #{goodsCode, jdbcType=VARCHAR}
           </if>
           AND NOT EXISTS ( SELECT 'X'
                              FROM TPAENTPSLIP PS
                             WHERE PS.ENTP_CODE = TE.ENTP_CODE
                               AND PS.ENTP_MAN_SEQ = TE.ENTP_MAN_SEQ
                               AND PS.PA_CODE = PG.PA_CODE
                          )
    </select>
    
    <resultMap id="paIntpGoodsVOMap" type="com.cware.netshopping.domain.PaIntpGoodsVO">
		<result property="describeExt" column="DESCRIBE_EXT" jdbcType="CLOB" javaType="string" />
		<result property="noticeExt" column="NOTICE_EXT" jdbcType="CLOB" javaType="string" />
	</resultMap>
	
    <select id="selectPaIntpGoodsInfo" parameterType="hashMap" resultMap="paIntpGoodsVOMap">
        SELECT /* paintpgoods.xml : paintp.paintpgoods.selectPaIntpGoodsInfo by PaIntpGoodsController-goodsInsert */
        	   PG.PA_GROUP_CODE
        	 , PG.PA_CODE
        	 , PG.PRD_NO
        	 , PG.PA_LMSD_KEY
             , TG.GOODS_NAME
			 , MK.MAKECO_NAME
			 , T1.CODE_NAME AS ORIGIN_NAME
			 , T.TAX_YN
			 , T.TAX_SMALL_YN
			 , T.ADULT_YN
			 , PG.PA_SALE_GB
			 , PG.PA_STATUS
			 , PP.APPLY_DATE
			 , PP.SALE_PRICE
			 , PP.DC_AMT
			 , PP.LUMP_SUM_DC_AMT
			 , PP.LUMP_SUM_OWN_DC_AMT
			 , PP.LUMP_SUM_ENTP_DC_AMT
			 , CASE WHEN (CEIL(FUN_GET_ORDER_ABLE_QTY(PG.GOODS_CODE,'%', T.WH_CODE) * T2.CODE_GROUP)) > 99999 THEN 99998
		            ELSE CEIL(FUN_GET_ORDER_ABLE_QTY(PG.GOODS_CODE,'%', T.WH_CODE) * T2.CODE_GROUP)
		             END AS TRANS_ORDER_ABLE_QTY
			 , TO_CHAR(SYSDATE, 'YYYYMMDD') AS INTP_SALE_START_DATE
			 , NVL(TO_CHAR(T.SALE_END_DATE, 'YYYYMMDD'),'99991231') AS INTP_SALE_END_DATE
			 , SC.SHIP_COST_CODE
			 , SC.GROUP_CODE
			 , SC.ORD_COST
			 , SC.RETURN_COST
			 , ES.PA_ADDR_SEQ
			 , PG.BRAND_NO
			 , (SELECT AA.PA_BRAND_NAME FROM TPABRAND AA WHERE AA.PA_GROUP_CODE = PG.PA_GROUP_CODE AND AA.PA_BRAND_NO = PG.BRAND_NO) AS PA_BRAND_NAME
			 , TG.ORDER_MAX_QTY
			 , SC.JEJU_COST
			 , SC.ISLAND_COST
			 , PG.GOODS_CODE
			 , PI.IMAGE_URL
			 , PI.IMAGE_P
			 , PI.IMAGE_AP
			 , PI.IMAGE_BP
			 , PI.IMAGE_CP
			 , PGK.LIFE_CERT_YN
		     , PGK.ELECTRIC_CERT_YN
		     , PGK.CHILD_CERT_YN
		     , PGK.MEDICAL_YN
		     , PGK.HEALTH_YN
		     , PGK.FOOD_YN
			 , ( SELECT CODE_NAME
				   FROM TCODE C1
				  WHERE C1.CODE_LGROUP = 'O507'
					AND C1.CODE_MGROUP = PG.PA_CODE) AS TOP_IMAGE
			 , ( SELECT CODE_NAME
				   FROM TCODE C1
				  WHERE C1.CODE_LGROUP = 'O507'
					AND C1.CODE_MGROUP = DECODE(PG.PA_CODE,'71','73','74')) AS BOTTOM_IMAGE
			 , TG.COLLECT_YN
			 , PI.TRANS_TARGET_YN AS IMAGE_TRANS_YN
			 , (SELECT TSB.DESCRIBE_NOTE
			 		  FROM TDESCRIBE TSB
			 		 WHERE TSB.DESCRIBE_CODE = '200'
			 		   AND TSB.GOODS_CODE 	 = TG.GOODS_CODE) AS GOODS_COM
			 , DECODE(T.COLLECT_YN, '0', '', (SELECT CODE_NAME
                                                FROM TCODE C1
                                               WHERE C1.CODE_LGROUP = 'O507'
                                                 AND C1.CODE_MGROUP = '99')) AS COLLECT_IMAGE
             , NVL( (SELECT REPLACE (DS.DESCRIBE_EXT, chr(10), '')
                       FROM TDESCRIBE DS
                      WHERE DS.DESCRIBE_CODE ='998'
                        AND DS.GOODS_CODE = TG.GOODS_CODE),
                    (SELECT DECODE(DS.WEB_FLAG, '1',  REPLACE(DS.DESCRIBE_EXT, chr(10), ''), DS.DESCRIBE_NOTE)
                       FROM TDESCRIBE DS
                      WHERE DS.DESCRIBE_CODE ='999'
                        AND DS.GOODS_CODE = TG.GOODS_CODE) ) AS DESCRIBE_EXT
			 , (SELECT /*+ INDEX_DESC (TNM IDX_TPANOTICEM_03)*/
             			   TNM.NOTICE_EXT
					  FROM TPANOTICEM TNM
					     , TPANOTICETARGET TNT
					     , TPANOTICEAPPLY TNA
					 WHERE TNM.NOTICE_NO  = TNT.NOTICE_NO
					   AND TNT.GOODS_CODE = TG.GOODS_CODE
					   AND TNM.USE_CODE   = '00'
					   AND INSTR(TNM.PA_GROUP_CODE, PG.PA_GROUP_CODE) > 0
					   AND TNT.NOTICE_NO  = TNA.NOTICE_NO
					   AND TNT.GOODS_CODE = TNA.GOODS_CODE
					   AND TNA.PA_GROUP_CODE = PG.PA_GROUP_CODE
					   AND ROWNUM = 1) AS NOTICE_EXT
		     , T.INSTALL_YN
		     , PG.PROHIBITID_YN
		     , T.BRAND_CODE AS STOA_BRAND_CODE
		     , T.LGROUP
		  FROM TPAPRODUCT TG
			 , TPAINTPGOODS PG
			 , TPAGOODSIMAGE PI
			 , TPAGOODSKINDS PGK
			 , TGOODS T
			 , TPAGOODSPRICE PP
			 , TMAKECOMP MK
			 , TPACUSTSHIPCOST SC
			 , TPAENTPSLIP ES
			 , TCODE T1
			 , TCODE T2
		 WHERE TG.GOODS_CODE = PG.GOODS_CODE
		   AND PI.GOODS_CODE = PG.GOODS_CODE
		   AND PI.PA_GROUP_CODE = PG.PA_GROUP_CODE 
		   AND PGK.PA_LMSD_KEY = PG.PA_LMSD_KEY
		   AND PGK.PA_GROUP_CODE = PG.PA_GROUP_CODE
		   AND PG.GOODS_CODE = T.GOODS_CODE
		   AND PP.GOODS_CODE = PG.GOODS_CODE
		   AND PP.PA_CODE = PG.PA_CODE
		   AND PP.ROWID = (SELECT /*+ INDEX_DESC (GP PK_TPAGOODSPRICE)*/
								  GP.ROWID
							 FROM TPAGOODSPRICE GP
							WHERE GP.GOODS_CODE = PG.GOODS_CODE
							  AND GP.APPLY_DATE &lt; SYSDATE
							  AND GP.PA_CODE = PG.PA_CODE
							  AND ROWNUM = 1)
		   AND T.MAKECO_CODE = MK.MAKECO_CODE
		   AND SC.PA_CODE = PG.PA_CODE
		   AND SC.ENTP_CODE = DECODE(T.DELY_TYPE,'10','100001',TG.ENTP_CODE)
		   AND SC.SHIP_COST_CODE = TG.SHIP_COST_CODE
		   AND SC.GROUP_CODE IS NOT NULL
		   AND ES.PA_CODE = PG.PA_CODE
		   AND ES.ENTP_CODE = DECODE(T.DELY_TYPE,'10','100001',TG.ENTP_CODE)
		   AND ES.ENTP_MAN_SEQ = DECODE(T.DELY_TYPE,'10','002',TG.RETURN_MAN_SEQ)       
		   AND T1.CODE_LGROUP = 'B023'
		   AND T.ORIGIN_CODE = T1.CODE_MGROUP
		   AND T2.CODE_LGROUP = 'O505'
		   AND T2.CODE_MGROUP = PG.PA_CODE
		   <!-- AND NVL(T.SALE_END_DATE,SYSDATE+1) > SYSDATE -->
		<if test='goodsCode != null and goodsCode != ""'>
			AND TG.GOODS_CODE = #{goodsCode, jdbcType=VARCHAR}
		</if>
		<if test='paCode != null and paCode != ""'>
			AND PG.PA_CODE = #{paCode, jdbcType=VARCHAR}
		</if>
		<if test='modCase == "MODIFY"'>
			AND ((PG.TRANS_TARGET_YN = '1' AND PG.PA_SALE_GB = '20') 
			  OR (PG.TRANS_SALE_YN = '1' AND PG.PA_SALE_GB = '30')) 
			AND PG.PA_STATUS IN ('30', '90')
		</if>
		<if test='modCase == "INSERT"'>
			AND PG.PA_STATUS IN  ('10', '20')
			AND TG.SALE_GB IN ('00')
		    AND PG.PA_SALE_GB = '20'
			AND NVL(T.SALE_END_DATE,SYSDATE+1) > SYSDATE
		</if>

			AND ROWNUM &lt; 50000
		ORDER BY PG.MODIFY_DATE
    </select>
    
    <select id="selectPaIntpGoodsOfferList" parameterType="hashMap" resultType="com.cware.netshopping.domain.PaGoodsOfferVO">
        SELECT /* paintpgoods.xml : paintp.paintpgoods.selectPaIntpGoodsOfferList by PaIntpGoodsController-goodsInsert */
               PO.GOODS_CODE
             , PO.PA_GROUP_CODE
             , PO.PA_OFFER_TYPE
             , PO.PA_OFFER_CODE 
             , PO.PA_OFFER_EXT
             , PC.REMARK AS REMARK1
             , PO.REMARK2
             , PC.PA_OFFER_TYPE_NAME
             , PC.PA_OFFER_CODE_NAME
          FROM TPAGOODSOFFER PO, TPAOFFERCODE PC
         WHERE PO.PA_GROUP_CODE = PC.PA_GROUP_CODE  
           AND PO.PA_OFFER_TYPE = PC.PA_OFFER_TYPE 
           AND PO.PA_OFFER_CODE = PC.PA_OFFER_CODE  
           AND PO.GOODS_CODE = #{goodsCode, jdbcType=VARCHAR}
           AND PO.PA_GROUP_CODE = #{paGroupCode, jdbcType=VARCHAR}
           AND PO.USE_YN = '1'
    </select>
    
    <select id="selectPaIntpGoodsdtInfoList" parameterType="hashMap" resultType="com.cware.netshopping.domain.model.PaGoodsdtMapping">
        SELECT /* paintpgoods.xml : paintp.paintpgoods.selectPaIntpGoodsdtInfoList by PaIntpGoodsController-goodsInsert */ 
               PD.GOODS_CODE 
             , DM.PA_CODE
             , PD.GOODSDT_CODE
             , DECODE(PD.GOODSDT_INFO,'없음','단일상품',PD.GOODSDT_INFO) AS GOODSDT_INFO
             , DECODE(PD.GOODSDT_INFO_KIND,'없음','단일상품',PD.GOODSDT_INFO_KIND) AS GOODSDT_INFO_KIND
             , DECODE(DT.SALE_GB, 00, NVL(CEIL(FUN_GET_ORDER_ABLE_QTY(PD.GOODS_CODE, PD.GOODSDT_CODE, GD.WH_CODE) * TC.CODE_GROUP), 0), 0) AS TRANS_ORDER_ABLE_QTY
             , PD.SORT_TYPE 
             , DM.PA_OPTION_CODE
             , DM.TRANS_TARGET_YN
             , DT.SALE_GB
          FROM TPAPRODUCTOPTION PD
             , TPAGOODSDTMAPPING DM
             , TGOODS GD
             , TCODE TC
             , TGOODSDT DT
         WHERE PD.GOODS_CODE = DM.GOODS_CODE
           AND PD.GOODSDT_CODE = DM.GOODSDT_CODE
           AND PD.GOODS_CODE = GD.GOODS_CODE
           AND TC.CODE_LGROUP = 'O505'
           AND TC.CODE_MGROUP = DM.PA_CODE
           AND DT.GOODS_CODE = PD.GOODS_CODE
           AND DT.GOODSDT_CODE = PD.GOODSDT_CODE
           AND DM.PA_CODE = #{paCode, jdbcType=VARCHAR}
           AND GD.GOODS_CODE = #{goodsCode, jdbcType=VARCHAR}
         ORDER BY PD.GOODS_CODE
                , PD.GOODSDT_CODE
    </select>
    
    <update id="updatePaIntpGoods"  parameterType="com.cware.netshopping.domain.PaIntpGoodsVO">
        UPDATE /* paintpgoods.xml : paintp.paintpgoods.updatePaIntpGoods by PaIntpGoodsController-goodsInsert */
               TPAINTPGOODS PG
           SET PG.PRD_NO = #{prdNo, jdbcType=VARCHAR}
             , PG.PA_STATUS = #{paStatus, jdbcType=VARCHAR}
             <choose>
                <when test="transOrderAbleQty > 99999999" >
                , PG.TRANS_ORDER_ABLE_QTY = 99999999
                </when>
                <otherwise>
                , PG.TRANS_ORDER_ABLE_QTY = #{transOrderAbleQty, jdbcType=NUMERIC}
                </otherwise>
             </choose>
             <choose>
             	<when test='returnNote != null and returnNote != ""'>
             		, PG.RETURN_NOTE = #{returnNote, jdbcType=VARCHAR}
             	</when>
             	<otherwise>
             	    , PG.RETURN_NOTE = ''
             	</otherwise>
             </choose>
             , PG.PA_SALE_GB = #{paSaleGb, jdbcType=VARCHAR}
             , PG.TRANS_TARGET_YN = '0'
             , PG.TRANS_SALE_YN = '0'
             , PG.MODIFY_ID = #{modifyId, jdbcType=VARCHAR}
             , PG.MODIFY_DATE = #{modifyDate, jdbcType=TIMESTAMP}
         WHERE PG.GOODS_CODE = #{goodsCode, jdbcType=VARCHAR}  
           AND PG.PA_CODE = #{paCode, jdbcType=VARCHAR}  
    </update>
    
    <update id="updatePaIntpGoodsdt"  parameterType="com.cware.netshopping.domain.model.PaGoodsdtMapping">
        UPDATE /* paintpgoods.xml : paintp.paintpgoods.updatePaIntpGoodsdt by PaIntpGoodsController-goodsInsert */
               TPAGOODSDTMAPPING PD
           SET PD.TRANS_TARGET_YN = '0'
             , PD.MODIFY_ID = #{modifyId, jdbcType=VARCHAR}
             , PD.MODIFY_DATE = #{modifyDate, jdbcType=TIMESTAMP}
             <if test='paOptionCode != null and paOptionCode != ""'>
             , PD.PA_OPTION_CODE = #{paOptionCode, jdbcType=VARCHAR}
             </if>
             <if test='transOrderAbleQty != null and transOrderAbleQty != ""'>
             , PD.TRANS_ORDER_ABLE_QTY = #{transOrderAbleQty, jdbcType=NUMERIC}
              </if>
         WHERE PD.GOODS_CODE = #{goodsCode, jdbcType=VARCHAR}
           AND PD.GOODSDT_CODE = #{goodsdtCode, jdbcType=VARCHAR}
           AND PD.PA_CODE = #{paCode, jdbcType=VARCHAR} 
    </update>
    
    <update id="updatePaIntpGoodsImage"  parameterType="com.cware.netshopping.domain.PaIntpGoodsVO">
        UPDATE /* paintpgoods.xml : paintp.paintpgoods.updatePaIntpGoods by PaIntpGoodsController-goodsInsert */
               TPAGOODSIMAGE PI
           SET PI.TRANS_TARGET_YN = '0'
             , PI.MODIFY_ID = #{modifyId, jdbcType=VARCHAR}
             , PI.MODIFY_DATE = #{modifyDate, jdbcType=TIMESTAMP}
         WHERE PI.GOODS_CODE = #{goodsCode, jdbcType=VARCHAR}  
           AND PI.PA_GROUP_CODE = #{paGroupCode, jdbcType=VARCHAR}  
    </update>
    
    <update id="updatePaIntpGoodsPrice"  parameterType="com.cware.netshopping.domain.PaIntpGoodsVO">
        UPDATE /* paintpgoods.xml : paintp.paintpgoods.updatePaIntpGoods by PaIntpGoodsController-goodsInsert */
               TPAGOODSPRICE PP
           SET PP.TRANS_ID = #{modifyId, jdbcType=VARCHAR}
             , PP.TRANS_DATE = SYSDATE 
             , PP.MODIFY_ID = #{modifyId, jdbcType=VARCHAR}
             , PP.MODIFY_DATE = #{modifyDate, jdbcType=TIMESTAMP}
         WHERE PP.GOODS_CODE = #{goodsCode, jdbcType=VARCHAR}  
           AND PP.PA_CODE = #{paCode, jdbcType=VARCHAR}
           AND PP.APPLY_DATE = #{applyDate, jdbcType=TIMESTAMP}
           AND PP.TRANS_DATE IS NULL
    </update>
    
    <update id="updatePaGoodsTarget" parameterType="com.cware.netshopping.domain.PaIntpGoodsVO">
        UPDATE TPAGOODSTARGET PGT /* paintpgoods.xml : paintp.paintpgoods.updatePaGoodsTarget by PaIntpGoodsController-goodsInsert */
           SET PGT.PA_GOODS_CODE = #{prdNo, jdbcType=VARCHAR}
             , PGT.PA_SALE_GB = #{paSaleGb, jdbcType=VARCHAR}
             , PGT.MODIFY_ID = #{modifyId, jdbcType=VARCHAR}
             , PGT.MODIFY_DATE = #{modifyDate, jdbcType=TIMESTAMP}
         WHERE PGT.PA_CODE = #{paCode, jdbcType=VARCHAR}
           AND PGT.GOODS_CODE = #{goodsCode, jdbcType=VARCHAR}
           AND PGT.PA_GOODS_CODE IS NULL
    </update>
    
    <update id="updatePaIntpCustShipCost"  parameterType="com.cware.netshopping.domain.PaIntpGoodsVO">
        UPDATE /* paintpgoods.xml : paintp.paintpgoods.updatePaIntpCustShipCost by PaIntpGoodsController-goodsInsert */
               TPACUSTSHIPCOST PS
           SET PS.TRANS_TARGET_YN = '0'
             , PS.MODIFY_ID = #{modifyId, jdbcType=VARCHAR}
             , PS.MODIFY_DATE = #{modifyDate, jdbcType=TIMESTAMP}
         WHERE PS.ENTP_CODE = #{entpCode, jdbcType=VARCHAR}  
           AND PS.PA_CODE = #{paCode, jdbcType=VARCHAR}
           AND PS.SHIP_COST_CODE = #{shipCostCode, jdbcType=VARCHAR}
    </update>
    
    <update id="updatePaIntpGoodsOffer"  parameterType="com.cware.netshopping.domain.PaIntpGoodsVO">
        UPDATE /* paintpgoods.xml : paintp.paintpgoods.updatePaIntpGoodsOffer by PaIntpGoodsController-goodsInsert */
               TPAGOODSOFFER PO
           SET PO.TRANS_TARGET_YN = '0'
             , PO.MODIFY_ID = #{modifyId, jdbcType=VARCHAR}
             , PO.MODIFY_DATE = #{modifyDate, jdbcType=TIMESTAMP}
         WHERE PO.GOODS_CODE = #{goodsCode, jdbcType=VARCHAR}  
           AND PO.PA_GROUP_CODE = #{paGroupCode, jdbcType=VARCHAR}
    </update>
    
    <select id="selectPaIntpGoodsdtMappingStockList" parameterType="hashMap" resultType="com.cware.netshopping.domain.PaIntpGoodsdtMappingVO">
        SELECT /* paintpgoods.xml : paintp.paintpgoods.selectPaIntpGoodsdtMappingStockList by PaIntpGoodsController-goodsStockModify */
               PD.GOODS_CODE
             , PD.GOODSDT_CODE
             , PD.GOODSDT_INFO_KIND
             , PD.GOODSDT_INFO
             , PM.PA_CODE
             , PM.PA_OPTION_CODE
             , CASE WHEN (DECODE(GT.SALE_GB, 00, CEIL(FUN_GET_ORDER_ABLE_QTY(PD.GOODS_CODE, PD.GOODSDT_CODE, GD.WH_CODE) * TC.CODE_GROUP), 0)) > 99999 THEN 99998
                    ELSE DECODE(GT.SALE_GB, 00, CEIL(FUN_GET_ORDER_ABLE_QTY(PD.GOODS_CODE, PD.GOODSDT_CODE, GD.WH_CODE) * TC.CODE_GROUP), 0)
                     END AS TRANS_ORDER_ABLE_QTY
             , PG.PRD_NO
          FROM TPAPRODUCTOPTION PD
             , TPAGOODSDTMAPPING PM
             , TPAINTPGOODS PG
             , TGOODS GD
             , TCODE TC
             , TGOODSDT GT
             , TPAPRODUCT P
         WHERE PD.GOODS_CODE    = PM.GOODS_CODE
           AND PD.GOODSDT_CODE  = PM.GOODSDT_CODE
           AND PM.GOODS_CODE    = PG.GOODS_CODE
           AND PM.PA_CODE       = PG.PA_CODE
           AND GD.GOODS_CODE    = PG.GOODS_CODE
           AND TC.CODE_LGROUP   = 'O505'
           AND TC.CODE_MGROUP   = PG.PA_CODE
           AND PG.PA_SALE_GB    = '20'
           AND PG.PA_STATUS     = '30'
           AND GT.GOODS_CODE    = PD.GOODS_CODE
           AND GT.GOODSDT_CODE  = PD.GOODSDT_CODE
           AND PM.TRANS_ORDER_ABLE_QTY != DECODE(GT.SALE_GB, 00, CEIL(FUN_GET_ORDER_ABLE_QTY(PD.GOODS_CODE, PD.GOODSDT_CODE, GD.WH_CODE) * TC.CODE_GROUP), 0)
           <if test='goodsCode != null and goodsCode != ""'>
           AND PM.GOODS_CODE    = #{goodsCode, jdbcType=VARCHAR}
           </if>
           <if test='paCode != null and paCode != ""'>
           AND PM.PA_CODE       = #{paCode, jdbcType=VARCHAR}
           </if>
           AND P.GOODS_CODE = PG.GOODS_CODE
           AND P.SALE_GB = '00'
	  ORDER BY GT.GOODS_CODE, GT.GOODSDT_CODE
    </select>
    
    <update id="updatePaIntpGoodsdtMappingQty"  parameterType="com.cware.netshopping.domain.PaIntpGoodsdtMappingVO">
        UPDATE /* paintpgoods.xml : paintp.paintpgoods.updatePaIntpGoodsdtMappingQty by PaIntpGoodsController-goodsModify */
               TPAGOODSDTMAPPING PD
           SET PD.MODIFY_ID = #{modifyId, jdbcType=VARCHAR}
             , PD.MODIFY_DATE = SYSDATE
             <if test='transOrderAbleQty != null and transOrderAbleQty != ""'>
             , PD.TRANS_ORDER_ABLE_QTY = #{transOrderAbleQty, jdbcType=VARCHAR}
             </if>
             <if test='paOptionCode != null and paOptionCode != ""'>
             , PD.PA_OPTION_CODE = #{paOptionCode, jdbcType=VARCHAR}
             </if>
         WHERE PD.GOODS_CODE = #{goodsCode, jdbcType=VARCHAR}
           AND PD.GOODSDT_CODE = #{goodsdtCode, jdbcType=VARCHAR}
           AND PD.PA_CODE = #{paCode, jdbcType=VARCHAR}
    </update>
    
    <select id="selectEmptyPaOptionCodeList" parameterType="hashMap" resultType="com.cware.netshopping.domain.PaIntpGoodsdtMappingVO">
	SELECT GOODS_CODE
		 , PRD_NO
		 , PA_CODE
	  FROM (
        SELECT /* paintpgoods.xml : paintp.paintpgoods.selectEmptyPaOptionCodeList by PaIntpGoodsController-goodsStockModify */
               DISTINCT PM.GOODS_CODE
             , PG.PRD_NO
             , PG.PA_CODE
             , PG.MODIFY_DATE
          FROM TPAINTPGOODS PG, TPAGOODSDTMAPPING PM
         WHERE PG.GOODS_CODE	= PM.GOODS_CODE
           AND PG.PA_CODE		= PM.PA_CODE
           AND PG.PA_SALE_GB	= '20'
           AND PG.PA_STATUS		= '30'
           AND PM.TRANS_ORDER_ABLE_QTY > 0
           AND PM.PA_OPTION_CODE IS NULL
           <if test='goodsCode != null and goodsCode != ""'>
           AND PG.GOODS_CODE    = #{goodsCode, jdbcType=VARCHAR}
           </if>
           <if test='paCode != null and paCode != ""'>
           AND PG.PA_CODE       = #{paCode, jdbcType=VARCHAR}
           </if>
           ORDER BY PG.MODIFY_DATE
           )
           WHERE rownum &lt; 2000           
	  ORDER BY PA_CODE, GOODS_CODE
    </select>
    
    <!-- 
    <select id="selectPaPromoTarget" parameterType="hashMap" resultType="com.cware.netshopping.domain.model.PaPromoTarget">
        SELECT /* paintpgoods.xml : paintp.paintpgoods.selectPaPromoTarget by PaIntpGoodsControlle */
               /*+INDEX_DESC (PPMT IDX_TPAPROMOTARGET_02)*/
               DECODE(PPMT.USE_CODE, '00', PPMT.PROC_GB, 'D') AS PROC_GB
             , PPMT.PROMO_NO
             , PPMT.PA_CODE
             , PPMT.GOODS_CODE
             , PPMT.SEQ
             , PPMT.TRANS_DATE
             , PPMT.DO_AMT AS DO_COST
             , PPMT.OWN_COST
             , PPMT.ENTP_COST
             , PPMT.INSERT_DATE
          FROM TPAPROMOTARGET PPMT
              ,TPROMOM PM
         WHERE (SYSDATE BETWEEN PPMT.PROMO_BDATE AND PPMT.PROMO_EDATE OR (SYSDATE > PPMT.PROMO_EDATE AND PPMT.PROC_GB = 'D'))
           AND PPMT.GOODS_CODE = #{goodsCode, jdbcType=VARCHAR}
           AND PPMT.PA_CODE = #{paCode, jdbcType=VARCHAR}
           AND PPMT.PROMO_NO = PM.PROMO_NO
           AND PM.COUPON_YN = '1'
           AND PM.IMMEDIATELY_YN = '1'
           AND NVL(PM.ALCOUT_PROMO_YN, '0') = '0'
           AND ROWNUM = 1
        UNION ALL
        SELECT /*+INDEX_DESC (PPMT IDX_TPAPROMOTARGET_02)*/
               DECODE(PPMT.USE_CODE, '00', PPMT.PROC_GB, 'D') AS PROC_GB
             , PPMT.PROMO_NO
             , PPMT.PA_CODE
             , PPMT.GOODS_CODE
             , PPMT.SEQ
             , PPMT.TRANS_DATE
             , PPMT.DO_AMT AS DO_COST
             , PPMT.OWN_COST
             , PPMT.ENTP_COST
             , PPMT.INSERT_DATE
          FROM TPAPROMOTARGET PPMT
              ,TPROMOM PM
         WHERE (SYSDATE BETWEEN PPMT.PROMO_BDATE AND PPMT.PROMO_EDATE OR (SYSDATE > PPMT.PROMO_EDATE AND PPMT.PROC_GB = 'D'))
           AND PPMT.GOODS_CODE = #{goodsCode, jdbcType=VARCHAR}
           AND PPMT.PA_CODE = #{paCode, jdbcType=VARCHAR}
           AND PPMT.PROMO_NO = PM.PROMO_NO
           AND PM.COUPON_YN = '1'
           AND PM.IMMEDIATELY_YN = '1'
           AND NVL(PM.ALCOUT_PROMO_YN, '0') = '1'
           AND ROWNUM = 1
    </select>
     -->
    <update id="updatePaPromoTarget"  parameterType="com.cware.netshopping.domain.model.PaPromoTarget">
        UPDATE /* paintpgoods.xml : paintp.paintpgoods.updatePaCopnGoodsOffer by PaIntpgoodsController */
               TPAPROMOTARGET PPMT
           SET PPMT.MODIFY_ID     = #{modifyId, jdbcType=VARCHAR}
			   <choose>
			   <when test='doCost != null and doCost == 0 '>
			 , PPMT.EXCEPT_REASON =  '마진률 초과  , 연동 예외 시간 : ' || TO_CHAR(SYSDATE , 'YYYY/MM/DD HH24:MI:SS')
			   </when>
			   <otherwise>
			 , PPMT.TRANS_DATE    = SYSDATE
			 , PPMT.EXCEPT_REASON = NULL
			   </otherwise>
			   </choose>  
             , PPMT.MODIFY_DATE   = #{modifyDate, jdbcType=TIMESTAMP}
         WHERE PPMT.PROMO_NO      = #{promoNo, jdbcType=VARCHAR}
           AND PPMT.PA_CODE       = #{paCode, jdbcType=VARCHAR}
           AND PPMT.GOODS_CODE    = #{goodsCode, jdbcType=VARCHAR}
           AND PPMT.SEQ           = #{seq, jdbcType=VARCHAR}
    </update>
    
    
    <!-- 상품명 제한 문자 조회, PA_GROUP_CODE 07이나 현재는 G/A 모두 대상 -->
    <select id="selectGoodsLimitCharList" parameterType="String" resultType="hashMap" >
       SELECT /* paintpgoods.xml : paintp.paintpgoods.selectGoodsLimitCharList by PaIntpGoodsController */
		       GLC.SEQ,
		       GLC.PA_GROUP_CODE,
		       CASE WHEN GLC.ADD_CHAR = '1'
		            THEN '\' || GLC.LIMIT_CHAR
		            WHEN GLC.ADD_CHAR = '2'
		            THEN '[' || GLC.LIMIT_CHAR || ']'
		            ELSE GLC.LIMIT_CHAR
		       END AS LIMIT_CHAR, 
		       GLC.REPLACE_CHAR
		  FROM TPAGOODSLIMITCHAR GLC
		 WHERE GLC.PA_GROUP_CODE = '07'
		   AND GLC.USE_YN = '1'
		ORDER BY GLC.SEQ
    </select>
    
    <select id="selectPaIntpGoodsdtMappingStock" parameterType="hashMap" resultType="com.cware.netshopping.domain.PaIntpGoodsdtMappingVO">
        SELECT /* paintpgoods.xml : paintp.paintpgoods.selectPaIntpGoodsdtMappingStock by PaIntpGoodsController-goodsStockModify */
               DISTINCT PD.GOODS_CODE
             , PM.PA_CODE
             , PG.PRD_NO
          FROM TPAPRODUCTOPTION PD
             , TPAGOODSDTMAPPING PM
             , TPAINTPGOODS PG
             , TGOODS GD
             , TCODE TC
             , TGOODSDT GT
         WHERE PD.GOODS_CODE    = PM.GOODS_CODE
           AND PD.GOODSDT_CODE  = PM.GOODSDT_CODE
           AND PM.GOODS_CODE    = PG.GOODS_CODE
           AND PM.PA_CODE       = PG.PA_CODE
           AND GD.GOODS_CODE    = PG.GOODS_CODE
           AND TC.CODE_LGROUP   = 'O505'
           AND TC.CODE_MGROUP   = PG.PA_CODE
           AND PG.PA_SALE_GB    = '20'
           AND PG.PA_STATUS     = '30'
           AND GT.GOODS_CODE    = PD.GOODS_CODE
           AND GT.GOODSDT_CODE  = PD.GOODSDT_CODE
           AND PM.TRANS_ORDER_ABLE_QTY != DECODE(GT.SALE_GB, 00, CEIL(FUN_GET_ORDER_ABLE_QTY(PD.GOODS_CODE, PD.GOODSDT_CODE, GD.WH_CODE) * TC.CODE_GROUP), 0)
           <if test='goodsCode != null and goodsCode != ""'>
           AND PM.GOODS_CODE    = #{goodsCode, jdbcType=VARCHAR}
           </if>
           <if test='paCode != null and paCode != ""'>
           AND PM.PA_CODE       = #{paCode, jdbcType=VARCHAR}
           </if>
           <if test='goodsCode == null or goodsCode == ""'>
   		   AND EXISTS ( SELECT 'X'
		                  FROM TPAPRODUCT P
		                 WHERE P.GOODS_CODE = PG.GOODS_CODE
		                   AND P.SALE_GB = '00')
   		   </if>
    </select>
    
    <select id="selectPaPromoTarget" parameterType="hashMap" resultType="com.cware.netshopping.domain.model.PaPromoTarget">
	   SELECT /* paintpgoods.xml : paintp.paintpgoods.selectPaPromoTarget by PaIntpGoodsController */
	           PROC_GB 
		     , PROMO_NO
		     , PA_CODE
		     , GOODS_CODE
		     , SEQ
		     , TRANS_DATE
		     , DO_COST
		     , OWN_COST
		     , ENTP_COST
		     , INSERT_DATE
			 , ALCOUT_PROMO_YN
			 , PA_GROUP_CODE
         FROM (
		       SELECT PPMT.PROC_GB
		            , PPMT.PROMO_NO
		            , PPMT.PA_CODE
		            , PPMT.GOODS_CODE
		            , PPMT.SEQ
		            , PPMT.TRANS_DATE
		            , PPMT.DO_AMT AS DO_COST
		            , PPMT.OWN_COST
		            , PPMT.ENTP_COST
		            , PPMT.INSERT_DATE
					, PM.ALCOUT_PROMO_YN
					, PPMT.PA_GROUP_CODE
		         FROM TPAPROMOTARGET PPMT
		            , TPROMOM PM
		            , TPPROMOTARGET	 PT
		        WHERE PPMT.USE_CODE = '00'
		          AND PT.PROMO_NO 	= PM.PROMO_NO
		          AND PT.GOODS_CODE = PPMT.GOODS_CODE 
		          AND PT.GIFT_AMT	= DECODE(PPMT.AMT_RATE_FLAG ,1, PPMT.DO_AMT , PPMT.DO_RATE) 
		          AND SYSDATE BETWEEN PPMT.PROMO_BDATE AND PPMT.PROMO_EDATE
		          AND SYSDATE BETWEEN PM.PROMO_BDATE   AND PM.PROMO_EDATE
		          AND PPMT.GOODS_CODE 				= #{goodsCode		, jdbcType=VARCHAR}
		          AND PPMT.PA_CODE 					= #{paCode			, jdbcType=VARCHAR}
		          <if test='promoNo != null and promoNo != ""'>
		          AND PPMT.PROMO_NO					= #{promoNo			, jdbcType=VARCHAR}
		          </if>
		          AND PPMT.PROMO_NO 				= PM.PROMO_NO
		          AND PM.COUPON_YN 					= '1'
		          AND PM.IMMEDIATELY_YN 			= '1'
		          AND NVL(PM.ALCOUT_PROMO_YN, '0') 	= #{alcoutPromoYn	, jdbcType=VARCHAR}
		          AND PROC_GB 					   != 'D'         
				  AND PPMT.ROWID    				= (SELECT /*+INDEX_DESC (PTT IDX_TPAPROMOTARGET_02)*/
						          					   		  ROWID 
						          					     FROM TPAPROMOTARGET PTT
						          					    WHERE PTT.PROMO_NO    = PPMT.PROMO_NO
						          					      AND PTT.PA_CODE  	  = PPMT.PA_CODE
						          					      AND PTT.GOODS_CODE  = PPMT.GOODS_CODE
						          					      AND PTT.PROC_GB    != 'D'
						          					      AND PTT.USE_CODE    = '00'
						          					      AND PTT.DO_AMT  	  > 0
						          					      AND ROWNUM = 1 )
		          AND NOT EXISTS (
					        	   SELECT 'X'
					        		 FROM TPAPROMOTARGET PPMT3
					        	    WHERE PPMT3.PROMO_NO  		= PPMT.PROMO_NO
					        		  AND PPMT3.PA_CODE	 	 	= PPMT.PA_CODE
						              AND PPMT3.GOODS_CODE  	= PPMT.GOODS_CODE
					        	  	  AND PPMT3.INSERT_DATE 	> PPMT.INSERT_DATE
					        		  AND PPMT3.PROC_GB 	  	= 'D')
                  AND NOT EXISTS ( SELECT 1
                       			 	 FROM TPAPROMOTARGETEXCEPT TPE
                      				WHERE TPE.TARGET_GB = '00'
			                          AND TPE.TARGET_CODE = PPMT.GOODS_CODE
			                          AND TPE.USE_YN = '1'
			                          AND (TPE.PA_GROUP_CODE_ALL_YN = '1' OR TPE.PA_GROUP_CODE LIKE '%07%'))
   	            ORDER BY PPMT.DO_AMT DESC )
	    WHERE ROWNUM = 1
    </select>
    
    <select id="selectPaPromoDeleteTarget" parameterType="hashMap" resultType="com.cware.netshopping.domain.model.PaPromoTarget">
        SELECT /* paintpgoods.xml : paintp.paintpgoods.selectPaPromoTargetDeleted by PaIntpGoodsController */
               /*+INDEX_DESC (PPMT IDX_TPAPROMOTARGET_02)*/
               PPMT.PROC_GB
             , PPMT.PROMO_NO
             , PPMT.PA_CODE
             , PPMT.GOODS_CODE
             , PPMT.SEQ
             , PPMT.TRANS_DATE
             , PPMT.DO_AMT AS DO_COST
             , PPMT.OWN_COST
             , PPMT.ENTP_COST
             , PPMT.INSERT_DATE
          FROM TPAPROMOTARGET PPMT
             , TPROMOM PM
         WHERE  PPMT.PROC_GB 				= 'D' 
           AND PPMT.TRANS_DATE 				IS NULL
           <!--  AND SYSDATE 						> PPMT.PROMO_EDATE-->
           AND PPMT.PROMO_NO 				= PM.PROMO_NO
           AND PM.COUPON_YN 				= '1'
           AND PM.IMMEDIATELY_YN 			= '1'
           AND NVL(PM.ALCOUT_PROMO_YN, '0') = #{alcoutPromoYn	, jdbcType=VARCHAR}
           AND PPMT.GOODS_CODE 				= #{goodsCode		, jdbcType=VARCHAR}
           AND PPMT.PA_CODE 				= #{paCode			, jdbcType=VARCHAR}
           AND EXISTS 	  ( SELECT /*+INDEX_DESC (PPMT3 IDX_TPAPROMOTARGET_04)*/
          						   'X'
					          FROM TPAPROMOTARGET PPMT3
					         WHERE PPMT3.PROMO_NO  		= PPMT.PROMO_NO
					           AND PPMT3.PA_CODE	 	= PPMT.PA_CODE
						       AND PPMT3.GOODS_CODE     = PPMT.GOODS_CODE
					           AND PPMT3.INSERT_DATE &lt; PPMT.INSERT_DATE
					           AND PPMT3.TRANS_DATE    IS NOT NULL
					           AND PPMT3.PROC_GB 	   != 'D'
					           AND PPMT3.DO_AMT  	    > 0
					           AND ROWNUM 				= 1)
           AND ROWNUM = 1
    </select>
    
    <insert id="insertNewPaPromoTarget"  parameterType="com.cware.netshopping.domain.model.PaPromoTarget">
		INSERT INTO /* paintpgoods.xml: paintp.paintpgoods.insertPaPromoTarget by PaIntpGoodsController */
			   TPAPROMOTARGET PPMT
                             (PPMT.PROMO_NO
                            , PPMT.PA_CODE
                            , PPMT.GOODS_CODE
                            , PPMT.SEQ
                            , PPMT.DO_TYPE
                            , PPMT.COUPON_YN
                            , PPMT.IMMEDIATELY_YN
                            , PPMT.PROMO_BDATE
                            , PPMT.PROMO_EDATE
                            , PPMT.AMT_RATE_FLAG
                            , PPMT.DO_RATE
                            , PPMT.DO_AMT
                            , PPMT.STANDARD_APP_AMT
                            , PPMT.LIMIT_AMT
                            , PPMT.USE_CODE
                            , PPMT.OWN_COST
                            , PPMT.ENTP_COST
                            , PPMT.PROC_GB
                            , PPMT.PA_GROUP_CODE
                            , PPMT.INSERT_ID
                            , PPMT.MODIFY_ID
                            , PPMT.TRANS_DATE
                            , PPMT.INSERT_DATE
                            , PPMT.MODIFY_DATE
                            , PPMT.DO_COST
                            , PPMT.DO_OWN_COST
                            , PPMT.DO_ENTP_COST     
                            , PPMT.EXCEPT_REASON                       
                            )
                         SELECT PM.PROMO_NO
                              , PM.PA_CODE
                              , PM.GOODS_CODE
                              , LPAD((SELECT MAX(PM1.SEQ) + 1 
                              	   FROM TPAPROMOTARGET PM1 
                              	  WHERE PM1.GOODS_CODE 	= #{goodsCode	, jdbcType=VARCHAR}
                              	  	AND PM1.PA_CODE 	= #{paCode		, jdbcType=VARCHAR}
                              	  	AND PM1.PROMO_NO 	= #{promoNo		, jdbcType=VARCHAR}
                              	  	), 4 ,'0')   
                              , PM.DO_TYPE
                              , PM.COUPON_YN
                              , PM.IMMEDIATELY_YN
                              , PM.PROMO_BDATE
                              , PM.PROMO_EDATE
                              , PM.AMT_RATE_FLAG
                              , PM.DO_RATE
                              , DECODE(#{doCost, jdbcType=NUMERIC}, 0 , 0 , PM.DO_AMT)
                              , PM.STANDARD_APP_AMT
                              , PM.LIMIT_AMT
                              , PM.USE_CODE
                              , DECODE(#{doCost, jdbcType=NUMERIC}, 0 , 0 , PM.OWN_COST)
                              , DECODE(#{doCost, jdbcType=NUMERIC}, 0 , 0 , PM.ENTP_COST)
                              , DECODE(PM.PROC_GB, 'I', 'U', PM.PROC_GB)
                              , PM.PA_GROUP_CODE 
                              , PM.INSERT_ID
                              , 'BATCH'
                              , SYSDATE
                              , SYSDATE
                              , SYSDATE
                              , DECODE(#{doCost, jdbcType=NUMERIC}, 0 , 0 , PM.DO_COST)
                              , DECODE(#{doCost, jdbcType=NUMERIC}, 0 , 0 , PM.DO_OWN_COST)
                              , DECODE(#{doCost, jdbcType=NUMERIC}, 0 , 0 , PM.DO_ENTP_COST) 
                              , DECODE(#{doCost, jdbcType=NUMERIC}, 0 , '마진률 초과  , 연동 예외 시간 : ' || TO_CHAR(SYSDATE , 'YYYY/MM/DD HH24:MI:SS') , '')                               
                           FROM TPAPROMOTARGET PM
                          WHERE PM.GOODS_CODE 	= #{goodsCode	, jdbcType=VARCHAR}
						    AND PM.PA_CODE 		= #{paCode		, jdbcType=VARCHAR}
							AND PM.PROMO_NO 	= #{promoNo		, jdbcType=VARCHAR}
					        AND PM.SEQ 			= #{seq			, jdbcType=VARCHAR}
     </insert>
         
     <update id="updateTPapromoTarget4ExceptMemo"  parameterType="com.cware.netshopping.domain.model.PaPromoTarget">
		UPDATE /* paintpgoods.xml: paintp.paintpgoods.updateTPapromoTarget4ExceptMemo by PaIntpGoodsController */
			   TPAPROMOTARGET T
		   SET T.EXCEPT_REASON = #{exceptReason	, jdbcType=VARCHAR}
		 WHERE T.PROMO_NO      = #{promoNo		, jdbcType=VARCHAR} 
		   AND T.PA_CODE       = #{paCode		, jdbcType=VARCHAR} 
		   AND T.SEQ		   = #{seq			, jdbcType=VARCHAR} 
		   AND T.GOODS_CODE	   = #{goodsCode	, jdbcType=VARCHAR} 
		   AND T.TRANS_DATE IS NULL
    </update>
       
    <insert id="insertNewPaPromoTargetAmt0"  parameterType="com.cware.netshopping.domain.model.PaPromoTarget">
		INSERT INTO /* paintpgoods.xml : paintp.paintpgoods.insertNewPaPromoTargetAmt0 by PaIntpGoodsController */
			   TPAPROMOTARGET PPMT
                             (PPMT.PROMO_NO
                            , PPMT.PA_CODE
                            , PPMT.GOODS_CODE
                            , PPMT.SEQ
                            , PPMT.DO_TYPE
                            , PPMT.COUPON_YN
                            , PPMT.IMMEDIATELY_YN
                            , PPMT.PROMO_BDATE
                            , PPMT.PROMO_EDATE
                            , PPMT.AMT_RATE_FLAG
                            , PPMT.DO_RATE
                            , PPMT.DO_AMT
                            , PPMT.STANDARD_APP_AMT
                            , PPMT.LIMIT_AMT
                            , PPMT.USE_CODE
                            , PPMT.OWN_COST
                            , PPMT.ENTP_COST
                            , PPMT.INSERT_ID
                            , PPMT.MODIFY_ID
                            , PPMT.PROC_GB
                            , PPMT.PA_GROUP_CODE
                            , PPMT.TRANS_DATE
                            , PPMT.INSERT_DATE
                            , PPMT.MODIFY_DATE
                            , PPMT.DO_COST
                            , PPMT.DO_OWN_COST
                            , PPMT.DO_ENTP_COST
                            )
                         SELECT PM.PROMO_NO
                              , PM.PA_CODE
                              , PM.GOODS_CODE
                              , LPAD((SELECT MAX(PM1.SEQ) + 1 
                              	   FROM TPAPROMOTARGET PM1 
                              	  WHERE PM1.GOODS_CODE 	= #{goodsCode	, jdbcType=VARCHAR}
                              	  	AND PM1.PA_CODE 	= #{paCode		, jdbcType=VARCHAR}
                              	  	AND PM1.PROMO_NO 	= #{promoNo		, jdbcType=VARCHAR}
                              	  	), 4 ,'0')   
                              , PM.DO_TYPE
                              , PM.COUPON_YN
                              , PM.IMMEDIATELY_YN
                              , PM.PROMO_BDATE
                              , PM.PROMO_EDATE
                              , PM.AMT_RATE_FLAG
                              , 0
                              , 0
                              , 0
                              , 0
                              , PM.USE_CODE
                              , 0
                              , 0
                              , PM.INSERT_ID
                              , 'BATCH'
                              , 'D'
                              , PM.PA_GROUP_CODE 
                              , SYSDATE
                              , SYSDATE
                              , SYSDATE
                              , 0
                              , 0
                              , 0                                
                           FROM TPAPROMOTARGET PM
                          WHERE PM.GOODS_CODE 	= #{goodsCode	, jdbcType=VARCHAR}
						    AND PM.PA_CODE 		= #{paCode		, jdbcType=VARCHAR}
							AND PM.PROMO_NO 	= #{promoNo		, jdbcType=VARCHAR}
					        AND PM.SEQ 			= #{seq			, jdbcType=VARCHAR}
     </insert>
     
     <select id="selectPaIntpGoodsModifyCheck" resultType="int" parameterType="com.cware.netshopping.domain.PaIntpGoodsVO">
        SELECT /* paintpgoods.xml : paintp.paintpgoods.selectPaIntpGoodsModifyCheck by PaIntpGoodsController */ 
               COUNT(1)
          FROM TPAINTPGOODS T
         WHERE T.GOODS_CODE = #{goodsCode		, jdbcType=VARCHAR}
           AND T.MODIFY_DATE > #{lastModifyDate, jdbcType=TIMESTAMP}
           AND T.PA_CODE = #{paCode, jdbcType=VARCHAR}
     </select>   
     
     <select id="selectPaIntpGoodsTrans" parameterType="String" resultType="hashMap">
        SELECT /* paintpgoods.xml : paintp.paintpgoods.selectPaIntpGoodsTrans by PaIntpGoodsController */ 
               TG.GOODS_CODE
             , PG.PA_CODE
          FROM TPAINTPGOODS  PG
             , TPAPRODUCT    TG
             , TGOODS        GD
             , TCODE         TC
             , TGOODSPRICE   GP
             , TPAGOODSPRICE PP
         WHERE TG.GOODS_CODE  = PG.GOODS_CODE
           AND TG.GOODS_CODE  = GD.GOODS_CODE
           AND TC.CODE_LGROUP = 'O505'
           AND TC.CODE_MGROUP = PG.PA_CODE
           AND GP.GOODS_CODE  = PG.GOODS_CODE
           <if test='goodsCode != null and goodsCode != ""'>
           AND PG.GOODS_CODE  = #{goodsCode , jdbcType=VARCHAR}
           </if>
           <if test='paCode != null and paCode != ""'>
           AND PG.PA_CODE     = #{paCode	, jdbcType=VARCHAR}
           </if>
           AND GP.ROWID = (SELECT /*+ INDEX_DESC (Z PK_TGOODSPRICE)*/
                                  Z.ROWID
                             FROM TGOODSPRICE Z
                            WHERE Z.GOODS_CODE 		= GP.GOODS_CODE
                              AND Z.APPLY_DATE		= PP.APPLY_DATE
                              AND Z.APPLY_DATE  &lt;= SYSDATE
                              AND ROWNUM 			= 1)
           AND PP.GOODS_CODE 		= PG.GOODS_CODE
           AND PP.PA_CODE 	 		= PG.PA_CODE
           AND PP.APPLY_DATE 		= GP.APPLY_DATE
           AND GD.SIGN_GB 	 		= '80'
           AND GD.GIFT_YN 	 		= '0'
           AND PG.PA_STATUS  		= '10'
           AND PG.PA_SALE_GB 		= '20'
           AND GD.INVI_GOODS_TYPE 	= '00'
           AND PG.INSERT_DATE &lt; SYSDATE - 1/24
           <if test='inComingUrl != "BO" and inComingUrl == ""'>
           	 AND PG.INSERT_DATE > SYSDATE - 30
           </if>
           AND EXISTS ( SELECT '1' 
                          FROM TPAGOODSTARGET PGT 
                         WHERE PGT.GOODS_CODE = PG.GOODS_CODE
                           AND PGT.PA_CODE = PG.PA_CODE)
           AND EXISTS ( SELECT '1' 
                          FROM TDESCRIBE DB 
                         WHERE DB.GOODS_CODE = GD.GOODS_CODE 
                           AND DB.DESCRIBE_CODE IN ('998','999')
                           AND DB.DESCRIBE_EXT IS NOT NULL
                           AND ROWNUM = 1 )  
           AND EXISTS ( SELECT '1'
                          FROM TGOODSIMAGE GI
                         WHERE GI.GOODS_CODE = GD.GOODS_CODE
                           AND NVL(IMAGE_C,IMAGE_G) IS NOT NULL
                           AND ROWNUM = 1 )
           AND GD.ENTP_CODE NOT IN (SELECT TC.CODE_MGROUP FROM TCODE TC WHERE TC.CODE_LGROUP = 'T001' AND INSTR(TC.CODE_GROUP, PG.PA_GROUP_CODE) > 0 )  
           <!-- <if test='massTargetYn != null and massTargetYn != ""'>
            AND PG.MASS_TARGET_YN   = #{massTargetYn , jdbcType=VARCHAR}
           </if> -->
           ORDER BY GOODS_CODE
    </select>
    
    <update id="updatePaIntpGoodsFail"  parameterType="hashMap">
        UPDATE TPAINTPGOODS PG
           SET PG.RETURN_NOTE = #{RETURN_NOTE, jdbcType=VARCHAR}
             , PG.PA_STATUS   = #{PA_STATUS, jdbcType=VARCHAR}
             , PG.MODIFY_ID   = #{MODIFY_ID, jdbcType=VARCHAR}
             , PG.MODIFY_DATE = SYSDATE
         WHERE PG.GOODS_CODE  = #{GOODS_CODE, jdbcType=VARCHAR}  
           AND PG.PA_CODE     = #{PA_CODE, jdbcType=VARCHAR}  
    </update>
    
    <update id="updateMassTargetYn" parameterType="com.cware.netshopping.domain.PaIntpGoodsVO">
		UPDATE /* paintpgoods.xml : paintp.paintpgoods.updateMassTargetYn*/ 
			   TPAINTPGOODS
		   SET MASS_TARGET_YN 	= #{massTargetYn 	, jdbcType=VARCHAR}
	 	 WHERE PA_CODE    		= #{paCode			, jdbcType=VARCHAR}
	 	   AND GOODS_CODE 		= #{goodsCode		, jdbcType=VARCHAR}
    </update>
    
    <update id="updateMassTargetYnByEpCode" parameterType="hashMap">
		UPDATE  /* paintpgoods.xml : paintp.paintpgoods.updateMassTargetYnByEpCode*/ 
			   TPAINTPGOODS
		   SET MASS_TARGET_YN 	= #{massTargetYn 	, jdbcType=VARCHAR}
		     , MASS_TARGET_CODE = NULL
	 	 WHERE MASS_TARGET_EP	= #{massTargetEp 	, jdbcType=VARCHAR}
	 	   AND MASS_TARGET_YN  != '9'
    </update>       	
    
    <resultMap id="selectPaNoticeDataMap" type="hashMap">
        <result column="NOTICE_EXT" property="NOTICE_EXT" jdbcType="CLOB"/>
    </resultMap>
    
	<select id="selectPaNoticeData" parameterType="hashMap" resultMap="selectPaNoticeDataMap">
        SELECT /*+ INDEX_DESC (TNM IDX_TPANOTICEM_03)*/
               NVL(TNM.NOTICE_EXT, '') AS NOTICE_EXT
		  FROM TPANOTICEM TNM
		     , TPANOTICETARGET TNT
		     , TPANOTICEAPPLY TNA
		 WHERE TNM.NOTICE_NO  = TNT.NOTICE_NO
		   AND TNT.GOODS_CODE = #{goodsCode , jdbcType=VARCHAR}
		   AND TNM.USE_CODE   = '00'
		   AND INSTR(TNM.PA_GROUP_CODE, #{paGroupCode , jdbcType=VARCHAR}) > 0
		   AND TNT.NOTICE_NO  = TNA.NOTICE_NO
		   AND TNT.GOODS_CODE = TNA.GOODS_CODE
		   AND TNA.PA_GROUP_CODE = #{paGroupCode , jdbcType=VARCHAR}
		   AND ROWNUM = 1
 	</select>
</mapper>
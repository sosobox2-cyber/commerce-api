<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"
        "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">

<mapper namespace="pacommon.paorder">
    
    <select id="selectSequenceNoCondition" parameterType="hashMap" resultType="string">
        SELECT /* paorder.xml : pacommon.paorder.selectSequenceNoCondition by PaOrderController */
        <if test="sequence_type == 'CUST_NO'">
            MOD(TO_CHAR(SYSDATE, 'MM'),2)
        </if>
        <if test="sequence_type == 'ORDER_NO' or sequence_type == 'GOODS_SELECT_NO' or sequence_type == 'RECEIPT_NO'">
            DECODE(TO_NUMBER(TO_CHAR(SYSDATE, 'D')), 1,'SUN', 2,'MON', 3,'TUE', 4,'WED', 5,'THU', 6,'FRI', 7,'SAT')
        </if>
            FROM DUAL
    </select>
    
    
     
     <select id="getGoodsCheckDelyGb" databaseId="Oracle" parameterType="hashMap" resultType="hashMap">
        SELECT /* order.xml : pacommon.paorder.getGoodsCheckDelyGb by PaOrderController */
                 SUBSTR(FUN_ORDER_DELY_GB_WH_CODE(#{delyGb,jdbcType=VARCHAR}, #{whCode,jdbcType=VARCHAR}, #{goodsCode,jdbcType=VARCHAR}, #{custNo,jdbcType=VARCHAR}, #{receiverSeq,jdbcType=VARCHAR}),1,2) AS DELY_GB
               , SUBSTR(FUN_ORDER_DELY_GB_WH_CODE(#{delyGb,jdbcType=VARCHAR}, #{whCode,jdbcType=VARCHAR}, #{goodsCode,jdbcType=VARCHAR}, #{custNo,jdbcType=VARCHAR}, #{receiverSeq,jdbcType=VARCHAR}),3,3) AS WH_CODE
          FROM DUAL
         WHERE ROWNUM = 1
    </select>
    
    
    
    <select id="selectSequenceNo" parameterType="hashMap" resultType="string">
        SELECT /* paorder.xml : pacommon.paorder.selectSequenceNo by PaOrderController */
        
        <if test="sequence_type == 'COUPONISSUE_SEQ'">
             TO_CHAR(sysdate, 'YYYYMMDD') || ltrim(to_char(BMTCOM.SEQ_COUPONISSUE_SEQ.NEXTVAL,'00000000'))
        </if> 
        
        <if test="sequence_type == 'ORDER_NO'">
             TO_CHAR(SYSDATE, 'YYYYMMDD') || LTRIM(TO_CHAR(
            <if test="condition_flag == 'SUN'">
                SEQ_ORDER_NO_SUN.NEXTVAL
            </if>
            <if test="condition_flag == 'MON'">
                SEQ_ORDER_NO_MON.NEXTVAL
            </if>
            <if test="condition_flag == 'TUE'">
                SEQ_ORDER_NO_TUE.NEXTVAL
            </if>
            <if test="condition_flag == 'WED'">
                SEQ_ORDER_NO_WED.NEXTVAL
            </if>
            <if test="condition_flag == 'THU'">
                SEQ_ORDER_NO_THU.NEXTVAL
            </if>
            <if test="condition_flag == 'FRI'">
                SEQ_ORDER_NO_FRI.NEXTVAL
            </if>
            <if test="condition_flag == 'SAT'">
                SEQ_ORDER_NO_SAT.NEXTVAL
            </if>
            ,'000000'))
        </if>
        
        <if test="sequence_type == 'CUST_NO'">
            LTRIM(TO_CHAR(SYSDATE,'YYYYMM'))|| LTRIM(TO_CHAR(
            <if test='condition_flag == "0"'>
                SEQ_CUST_NO_EVEN.NEXTVAL
            </if>
            <if test='condition_flag == "1"'>
                SEQ_CUST_NO_ODD.NEXTVAL
            </if>
            , '000000'))
        </if>
        
        <if test="sequence_type == 'RECEIPT_NO'">
            TO_CHAR(SYSDATE, 'YYYYMMDD') || LTRIM(TO_CHAR(
            <if test="condition_flag == 'SUN'">
               SEQ_RECEIPT_NO_SUN.NEXTVAL
            </if>
            <if test="condition_flag == 'MON'">
               SEQ_RECEIPT_NO_MON.NEXTVAL
            </if>
            <if test="condition_flag == 'TUE'">
               SEQ_RECEIPT_NO_TUE.NEXTVAL
            </if>
            <if test="condition_flag == 'WED'">
               SEQ_RECEIPT_NO_WED.NEXTVAL
            </if>
            <if test="condition_flag == 'THU'">
               SEQ_RECEIPT_NO_THU.NEXTVAL
            </if>
            <if test="condition_flag == 'FRI'">
               SEQ_RECEIPT_NO_FRI.NEXTVAL
            </if>
            <if test="condition_flag == 'SAT'">
               SEQ_RECEIPT_NO_SAT.NEXTVAL
            </if>
            ,'00000000'))
        </if>
        
        <if test="sequence_type == 'MEMB_NO'">
            LTRIM(TO_CHAR(SEQ_MEMB_NO.NEXTVAL, '00000000'))
        </if>
        
        <if test="sequence_type == 'ORDERPROMO_SEQ'">
            TO_CHAR(SYSDATE, 'YYYYMMDD') || LTRIM(TO_CHAR(SEQ_ORDERPROMO_SEQ.NEXTVAL,'00000000'))
        </if>
        
        <if test="sequence_type == 'GOODS_SELECT_NO'">
            TO_CHAR(SYSDATE, 'YYYYMMDD') || LTRIM(TO_CHAR(
            <if test="condition_flag == 'SUN'">
                SEQ_GOODS_SELECT_NO_SUN.NEXTVAL
            </if>
            <if test="condition_flag == 'MON'">
                SEQ_GOODS_SELECT_NO_MON.NEXTVAL
            </if>
            <if test="condition_flag == 'TUE'">
                SEQ_GOODS_SELECT_NO_TUE.NEXTVAL
            </if>
            <if test="condition_flag == 'WED'">
                SEQ_GOODS_SELECT_NO_WED.NEXTVAL
            </if>
            <if test="condition_flag == 'THU'">
                SEQ_GOODS_SELECT_NO_THU.NEXTVAL
            </if>
            <if test="condition_flag == 'FRI'">
                SEQ_GOODS_SELECT_NO_FRI.NEXTVAL
            </if>
            <if test="condition_flag == 'SAT'">
                SEQ_GOODS_SELECT_NO_SAT.NEXTVAL
            </if>
            ,'00000000'))
        </if>        
            FROM DUAL
    </select>
    
    <insert id="insertTCustomer" parameterType="com.cware.netshopping.domain.model.Customer">
          INSERT INTO TCUSTOMER ( /* paorder.xml : pacommon.paorder.insertTCustomer by PaOrderController */
                      CUST_NO
                    , CUST_NAME
                    , CUST_NAME1
                    , CUST_NAME2
                    , CUST_NAME3
                    , RESIDENT_NO
                    , SEX
                    , ENAME
                    , COMP_NAME
                    , COMP_DEPTNAME
                    , BIRTHDAY_YN
                    , BIRTHDAY
                    , WEDDING_YN
                    , WEDDING_DATE
                    , JOB_CODE
                    , EMAIL_ADDR
                    , RECEIVE_METHOD
                    , COUNTRY
                    , ORDER_SMS_YN
                    , SMS_YN
                    , ORDER_EMAIL_YN
                    , EMAIL_YN
                    , EM_YN
                    , EMAIL_FLAG
                    , EM_NO
                    , MEMB_NO
                    , MEM_ID
                    , PASSWD
                    , PASSWD_HINT
                    , PASSWD_ANSWER
                    , NOMINATE_ID
                    , NOMINATE_YN
                    , WITHDRAWAL_YN
                    , WITHDRAWAL_DATE
                    , WITHDRAWAL_CODE
                    , WITHDRAWAL_CONTENT
                    , CUST_SOURCE
                    , ID_INSERT_DATE
                    , INSERT_ID
                    , INSERT_DATE
                    , MODIFY_ID
                    , MODIFY_DATE )
             VALUES( #{custNo, jdbcType=VARCHAR}
                   , #{custName, jdbcType=VARCHAR}
                   , #{custName1, jdbcType=VARCHAR}
                   , #{custName2, jdbcType=VARCHAR}
                   , #{custName3, jdbcType=VARCHAR}
                   , CWARE_ENC_DEC(#{residentNo, jdbcType=VARCHAR}, 'e')
                   , #{sex, jdbcType=VARCHAR}
                   , #{ename, jdbcType=VARCHAR}
                   , #{compName, jdbcType=VARCHAR}
                   , #{compDeptname, jdbcType=VARCHAR}
                   , #{birthdayYn, jdbcType=VARCHAR}
                   , #{birthday, jdbcType=DATE}
                   , #{weddingYn, jdbcType=VARCHAR}
                   , #{weddingDate, jdbcType=DATE}
                   , #{jobCode, jdbcType=VARCHAR}
                   , #{emailAddr, jdbcType=VARCHAR}
                   , #{receiveMethod, jdbcType=VARCHAR}
                   , #{country, jdbcType=VARCHAR}
                   , #{orderSmsYn, jdbcType=VARCHAR}
                   , #{smsYn, jdbcType=VARCHAR}
                   , #{orderEmailYn, jdbcType=VARCHAR}
                   , #{emailYn, jdbcType=VARCHAR}
                   , #{emYn, jdbcType=VARCHAR}
                   , #{emailFlag, jdbcType=VARCHAR}
                   , #{emNo, jdbcType=VARCHAR}
                   , #{membNo, jdbcType=VARCHAR}
                   , #{memId, jdbcType=VARCHAR}
                   , CWARE_ENC_DEC(#{passwd, jdbcType=VARCHAR}, 'h')
                   , #{passwdHint, jdbcType=VARCHAR}
                   , #{passwdAnswer, jdbcType=VARCHAR}
                   , #{nominateId, jdbcType=VARCHAR}
                   , #{nominateYn, jdbcType=VARCHAR}
                   , #{withdrawalYn, jdbcType=VARCHAR}
                   , #{withdrawalDate, jdbcType=DATE}
                   , #{withdrawalCode, jdbcType=VARCHAR}
                   , #{withdrawalContent, jdbcType=VARCHAR}
                   , DECODE(#{custSource, jdbcType=VARCHAR}, '', '999999', #{custSource, jdbcType=VARCHAR})
                   , #{idInsertDate, jdbcType=DATE}
                   , #{insertId, jdbcType=VARCHAR}
                   , #{insertDate, jdbcType=VARCHAR}
                   , #{modifyId, jdbcType=VARCHAR}
                   , #{modifyDate, jdbcType=TIMESTAMP})
    </insert>
    
    <insert id="insertCustsystem" parameterType="com.cware.netshopping.domain.model.Custsystem" >
        INSERT INTO TCUSTSYSTEM ( /* pfaorder.xml : pacommon.paorder.insertCustsystem by PaOrderController */
                      CUST_NO
                    , CUST_GB
                    , MEMB_GB
                    , CUST_WARNING
                    , CUST_CHAR
                    , BIRTHDAY_MMDD
                    , DM_YN
                    , DM_NO_GB
                    , DM_NO_ID
                    , DM_NO_DATE
                    , LAST_CON_MEDIA
                    , LAST_CON_DATE
                    , MODIFY_ID
                    , MODIFY_DATE 
                    <!-- , LAST_CON_MEDIA_CODE
                     , LAST_ORDER_MEDIA
                     , LAST_ORDER_MEDIA_CODE
                     , INSERT_MEDIA
                     , INSERT_MEDIA_CODE
                     , INSERT_DATE -->
                    
                    )
           VALUES (   #{custNo,jdbcType=VARCHAR}
                    , #{custGb,jdbcType=VARCHAR}
                    , #{membGb,jdbcType=VARCHAR}
                    , #{custWarning,jdbcType=VARCHAR}
                    , DECODE(#{custChar,jdbcType=VARCHAR}, '', '99', #{custChar,jdbcType=VARCHAR})
                    , #{birthdayMmdd,jdbcType=VARCHAR}
                    , DECODE(#{dmYn,jdbcType=VARCHAR}, '', '1', #{dmYn,jdbcType=VARCHAR})
                    , #{dmNoGb,jdbcType=VARCHAR}
                    , #{dmNoId,jdbcType=VARCHAR}
                    , #{dmNoDate,jdbcType=DATE}
                    , '62'
                    , #{modifyDate,jdbcType=DATE}
                    , #{modifyId,jdbcType=VARCHAR}
                    , #{modifyDate,jdbcType=DATE}
                    <!--, #{lastConMediaCode,jdbcType=VARCHAR}
                    , #{lastOrderMedia,jdbcType=VARCHAR}
                    , #{lastOrderMediaCode,jdbcType=VARCHAR}
                    , #{insertMedia,jdbcType=VARCHAR}
                    , #{insertMediaCode,jdbcType=VARCHAR}
                    , #{insertDate,jdbcType=DATE} -->
                     )
    </insert>
    
    <insert id="insertCusttel" parameterType="com.cware.netshopping.domain.model.Custtel" >
        INSERT INTO TCUSTTEL ( /* paorder.xml : pacommon.paorder.insertCusttel by PaOrderController */
                   CUST_NO
                 , TEL )
           VALUES (#{custNo,jdbcType=VARCHAR}
                 , #{tel,jdbcType=VARCHAR} )
    </insert>
    
    
    
    
    <insert id="insertCustspinfo" parameterType="com.cware.netshopping.domain.model.Custspinfo" >
        INSERT INTO TCUSTSPINFO ( /* paorder.xml : pacommon.paorder.insertCustspinfo by PaOrderController */
                    CUST_NO
                  , SEQ
                  , TYPE
                  , CONTENT
                  , SP_BDATE
                  , SP_EDATE
                  , MSG
                  , INSERT_DATE
                  , INSERT_ID
                  , MODIFY_DATE
                  , MODIFY_ID)
        VALUES (    #{custNo,jdbcType=VARCHAR}
                  , #{seq,jdbcType=VARCHAR}
                  , #{type,jdbcType=VARCHAR}
                  , #{content,jdbcType=VARCHAR}
                  , #{spBdate,jdbcType=DATE}
                  , #{spEdate,jdbcType=DATE}
                  , #{msg,jdbcType=VARCHAR}
                  , #{insertDate,jdbcType=DATE}
                  , #{insertId,jdbcType=VARCHAR}
                  , #{modifyDate,jdbcType=DATE}
                  , #{modifyId,jdbcType=VARCHAR})
    </insert>
    
    <insert id="insertReceiver" parameterType="com.cware.netshopping.domain.model.Receiver" >
        INSERT INTO TRECEIVER (/* paorder.xml : pacommon.paorder.insertReceiver by PaOrderController  */
                    CUST_NO,            RECEIVER_SEQ,           RECEIVER_GB,
                    DEFAULT_YN,         RECEIVER,               RECEIVER_DDD,
                    RECEIVER_TEL1,      RECEIVER_TEL2,          RECEIVER_TEL3,
                    TEL,                RECEIVER_POST,          RECEIVER_POST_SEQ,
                    RECEIVER_POST_ADDR, RECEIVER_ADDR,          RECEIVER_HP,            RECEIVER_HP1,
                    RECEIVER_HP2,       RECEIVER_HP3,
                    RECEIVER1,          RECEIVER2,              RECEIVER3,
                    USE_YN,             BEFORE_SEQ,
                    ROAD_ADDR_YN,       ROAD_POST_ADDR,         ROAD_ADDR,                ROAD_ADDR_NO,
                    INSERT_ID,          INSERT_DATE,            MODIFY_ID,                MODIFY_DATE,
                    SELECT_ADDR,
                    STD_ROAD_POST,      STD_ROAD_POST_SEQ,      STD_ROAD_POST_ADDR1,      STD_ROAD_POST_ADDR2,     STD_ROAD_POST_LNGX,    STD_ROAD_POST_LATY, 
                    STD_POST,           STD_POST_SEQ,           STD_POST_ADDR1,           STD_POST_ADDR2,          STD_POST_LNGX,         STD_POST_LATY,
                    REFINE_RESULT_CODE
                    )
            VALUES (#{custNo,jdbcType=VARCHAR},                 #{receiverSeq,jdbcType=VARCHAR},            #{receiverGb,jdbcType=VARCHAR},
                    #{defaultYn,jdbcType=VARCHAR},              #{receiver,jdbcType=VARCHAR},               #{receiverDdd,jdbcType=VARCHAR},
                    #{receiverTel1,jdbcType=VARCHAR},           #{receiverTel2,jdbcType=VARCHAR},           #{receiverTel3,jdbcType=VARCHAR},
                    #{tel,jdbcType=VARCHAR},                    #{receiverPost,jdbcType=VARCHAR},           #{receiverPostSeq,jdbcType=VARCHAR},
                    RTRIM(#{receiverPostAddr,jdbcType=VARCHAR}),RTRIM(#{receiverAddr,jdbcType=VARCHAR}),    #{receiverHp,jdbcType=VARCHAR},                     #{receiverHp1,jdbcType=VARCHAR},
                    #{receiverHp2,jdbcType=VARCHAR},            #{receiverHp3,jdbcType=VARCHAR},
                    #{receiver1,jdbcType=VARCHAR},              #{receiver2,jdbcType=VARCHAR},              #{receiver3,jdbcType=VARCHAR},
                    #{useYn,jdbcType=VARCHAR},                  #{beforeSeq,jdbcType=VARCHAR},
                    NVL(#{roadAddrYn,jdbcType=VARCHAR},'1'),  #{roadPostAddr,jdbcType=VARCHAR},           #{roadAddr,jdbcType=VARCHAR},                       #{roadAddrNo,jdbcType=VARCHAR},
                    #{insertId,jdbcType=VARCHAR},               #{insertDate,jdbcType=DATE},                #{modifyId,jdbcType=VARCHAR},                       #{modifyDate,jdbcType=DATE},
                    NVL(#{selectAddr,jdbcType=VARCHAR}, '1'),   
                    #{receiverRoadPost, jdbcType=VARCHAR },     #{receiverRoadPostSeq, jdbcType=VARCHAR},   RTRIM(#{receiverRoadPostAddr, jdbcType=VARCHAR}),   RTRIM(#{receiverRoadPostAddr2, jdbcType=VARCHAR}),      #{stdRoadPostLngx,jdbcType=VARCHAR},  #{stdRoadPostLaty,jdbcType=VARCHAR},                                                        
                    #{receiverStdPost, jdbcType=VARCHAR},       #{receiverStdPostSeq, jdbcType=VARCHAR},    RTRIM(#{receiverStdPostAddr, jdbcType=VARCHAR}),    RTRIM(#{receiverStdPostAddr2, jdbcType=VARCHAR}),       #{stdPostLngx,jdbcType=VARCHAR},      #{stdPostLaty,jdbcType=VARCHAR},
                    #{refineResultCode, jdbcType=VARCHAR} 
                    )
    </insert>
    
    <select id="getSysdatetime" resultType="string">
        SELECT /* paorder.xml : pacommon.paorder.getSysdatetime by PaOrderController */
                TO_CHAR(SYSDATE, 'YYYY/MM/DD HH24:MI:SS')
          FROM DUAL
    </select>
    
    
    
    <resultMap id="OrderInfoMsg"   type="com.cware.api.pacommon.message.pacommon.OrderInfoMsg">
        <result     property="salePrice"          column="SALE_PRICE" />
        <result     property="buyPrice"           column="BUY_PRICE"     />
        <result     property="saleVatRate"        column="SALE_VAT_RATE" />
        <result     property="arsDcAmt"           column="ARS_DC_AMT" />
        <result     property="arsOwnDcAmt"        column="ARS_OWN_DC_AMT" />        
        <result     property="arsEntpDcAmt"       column="ARS_ENTP_DC_AMT" />
        <result     property="goodsCode"          column="GOODS_CODE" />
        <result     property="goodsName"          column="GOODS_NAME" />
        <result     property="inviGoodsType"      column="INVI_GOODS_TYPE" />
        <result     property="norestAllotMonths"  column="NOREST_ALLOT_MONTHS" />
        <result     property="delyType"           column="DELY_TYPE" />
        <result     property="whCode"             column="WH_CODE" />
        <result     property="mdCode"             column="MD_CODE" />
        <result     property="directShipYn"       column="DIRECT_SHIP_YN" />
        <result     property="goodsDtCode"        column="GOODSDT_CODE" />
        <result     property="stockChkPlace"      column="STOCK_CHK_PLACE" />
        <result     property="goodsDtInfo"        column="GOODSDT_INFO" />          
        <result     property="giftYn"             column="GIFT_YN" />
        <result     property="priceSeq"           column="PRICE_SEQ" />          
    </resultMap>

    <!-- 주문상품 정보요청 -->
    <select id="selectGoodsInfo" parameterType="hashMap" resultMap="OrderInfoMsg">
        SELECT /* paorder.xml : pacommon.paorder.selectGoodsInfo by PaOrderController */
               D.SALE_PRICE
             , D.BUY_PRICE
             , D.ARS_DC_AMT
             , D.ARS_OWN_DC_AMT
             , D.ARS_ENTP_DC_AMT
             , B.GOODS_CODE
             , B.GOODS_NAME
             , DECODE(B.DELY_TYPE, '10', '100001', B.ENTP_CODE) AS ENTP_CODE_ORG
             , B.ENTP_CODE AS ENTP_CODE
             , B.INVI_GOODS_TYPE
             , B.NOREST_ALLOT_MONTHS
             , B.DELY_TYPE
             , B.WH_CODE
             , B.MD_CODE
             , B.DIRECT_SHIP_YN
             , B.STOCK_CHK_PLACE
             , C.GOODSDT_INFO
             , C.GOODSDT_CODE
             , B.GIFT_YN
             , D.PRICE_SEQ
             , D.LUMP_SUM_DC_AMT
			 , D.LUMP_SUM_OWN_DC_AMT
			 , D.LUMP_SUM_ENTP_DC_AMT
          FROM TGOODS           B
             , TGOODSDT         C
             , TGOODSPRICE      D
         WHERE B.GOODS_CODE = C.GOODS_CODE
           AND B.GOODS_CODE = D.GOODS_CODE
           AND B.SIGN_GB = '80'
           AND B.GOODS_CODE = D.GOODS_CODE
           AND D.ROWID      =(SELECT /*+ INDEX_DESC (I PK_TGOODSPRICE)*/
                                      I.ROWID
                                 FROM TGOODSPRICE I
                                WHERE D.GOODS_CODE = I.GOODS_CODE
                                  AND I.APPLY_DATE &lt;= TO_DATE(#{applyDate, jdbcType=VARCHAR}, 'YYYYMMDDHH24MISS')
                                  AND ROWNUM = 1)
           AND B.GOODS_CODE = #{goodsCode, jdbcType=VARCHAR}
           AND C.GOODSDT_CODE = #{goodsdtCode, jdbcType=VARCHAR}
    </select>
    
    <insert id="insertOrderm" parameterType="com.cware.netshopping.domain.model.Orderm" >
    INSERT INTO TORDERM ( /* paorder.xml : pacommon.paorder.insertOrderm by PaOrderController */
              ORDER_NO
            , CUST_NO
            , ORDER_DATE
            , ORDER_MEDIA
            , INSERT_ID
            , WITH_CODE
            , IP_ADDR
            , MEMB_GB
            , EMPLOYEE_ID
            , SENDER_NAME
            , CHANNEL
            , CHANNEL_ID )
     VALUES (
              #{orderNo,jdbcType=VARCHAR}
            , #{custNo,jdbcType=VARCHAR}
            , #{orderDate,jdbcType=TIMESTAMP}
            , #{orderMedia,jdbcType=VARCHAR}
            , #{insertId,jdbcType=VARCHAR}
            , #{withCode,jdbcType=VARCHAR}
            , #{ipAddr,jdbcType=VARCHAR}
            , #{membGb,jdbcType=VARCHAR}
            , #{employeeId,jdbcType=VARCHAR}
            , #{senderName,jdbcType=VARCHAR}
            , #{channel,jdbcType=VARCHAR}
            , #{channel_id,jdbcType=VARCHAR}
            )
    </insert>
    
    <insert id="insertOrdergoods" parameterType="com.cware.netshopping.domain.model.Ordergoods" >
        INSERT INTO TORDERGOODS ( /* paorder.xml : pacommon.paorder.insertOrdergoods by PaOrderController */
                   ORDER_NO
                 , ORDER_G_SEQ
                 , CUST_NO
                 , ORDER_DATE
                 , ORDER_GB
                 , SET_YN
                 , GOODS_CODE
                 , ORDER_QTY
                 , SALE_PRICE
                 , DC_RATE
                 , DC_AMT
                 , DC_AMT_GOODS
                 , DC_AMT_MEMB
                 , DC_AMT_DIV
                 , DC_AMT_CARD
                 , NOREST_ALLOT_MONTHS
                 <!--, SHIP_COST_CODE -->
                 , COUNSEL_TEL )
        VALUES (   #{orderNo,jdbcType=VARCHAR}
                 , #{orderGSeq,jdbcType=VARCHAR}
                 , #{custNo,jdbcType=VARCHAR}
                 , #{orderDate,jdbcType=TIMESTAMP}
                 , #{orderGb,jdbcType=VARCHAR}
                 , #{setYn,jdbcType=VARCHAR}
                 , #{goodsCode,jdbcType=VARCHAR}
                 , #{orderQty,jdbcType=VARCHAR}
                 , #{salePrice,jdbcType=DOUBLE}
                 , #{dcRate,jdbcType=DOUBLE}
                 , #{dcAmt,jdbcType=DOUBLE}
                 , #{dcAmtGoods,jdbcType=VARCHAR}
                 , #{dcAmtMemb,jdbcType=VARCHAR}
                 , #{dcAmtDiv,jdbcType=VARCHAR}
                 , #{dcAmtCard,jdbcType=VARCHAR}
                 , #{norestAllotMonths,jdbcType=VARCHAR}
                 <!--, #{shipCostCode,jdbcType=VARCHAR} -->
                 , #{counseltel,jdbcType=VARCHAR})
    </insert>
    
    <insert id="insertOrderdt" parameterType="com.cware.netshopping.domain.model.Orderdt" >
        INSERT INTO TORDERDT ( /* paorder.xml : pacommon.paorder.insertOrderdt by PaOrderController */
               ORDER_NO,         ORDER_G_SEQ,     ORDER_D_SEQ,    ORDER_W_SEQ,
               CUST_NO,          RECEIVER_SEQ,    ORDER_DATE,     ORDER_GB,
               DO_FLAG,          GOODS_GB,        MEDIA_GB,       MEDIA_CODE,
               GOODS_CODE,       GOODSDT_CODE,    GOODSDT_INFO,   SALE_PRICE,
               ORDER_QTY,        SYSCANCEL,       SYSLAST,        ORDER_AMT,
               DC_RATE_GOODS,    DC_RATE,         DC_AMT,         DC_AMT_GOODS,
               DC_AMT_MEMB,      DC_AMT_DIV,      DC_AMT_CARD,    RSALE_AMT,       SYSLAST_DC,
               SYSLAST_DC_GOODS, SYSLAST_DC_MEMB, SYSLAST_DC_DIV, SYSLAST_DC_CARD, SYSLAST_AMT,
               VAT_RATE,         MD_CODE,         WH_CODE,        SALE_YN,
               DELY_TYPE,        DELY_GB,         CUST_DELY_FLAG, FIRST_PLAN_DATE,
               OUT_PLAN_DATE,    STOCK_FLAG,      STOCK_KEY,      DELY_HOPE_DATE,
               PREOUT_GB,      GOODS_SELECT_NO,
               SINGLE_DUE_GB,    ANONY_YN,        MSG,            MSG_NOTE,
               HAPPY_CARD_YN,    SAVEAMT,         SAVEAMT_GB,     LAST_PROC_DATE,
               PROMO_NO1,        PROMO_NO2,       SET_GOODS_CODE, SET_MD_CODE,
               RECEIPT_YN,       SLIP_YN,         LAST_PROC_ID,   SYSLAST_NET,
               SYSLAST_VAT,      
               RSALE_NET,       
               RSALE_VAT,      
               DIRECT_YN,
               BUY_PRICE,        REMARK2_V,         REMARK3_N,   REMARK4_N, PRICE_SEQ  ,
               POUT_ORG_ORDER_NO, POUT_ORG_ORDER_NO_G_SEQ, POUT_ORG_ORDER_NO_D_SEQ, POUT_ORG_ORDER_NO_W_SEQ
               )
        VALUES (#{orderNo,jdbcType=VARCHAR},        LTRIM(TO_CHAR(#{orderGSeq,jdbcType=VARCHAR}, '000')), LTRIM(TO_CHAR(#{orderDSeq,jdbcType=VARCHAR}, '000')), #{orderWSeq,jdbcType=VARCHAR},
                #{custNo,jdbcType=VARCHAR},             #{receiverSeq,jdbcType=VARCHAR},    #{orderDate,jdbcType=TIMESTAMP},        #{orderGb,jdbcType=VARCHAR},
                #{doFlag,jdbcType=VARCHAR},             #{goodsGb,jdbcType=VARCHAR},        #{mediaGb,jdbcType=VARCHAR},        #{mediaCode,jdbcType=VARCHAR},
                #{goodsCode,jdbcType=VARCHAR},      #{goodsdtCode,jdbcType=VARCHAR},        #{goodsdtInfo,jdbcType=VARCHAR},    #{salePrice,jdbcType=DOUBLE},
                #{orderQty,jdbcType=VARCHAR},       #{syscancel,jdbcType=VARCHAR},      #{syslast,jdbcType=VARCHAR},        #{orderAmt,jdbcType=DOUBLE},
                #{dcRateGoods,jdbcType=VARCHAR},    #{dcRate,jdbcType=DOUBLE},          #{dcAmt,jdbcType=DOUBLE},           #{dcAmtGoods,jdbcType=DOUBLE},
                #{dcAmtMemb,jdbcType=DOUBLE},       #{dcAmtDiv,jdbcType=DOUBLE},        #{dcAmtCard,jdbcType=DOUBLE},       #{rsaleAmt,jdbcType=DOUBLE},        #{syslastDc,jdbcType=DOUBLE},
                #{syslastDcGoods,jdbcType=DOUBLE},  #{syslastDcMemb,jdbcType=DOUBLE},   #{syslastDcDiv,jdbcType=DOUBLE},    #{syslastDcCard,jdbcType=DOUBLE},   #{syslastAmt,jdbcType=DOUBLE},
                FUN_GET_GOODS_PRICE(#{goodsCode,jdbcType=VARCHAR},#{lastProcDate,jdbcType=TIMESTAMP},'11'), #{mdCode,jdbcType=VARCHAR}, #{whCode,jdbcType=VARCHAR}, #{saleYn,jdbcType=VARCHAR},
                #{delyType,jdbcType=VARCHAR},       #{delyGb,jdbcType=VARCHAR},             #{custDelyFlag,jdbcType=VARCHAR},   #{firstPlanDate,jdbcType=TIMESTAMP},
                #{outPlanDate,jdbcType=TIMESTAMP},      #{stockFlag,jdbcType=VARCHAR},      #{stockKey,jdbcType=VARCHAR},       #{delyHopeDate,jdbcType=TIMESTAMP},
                 #{preoutGb,jdbcType=VARCHAR},       #{goodsSelectNo,jdbcType=VARCHAR},
                #{singleDueGb,jdbcType=VARCHAR},    #{anonyYn,jdbcType=VARCHAR},        #{msg,jdbcType=VARCHAR},            #{msgNote,jdbcType=VARCHAR},
                #{happyCardYn,jdbcType=VARCHAR},    #{saveamt,jdbcType=DOUBLE},         #{saveamtGb,jdbcType=VARCHAR},      #{lastProcDate,jdbcType=TIMESTAMP},
                #{promoNo1,jdbcType=VARCHAR},       #{promoNo2,jdbcType=VARCHAR},       #{setGoodsCode,jdbcType=VARCHAR},   #{setMdCode,jdbcType=VARCHAR},
                #{receiptYn,jdbcType=VARCHAR},      #{slipYn,jdbcType=VARCHAR},             #{lastProcId,jdbcType=VARCHAR}
               ,FUN_REVISE_AMT(#{syslastAmt,jdbcType=DOUBLE} / (1+FUN_GET_GOODS_PRICE(#{goodsCode,jdbcType=VARCHAR},#{lastProcDate,jdbcType=TIMESTAMP},'11')/100),'V')
               ,#{syslastAmt,jdbcType=DOUBLE} - FUN_REVISE_AMT(#{syslastAmt,jdbcType=DOUBLE} / (1+FUN_GET_GOODS_PRICE(#{goodsCode,jdbcType=VARCHAR},#{lastProcDate,jdbcType=TIMESTAMP},'11')/100),'V') 
               ,FUN_REVISE_AMT(#{rsaleAmt,jdbcType=DOUBLE} / (1+FUN_GET_GOODS_PRICE(#{goodsCode,jdbcType=VARCHAR},#{lastProcDate,jdbcType=TIMESTAMP},'11')/100),'V') 
               ,#{rsaleAmt,jdbcType=DOUBLE} - FUN_REVISE_AMT(#{rsaleAmt,jdbcType=DOUBLE} / (1+FUN_GET_GOODS_PRICE(#{goodsCode,jdbcType=VARCHAR},#{lastProcDate,jdbcType=TIMESTAMP},'11')/100),'V') 
               ,NVL((SELECT A.DIRECT_SHIP_YN FROM TGOODS A WHERE A.GOODS_CODE = #{goodsCode,jdbcType=VARCHAR}),'0'),
                #{buyPrice,jdbcType=DOUBLE},   #{remark2V,jdbcType=VARCHAR},    #{remark3N, jdbcType=NUMERIC},   #{remark4N,jdbcType=NUMERIC},   #{priceSeq,jdbcType=VARCHAR}
               ,#{poutOrgOrderNo,jdbcType=VARCHAR} ,#{poutOrgOrderNoGSeq,jdbcType=VARCHAR} ,#{poutOrgOrderNoDSeq,jdbcType=VARCHAR} ,#{poutOrgOrderNoWSeq,jdbcType=VARCHAR} )
    
    </insert>
    
     
     <insert id="insertOrdercostapply" parameterType="com.cware.netshopping.domain.model.Ordercostapply">
        INSERT INTO TORDERCOSTAPPLY ( /* paorder.xml : pacommon.paorder.insertOrdercostapply by PaOrderController */
               ORDER_NO
             , ORDER_G_SEQ
             , ORDER_D_SEQ
             , ORDER_W_SEQ
             , APPLY_COST_SEQ
             , SHIP_COST_NO
             , INSERT_ID
             , INSERT_DATE
             , MODIFY_ID
             , MODIFY_DATE
              )
        VALUES (
               #{orderNo      , jdbcType=VARCHAR}
             , #{orderGSeq    , jdbcType=VARCHAR}
             , #{orderDSeq    , jdbcType=VARCHAR}
             , #{orderWSeq    , jdbcType=VARCHAR}
             , #{applyCostSeq , jdbcType=VARCHAR}
             , #{shipCostNo   , jdbcType=NUMERIC}
             , #{insertId     , jdbcType=VARCHAR}
             , #{insertDate   , jdbcType=TIMESTAMP}
             , #{modifyId     , jdbcType=VARCHAR}
             , #{modifyDate   , jdbcType=TIMESTAMP}
               )
    </insert>
  
    <update id="updateOrderReceiptCancel" parameterType="com.cware.netshopping.domain.model.Orderreceipts" >
        UPDATE TORDERRECEIPTS TR
        SET     TR.REPAY_PB_AMT = 0
              , TR.CANCEL_YN    = '1'
              , TR.CANCEL_CODE  = '100'
              , TR.CANCEL_DATE  = #{cancelDate   , jdbcType=TIMESTAMP}
              , TR.Cancel_Id    = #{cancelId     , jdbcType=VARCHAR}
        WHERE TR.ORDER_NO = #{orderNo      , jdbcType=VARCHAR}
          AND TR.DO_FLAG  = '10'
          AND TR.SETTLE_GB IN ('11','15')
          AND TR.CANCEL_YN = '0'    
    </update>   

    <update id="updateOrdercostapply" parameterType="com.cware.netshopping.domain.model.Ordercostapply" >
        UPDATE TORDERCOSTAPPLY /* paorder.xml : pacommon.paorder.updateOrdercostapply by PaOrderController */
           SET APPLY_COST_SEQ =  #{applyCostSeq , jdbcType=VARCHAR}
             , SHIP_COST_NO =  #{shipCostNo   , jdbcType=NUMERIC}
             , MODIFY_ID    = #{modifyId,jdbcType=VARCHAR}
             , MODIFY_DATE  = #{modifyDate,jdbcType=TIMESTAMP}
         WHERE ORDER_NO     = #{orderNo      , jdbcType=VARCHAR}
           AND ORDER_G_SEQ  = #{orderGSeq    , jdbcType=VARCHAR}
           AND ORDER_D_SEQ  = #{orderDSeq    , jdbcType=VARCHAR}
           AND ORDER_W_SEQ  = #{orderWSeq    , jdbcType=VARCHAR}
    </update>
    
    <update id="updatePaOrderShipCost" parameterType="com.cware.netshopping.domain.model.PaOrderShipCost" >
        UPDATE TPAORDERSHIPCOST /* paorder.xml : pacommon.paorder.updatePaOrderShipCost by PaOrderController */
           SET 
                REMARK1_V      = '무통장'
               <if test = 'shpFeeAmt > 0'> 
                 ,REMARK3_N    = SHPFEE_COST
                 ,SHPFEE_COST  = #{shpFeeAmt    , jdbcType=VARCHAR}
               </if>
               
               <if test = 'paShpFeeAmt > 0'> 
                 ,REMARK2_N      = PA_SHPFEE_COST
                 ,PA_SHPFEE_COST = #{paShpFeeAmt   , jdbcType=VARCHAR}
               </if>
              
         WHERE ORDER_NO     = #{orderNo      , jdbcType=VARCHAR}
          AND  SEQ          = #{seq          , jdbcType=VARCHAR}
          
    </update>
    <insert id="insertOrdershipcost" parameterType="com.cware.netshopping.domain.model.Ordershipcost" >
        INSERT INTO TORDERSHIPCOST ( /* paorder.xml : pacommon.paorder.insertOrdershipcost by PaOrderController */
                      ORDER_NO
                    , SEQ
                    , RECEIVER_SEQ
                    , TYPE
                    , SHPFEE_CODE
                    , SHPFEE_COST
                    , DELY_TYPE
                    , ENTP_CODE
                    , SHIP_COST_NO
                    , INSERT_DATE
                    , INSERT_ID
                    , ORDER_G_SEQ
                    , ORDER_D_SEQ
                    , ORDER_W_SEQ
                    <if test = 'manualCancelAmt > 0'> <!-- 교환배송비 판매자 사유일때 저장.. -->
                    ,MANUAL_CANCEL_AMT
                    ,MANUAL_CANCEL_ID
                    ,MANUAL_CANCEL_DATE                   
                    </if>
                        
                     )
             SELECT   #{orderNo}
                    , TRIM(TO_CHAR(#{seq}, '000'))
                    , #{receiverSeq}
                    , #{type}
                    , #{shpfeeCode}
                    , #{shpfeeCost}
                    , #{delyType}
                    , #{entpCode}
                    , #{shipCostNo}
                    , #{insertDate}
                    , #{insertId}
                    , #{orderGSeq,jdbcType=VARCHAR}
                    , #{orderDSeq,jdbcType=VARCHAR}
                    , #{orderWSeq,jdbcType=VARCHAR}
                    <if test = 'manualCancelAmt > 0'> 
                    , #{manualCancelAmt,jdbcType=NUMERIC}
                    , #{manualCancelId,jdbcType=VARCHAR}
                    , #{manualCancelDate,jdbcType=TIMESTAMP}
                     </if>
                     
               FROM DUAL
    </insert>
    
    <insert id="insertOrderpromo" parameterType="com.cware.netshopping.domain.model.Orderpromo" >
        INSERT INTO TORDERPROMO ( /* paorder.xml : pacommon.paorder.insertOrderpromo by PaOrderController */
                      SEQ
                    , PROMO_NO
                    , DO_TYPE
                    , ORDER_NO
                    , ORDER_G_SEQ
                    , PROC_AMT
                    , CANCEL_AMT
                    , CALIM_AMT
                    , PROC_COST
                    , OWN_PROC_COST
                    , ENTP_PROC_COST
                    , ENTP_CODE
                    , INSERT_DATE
                    , INSERT_ID )
           VALUES (   #{seq, jdbcType=VARCHAR}
                    , #{promoNo, jdbcType=VARCHAR}
                    , #{doType, jdbcType=VARCHAR}
                    , #{orderNo, jdbcType=VARCHAR}
                    , #{orderGSeq, jdbcType=VARCHAR}
                    , #{procAmt, jdbcType=NUMERIC}
                    , #{cancelAmt, jdbcType=NUMERIC}
                    , #{claimAmt, jdbcType=NUMERIC}
                    , #{procCost, jdbcType=NUMERIC}
                    , #{ownProcCost, jdbcType=NUMERIC}
                    , #{entpProcCost, jdbcType=NUMERIC}
                    , #{entpCode, jdbcType=VARCHAR}
                    , #{insertDate, jdbcType=TIMESTAMP}
                    , #{insertId, jdbcType=VARCHAR} )
    </insert>
    
    
    
    <insert id="insertTpaOrderShipCost" parameterType="com.cware.netshopping.domain.model.PaOrderShipCost" >
        INSERT INTO TPAORDERSHIPCOST( /* paorder.xml : pacommon.paorder.insertTpaOrderShipCost by PaOrderController */
                ORDER_NO,          SEQ,            CUST_NO,        OUT_RECEIVER_SEQ,   RETURN_RECEIVER_SEQ,
                ORDER_DATE,     RECEIPT_NO,     TYPE,
                PA_SHPFEE_COST,    SHPFEE_COST,    SHPFEE_YN,
                MANUAL_CANCEL_AMT, INSERT_DATE,    INSERT_ID)
         VALUES(#{orderNo,jdbcType=VARCHAR},       #{seq,jdbcType=VARCHAR},          #{custNo,jdbcType=VARCHAR},       #{outReceiverSeq,jdbcType=VARCHAR},     #{returnReceiverSeq,jdbcType=VARCHAR},  
                #{orderDate,jdbcType=TIMESTAMP},  #{receiptNo,jdbcType=VARCHAR},     #{type,jdbcType=VARCHAR},
                #{paShpFeeAmt,jdbcType=NUMERIC},   #{shpFeeAmt,jdbcType=NUMERIC},    #{shpFeeYn,jdbcType=NUMERIC},
                #{manualCancelAmt,jdbcType=NUMERIC},#{insertDate,jdbcType=TIMESTAMP},#{insertId,jdbcType=VARCHAR})  
    </insert>
    
    <insert id="insertOrderreceipts" parameterType="com.cware.netshopping.domain.model.Orderreceipts" >
        INSERT INTO TORDERRECEIPTS ( /* paorder.xml : pacommon.paorder.insertOrderreceipts by PaOrderController */
                 RECEIPT_NO,        ORDER_NO,        CUST_NO,
                 DO_FLAG,           SETTLE_GB,       CARD_BANK_CODE,
                 CARD_NAME,         BANK_SEQ,        CARD_NO,
                 DEPOSITOR,         VALID_DATE,      QUEST_AMT,
                 RECEIPT_PLAN_DATE, OK_NO,           OK_DATE,
                 OK_MED,            OK_ERROR_CODE,   VAN_COMP,
                 PAY_MONTH,         NOREST_YN,       NOREST_RATE,
                 NOREST_AMT,        RECEIPT_AMT,     RECEIPT_DATE,
                 END_YN,            REPAY_PB_AMT,    CANCEL_YN,
                 SAVEAMT_USE_FLAG,  INSERT_DATE,
                 INSERT_ID,         REMARK,          REMARK2_V,
                 CVV,               REMARK1_V,       REMARK4_N,
                 REMARK3_N,         PROC_ID,         PROC_DATE,
                 PROTX_TXAUTHNO,    PARTIAL_CANCEL_YN, PAYBOX_IDENTIFIANT, 
                 PROTX_STATUS)
         VALUES (#{receiptNo,jdbcType=VARCHAR},     #{orderNo,jdbcType=VARCHAR},        #{custNo,jdbcType=VARCHAR},
                 #{doFlag,jdbcType=VARCHAR},        #{settleGb,jdbcType=VARCHAR},       #{cardBankCode,jdbcType=VARCHAR},
                 #{cardName,jdbcType=VARCHAR},      #{bankSeq,jdbcType=VARCHAR},        CWARE_ENC_DEC(#{cardNo,jdbcType=VARCHAR}, 'e'),
                 #{depositor,jdbcType=VARCHAR},     #{validDate,jdbcType=VARCHAR},      #{questAmt,jdbcType=DOUBLE},
                 TRUNC(#{receiptPlanDate,jdbcType=TIMESTAMP}), #{okNo,jdbcType=VARCHAR}, #{okDate,jdbcType=TIMESTAMP},
                 #{okMed,jdbcType=VARCHAR},         #{okErrorCode,jdbcType=VARCHAR},    #{vanComp,jdbcType=VARCHAR},
                 #{payMonth,jdbcType=VARCHAR},      #{norestYn,jdbcType=VARCHAR},       #{norestRate,jdbcType=VARCHAR},
                 #{norestAmt,jdbcType=VARCHAR},     #{receiptAmt,jdbcType=VARCHAR},     #{receiptDate,jdbcType=TIMESTAMP},
                 #{endYn,jdbcType=VARCHAR},         #{repayPbAmt,jdbcType=NUMERIC},     #{cancelYn,jdbcType=VARCHAR},
                 #{saveamtUseFlag,jdbcType=VARCHAR},#{insertDate,jdbcType=TIMESTAMP},
                 #{insertId,jdbcType=VARCHAR},      #{remark,jdbcType=VARCHAR},         #{remark2V,jdbcType=VARCHAR},
                 #{cvv,jdbcType=VARCHAR},           #{remark1V,jdbcType=VARCHAR},       #{remark4N,jdbcType=VARCHAR},
                 #{remark3N,jdbcType=VARCHAR},      #{procId,jdbcType=VARCHAR},         NVL(#{procDate,jdbcType=TIMESTAMP}, #{insertDate,jdbcType=TIMESTAMP}),
                 #{protxTxauthno,jdbcType=VARCHAR}, #{partialCancelYn,jdbcType=VARCHAR}, substrb(#{payboxIdentifiant,jdbcType=VARCHAR}, 1, 10),
                 #{protxStatus,jdbcType=VARCHAR} )
    </insert>
    
    <update id="updateOrderStockEnd" parameterType="com.cware.netshopping.domain.model.Orderstock" >
        UPDATE TORDERSTOCK /* paorder.xml : pacommon.paorder.updateOrderStockEnd by PaOrderController */
           SET OUT_PLAN_QTY = OUT_PLAN_QTY + #{orderQty,jdbcType=NUMERIC}
             , TOT_SALE_QTY = TOT_SALE_QTY + #{orderQty,jdbcType=VARCHAR}
             , MODIFY_ID    = #{modifyId,jdbcType=VARCHAR}
             , MODIFY_DATE  = #{modifyDate,jdbcType=TIMESTAMP}
         WHERE GOODS_CODE   = #{goodsCode,jdbcType=VARCHAR}
           AND GOODSDT_CODE = #{goodsdtCode,jdbcType=VARCHAR}
           AND WH_CODE      = #{whCode,jdbcType=VARCHAR}
    </update>
    
   <update id="updateOrderStock" parameterType="com.cware.netshopping.domain.model.Orderstock" >
        UPDATE TORDERSTOCK /* paorder.xml : pacommon.paorder.updateOrderStock by PaOrderController */
           SET OUT_PLAN_QTY = OUT_PLAN_QTY + #{outPlanQty,jdbcType=NUMERIC}
             , ORDER_QTY    = ORDER_QTY    + #{orderQty,jdbcType=NUMERIC}
             , TOT_SALE_QTY = TOT_SALE_QTY + #{totSaleQty,jdbcType=NUMERIC}
             , MODIFY_ID    = #{modifyId,jdbcType=VARCHAR}
             , MODIFY_DATE  = #{modifyDate,jdbcType=TIMESTAMP}
         WHERE GOODS_CODE   = #{goodsCode,jdbcType=VARCHAR}
           AND GOODSDT_CODE = #{goodsdtCode,jdbcType=VARCHAR}
           AND WH_CODE      = #{whCode,jdbcType=VARCHAR}
    </update>
    
    
    <select id="selectOrderAbleQtyPa" parameterType="hashMap" resultType="int">
        SELECT /* paorder.xml : pacommon.paorder.selectOrderAbleQtyPa by PaOrderController */
               FUN_GET_ORDER_ABLE_QTY_PA(#{goodsCode, jdbcType=VARCHAR}
                                       , #{goodsdtCode, jdbcType=VARCHAR}
                                       , #{whCode, jdbcType=VARCHAR}) 
          FROM DUAL
    </select>
    
    <select id="selectGoodsForStock" parameterType="HashMap" resultType="HashMap">
        SELECT /* paorder.xml : pacommon.paorder.selectGoodsForStock by PaOrderController */
                BUY_MED
              , DECODE(SIGN(RESERV_OUT_DATE - SYSDATE ), 1, nvl(RESERV_GOODS_YN, '0'), '0') AS RESERV_GOODS_YN
              , TO_CHAR(RESERV_OUT_DATE, 'YYYY/MM/DD') AS RESERV_OUT_DATE
              , NVL(AVG_DELY_LEADTIME, 0) AS AVG_DELY_LEADTIME
          FROM TGOODS
         WHERE GOODS_CODE = #{goodsCode,jdbcType=VARCHAR}
    </select>
    
    <select id="selectGoodsCheckDelyGb" parameterType="hashMap" resultType="hashMap">
         SELECT /* paorder.xml : pacommon.paorder.selectGoodsCheckDelyGb by PaOrderController */
                  SUBSTR(FUN_ORDER_DELY_GB_WH_CODE(#{delyGb,jdbcType=VARCHAR}, #{whCode,jdbcType=VARCHAR}, #{goodsCode,jdbcType=VARCHAR}, #{custNo,jdbcType=VARCHAR}, #{receiverSeq,jdbcType=VARCHAR}),1,2) AS DELY_GB
                , SUBSTR(FUN_ORDER_DELY_GB_WH_CODE(#{delyGb,jdbcType=VARCHAR}, #{whCode,jdbcType=VARCHAR}, #{goodsCode,jdbcType=VARCHAR}, #{custNo,jdbcType=VARCHAR}, #{receiverSeq,jdbcType=VARCHAR}),3,3) AS WH_CODE
           FROM DUAL
          WHERE ROWNUM = 1
    </select>
    
    <!-- ASIS :: sql.order.st.selectSqlCurCounselQtyA -->
    <select id="selectCurCounselQtyA" parameterType="hashMap" resultType="long">
        SELECT /* paorder.xml : pacommon.paorder.selectCurCounselQtyA by PaOrderController */
               NVL(SUM(COUNSEL_QTY),0)
          FROM TCOUNSEL
         WHERE GOODS_CODE       = #{goodsCode, jdbcType=VARCHAR}
           AND GOODS_SELECT_NO &lt; #{goodsSelectNo, jdbcType=VARCHAR}
           AND WH_CODE          = #{whCode, jdbcType=VARCHAR}
    </select>
    
    <!-- ASIS :: sql.order.st.selectSqlCurCounselQtyB -->
    <select id="selectCurCounselQtyB" parameterType="hashMap" resultType="long">
        SELECT /* paorder.xml :  pacommon.paorder.selectCurCounselQtyB by PaOrderController */
               NVL(SUM(COUNSEL_QTY),0)
          FROM TCOUNSEL
         WHERE GOODS_CODE       = #{goodsCode, jdbcType=VARCHAR}
           AND GOODSDT_CODE     = #{goodsdtCode, jdbcType=VARCHAR}
           AND GOODS_SELECT_NO &lt; #{goodsSelectNo, jdbcType=VARCHAR}
           AND WH_CODE          = #{whCode, jdbcType=VARCHAR}
    </select>
    
    <!-- ASIS :: sql.order.st.selectSqlCurCounselQtyC -->
    <select id="selectCurCounselQtyC" parameterType="hashMap" resultType="long">
        SELECT /* paorder.xml : pacommon.paorder.selectCurCounselQtyC by PaOrderController */
               NVL(SUM(COUNSEL_QTY),0)
          FROM TCOUNSEL
         WHERE GOODS_CODE       = #{goodsCode, jdbcType=VARCHAR}
           AND GOODS_SELECT_NO &lt; #{goodsSelect_no, jdbcType=VARCHAR}
           AND WH_CODE          = #{whCode, jdbcType=VARCHAR}
    </select>

    <!-- ASIS :: sql.order.st.selectSqlCurCounselQtyD -->
    <select id="selectCurCounselQtyD" parameterType="hashMap" resultType="long">
        SELECT /* paorder.xml : pacommon.paorder.selectCurCounselQtyD by PaOrderController */
               NVL(SUM(COUNSEL_QTY),0)
          FROM TCOUNSEL
         WHERE GOODS_CODE       = #{goodsCode, jdbcType=VARCHAR}
           AND GOODSDT_CODE     = #{goodsdtCode, jdbcType=VARCHAR}
           AND GOODS_SELECT_NO &lt; #{goodsSelectNo, jdbcType=VARCHAR}
           AND WH_CODE          = #{whCode, jdbcType=VARCHAR}
    </select>
    
    <!-- ASIS :: sql.order.st.selectSqlMaxSaleQtyA -->
    <select id="selectMaxSaleQtyA" parameterType="hashMap" resultType="hashMap">
        SELECT /* paorder.xml : pacommon.paorder.selectMaxSaleQtyA by PaOrderController */
                NVL(MAX(A.MAX_SALE_QTY),0) AS MAX_SALE_QTY
              , NVL(SUM(B.TOT_SALE_QTY),0) AS TOT_SALE_QTY
              , NVL(SUM(B.ORDER_QTY),   0) AS ORDER_QTY
              , NVL(SUM(B.OUT_PLAN_QTY),0) AS OUT_PLAN_QTY
           FROM TINPLANQTY A
              , TORDERSTOCK B
          WHERE A.GOODS_CODE     = B.GOODS_CODE
            AND A.GOODS_CODE     = #{goodsCode, jdbcType=VARCHAR}
            <!-- AND A.START_DATE &lt;= TRUNC(sysdate)
            AND A.END_DATE   &gt;= TRUNC(sysdate) -->
            AND SYSDATE BETWEEN A.START_DATE AND A.END_DATE
            AND B.WH_CODE        = #{whCode, jdbcType=VARCHAR}
    </select>

    <!-- ASIS :: orderStockDAO.getMaxSaleQtyB -->
    <select id="selectMaxSaleQtyB" parameterType="hashMap" resultType="hashMap">
        SELECT /* paorder.xml : pacommon.paorder.selectMaxSaleQtyB by PaOrderController */
               NVL(A.MAX_SALE_QTY,0) AS MAX_SALE_QTY
             , NVL(B.TOT_SALE_QTY,0) AS TOT_SALE_QTY
             , NVL(B.ORDER_QTY,0)    AS ORDER_QTY
             , NVL(B.OUT_PLAN_QTY,0) AS OUT_PLAN_QTY
          FROM TINPLANQTY  A
             , TORDERSTOCK B
         WHERE A.GOODS_CODE      = B.GOODS_CODE
           AND A.GOODSDT_CODE    = B.GOODSDT_CODE
           AND A.GOODS_CODE      = #{goodsCode, jdbcType=VARCHAR}
           AND A.GOODSDT_CODE    = #{goodsdtCode, jdbcType=VARCHAR}
           <!-- AND A.START_DATE &lt;= TRUNC(sysdate)
            AND A.END_DATE   &gt;= TRUNC(sysdate) -->
           AND SYSDATE BETWEEN A.START_DATE AND A.END_DATE
           AND B.WH_CODE         = #{whCode, jdbcType=VARCHAR}
    </select>

    <!-- ASIS :: sql.order.st.selectSqlMaxSaleQtyC -->
    <select id="selectMaxSaleQtyC" parameterType="hashMap" resultType="hashMap">
        SELECT /* paorder.xml : pacommon.paorder.selectMaxSaleQtyC by PaOrderController */
               NVL(MAX(A.MAX_SALE_QTY),0) AS MAX_SALE_QTY
             , NVL(SUM(B.TOT_SALE_QTY),0) AS TOT_SALE_QTY
             , NVL(SUM(B.ORDER_QTY),   0) AS ORDER_QTY
             , NVL(SUM(B.OUT_PLAN_QTY),0) AS OUT_PLAN_QTY
          FROM TINPLANQTY  A
             , TORDERSTOCK B
         WHERE A.GOODS_CODE      = B.GOODS_CODE
           AND A.GOODSDT_CODE    = B.GOODSDT_CODE
           AND A.GOODS_CODE      = #{goodsCode, jdbcType=VARCHAR}
           <!-- AND A.START_DATE &lt;= TRUNC(sysdate)
            AND A.END_DATE   &gt;= TRUNC(sysdate) -->
           AND SYSDATE BETWEEN A.START_DATE AND A.END_DATE
           AND B.WH_CODE         = #{whCode, jdbcType=VARCHAR}
    </select>
    
    <!-- ASIS :: sql.order.st.selectSqlSyslast -->
    <select id="selectSyslast" parameterType="hashMap" resultType="long">
        SELECT /* paorder.xml : pacommon.paorder.selectSyslast by PaOrderController */
               A.SYSLAST
          FROM TORDERDT A
         WHERE A.ORDER_NO    = #{orderNo, jdbcType=VARCHAR}
           AND A.ORDER_G_SEQ = #{orderGSeq, jdbcType=VARCHAR}
           AND A.ORDER_D_SEQ = #{orderDSeq, jdbcType=VARCHAR}
           AND A.ORDER_W_SEQ = #{orderWSeq, jdbcType=VARCHAR}
           AND A.DO_FLAG   &lt; '30'
    </select>
    
    <select id="selectDeliveryPointCount" parameterType="HashMap" resultType="long">
        SELECT /* paorder.xml : pacommon.paorder.selectDeliveryPointCount by PaOrderController */
               NVL(MAX(DELIVERY_POINT_COUNT),1)
            FROM TPOST
          WHERE POST_NO = #{postNo,jdbcType=VARCHAR}
    </select>
    
    <select id="selectRealStock" parameterType="HashMap" resultType="HashMap">
        SELECT /* paorder.xml : pacommon.paorder.selectRealStock by PaOrderController */
               SUM(A.AQTY) AS STOCK_QTY
             , SUM(A.AQTY) - #{orderSeq,jdbcType=VARCHAR} AS SELF_ORDER
          FROM VSTOCK A
         WHERE A.WH_CODE   = #{whCode,jdbcType=VARCHAR}
           AND A.GOODS_CODE   = #{goodsCode,jdbcType=VARCHAR}
           <if test='stockChkPlace == "2" '>
                AND A.GOODSDT_CODE = #{goodsdtCode,jdbcType=VARCHAR}
           </if>
           <if test='stockChkPlace == "3" and goodsdtCode != "000" '>
                AND A.GOODSDT_CODE = #{goodsdtCode,jdbcType=VARCHAR}
           </if>
         GROUP BY GOODS_CODE, GOODSDT_CODE
         ORDER BY GOODS_CODE, GOODSDT_CODE
    </select>
    
    <!--
    <select id="getDeliveryPointCount" parameterType="HashMap" resultType="long">
        SELECT /* order.xml : pacommon.paorder.getDeliveryPointCount by PaOrderController */
               CASE WHEN B.ROAD_ADDR_YN != '1'
                    THEN (SELECT NVL(MAX(DELIVERY_POINT_COUNT),1)
                          FROM   TPOST
                          WHERE  POST_NO = B.RECEIVER_POST)
                    ELSE (SELECT NVL(MAX(DELIVERY_POINT_COUNT),1)
                          FROM   TROADADDR C
                          WHERE  C.ROAD_ADDR_NO = B.ROAD_ADDR_NO)
                    END
        FROM   TRECEIVER B
        WHERE  B.CUST_NO = #{custNo,jdbcType=VARCHAR}
        AND    B.RECEIVER_SEQ = #{receiverSeq,jdbcType=VARCHAR}
    </select>
    -->
    
    <select id="getDeliveryPointCount" parameterType="HashMap" resultType="long">
       SELECT MAX(CNT) FROM( /* order.xml : pacommon.paorder.getDeliveryPointCount by PaOrderController */
              SELECT NVL(MAX(DELIVERY_POINT_COUNT),1) AS CNT
              FROM   TPOST
              WHERE  POST_NO = #{postNo,jdbcType=VARCHAR}
       union  all
              SELECT NVL(MAX(DELIVERY_POINT_COUNT),1) AS CNT
              FROM   TROADADDR C
              WHERE  C.ROAD_ADDR_NO = #{roadAddrNo,jdbcType=VARCHAR} )
    </select>
    
    
    <select id="getOutPlanCnt" parameterType="HashMap" resultType="long">
        SELECT /* paorder.xml : pacommon.paorder.getOutPlanCnt by PaOrderController */
               DECODE(SIGN(TO_NUMBER(TO_CHAR(SYSDATE, 'HH24MISS')-#{outPlanDateSys, jdbcType=VARCHAR})),-1,#{outPlanDateSet,jdbcType=VARCHAR},#{outPlanDateSet,jdbcType=VARCHAR}+1)
          FROM DUAL
    </select>
    
    
    <select id="getOutPlanCnt2" parameterType="HashMap" resultType="long">
        SELECT /* order.xml : custcenter.order.getOutPlanCnt by OrderInput */
               DECODE(SIGN(TO_NUMBER(TO_CHAR(TRUNC(SYSDATE, 'HH24'), 'HH24')) - DECODE(CAST(TO_CHAR(SYSDATE, 'd') AS NUMERIC), 7, 12, 14)), -1, 0, 1)
            FROM DUAL
    </select>
       
    
    
    <!-- 중간에 휴일이 있어도 정상적으로 계산 -->
    <select id="getDelyday2" databaseId="Oracle" parameterType="HashMap" resultType="HashMap">
        SELECT * /* paorder.xml : pacommon.paorder.getDelyday2 by PaOrderController */
          FROM (
                 SELECT /*+INDEX(A PK_TDELYDAY) */
                        TO_CHAR(YYMMDD, 'YYYY/MM/DD') AS DELYDAY
                      , ROWNUM AS RNUM
                   FROM TDELYDAY A
                  WHERE A.DELY_GB = #{delyGb,jdbcType=VARCHAR}
                    AND A.WORK_YN = #{workYn,jdbcType=VARCHAR}
                    <if test="outPlanDate != null and outPlanCnt != null">
                        AND A.YYMMDD &gt;= #{outPlanDate,jdbcType=TIMESTAMP}
                    </if>
               )
         WHERE RNUM &gt;  #{outPlanCnt,jdbcType=VARCHAR}
           AND RNUM &lt;= #{dataNum,jdbcType=NUMERIC} + #{outPlanCnt,jdbcType=VARCHAR}
    </select>
    
    <select id="getDelydayExcept" databaseId="Oracle" parameterType="HashMap" resultType="HashMap">
        SELECT /* paorder.xml : pacommon.paorder.getDelydayExcept by PaOrderController */
               TO_CHAR(#{outPlanDate,jdbcType=VARCHAR} + #{outPlanCnt,jdbcType=VARCHAR} - 1 + level, 'YYYY/MM/DD') AS DELYDAY
          FROM DUAL
         CONNECT BY LEVEL &lt;= #{dataNum,jdbcType=NUMERIC}
    </select>        
        
    <select id="getTargetGoodsdt" parameterType="String" resultType="String">
    <![CDATA[
        SELECT /* paorder.xml : pacommon.paorder.getTargetGoodsdt by PaOrderController */
               GOODSDT_CODE
          FROM TINPLANQTY
         WHERE (GOODS_CODE, LEAD_TIME, DAILY_CAPA_QTY) IN
               (SELECT GOODS_CODE, MAX(LEAD_TIME), MIN(DAILY_CAPA_QTY)
                  FROM TINPLANQTY
                 WHERE (GOODS_CODE, LEAD_TIME) IN
                       (SELECT GOODS_CODE, MAX(LEAD_TIME)
                          FROM TINPLANQTY A
                         WHERE A.GOODS_CODE = #{goodsCode,jdbcType=VARCHAR}
                           AND A.GOODSDT_CODE != '000'
                           /*AND A.START_DATE   <= TRUNC(sysdate)
                           AND A.END_DATE     >= TRUNC(sysdate)*/
                           AND SYSDATE BETWEEN A.START_DATE AND A.END_DATE
                         GROUP BY GOODS_CODE
                       )
                   AND GOODSDT_CODE != '000'
                   /*AND START_DATE   <= TRUNC(sysdate)
                   AND END_DATE     >= TRUNC(sysdate)*/
                   AND SYSDATE BETWEEN START_DATE AND END_DATE
                 GROUP BY GOODS_CODE
               )
           AND GOODSDT_CODE != '000'
           /*AND START_DATE   <= TRUNC(sysdate)
           AND END_DATE     >= TRUNC(sysdate)*/
           AND SYSDATE BETWEEN START_DATE AND END_DATE
           AND ROWNUM = 1
    ]]>
    </select>

    <select id="getSupplyCapa" parameterType="HashMap" resultType="HashMap">
    <![CDATA[
        SELECT /* paorder.xml : pacommon.paorder.getSupplyCapa by PaOrderController */
                 A.DAILY_CAPA_QTY
               , A.LEAD_TIME
          FROM TINPLANQTY A
         WHERE A.GOODS_CODE    = #{goodsCode,jdbcType=VARCHAR}
           AND A.GOODSDT_CODE  = #{goodsdtCode,jdbcType=VARCHAR}
           /*AND A.START_DATE   <= TRUNC(sysdate)
           AND A.END_DATE     >= TRUNC(sysdate)*/
           AND SYSDATE BETWEEN A.START_DATE AND A.END_DATE
           AND ROWNUM          = 1
    ]]>
    </select>
    
   <select id="selectCalShpfeeAmt" parameterType="hashMap" resultType="hashMap">
        SELECT /* paorder.xml : pacommon.paorder.selectCalShpfeeAmt by PaOrderController */
               FUN_GET_CUST_SHIPCOST(#{argOrderGb,jdbcType=VARCHAR},TO_DATE(#{argDate,jdbcType=TIMESTAMP},'YYYY/MM/DD HH24:MI:SS'),
                                     #{argCustNo,jdbcType=VARCHAR} ,#{argReceiverSeq,jdbcType=VARCHAR},
                                     #{argGoodsStr,jdbcType=VARCHAR},#{argAmtStr,jdbcType=VARCHAR},#{argQtyStr,jdbcType=VARCHAR}) AS RESULT_AMT
          FROM DUAL
   </select>
    
   <update id="updateOrdergoods" parameterType="com.cware.netshopping.domain.OrdergoodsVO" >
        UPDATE TORDERGOODS /* paorder.xml : pacommon.paorder.updateOrdergoods by PaOrderController */
           SET CANCEL_QTY  = NVL(CANCEL_QTY,0) + #{cancelQty,jdbcType=VARCHAR}
             , CLAIM_QTY   = NVL(CLAIM_QTY,0)  + #{claimQty,jdbcType=VARCHAR}
             , EXCH_CNT    = NVL(EXCH_CNT,0)   + #{exchCnt,jdbcType=VARCHAR}
             , AS_CNT      = NVL(AS_CNT,0)     + #{asCnt,jdbcType=VARCHAR}
         WHERE ORDER_NO    = #{orderNo,jdbcType=VARCHAR}
           AND ORDER_G_SEQ = #{orderGSeq,jdbcType=VARCHAR}
           AND CANCEL_QTY  = #{cancelQtyOrg,jdbcType=VARCHAR}
           AND CLAIM_QTY   = #{claimQtyOrg,jdbcType=VARCHAR}
           AND EXCH_CNT    = #{exchCntOrg,jdbcType=VARCHAR}
           AND AS_CNT      = #{asCntOrg,jdbcType=VARCHAR}
   </update>
   
   <update id="updateOrderdtSyslast" parameterType="com.cware.netshopping.domain.CanceldtVO" >
    <![CDATA[
        UPDATE TORDERDT /* paorder.xml : pacommon.paorder.updateOrderdtSyslast by PaOrderController */
           SET SYSCANCEL        = SYSCANCEL        + #{cancelQty,jdbcType=VARCHAR}
             , SYSLAST          = SYSLAST          - #{cancelQty,jdbcType=VARCHAR}
             , SYSLAST_DC       = SYSLAST_DC       - #{dcAmt,jdbcType=DOUBLE}
             , SYSLAST_DC_GOODS = SYSLAST_DC_GOODS - #{dcAmtGoods,jdbcType=DOUBLE}
             , SYSLAST_DC_MEMB  = SYSLAST_DC_MEMB  - #{dcAmtMemb,jdbcType=DOUBLE}
             , SYSLAST_DC_DIV   = SYSLAST_DC_DIV   - #{dcAmtDiv,jdbcType=DOUBLE}
             , SYSLAST_DC_CARD  = SYSLAST_DC_CARD  - #{dcAmtCard,jdbcType=DOUBLE}
             , SYSLAST_AMT      = SYSLAST_AMT      - #{rsaleAmt,jdbcType=DOUBLE}
             , LAST_PROC_ID     = #{lastProcId,jdbcType=VARCHAR}
             , SYSLAST_NET      = ROUND((SYSLAST_AMT-#{rsaleAmt,jdbcType=DOUBLE}) / (1+VAT_RATE/100), 0)
             , SYSLAST_VAT      = (SYSLAST_AMT-#{rsaleAmt,jdbcType=DOUBLE}) - ROUND((SYSLAST_AMT-#{rsaleAmt,jdbcType=DOUBLE}) / (1+VAT_RATE/100), 0)
         WHERE ORDER_NO    = #{orderNo,jdbcType=VARCHAR}
           AND ORDER_G_SEQ = #{orderGSeq,jdbcType=VARCHAR}
           AND ORDER_D_SEQ = #{orderDSeq,jdbcType=VARCHAR}
           AND ORDER_W_SEQ = '001'
           AND DO_FLAG     < '30'
    ]]>
    </update>
    
    <insert id="insertCanceldt" parameterType="com.cware.netshopping.domain.CanceldtVO" >
        INSERT INTO TCANCELDT ( /* paorder.xml : pacommon.paorder.insertTcanceldt by PaOrderController */
                 ORDER_NO,        ORDER_G_SEQ,     ORDER_D_SEQ,
                 ORDER_W_SEQ,     CUST_NO,         RECEIVER_SEQ,
                 CANCEL_DATE,     CANCEL_GB,       DO_FLAG,
                 CANCEL_CODE,     GOODS_GB,        MEDIA_GB,
                 MEDIA_CODE,      GOODS_CODE,      GOODSDT_CODE,
                 GOODSDT_INFO,    SALE_PRICE,      CANCEL_QTY,
                 CANCEL_AMT,      DC_RATE_GOODS,   DC_RATE,
                 DC_AMT,          DC_AMT_GOODS,    DC_AMT_MEMB,
                 DC_AMT_DIV,      DC_AMT_CARD,     RSALE_AMT,       VAT_RATE,
                 MD_CODE,         SALE_YN,         WH_CODE,
                 DELY_TYPE,       DELY_GB,         DELY_HOPE_DATE,
                 DELY_HOPE_YN,    DELY_HOPE_TIME,  PREOUT_GB,
                 SINGLE_DUE_GB,   SAVEAMT,         SAVEAMT_GB,
                 LAST_PROC_DATE,  PROMO_NO1,       PROMO_NO2,
                 SET_GOODS_CODE,  SET_MD_CODE,     REMARK6_V,
                 LAST_PROC_ID,    RSALE_VAT,       
                 RSALE_NET,
                 BUY_PRICE,       REMARK4_N,       REMARK3_N,
                 CS_LGROUP,       CS_MGROUP,       CS_SGROUP,       CS_LMS_CODE )
        VALUES ( #{orderNo,jdbcType=VARCHAR},           #{orderGSeq,jdbcType=VARCHAR},      #{orderDSeq,jdbcType=VARCHAR},
                 #{orderWSeq,jdbcType=VARCHAR},         #{custNo,jdbcType=VARCHAR},         #{receiverSeq,jdbcType=VARCHAR},
                 #{cancelDate,jdbcType=TIMESTAMP},      #{cancelGb,jdbcType=VARCHAR},       #{doFlag,jdbcType=VARCHAR},
                 #{cancelCode,jdbcType=VARCHAR},        #{goodsGb,jdbcType=VARCHAR},        #{mediaGb,jdbcType=VARCHAR},
                 #{mediaCode,jdbcType=VARCHAR},         #{goodsCode,jdbcType=VARCHAR},      #{goodsdtCode,jdbcType=VARCHAR},
                 #{goodsdtInfo,jdbcType=VARCHAR},       #{salePrice,jdbcType=DOUBLE},       #{cancelQty,jdbcType=VARCHAR},
                 #{cancelAmt,jdbcType=DOUBLE},          #{dcRateGoods,jdbcType=DOUBLE},     #{dcRate,jdbcType=DOUBLE},
                 #{dcAmt,jdbcType=DOUBLE},              #{dcAmtGoods,jdbcType=DOUBLE},      #{dcAmtMemb,jdbcType=DOUBLE},
                 #{dcAmtDiv,jdbcType=DOUBLE},           #{dcAmtCard,jdbcType=DOUBLE},       #{rsaleAmt,jdbcType=DOUBLE}, #{vatRate,jdbcType=DOUBLE},
                 #{mdCode,jdbcType=VARCHAR},            #{saleYn,jdbcType=VARCHAR},         #{whCode,jdbcType=VARCHAR},
                 #{delyType,jdbcType=VARCHAR},          #{delyGb,jdbcType=VARCHAR},         #{delyHopeDate,jdbcType=TIMESTAMP},
                 #{delyHopeYn,jdbcType=VARCHAR},        #{delyHopeTime,jdbcType=VARCHAR},   #{preoutGb,jdbcType=VARCHAR},
                 #{singleDueGb,jdbcType=VARCHAR},       #{saveamt,jdbcType=DOUBLE},         #{saveamtGb,jdbcType=VARCHAR},
                 #{cancelDate,jdbcType=TIMESTAMP},      #{promoNo1,jdbcType=VARCHAR},       #{promoNo2,jdbcType=VARCHAR},
                 #{setGoodsCode,jdbcType=VARCHAR},      #{setMdCode,jdbcType=VARCHAR},      #{remark6V,jdbcType=VARCHAR},
                 #{lastProcId,jdbcType=VARCHAR},        #{rsaleVat,jdbcType=VARCHAR}, 
                 #{rsaleNet,jdbcType=VARCHAR},
                 #{buyPrice,jdbcType=DOUBLE},           #{rsalePaAmt,jdbcType=DOUBLE},      #{remark3N,jdbcType=NUMERIC}, 
                 #{csLgroup,jdbcType=VARCHAR},          #{csMgroup,jdbcType=VARCHAR},       #{csSgroup,jdbcType=VARCHAR},       #{csLmsCode,jdbcType=VARCHAR})
    </insert>
    
    <update id="updateInplanqty" parameterType="com.cware.netshopping.domain.CanceldtVO" >
    <![CDATA[
         UPDATE TINPLANQTY T  /* paorder.xml : pacommon.paorder.updateInplanqty by PaOrderController */
            SET T.MAX_SALE_QTY = T.MAX_SALE_QTY - #{cancelQty,jdbcType=VARCHAR}
              , T.MODIFY_ID    = #{lastProcId,jdbcType=VARCHAR}
              , T.MODIFY_DATE  = #{modifyDate,jdbcType=TIMESTAMP}            
          WHERE T.START_DATE > TRUNC((SELECT ORDER_DATE
                                       FROM TORDERM
                                      WHERE ORDER_NO = #{orderNo,jdbcType=VARCHAR}))
            AND T.GOODS_CODE   = #{goodsCode,jdbcType=VARCHAR}   
            AND T.GOODSDT_CODE = #{goodsdtCode,jdbcType=VARCHAR}
            AND T.INSERT_DATE  > (SELECT ORDER_DATE
                                    FROM TORDERM
                                   WHERE ORDER_NO = #{orderNo,jdbcType=VARCHAR})
    ]]>
    </update>
    
    <update id="updateReceiptsRepay" parameterType="hashMap" >
        UPDATE TORDERRECEIPTS /* paorder.xml : pacommon.paorder.updateReceiptsRepay by PaOrderController */
           SET REPAY_PB_AMT = REPAY_PB_AMT - #{questAmt,jdbcType=DOUBLE}
         WHERE ORDER_NO   = #{orderNo,jdbcType=VARCHAR}
           AND SETTLE_GB  = #{settleGb,jdbcType=VARCHAR}
           AND RECEIPT_NO = #{receiptNo, jdbcType=VARCHAR}
    </update>
    
    <update id="updateTorderpromo" parameterType="com.cware.netshopping.domain.model.Orderpromo" >
        UPDATE TORDERPROMO /* paorder.xml : pacommon.paorder.updateTorderpromo by PaOrderController */
           SET CANCEL_YN   = '1'
             , CANCEL_DATE = #{cancelDate,jdbcType=TIMESTAMP}
             , CANCEL_ID   = #{cancelId,jdbcType=VARCHAR}
         WHERE ORDER_NO    = #{orderNo,jdbcType=VARCHAR}
           AND ORDER_G_SEQ = #{orderGSeq,jdbcType=VARCHAR}
    </update>
    
    <select id="getLimitYn" parameterType="String" resultType="String">
        SELECT /* paorder.xml : pacommon.paorder.getLimitYn by PaCancelController */
               LIMIT_YN
          FROM TPROMOM
         WHERE PROMO_NO = #{promoNo, jdbcType=VARCHAR}
    </select>
    
    <delete id="deletePromoCounsel" parameterType="com.cware.netshopping.domain.model.Promocounsel" >
        DELETE /* paorder.xml : pacommon.paorder.getLimitYn by PaCancelController */
          FROM TPROMOCOUNSEL
         WHERE ORDER_NO    = #{orderNo, jdbcType=VARCHAR}
           AND ORDER_G_SEQ = #{orderGSeq, jdbcType=VARCHAR}
    </delete>
    
    <select id="selectMaxNo" parameterType="hashMap" resultType="string">
        select /* paorder.xml : pacommon.paorder.selectMaxNo by PaOrderController */
               /*+INDEX_DESC( ${table_name} PK_${table_name} ) */ ${column_name}
            from ${table_name}
        <trim prefix="WHERE" prefixOverrides="AND">
            <if test="mod_query != null"> ${mod_query} </if>
            and rownum = 1
        </trim>
    </select>
    
    <select id="selectGetOrgShipCost" parameterType="String" resultType="double">
       SELECT MAX(QUEST_AMT) AS QUEST_AMT 
         FROM (
                SELECT TR.QUEST_AMT
                FROM TORDERRECEIPTS TR 
                WHERE TR.ORDER_NO  = #{orderNo, jdbcType=VARCHAR} 
                  AND TR.CANCEL_YN = 0
                  AND TR.SETTLE_GB = '15'
                  AND TR.DO_FLAG   = '10'
                  AND TR.REPAY_PB_AMT != 0
               
                UNION
                
                SELECT 0
                FROM DUAL)     
    </select>
    
    <update id="updateOrderStockCancel20" parameterType="com.cware.netshopping.domain.OrderstockVO" >
        UPDATE TORDERSTOCK /* paorder.xml : pacommon.paorder.updateOrderStockCancel20 by PaOrderController */
           SET OUT_PLAN_QTY = OUT_PLAN_QTY - #{outPlanQty, jdbcType=NUMERIC}
             , TOT_SALE_QTY  = TOT_SALE_QTY - (CASE WHEN SYSDATE >= TO_DATE(FUN_GETCONFIG('CANCEL_QTY_RETURN_DATE'),'YYYYMMDDHH24MISS') THEN
                                                       #{totSaleQty,jdbcType=VARCHAR}
                                                    WHEN ( NVL(#{whCode,jdbcType=VARCHAR}, '') &lt;> '990') THEN
                                                       #{totSaleQty,jdbcType=VARCHAR}
													ELSE
														0 
												END)
            <!--<if test='whCode != "990"' > 
             , TOT_SALE_QTY = TOT_SALE_QTY - #{totSaleQty, jdbcType=NUMERIC}
            </if>-->
             , MODIFY_ID    = #{modifyId,jdbcType=VARCHAR}
             , MODIFY_DATE  = #{modifyDate,jdbcType=TIMESTAMP}
         WHERE GOODS_CODE   = #{goodsCode, jdbcType=VARCHAR}
           AND GOODSDT_CODE = #{goodsdtCode, jdbcType=VARCHAR}
           AND WH_CODE      = #{whCode, jdbcType=VARCHAR}
    </update>
    
     <update id="updateOrderStockCancel" parameterType="com.cware.netshopping.domain.OrderstockVO" >
        UPDATE TORDERSTOCK /* paorder.xml : pacommon.paorder.updateOrderStockCancel by PaOrderController */
           SET OUT_PLAN_QTY = OUT_PLAN_QTY - #{outPlanQty, jdbcType=NUMERIC}
             , ORDER_QTY    = ORDER_QTY    - #{orderQty, jdbcType=NUMERIC}
             , TOT_SALE_QTY  = TOT_SALE_QTY - (CASE WHEN SYSDATE >= TO_DATE(FUN_GETCONFIG('CANCEL_QTY_RETURN_DATE'),'YYYYMMDDHH24MISS') THEN
                                                       #{totSaleQty,jdbcType=VARCHAR}
                                                    WHEN ( NVL(#{whCode,jdbcType=VARCHAR}, '') &lt;> '990') THEN
                                                       #{totSaleQty,jdbcType=VARCHAR}
													ELSE
														0 
												END)
            <!--<if test='whCode != "990"' > 
             , TOT_SALE_QTY = TOT_SALE_QTY - #{totSaleQty, jdbcType=NUMERIC}
            </if>-->
             , MODIFY_ID    = #{modifyId,jdbcType=VARCHAR}
             , MODIFY_DATE  = #{modifyDate,jdbcType=TIMESTAMP}
         WHERE GOODS_CODE   = #{goodsCode, jdbcType=VARCHAR}
           AND GOODSDT_CODE = #{goodsdtCode, jdbcType=VARCHAR}
           AND WH_CODE      = #{whCode, jdbcType=VARCHAR}
    </update>
    
    <select id="selectOrderDt" parameterType="com.cware.netshopping.domain.CancelInputVO" resultType="com.cware.netshopping.domain.OrderdtVO">
        SELECT /* paorder.xml : pacommon.paorder.selectOrderDt by PaOrderController */
               OD.ORDER_NO 
             , OD.ORDER_G_SEQ
             , OD.ORDER_D_SEQ
             , OD.ORDER_W_SEQ
             , OD.ORDER_QTY
             , OD.DO_FLAG
             , OD.GOODS_GB
             , OD.MEDIA_GB
             , OD.MEDIA_CODE
             , OD.GOODSDT_INFO
             , OD.MD_CODE
             , OD.SALE_YN
             , OD.DELY_TYPE
             , OD.DELY_GB
             , OD.DELY_HOPE_DATE
             , OD.DELY_HOPE_YN
             , OD.DELY_HOPE_TIME
             , OD.PREOUT_GB
             , OD.SINGLE_DUE_GB
             , OD.GOODS_CODE
             , OD.GOODSDT_CODE
             , OD.SYSLAST
             , OD.ORDER_QTY
             , OD.RECEIVER_SEQ
             , OD.WH_CODE
             , OD.CUST_NO
             , OD.SALE_PRICE
             , OD.BUY_PRICE
             , OD.DC_RATE_GOODS
             , OD.DC_RATE
             , OD.DC_AMT_GOODS
             , OD.DC_AMT_MEMB
             , OD.DC_AMT_DIV
             , OD.DC_AMT_CARD
             , OD.DC_AMT
             , OD.RSALE_NET
             , OD.RSALE_VAT
             , OD.RSALE_AMT
             , OD.VAT_RATE
             , OD.SYSCANCEL
             , OD.SYSLAST_DC_GOODS
             , OD.SYSLAST_DC_MEMB
             , OD.SYSLAST_DC_DIV
             , OD.SYSLAST_DC_CARD
             , OD.SYSLAST_DC
             , OD.SYSLAST_AMT
             , OD.SAVEAMT_GB
             , OD.SAVEAMT
             , OD.ORDER_AMT
             , DECODE(OD.DELY_TYPE,'10','100001', DECODE(SUBSTR(GS.BUY_MED,2,1),'1','100001','3','100001',GS.ENTP_CODE)) AS ENTP_CODE
             , OD.REMARK3_N
             , OD.SYSLAST
         FROM TORDERDT OD
            , TGOODS GS
        WHERE OD.GOODS_CODE = GS.GOODS_CODE
          AND ORDER_NO      = #{orderNo, jdbcType=VARCHAR}   
          <!--AND ORDER_G_SEQ   = #{orderGSeq, jdbcType=VARCHAR} -->
          AND SYSLAST > 0
    </select>
      <select id="selectOrderDtOld" parameterType="com.cware.netshopping.domain.CancelInputVO" resultType="com.cware.netshopping.domain.OrderdtVO">
        SELECT /* paorder.xml : pacommon.paorder.selectOrderDt by PaOrderController */
               OD.ORDER_NO 
             , OD.ORDER_G_SEQ
             , OD.ORDER_D_SEQ
             , OD.ORDER_W_SEQ
             , OD.ORDER_QTY
             , OD.DO_FLAG
             , OD.GOODS_GB
             , OD.MEDIA_GB
             , OD.MEDIA_CODE
             , OD.GOODSDT_INFO
             , OD.MD_CODE
             , OD.SALE_YN
             , OD.DELY_TYPE
             , OD.DELY_GB
             , OD.DELY_HOPE_DATE
             , OD.DELY_HOPE_YN
             , OD.DELY_HOPE_TIME
             , OD.PREOUT_GB
             , OD.SINGLE_DUE_GB
             , OD.GOODS_CODE
             , OD.GOODSDT_CODE
             , OD.SYSLAST
             , OD.ORDER_QTY
             , OD.RECEIVER_SEQ
             , OD.WH_CODE
             , OD.CUST_NO
             , OD.SALE_PRICE
             , OD.BUY_PRICE
             , OD.DC_RATE_GOODS
             , OD.DC_RATE
             , OD.DC_AMT_GOODS
             , OD.DC_AMT_MEMB
             , OD.DC_AMT_DIV
             , OD.DC_AMT_CARD
             , OD.DC_AMT
             , OD.RSALE_NET
             , OD.RSALE_VAT
             , OD.RSALE_AMT
             , OD.VAT_RATE
             , OD.SYSCANCEL
             , OD.SYSLAST_DC_GOODS
             , OD.SYSLAST_DC_MEMB
             , OD.SYSLAST_DC_DIV
             , OD.SYSLAST_DC_CARD
             , OD.SYSLAST_DC
             , OD.SYSLAST_AMT
             , OD.SAVEAMT_GB
             , OD.SAVEAMT
             , OD.ORDER_AMT
             , DECODE(OD.DELY_TYPE,'10','100001', DECODE(SUBSTR(GS.BUY_MED,2,1),'1','100001','3','100001',GS.ENTP_CODE)) AS ENTP_CODE
             , OD.REMARK3_N
             , OD.SYSLAST
         FROM TORDERDT OD
            , TGOODS GS
        WHERE OD.GOODS_CODE = GS.GOODS_CODE
          AND ORDER_NO      = #{orderNo, jdbcType=VARCHAR}   
          AND ORDER_G_SEQ   = #{orderGSeq, jdbcType=VARCHAR}
          AND SYSLAST > 0
    </select>
    
    <select id="selectOrderDtList" parameterType="com.cware.netshopping.domain.CancelInputVO" resultType="com.cware.netshopping.domain.OrderdtVO">
        SELECT /* paorder.xml : pacommon.paorder.selectOrderDt by PaOrderController */
               OD.ORDER_NO 
             , OD.ORDER_G_SEQ
             , OD.ORDER_D_SEQ
             , OD.ORDER_W_SEQ
             , OD.ORDER_QTY
             , OD.DO_FLAG
             , OD.GOODS_GB
             , OD.MEDIA_GB
             , OD.MEDIA_CODE
             , OD.GOODSDT_INFO
             , OD.MD_CODE
             , OD.SALE_YN
             , OD.DELY_TYPE
             , OD.DELY_GB
             , OD.DELY_HOPE_DATE
             , OD.DELY_HOPE_YN
             , OD.DELY_HOPE_TIME
             , OD.PREOUT_GB
             , OD.SINGLE_DUE_GB
             , OD.GOODS_CODE
             , OD.GOODSDT_CODE
             , OD.SYSLAST
             , OD.ORDER_QTY
             , OD.RECEIVER_SEQ
             , OD.WH_CODE
             , OD.CUST_NO
             , OD.SALE_PRICE
             , OD.BUY_PRICE
             , OD.DC_RATE_GOODS
             , OD.DC_RATE
             , OD.DC_AMT_GOODS
             , OD.DC_AMT_MEMB
             , OD.DC_AMT_DIV
             , OD.DC_AMT_CARD
             , OD.DC_AMT
             , OD.RSALE_NET
             , OD.RSALE_VAT
             , OD.RSALE_AMT
             , OD.VAT_RATE
             , OD.SYSCANCEL
             , OD.SYSLAST_DC_GOODS
             , OD.SYSLAST_DC_MEMB
             , OD.SYSLAST_DC_DIV
             , OD.SYSLAST_DC_CARD
             , OD.SYSLAST_DC
             , OD.SYSLAST_AMT
             , OD.SAVEAMT_GB
             , OD.SAVEAMT
             , OD.ORDER_AMT
             , DECODE(OD.DELY_TYPE,'10','100001', DECODE(SUBSTR(GS.BUY_MED,2,1),'1','100001','3','100001',GS.ENTP_CODE)) AS ENTP_CODE
             , OD.REMARK3_N
             , B.CUST_NAME
         FROM TORDERDT OD
            , TGOODS GS
            , TCUSTOMER B
        WHERE OD.GOODS_CODE = GS.GOODS_CODE
          AND ORDER_NO      = #{orderNo, jdbcType=VARCHAR}   
          AND ORDER_G_SEQ   = #{orderGSeq, jdbcType=VARCHAR} 
          AND OD.CUST_NO = B.CUST_NO
    </select>
    
    <select id="selectWSeq" parameterType="com.cware.netshopping.domain.CancelInputVO" resultType="string">
        SELECT /* paorder.xml : pacommon.paorder.selectWSeq by PaOrderController */
               LPAD(MAX(ORDER_W_SEQ) + 1, 3, 0)
          FROM TORDERPROC
         WHERE ORDER_NO    = #{orderNo, jdbcType=VARCHAR}   
           AND ORDER_G_SEQ = #{orderGSeq, jdbcType=VARCHAR}
           AND ORDER_D_SEQ = '001'
    </select>
    
    <select id="selectOrderGoods" parameterType="hashMap" resultType="com.cware.netshopping.domain.OrdergoodsVO">
        SELECT /* paorder.xml : pacommon.paorder.selectOrderGoods by PaOrderController */
               TG.CANCEL_QTY
             , TG.CLAIM_QTY
             , TG.EXCH_CNT
             , TG.AS_CNT
          FROM TORDERGOODS TG
         WHERE TG.ORDER_NO    = #{orderNo, jdbcType=VARCHAR}
           AND TG.ORDER_G_SEQ = #{orderGSeq, jdbcType=VARCHAR}
    </select>
    
    <select id="selectOrderShipCost" parameterType="hashMap" resultType="com.cware.netshopping.domain.OrdershipcostVO">
        SELECT /* paorder.xml : pacommon.paorder.selectOrderShipCost by PaOrderController */
               A.SEQ
             , A.TYPE
             , A.SHPFEE_CODE
             , A.SHPFEE_COST
             , A.RECEIVER_SEQ
             , A.DELY_TYPE
             , A.ENTP_CODE
             , A.ORDER_NO
             , A.ORDER_G_SEQ
             , A.ORDER_D_SEQ
             , A.ORDER_W_SEQ
          FROM TORDERSHIPCOST A
         WHERE A.ORDER_NO  = #{orderNo, jdbcType=VARCHAR}
           AND A.ENTP_CODE = #{entpCode, jdbcType=VARCHAR}
           AND A.TYPE      = '10'
          AND ROWNUM       = '1'
    </select>
    
    <select id="selectOrderShipCostOrg" parameterType="hashMap" resultType="com.cware.netshopping.domain.OrdershipcostVO">
        SELECT /* paorder.xml : pacommon.paorder.selectOrderShipCostOrg by PaOrderController */
               A.RECEIVER_SEQ
             , A.ENTP_CODE
             , A.SHIP_COST_NO
             , SUM(DECODE(A.TYPE, '10', A.SHPFEE_COST, A.SHPFEE_COST * -1)) AS SHPFEE_COST
          FROM TORDERSHIPCOST A
         WHERE ORDER_NO = #{orderNo, jdbcType=VARCHAR}
           AND TYPE IN ('10', '20')
         GROUP BY RECEIVER_SEQ, ENTP_CODE , A.SHIP_COST_NO
    </select>
    
    <select id="selectOriginalOrderdtAll" parameterType="String" resultType="com.cware.netshopping.domain.OrderdtVO">
        SELECT /* paorder.xml : pacommon.paorder.selectOriginalOrderdtAll by PaOrderController */
               A.GOODS_CODE
             , A.ORDER_G_SEQ
             , A.ORDER_QTY
             , A.SYSLAST
             , A.SALE_PRICE
             , A.RECEIVER_SEQ
             , A.ORDER_DATE
             , A.CUST_NO
             , A.RSALE_AMT
             , B.CUST_NAME
          FROM TORDERDT A
             , TCUSTOMER B
         WHERE A.CUST_NO = B.CUST_NO
           AND A.ORDER_NO = #{orderNo, jdbcType=VARCHAR}         
    </select>
    
    
     <select id="selectOrderdtAll" parameterType="String" resultType="com.cware.netshopping.domain.OrderdtVO">
        SELECT /* paorder.xml : pacommon.paorder.selectOrderdtAll by PaOrderController */
               A.GOODS_CODE
             , A.GOODSDT_CODE
             , A.WH_CODE
             , A.ORDER_NO  
             , A.ORDER_G_SEQ
             , A.ORDER_D_SEQ
             , A.ORDER_W_SEQ
             , A.ORDER_QTY
             , A.SYSLAST
             , A.SALE_PRICE
             , A.RECEIVER_SEQ
             , A.ORDER_DATE
             , A.CUST_NO
             , A.RSALE_AMT
             , B.RECEIVER AS CUST_NAME
          FROM TORDERDT A, TRECEIVER B
         WHERE A.ORDER_NO       = #{orderNo, jdbcType=VARCHAR} 
           AND B.CUST_NO        = A.CUST_NO
           AND B.RECEIVER_SEQ   = A.RECEIVER_SEQ
           AND B.USE_YN         = '1'       
           AND A.SYSLAST        > 0
           /*AND A.ORDER_D_SEQ    = '001'*/
    </select>
    
    
   <select id="selectOrderdt4GSEQ" parameterType="hashMap" resultType="com.cware.netshopping.domain.OrderdtVO">
        SELECT /* paorder.xml : pacommon.paorder.selectOrderdt4GSEQ by PaOrderController */
               A.GOODS_CODE
             , A.ORDER_G_SEQ
             , A.ORDER_D_SEQ
             , A.ORDER_W_SEQ
             , A.ORDER_QTY
             , A.SYSLAST
             , A.SALE_PRICE
             , A.RECEIVER_SEQ
             , A.ORDER_DATE
             , A.CUST_NO
             , A.RSALE_AMT
             , B.CUST_NAME
          FROM TORDERDT A
             , TCUSTOMER B
         WHERE A.CUST_NO = B.CUST_NO
           AND A.ORDER_NO = #{orderNo, jdbcType=VARCHAR} 
           AND A.ORDER_G_SEQ = #{orderGSeq, jdbcType=VARCHAR}       
    </select>
    
    <select id="selectRsalePaAmt" parameterType="hashMap" resultType="double">
        SELECT /* paorder.xml : pacommon.paorder.selectRsalePaAmt by PaOrderController */
               FUN_GET_RSALE_PA_AMT(#{arg_order_gb,     jdbcType=VARCHAR}
                                  , #{arg_order_no,     jdbcType=VARCHAR}
                                  , #{arg_order_g_seq,  jdbcType=VARCHAR}
                                  , #{arg_order_d_seq,  jdbcType=VARCHAR}
                                  , #{arg_proc_qty,     jdbcType=DOUBLE})
          FROM DUAL
    </select>
    
    <select id="selectOrderPromo" parameterType="hashMap" resultType="com.cware.netshopping.domain.model.Orderpromo">
        SELECT /* paorder.xml : pacommon.paorder.selectOrderPromo by PaOrderController */
               PROMO_NO
          FROM TORDERPROMO
         WHERE ORDER_NO    = #{orderNo, jdbcType=VARCHAR}
           AND ORDER_G_SEQ = #{orderGSeq, jdbcType=VARCHAR}
           AND DO_TYPE IN ('10', '90', '92')
    </select>
    
    
    <select id="selectReciverPost" parameterType="hashMap" resultType="String">
        SELECT /* paorder.xml : pacommon.paorder.selectReciverNo by PaOrderProcessImpl */
               RECEIVER_POST
          FROM TRECEIVER
         WHERE CUST_NO      = #{custno, jdbcType=VARCHAR}
           AND RECEIVER_SEQ = #{recieverseq, jdbcType=VARCHAR}
    </select>
    
    
    
    <select id="selectPromoNo" parameterType="String" resultType="String">
        SELECT /* paorder.xml : pacommon.paorder.selectPromoNo by PaOrderController */
               /*+ INDEX_DESC(TP IDX_TPROMOM_01) */
               TP.PROMO_NO
          FROM TPROMOM TP
         WHERE TP.APP_TYPE = '10'
           AND TP.DO_TYPE  = #{doType, jdbcType=VARCHAR}
           AND TP.USE_CODE = '00'
           AND ROWNUM      = 1
    </select>
    
    <select id="selectLumpPromoNo" parameterType="com.cware.netshopping.domain.OrderdtVO" resultType="String">
        SELECT /* paorder.xml : pacommon.paorder.selectLumpPromoNo by PaOrderController */
		       MAX(TP.PROMO_NO) AS PROMO_NO
		  FROM TPROMOM 		TP
		     , TPPROMOTARGET TPR
		 WHERE TP.PROMO_NO 		= TPR.PROMO_NO
		  AND TP.APP_TYPE 		= '30'
		   AND TP.DO_TYPE 		= '70'
		   AND TP.USE_CODE 		= '00'
		   AND TPR.GOODS_CODE 	= #{goodsCode, jdbcType=VARCHAR}
		   AND SYSDATE BETWEEN TP.PROMO_BDATE AND TP.PROMO_EDATE
    </select>
    
    <select id="selectGiftPromo" parameterType="hashMap" resultType="hashMap">
        SELECT /* paorder.xml : pacommon.paorder.selectGiftPromo by PaOrderController */
               A.PROMO_NO
             , A.LIMIT_YN
             , A.LIMIT_QTY
         FROM  TPROMOM      A
             , TPPROMOTARGET B
             , TGOODS G
         WHERE A.PROMO_NO = B.PROMO_NO
           AND B.GOODS_CODE = G.GOODS_CODE
           AND SYSDATE BETWEEN A.PROMO_BDATE AND A.PROMO_EDATE
           AND A.USE_CODE ='00'
           AND B.GOODS_CODE = #{goodsCode, jdbcType=VARCHAR}
           AND A.GOODS_ALL_YN = '0'
           AND A.ORDER_MEDIA_ALL_YN = '1'
           AND A.MEDIA_CODE_ALL_YN  = '1'
           AND ( A.LIMIT_YN = '0' OR (A.LIMIT_YN = '1' AND A.LIMIT_QTY > NVL((SELECT SUM(SB.COUNSEL_QTY)
                                                      FROM TPROMOCOUNSEL SB
                                                     WHERE SB.PROMO_NO = A.PROMO_NO),0)))
           AND A.MEMB_GB_ALL_YN = '1'
           AND G.DO_NOT_GIFT_YN = '0'
           AND A.DO_TYPE = '10'
           AND A.USE_CODE ='00'

        UNION ALL
                        
        SELECT A.PROMO_NO
             , A.LIMIT_YN
             , A.LIMIT_QTY
          FROM TPROMOM A
             , TGOODS G
         WHERE A.GOODS_ALL_YN   = '1'
           AND A.USE_CODE       = '00'
           AND SYSDATE BETWEEN A.PROMO_BDATE AND A.PROMO_EDATE
           AND A.COUPON_YN      = '0'
           AND A.APP_TYPE = '10'
           AND A.ORDER_MEDIA_ALL_YN = '1'
           AND A.MEDIA_CODE_ALL_YN  = '1'
           AND A.MEMB_GB_ALL_YN = '1'
           AND ( A.LIMIT_YN = '0' OR (A.LIMIT_YN = '1' AND A.LIMIT_QTY > NVL((SELECT SUM(SB.COUNSEL_QTY)
                                                      FROM TPROMOCOUNSEL SB
                                                     WHERE SB.PROMO_NO = A.PROMO_NO),0)))
           AND G.DO_NOT_GIFT_YN = '0'
           AND A.DO_TYPE = '10'
           AND A.USE_CODE ='00'
        ORDER BY PROMO_NO DESC
    </select>
    
    <select id="selectGiftPromoDt" parameterType="hashMap" resultType="hashMap">
        SELECT /* paorder.xml : pacommon.paorder.selectGiftPromoDt by PaOrderController */
               A.GOODS_CODE
             , MIN(A.GOODSDT_CODE) AS GOODSDT_CODE
          FROM (
                SELECT GD.GOODS_CODE
                     , GD.GOODSDT_CODE
                     , FUN_GET_ORDER_ABLE_QTY(PG.GIFT_GOODS_CODE, GD.GOODSDT_CODE, G.WH_CODE) AS ORDER_ABLE_QTY
                  FROM TPROMOGIFT PG
                     , TGOODS G
                     , TGOODSDT GD
                 WHERE PG.GIFT_GOODS_CODE = GD.GOODS_CODE
                   AND PG.GIFT_GOODs_CODE = G.GOODS_CODE
                   AND GD.SALE_GB = '00'
                   AND PG.PROMO_NO = #{promoNo, jdbcType=VARCHAR}
                ) A
          WHERE A.ORDER_ABLE_QTY >= #{orderQty, jdbcType=NUMERIC}
          GROUP BY A.GOODS_CODE
          ORDER BY A.GOODS_CODE ASC
    </select>
    
    <select id="retrieveSumCouncelQty" parameterType="com.cware.netshopping.domain.model.Promocounsel" resultType="long">
        SELECT /* paorder.xml : pacommon.paorder.retrieveSumCouncelQty by PaOrderController */
               NVL(SUM(COUNSEL_QTY),0)
               AS CNT
          FROM TPROMOCOUNSEL
         WHERE PROMO_NO = #{promoNo,jdbcType=VARCHAR}
           AND #{goodsSelectNo,jdbcType=VARCHAR} > GOODS_SELECT_NO
    </select>
    
    <insert id="insertPromoCounsel" parameterType="com.cware.netshopping.domain.model.Promocounsel">
        INSERT INTO TPROMOCOUNSEL ( /* paorder.xml : pacommon.paorder.insertPromoCounsel by PaOrderController */
                  PROMO_NO
                , ORDER_NO
                , ORDER_G_SEQ
                , GOODS_SELECT_NO
                , COUNSEL_QTY
                , INSERT_ID
                , INSERT_DATE)
        VALUES (  #{promoNo,jdbcType=VARCHAR}
                , #{orderNo,jdbcType=VARCHAR}
                , #{orderGSeq,jdbcType=VARCHAR}
                , #{goodsSelectNo,jdbcType=VARCHAR}
                , #{counselQty,jdbcType=VARCHAR}
                , #{insertId,jdbcType=VARCHAR}
                , #{insertDate,jdbcType=TIMESTAMP})
    </insert>
    
    <insert id="insertClaimdt" parameterType="com.cware.netshopping.domain.ClaimdtVO" >
        INSERT INTO TCLAIMDT ( /* paorder.xml : pacommon.paorder.insertClaimdt by PaCancelController */
                 ORDER_NO                               , ORDER_G_SEQ                       , ORDER_D_SEQ
               , ORDER_W_SEQ                            , CUST_NO                           , RECEIVER_SEQ
               , CLAIM_DATE                             , CLAIM_GB                          , DO_FLAG
               , CLAIM_CODE                             , EXCH_PAIR                         , GOODS_GB
               , MEDIA_GB                               , MEDIA_CODE                        , GOODS_CODE
               , GOODSDT_CODE                           , GOODSDT_INFO                      , SALE_PRICE
               , CLAIM_QTY                              , SYSCANCEL                         , SYSLAST
               , CLAIM_AMT                              , DC_RATE_GOODS                     , DC_RATE
               , DC_AMT                                 , DC_AMT_GOODS                      , DC_AMT_MEMB
               , DC_AMT_DIV                             , DC_AMT_CARD                       , RSALE_AMT                             , SYSLAST_DC
               , SYSLAST_DC_GOODS                       , SYSLAST_DC_MEMB                   , SYSLAST_DC_DIV                        , SYSLAST_DC_CARD
               , SYSLAST_AMT                            , VAT_RATE                          , MD_CODE
               , SALE_YN                                , WH_CODE                           , DELY_TYPE                             , DELY_GB  
               , DELY_HOPE_YN                           , PREOUT_GB
               , SINGLE_DUE_GB                          , PACK_YN
               , ANONY_YN                               , MSG                               , MSG_NOTE
               , HAPPY_CARD_YN                          , SAVEAMT                           , SAVEAMT_GB
               , REPAY_GB                               , CUST_DELY_FLAG                    , LAST_PROC_DATE
               , PROMO_NO1                              , PROMO_NO2                         , SET_GOODS_CODE
               , SET_MD_CODE                            , REMARK1_V       
               , ORDER_MEDIA                            , LAST_PROC_ID
               , RSALE_NET                              , RSALE_VAT                         , SYSLAST_NET
               , SYSLAST_VAT                            , DIRECT_YN                         , DIRECT_RETURN_YN
               , BUY_PRICE
               , CS_LGROUP                              , CS_MGROUP                         ,CS_SGROUP             ,CS_LMS_CODE )
        SELECT   OD.ORDER_NO                            , OD.ORDER_G_SEQ                    , OD.ORDER_D_SEQ
               , #{orderWSeq,jdbcType=VARCHAR}          , #{custNo,jdbcType=VARCHAR}        , #{receiverSeq,jdbcType=VARCHAR}
               , #{claimDate,jdbcType=TIMESTAMP}        , #{claimGb,jdbcType=VARCHAR}       , #{doFlag,jdbcType=VARCHAR}
               , #{claimCode,jdbcType=VARCHAR}          , #{exchPair,jdbcType=VARCHAR}      , OD.GOODS_GB
               , OD.MEDIA_GB                            , OD.MEDIA_CODE                     , #{goodsCode,jdbcType=VARCHAR}
               , #{goodsdtCode,jdbcType=VARCHAR}        , #{goodsdtInfo,jdbcType=VARCHAR}   , OD.SALE_PRICE
               , #{claimQty,jdbcType=VARCHAR}           , #{syscancel,jdbcType=VARCHAR}     , #{claimQty,jdbcType=VARCHAR}
               , #{claimAmt,jdbcType=DOUBLE}            , OD.DC_RATE_GOODS                  , OD.DC_RATE
               , #{dcAmt,jdbcType=DOUBLE}               , #{dcAmtGoods,jdbcType=DOUBLE}     , #{dcAmtMemb,jdbcType=DOUBLE}
               , #{dcAmtDiv,jdbcType=DOUBLE}            , #{dcAmtCard,jdbcType=DOUBLE}      , #{rsaleAmt,jdbcType=DOUBLE}       , #{syslastDc,jdbcType=DOUBLE}
               , #{syslastDcGoods,jdbcType=DOUBLE}      , #{syslastDcMemb,jdbcType=DOUBLE}  , #{syslastDcDiv,jdbcType=DOUBLE}   , #{syslastDcCard,jdbcType=DOUBLE}
               , #{rsaleAmt,jdbcType=DOUBLE}            , OD.VAT_RATE                       , OD.MD_CODE
               , OD.SALE_YN                             , GS.WH_CODE                        , GS.DELY_TYPE                      , OD.DELY_GB
               , OD.DELY_HOPE_YN                        , OD.PREOUT_GB
               , OD.SINGLE_DUE_GB                       , OD.PACK_YN
               , OD.ANONY_YN                            , OD.MSG                            , OD.MSG_NOTE
               , #{happyCardYn,jdbcType=VARCHAR}        , OD.SAVEAMT                        , #{saveamtGb, jdbcType=VARCHAR}
               , #{repayGb,jdbcType=VARCHAR}            , OD.CUST_DELY_FLAG                 , #{claimDate,jdbcType=TIMESTAMP}
               , OD.PROMO_NO1                           , OD.PROMO_NO2                      , OD.SET_GOODS_CODE
               , OD.SET_MD_CODE                         , OD.DO_FLAG 
               , OM.ORDER_MEDIA                         , #{lastProcId,jdbcType=VARCHAR}
               , FUN_REVISE_AMT(#{rsaleAmt,jdbcType=DOUBLE}/#{claimQty,jdbcType=VARCHAR}/(1+OD.VAT_RATE/100),'V')*#{claimQty,jdbcType=VARCHAR}, #{rsaleAmt,jdbcType=DOUBLE} - FUN_REVISE_AMT(#{rsaleAmt,jdbcType=DOUBLE}/#{claimQty,jdbcType=VARCHAR}/(1+OD.VAT_RATE/100),'V')*#{claimQty,jdbcType=VARCHAR}, FUN_REVISE_AMT(#{syslastAmt,jdbcType=DOUBLE}/#{claimQty,jdbcType=VARCHAR}/(1+OD.VAT_RATE/100),'V')*#{claimQty,jdbcType=VARCHAR}
               , #{syslastAmt,jdbcType=DOUBLE} - FUN_REVISE_AMT(#{syslastAmt,jdbcType=DOUBLE}/#{claimQty,jdbcType=VARCHAR}/(1+OD.VAT_RATE/100),'V')*#{claimQty,jdbcType=VARCHAR}
               , NVL((SELECT A.DIRECT_SHIP_YN FROM TGOODS A WHERE A.GOODS_CODE = OD.GOODS_CODE),'0')
               , NVL((SELECT A.DIRECT_RETURN_YN FROM TGOODS A WHERE A.GOODS_CODE = OD.GOODS_CODE),'0')
               , OD.BUY_PRICE
               , #{csLgroup,jdbcType=VARCHAR}           ,#{csMgroup,jdbcType=VARCHAR}       ,#{csSgroup,jdbcType=VARCHAR}       ,#{csLmsCode,jdbcType=VARCHAR}
            FROM TORDERM OM
               , TORDERDT OD
               , TGOODS GS 
           WHERE OM.ORDER_NO = OD.ORDER_NO
             AND OD.GOODS_CODE = GS.GOODS_CODE
             AND OD.ORDER_NO = #{orderNo,jdbcType=VARCHAR}
             AND OD.ORDER_G_SEQ = #{orderGSeq,jdbcType=VARCHAR}
             AND OD.ORDER_D_SEQ = #{orderDSeq,jdbcType=VARCHAR}
             AND OD.SYSLAST > 0
    </insert>
    
    <select id="selectOrderRepayPbAmt" parameterType="com.cware.netshopping.domain.model.Orderreceipts" resultType="com.cware.netshopping.domain.model.Orderreceipts">
        SELECT /* paorder.xml : pacommon.paorder.selectOrderRepayPbAmt by PaCancelController */
               RECEIPT_NO
             , REPAY_PB_AMT 
          FROM TORDERRECEIPTS
         WHERE ORDER_NO = #{orderNo,jdbcType=VARCHAR}
           AND SETTLE_GB = #{settleGb,jdbcType=VARCHAR}
           AND REPAY_PB_AMT > 0
         ORDER BY RECEIPT_NO 
    </select>

    <select id="selectGoodsSaleGb" parameterType="com.cware.netshopping.domain.OrderStockInVO" resultType="String">
        SELECT /* paorder.xml : pacommon.paorder.selectGoodsSaleGb by PaCancelController */
               MAX(SALE_GB) AS SALE_GB
          FROM (SELECT SALE_GB
                  FROM TGOODS GD
                 WHERE GOODS_CODE = #{goodsCode, jdbcType=VARCHAR}
                 
                UNION ALL
                
                SELECT SALE_GB
                  FROM TGOODSDT
                 WHERE GOODS_CODE = #{goodsCode, jdbcType=VARCHAR}
                   AND GOODSDT_CODE = #{goodsdtCode, jdbcType=VARCHAR})
    </select>
    
    <update id="updatePaOrderm" parameterType="hashMap">
        UPDATE TPAORDERM /* paorder.xml : pacommon.paorder.updatePaOrderm by PaCancelController */
           SET API_RESULT_CODE      = #{resultCode, jdbcType=VARCHAR}
             , API_RESULT_MESSAGE   = #{resultMessage, jdbcType=VARCHAR}
             <if test='createYn == "1"'>
             , ORDER_NO             = #{orderNo, jdbcType=VARCHAR}
             , ORDER_G_SEQ          = #{orderGSeq, jdbcType=VARCHAR}
             , ORDER_D_SEQ          = #{orderDSeq, jdbcType=VARCHAR}
             , ORDER_W_SEQ          = #{orderWSeq, jdbcType=VARCHAR}
             , CREATE_YN            = #{createYn, jdbcType=VARCHAR}
             , CREATE_DATE          = SYSDATE
             </if>
         WHERE MAPPING_SEQ = #{mappingSeq, jdbcType=VARCHAR}
           AND CREATE_YN = '0'
           AND PRE_CANCEL_YN ='0'
    </update>
    
     <update id="updatePaOrderm20Approval" parameterType="hashMap">
         UPDATE TPAORDERM /* paorder.xml : pacommon.paorder.updatePaOrderm20Approval by PaCancelController */
           SET
            API_RESULT_CODE       = #{apiResultCode     , jdbcType=VARCHAR}
           ,API_RESULT_MESSAGE    = #{apiResultMessage  , jdbcType=VARCHAR}
          
           <if test='apiResultCode == "000000"'>
             , PA_DO_FLAG           = '30'
             , MODIFY_DATE          = SYSDATE  
           </if>                     
         WHERE PA_ORDER_NO          = #{paOrderNo, jdbcType=VARCHAR} 
           AND ORDER_NO				= #{orderNo, jdbcType=VARCHAR}
           AND PA_ORDER_GB          = '10'
           AND PA_DO_FLAG           = '10'
           AND PA_CODE  IN ('21','22')
          <!--AND ORDER_NO             = #{orderNo, jdbcType=VARCHAR} -->
          <!--AND ORDER_G_SEQ          = #{orderGSeq, jdbcType=VARCHAR} -->
          <!-- AND ORDER_D_SEQ          = '001' -->
          <!-- AND ORDER_W_SEQ          = '001' -->
           AND CREATE_YN            = '1'
           AND PRE_CANCEL_YN        = '0'
    </update>
    
    <update id="updateNaverPaOrderm20Approval" parameterType="hashMap">
     UPDATE TPAORDERM /* paorder.xml : pacommon.paorder.updateNaverPaOrderm20Approval by PaCancelController */
       SET
        API_RESULT_CODE       = #{apiResultCode     , jdbcType=VARCHAR}
       ,API_RESULT_MESSAGE    = #{apiResultMessage  , jdbcType=VARCHAR}
      
       <if test='apiResultCode == "000000"'>
         , PA_DO_FLAG           = '30'
         , MODIFY_DATE          = SYSDATE  
       </if>                     
     WHERE PA_ORDER_NO          = #{paOrderNo, jdbcType=VARCHAR} 
       AND ORDER_NO             = #{orderNo, jdbcType=VARCHAR}
       AND PA_ORDER_GB          = '10'
       AND PA_DO_FLAG           = '10'
       AND PA_CODE              = '41'
       AND CREATE_YN            = '1'
       AND PRE_CANCEL_YN        = '0'
    </update>
    
     <update id="updatePreCancelOrder" parameterType="String">
        UPDATE TPAORDERM /* paorder.xml : pacommon.paorder.updatePreCancelOrder by OrderRefuse */
           SET PRE_CANCEL_YN = '1'
         WHERE MAPPING_SEQ = #{mappingSeq, jdbcType=VARCHAR}
           AND CREATE_YN = '0'
           AND PRE_CANCEL_YN ='0'
    </update>
    
    <update id = "updateOrderdt20Approval" parameterType = "com.cware.netshopping.domain.OrderdtVO">
        UPDATE TORDERDT /* paorder.xml : pacommon.paorder.updateOrderdt20Approval by upDateOrder */
           SET DO_FLAG     = '20'
          ,LAST_PROC_DATE  = #{lastProcDate,jdbcType=TIMESTAMP}
         WHERE ORDER_NO    = #{orderNo, jdbcType=VARCHAR}
           AND ORDER_G_SEQ = #{orderGSeq, jdbcType=VARCHAR}
           AND ORDER_D_SEQ = #{orderDSeq, jdbcType=VARCHAR}
    </update>
    
    <update id="updateOrderReceipts20Approval" parameterType="com.cware.netshopping.domain.model.Orderreceipts">
         UPDATE TORDERRECEIPTS /* cashdepositlink.xml : interfaces.cashdepositlink.updateOrderReceipts by CashDepositLinkController */
            SET DO_FLAG       = '90'
               ,OK_DATE       = #{receiptDate   ,jdbcType=TIMESTAMP}
               ,RECEIPT_AMT   = #{receiptAmt    ,jdbcType=NUMERIC}
               ,REPAY_PB_AMT  = #{receiptAmt    ,jdbcType=NUMERIC}
               ,RECEIPT_DATE  = #{receiptDate   ,jdbcType=TIMESTAMP}
               ,END_YN        = '1'
               ,PROC_ID       = #{procId        ,jdbcType=TIMESTAMP}
               ,PROC_DATE     = #{procDate      ,jdbcType=TIMESTAMP}
          WHERE ORDER_NO      = #{orderNo       ,jdbcType=VARCHAR}
            AND SETTLE_GB     = #{settleGb      ,jdbcType=VARCHAR}
            AND DO_FLAG       = '10'
            AND CANCEL_YN     = '0'
   </update>
   
   <update id="updateOrderReceipts20ApprovalShipping" parameterType="com.cware.netshopping.domain.model.Orderreceipts">
         UPDATE TORDERRECEIPTS /* cashdepositlink.xml : interfaces.cashdepositlink.updateOrderReceipts by CashDepositLinkController */
            SET DO_FLAG       = '90'
               ,OK_DATE       = #{receiptDate   ,jdbcType=TIMESTAMP}
               ,RECEIPT_AMT   = REPAY_PB_AMT
               ,REPAY_PB_AMT  = REPAY_PB_AMT
               ,RECEIPT_DATE  = #{receiptDate   ,jdbcType=TIMESTAMP}
               ,END_YN        = '1'
               ,PROC_ID       = #{procId        ,jdbcType=TIMESTAMP}
               ,PROC_DATE     = #{procDate      ,jdbcType=TIMESTAMP}
          WHERE ORDER_NO      = #{orderNo       ,jdbcType=VARCHAR}
            AND SETTLE_GB     = #{settleGb      ,jdbcType=VARCHAR}
            AND DO_FLAG       = '10'
            AND CANCEL_YN     = '0'
   </update>

    <select id="selectRemainQty" parameterType="hashMap" resultType="int">

        SELECT  SYSLAST - 
              NVL((SELECT SUM(SYSLAST) AS CLAIM_QTY from TCLAIMDT CT
               WHERE CT.ORDER_NO =    #{orderNo , jdbcType=VARCHAR} 
               AND   CT.ORDER_G_SEQ = #{orderGSeq , jdbcType=VARCHAR} 
               AND   CT.ORDER_D_SEQ = '001'),0)  REMAIN_QTY
        FROM TORDERDT OD 
        WHERE OD.ORDER_NO =    #{orderNo , jdbcType=VARCHAR} 
        AND   OD.ORDER_G_SEQ = #{orderGSeq , jdbcType=VARCHAR} 
        AND   OD.ORDER_D_SEQ = '001'

    </select>
    
   <select id="selectOrderreceipt" parameterType="com.cware.netshopping.domain.model.Orderreceipts" resultType="int">
        SELECT COUNT(1) 
          FROM TORDERRECEIPTS TR
         WHERE TR.ORDER_NO     = #{orderNo       ,jdbcType=VARCHAR}
           AND TR.SETTLE_GB    = #{settleGb      ,jdbcType=VARCHAR}
           AND TR.DO_FLAG      = '10'
           AND TR.CANCEL_YN    = '0'
   </select>
  
    <select id="checkSalePriceBWPaGoodsPriceNGoodsPrice" parameterType="hashMap" resultType="int">
        SELECT COUNT(1) FROM(

              SELECT SUM(X.SK_PRICE) AS SK_PRICE     
                    ,SUM(X.ST11_PRICE) AS ST11_PRICE
                FROM        
                    (  
                      SELECT GP.SALE_PRICE AS SK_PRICE
                            ,0             AS ST11_PRICE
                        FROM TGOODSPRICE GP
                       WHERE GP.GOODS_CODE =  #{goodsCode , jdbcType=VARCHAR} 
                         AND GP.APPLY_DATE = (SELECT MAX(GPS.APPLY_DATE)
                                                FROM TGOODSPRICE GPS
                                               WHERE GPS.GOODS_CODE = GP.GOODS_CODE
                                                 AND GPS.APPLY_DATE &lt;= TO_DATE(SYSDATE, 'YYYY/MM/DD HH:MI:SS'))
                                                 
                     UNION ALL 
                                                
                      SELECT 0              AS SK_PRICE
                            ,PGP.SALE_PRICE AS ST11_PRICE
                        FROM TPAGOODSPRICE PGP
                       WHERE PGP.GOODS_CODE =  #{goodsCode , jdbcType=VARCHAR} 
                         AND PGP.APPLY_DATE = (SELECT MAX(PGPS.APPLY_DATE)
                                                FROM TGOODSPRICE PGPS
                                               WHERE PGPS.GOODS_CODE = PGP.GOODS_CODE
                                                 AND PGPS.APPLY_DATE &lt;= TO_DATE(SYSDATE, 'YYYY/MM/DD HH:MI:SS'))
                         AND PGP.TRANS_DATE IS NOT NULL  
                         AND PGP.PA_CODE =  #{pacode , jdbcType=VARCHAR}                                                 
                     ) X                            
        )
        WHERE (SK_PRICE      != ST11_PRICE 
               OR SK_PRICE   != #{salePrice , jdbcType=VARCHAR}
               OR ST11_PRICE != #{salePrice , jdbcType=VARCHAR}
               )
    </select>
    
    <!--
      <select id="checkSalePriceBWPaGoodsPriceNGoodsPrice" parameterType="hashMap" resultType="int">
                SELECT /* pa11stdelivery.xml : pacommon.paorder.checkSalePriceBWPaGoodsPriceNGoodsPrice by PaOrderController */
                       COUNT(1) AS CNT
                From(  
                        SELECT 'CheckPrice' FROM(
                                                 SELECT 'x' 
                                                 FROM TPAGOODSPRICE PG
                                                 WHERE Exists(
                                                              SELECT 'x'
                                                              FROM TGOODSPRICE GP
                                                              WHERE GP.GOODS_CODE = PG.GOODS_CODE 
                                                              AND   GP.APPLY_DATE = PG.APPLY_DATE
                                                              AND   (GP.SALE_PRICE != PG.SALE_PRICE 
                                                                     OR PG.SUPPLY_PRICE != ROUND( (GP.SALE_PRICE - GP.ARS_DC_AMT) * (100- (SELECT /*+ INDEX_DESC (TD IDX_TCODE_02)*/
                                                                                                                                           / 100) )))    
                                                 AND   PG.GOODS_CODE = #{goodsCode , jdbcType=VARCHAR}    
                                                 AND   TRANS_DATE IS NOT NULL
                                                 AND   PG.APPLY_DATE &lt;= TRUNC(#{orderdate, jdbcType=TIMESTAMP})
                                                 AND   PG.PA_CODE =  #{pacode , jdbcType=VARCHAR}
                                                 AND   ROWNUM = 1
                                            
                                                 ORDER BY PG.TRANS_DATE  DESC)
                                                 
                         UNION ALL
                        
                   
                         SELECT 'CheckTransNull' 
                         FROM   TGOODSPRICE GP
                         WHERE  GP.GOODS_CODE = #{goodsCode , jdbcType=VARCHAR}
                         AND    GP.APPLY_DATE = TRUNC(#{orderdate, jdbcType=TIMESTAMP}) 
                         AND    NOT EXISTS (
                                             SELECT 'x'
                                             FROM   TPAGOODSPRICE PG
                                             WHERE GP.GOODS_CODE = PG.GOODS_CODE 
                                             AND   GP.APPLY_DATE = PG.APPLY_DATE
                                             AND   PG.PA_CODE =  #{pacode , jdbcType=VARCHAR}
                                             AND   TRANS_DATE IS NOT NULL))                                       
     </select>
     
     -->
     
     <insert id="insertTpaMonitering" parameterType="com.cware.netshopping.domain.model.PaMonitering" >
        INSERT INTO TPAMONITERING  /* paorder.xml : pacommon.paorder.insertTpaMonitering by PaOrderController */
                  ( MONITERING_SEQ
                    ,CHECK_GB  
                    ,CHECK_NO  
                    ,CHECK_TXT  
                    ,GOODS_CODE  
                    ,PA_GOODS_CODE    
                    ,INSERT_DATE
                    ,INSERT_ID
                    ,MODIFY_DATE
                    ,MODIFY_ID
           ) 
            VALUES 
                  (TO_CHAR(SYSDATE, 'YYYYMMDD') || LTRIM(TO_CHAR(SEQ_PA_MONITERING_SEQ.NEXTVAL, '000000')) 
                , #{checkGb,    jdbcType=VARCHAR}
                , #{checkNo,    jdbcType=VARCHAR}
                , #{checkTxt,   jdbcType=VARCHAR}
                , #{goodsCode,  jdbcType=VARCHAR}
                , #{paGoodsCode,jdbcType=VARCHAR}
                , SYSDATE
                , 'PA11'
                , SYSDATE
                , 'PA11'
                )
                
     </insert>
     
     <insert id="insertCouponissue" parameterType="com.cware.netshopping.domain.model.Couponissue" >
        INSERT INTO TCOUPONISSUE ( /* paorder.xml : pacommon.paorder.insertTcouponissue by PaOrderController */
                    SEQ
                  , PROMO_NO
                  , CUST_NO
                  , GET_ORDER_NO
                  , USE_YN
                  , USE_ORDER_NO
                  , USE_START_DATE
                  , USE_END_DATE
                  , INSERT_DATE
                  , INSERT_ID
                  , MODIFY_DATE
                  , MODIFY_ID )
         VALUES (   #{seq}
                  , #{promoNo}
                  , #{custNo}
                  , #{getOrderNo}
                  , #{useYn}
                  , #{useOrderNo}
                  , #{useStartDate}
                  , #{useEndDate}
                  , #{insertDate}
                  , #{insertId}
                  , #{modifyDate}
                  , #{modifyId} )
    </insert>

     
    <select id="selectOrderTagetDt" parameterType="String" resultType="hashMap">
        SELECT /* pa11storder.xml : pa11st.order.selectOrderInputTargetDtList by Pa11stOrderController */
                PGM.PRODUCT_NO AS PA_GOODS_CODE,
                PGM.GOODS_CODE AS GOODS_CODE,
                OL.ORD_NO      AS PA_ORDER_NO
          FROM TPAORDERM PM
             , TPA11STORDERLIST OL
             , TCODE TC
             , TPA11STGOODS PGM
             , TPAGOODSDTMAPPING PGD
             , TPAGOODSPRICE PGP
         WHERE PM.PA_ORDER_NO = OL.ORD_NO
           AND PM.PA_ORDER_SEQ = OL.ORD_PRD_SEQ
           AND PM.PA_SHIP_NO = OL.DLV_NO
           AND PM.PA_ORDER_GB = OL.PA_ORDER_GB
           AND PM.PA_CODE = TC.CODE_MGROUP
           AND PGM.GOODS_CODE = PGD.GOODS_CODE
           AND PGM.PA_CODE = PGD.PA_CODE
           AND OL.PRD_NO = PGM.PRODUCT_NO
           AND OL.PRD_STCK_NO != PGD.PA_OPTION_CODE
           AND PGD.GOODS_CODE = PGP.GOODS_CODE
           AND PM.PA_CODE = PGP.PA_CODE
           AND PGP.ROWID = (SELECT /*+ INDEX_DESC(I PK_TPAGOODSPRICE) */
                                   ROWID 
                              FROM TPAGOODSPRICE I 
                             WHERE I.GOODS_CODE = PGP.GOODS_CODE 
                               AND I.PA_CODE = PM.PA_CODE 
                               AND I.TRANS_DATE &lt;= OL.ORD_DT 
                               AND I.TRANS_DATE IS NOT NULL 
                               AND ROWNUM = 1)
           AND TC.CODE_LGROUP = 'O501'
           AND PM.PA_ORDER_GB = '10'
           AND PM.CREATE_YN = '0'
           AND PM.PRE_CANCEL_YN = '0'
           AND PA_ORDER_NO = #{paOrderNo, jdbcType=VARCHAR}
           
    </select>
    
    
     <select id="getTpaMonitering" parameterType="String" resultType="int">
         SELECT COUNT(1) from TPAMONITERING TM     
         WHERE TM.CHECK_GB =      #{checkGb, jdbcType=VARCHAR}
         AND   TM.CHECK_NO =      #{checkNo, jdbcType=VARCHAR}
        <if test="checkGb != '99'">
         AND   TM.GOODS_CODE =    #{goodsCode, jdbcType=VARCHAR}
         AND   TM.PA_GOODS_CODE = #{paGoodsCode, jdbcType=VARCHAR}
        </if>
      </select>
  
    
    <select id="getConfigVal" parameterType="String" resultType="String">
         SELECT CF.VAL FROM TCONFIG CF    
         WHERE CF.ITEM =      #{item, jdbcType=VARCHAR}
    </select>
    
    
    
    <update id="updateDisable" parameterType="com.cware.netshopping.domain.model.Receiver" >
        UPDATE TRECEIVER /* paorder.xml : pacommon.paorder.updateDisable by PaOrderController */
           SET RECEIVER        = RECEIVER ||'*',
               USE_YN          = '0',
               DEFAULT_YN      = '0',
               MODIFY_DATE     = #{modifyDate       , jdbcType=TIMESTAMP},
               MODIFY_ID       = #{modifyId         , jdbcType=VARCHAR}
         WHERE CUST_NO         = #{custNo           , jdbcType=VARCHAR}
           AND RECEIVER_SEQ    = #{beforeSeq        , jdbcType=VARCHAR}
           AND DEFAULT_YN      = #{defaultYn        , jdbcType=VARCHAR}
           AND RECEIVER_GB     = DECODE(#{defaultYn,jdbcType=VARCHAR}, '1', '00', #{receiverGb,jdbcType=VARCHAR})
    </update>
    
    <update id="updateOrderDtForReceiverSeq" parameterType="hashMap" >
        UPDATE TORDERDT /* paorder.xml : pacommon.paorder.updateOrderDtForReceiverSeq by PaOrderController */
           SET RECEIVER_SEQ    = #{receiverSeq  , jdbcType=TIMESTAMP}
         WHERE ORDER_NO        = #{orderNo      , jdbcType=VARCHAR}
           AND RECEIVER_SEQ    = #{beforeSeq    , jdbcType=VARCHAR}
    </update>
    
    <update id="updateTelInfo" parameterType="com.cware.netshopping.domain.model.Receiver" >
        UPDATE TRECEIVER         /* paorder.xml : pacommon.paorder.updateTelInfo by PaOrderController */
           SET TEL              =  #{tel         , jdbcType=VARCHAR},
               RECEIVER_DDD     =  #{receiverDdd , jdbcType=VARCHAR},
               RECEIVER_TEL1    =  #{receiverTel1, jdbcType=VARCHAR},
               RECEIVER_TEL2    =  #{receiverTel2, jdbcType=VARCHAR},
               RECEIVER_HP      =  #{receiverHp  , jdbcType=VARCHAR},
               RECEIVER_HP1     =  #{receiverHp1 , jdbcType=VARCHAR},
               RECEIVER_HP2     =  #{receiverHp2 , jdbcType=VARCHAR},
               RECEIVER_HP3     =  #{receiverHp3 , jdbcType=VARCHAR},
               MODIFY_DATE      =  #{modifyDate  , jdbcType=TIMESTAMP},
               MODIFY_ID        =  #{modifyId    , jdbcType=VARCHAR}                      
         WHERE CUST_NO          =  #{custNo      , jdbcType=VARCHAR}
           AND RECEIVER_SEQ     =  #{receiverSeq , jdbcType=VARCHAR}
    </update>
    

    
    <select id="getNewReceiverSeq" parameterType="String" resultType="String">
        SELECT /* paorder.xml : pacommon.paorder.getNewReceiverSeq by PaOrderController */
                LTRIM(TO_CHAR(NVL(MAX(TO_NUMBER(RECEIVER_SEQ)),0)+1,'0000000000')) AS RECEIVER_SEQ
          FROM  TRECEIVER
         WHERE  CUST_NO = #{custNo , jdbcType=VARCHAR}
    </select>
    
    
     <select id="checkAddressStatus" parameterType="com.cware.netshopping.domain.model.Receiver" resultType="String">
        SELECT /* paorder.xml : pacommon.paorder.checkAddressStatus by PaOrderController */
              CASE WHEN TR.RECEIVER_POST  = '999999'  THEN '-1'
                   WHEN TR.STD_POST_ADDR1      || TR.STD_POST_ADDR2      != #{receiverStdPostAddr   ,jdbcType=VARCHAR}  || #{receiverStdPostAddr2  ,jdbcType=VARCHAR}  THEN '1'
                   WHEN TR.STD_ROAD_POST_ADDR1 || TR.STD_ROAD_POST_ADDR2 != #{receiverRoadPostAddr  ,jdbcType=VARCHAR}  || #{receiverRoadPostAddr2 ,jdbcType=VARCHAR}  THEN '1'
                   WHEN (TR.RECEIVER_HP  IS NULL OR  TR.RECEIVER_HP   !=  #{receiverHp   , jdbcType=VARCHAR}  )      THEN '2'
                   WHEN (TR.RECEIVER_TEL IS NULL OR  TR.RECEIVER_TEL  !=  #{tel          , jdbcType=VARCHAR}  )      THEN '3'
                   ELSE '0'
               END CHG   
         FROM TRECEIVER TR
        WHERE TR.CUST_NO      = #{custNo,jdbcType=VARCHAR}
          AND TR.RECEIVER_SEQ = #{beforeSeq,jdbcType=VARCHAR}      
    </select>
    
    <select id="checkPaOrderWseq"  parameterType="com.cware.netshopping.domain.model.Orderdt" resultType="int">
        SELECT /* paorder.xml: pacommon.paorder.checkPaOrderWseq by PaOrderController */
               NVL(LTRIM(MAX(ORDER_W_SEQ), 0), 0) AS ORDER_W_SEQ
          FROM TPAORDERM
         WHERE ORDER_NO     = #{orderNo,    jdbcType=VARCHAR}
           AND ORDER_G_SEQ  = #{orderGSeq,  jdbcType=VARCHAR}
    </select>
    
    <select id="selectPaPersonalInfoSms" parameterType="hashMap" resultType="hashMap">
         SELECT /* paorder.xml : pacommon.paorder.selectPaPersonalInfoSms by PaOrderController */
                COUNT(1) AS CNT
		      , FUN_GET_MEDIA_NAME(#{mediaCode, jdbcType=VARCHAR}) AS PA_NAME
              , FUN_GETCONFIG('SMS_SEND_NO') AS SEND_NO
		   FROM TPAPERSONALINFONOTICE T
		  WHERE T.CUST_NO = #{custNo,  jdbcType=VARCHAR}
         		
    </select>
    
    <select id="selectTransMsg" parameterType="hashMap" resultType="string">
         SELECT /*paorder.xml : pacommon.paorder.selectTransMsg by PaOrderController*/
                AA.TRAN_MSG
           FROM 
                (
                 SELECT 
                        replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(REMARK , '$DATA1$', NVL(#{data1,jdbcType=VARCHAR},''))
                                                                                               , '$DATA2$', NVL(#{data2,jdbcType=VARCHAR},''))
                                                                                               , '$DATA3$', NVL(#{data3,jdbcType=VARCHAR},''))
                                                                                               , '$DATA4$', NVL(#{data4,jdbcType=VARCHAR},''))
                                                                                               , '$DATA5$', NVL(#{data5,jdbcType=VARCHAR},'')) 
                                                                                               , '$DATA6$', NVL(#{data6,jdbcType=VARCHAR},''))
                                                                                               , '$DATA7$', NVL(#{data7,jdbcType=VARCHAR},''))
                                                                                               , '$DATA8$', NVL(#{data8,jdbcType=VARCHAR},'')) 
                                                                                               , '$DATA9$', NVL(#{data9,jdbcType=VARCHAR},''))
                                                                                               , '$DATA10$', NVL(#{data10,jdbcType=VARCHAR},'')) 
                                                                                               , '$DATA11$', NVL(#{data11,jdbcType=VARCHAR},'')) AS TRAN_MSG
                   FROM TCODE
                  WHERE CODE_LGROUP = 'C302'
                    AND CODE_MGROUP = #{sendFlag,jdbcType=VARCHAR}
                ) AA            
    </select>
    
    <insert id="insertPaPersonalInfoNoticeSmsList" parameterType="com.cware.netshopping.domain.model.PaPersonalInfoNoticeSms">
          INSERT INTO TPAPERSONALINFONOTICE ( /*paorder.xml : pacommon.paorder.insertPaPersonalInfoNoticeSmsList by PaOrderController*/
                      TRANS_SEQ
                    , ORDER_NO
                    , CUST_NO
                    , MEDIA_CODE
                    , SEND_GB
                    , INSERT_ID
                    , INSERT_DATE
                    , SEND_HP
                    , SEND_MSG
                     )
             VALUES( TO_CHAR(SYSDATE, 'YYYYMMDD') || LTRIM(TO_CHAR(SEQ_PA_TRANS_NO.NEXTVAL,'000000')) 
                   , #{orderNo, jdbcType=VARCHAR}
                   , #{custNo, jdbcType=VARCHAR}
                   , #{mediaCode, jdbcType=VARCHAR}
                   , '1'
                   , #{insertId, jdbcType=VARCHAR}
                   , SYSDATE
                   , #{receiverHp, jdbcType=VARCHAR}
                   , #{msg, jdbcType=VARCHAR}
                   )
    </insert>
    
    <select id="getGmktShippingFee" parameterType="String" resultType="double">
       SELECT /*paorder.xml : pacommon.paorder.getGmktShippingFee by PaOrderProcessImpl*/
       		  NVL(SUM(A.SHIPPING_FEE),0)  AS SUM_SHIP_FEE 
       	 FROM TPAGMKTORDERLIST A
	    WHERE A.PAY_NO = #{paOrderNo, jdbcType=VARCHAR} 
    </select>
    
    <select id="selectPaOrderPromo" parameterType="hashMap" resultType="com.cware.netshopping.domain.OrderpromoVO">
         SELECT /*paorder.xml : pacommon.paorder.selectOrderPaPromo */
         		 *
           FROM (SELECT PPT.SEQ
		              , PPT.PROC_GB 
		              , PM.PROMO_NO AS PROMO_NO
		              , PPT.PA_CODE
		              , TG.GOODS_CODE
		              , PM.DO_TYPE
		              , PM.COUPON_YN
		              , PM.MEDIA_CODE
		              , PM.PROMO_BDATE AS COUPON_PROMO_BDATE
		              , PM.PROMO_EDATE AS COUPON_PROMO_EDATE
		              , PPT.DO_AMT AS PROC_COST
		              , PPT.OWN_COST AS OWN_PROC_COST
		              , PPT.ENTP_COST AS ENTP_PROC_COST   
		              , PPT.INSERT_DATE  
					  , CASE WHEN  PPT.PROC_GB = 'D' THEN 0
			                 WHEN  PPT.PROC_GB = 'U' AND PPT.USE_CODE != '00'  THEN 0
			                 ELSE  PPT.DO_AMT
			            END AS DO_AMT
		           FROM TPROMOM          PM
		              , TPAPROMOTARGET   PPT
		              , TGOODS           TG
		           WHERE PM.PROMO_NO       				= PPT.PROMO_NO
		             AND PPT.GOODS_CODE    				= TG.GOODS_CODE
		             AND PPT.PA_CODE					= #{paCode			,	jdbcType=VARCHAR}
		             AND PPT.GOODS_CODE    				= #{goodsCode		,	jdbcType=VARCHAR}
		             AND NVL(PM.ALCOUT_PROMO_YN, '0') 	= #{alcoutPromoYn	,	jdbcType=VARCHAR}
		             AND PM.COUPON_YN      				= '1'
		             AND PM.APP_TYPE       				= '10'
		             AND PM.IMMEDIATELY_YN 				= '1'
		             AND PM.GOODS_ALL_YN   				= '0'
		             AND ((PPT.USE_CODE       			= '00' AND PPT.PROC_GB IN ('I', 'U') )  OR (PPT.PROC_GB = 'D') ) 
		             AND TG.GIFT_YN        				= '0'
		             AND PPT.TRANS_DATE    IS NOT NULL
		             AND PPT.TRANS_DATE    &lt; TO_DATE(#{orderDate,jdbcType=VARCHAR} , 'YYYY-MM-DD HH24MISS')
		             AND (( TO_DATE(#{orderDate		,	jdbcType=VARCHAR} , 'YYYY-MM-DD HH24MISS') BETWEEN PPT.TRANS_DATE AND PPT.PROMO_EDATE +  #{ papromoAllowTerm, jdbcType=VARCHAR} )
		             	   OR ( TO_DATE(#{orderDate	,	jdbcType=VARCHAR} , 'YYYY-MM-DD HH24MISS') >  PPT.PROMO_EDATE AND PPT.PROC_GB = 'D' )
		             	   OR #{remark4N , jdbcType=VARCHAR} = 1 )
		             <if test='paGroupCode != null and paGroupCode != ""'>	             
		             AND (INSTR(PPT.PA_GROUP_CODE, #{paGroupCode	,	jdbcType=VARCHAR} )) > 0
		             </if>
		        ORDER BY PPT.TRANS_DATE DESC )
         WHERE ROWNUM = 1
    </select>   
	
	<update id="updateOrderCancelYn" parameterType="hashMap" >
        UPDATE TPAORDERM /* paorder.xml : pacommon.paorder.updateOrderCancelYn by PaOrderController */
           SET ORDER_CANCEL_YN = #{ORDER_CANCEL_YN, jdbcType=VARCHAR}
             , API_RESULT_MESSAGE = #{RSLT_MESSAGE, jdbcType=VARCHAR}
             <if test='ORDER_CANCEL_RESULT_MESSAGE != null and ORDER_CANCEL_RESULT_MESSAGE !=  ""'>
             , ORDER_CANCEL_RESULT_MESSAGE = #{ORDER_CANCEL_RESULT_MESSAGE, jdbcType=VARCHAR}
             </if>
             , MODIFY_DATE = SYSDATE
         WHERE PA_ORDER_NO  = #{PA_ORDER_NO, jdbcType=VARCHAR}
           AND PA_ORDER_SEQ = #{PA_ORDER_SEQ, jdbcType=VARCHAR}
           AND PA_ORDER_GB  = '10'
    </update>
    
    <update id="updateRemark3N" parameterType="hashMap" >
        UPDATE TPAORDERM /* paorder.xml : pacommon.paorder.updateRemark3N by PaOrderController */
           SET REMARK3_N = #{REMARK3_N, jdbcType=VARCHAR}
             , API_RESULT_MESSAGE = #{RSLT_MESSAGE, jdbcType=VARCHAR}
             , MODIFY_DATE = SYSDATE
         WHERE PA_ORDER_NO  = #{PA_ORDER_NO, jdbcType=VARCHAR}
           AND PA_ORDER_SEQ = #{PA_ORDER_SEQ, jdbcType=VARCHAR}
           AND PA_ORDER_GB  = '10'
    </update>
    
    <insert id="insertTpaSlipInfo" parameterType="com.cware.netshopping.domain.model.PaSlipInfo">
    	<selectKey resultType="string" keyProperty="seq" order="BEFORE">
		    select LPAD(NVL(MAX(SEQ), 0) + 1, 3, '0')
		      from TPASLIPINFO
		     where MAPPING_SEQ = #{mappingSeq	,	jdbcType=VARCHAR}
    	</selectKey>	
     	
     	INSERT INTO TPASLIPINFO ( /* paorder.xml : pacommon.paorder.insertTpaSlipInfo */
                      PA_GROUP_CODE
                    , MAPPING_SEQ
                    , SEQ
                    , TRANS_PA_DELY_GB
                    , TRANS_SLIP_NO
                    , PA_DELY_GB
                    , SLIP_NO
                    , LAST_YN
                    , TRANS_YN
                    , REMARK1_V
                    , INSERT_DATE
                    , MODIFY_ID
                    , MODIFY_DATE )
             VALUES( #{paGroupCode 		, jdbcType=VARCHAR}
                   , #{mappingSeq		, jdbcType=VARCHAR}
                   , #{seq				, jdbcType=VARCHAR}
                   , #{transPaDelyGb	, jdbcType=VARCHAR}
                   , #{transSlipNo		, jdbcType=VARCHAR}
                   , #{paDelyGb			, jdbcType=VARCHAR}
                   , #{slipNo			, jdbcType=VARCHAR}
                   , #{lastYn			, jdbcType=VARCHAR}
                   , #{transYn			, jdbcType=VARCHAR}
                   , #{remark1V			, jdbcType=VARCHAR}
                   , SYSDATE
                   , #{modifyId			, jdbcType=VARCHAR}
                   , SYSDATE)
    </insert>
    
    <update id="updateTpaSlipInfo4Renew" parameterType="com.cware.netshopping.domain.model.PaSlipInfo" >
        UPDATE TPASLIPINFO
           SET LAST_YN		= '0'
             , MODIFY_DATE  = SYSDATE
             , MODIFY_ID    = #{modifyId	, jdbcType=VARCHAR}
        WHERE MAPPING_SEQ 	= #{mappingSeq  , jdbcType=VARCHAR}
          AND PA_GROUP_CODE = #{paGroupCode , jdbcType=VARCHAR}
    </update>   
    
    <select id="selectSlipProcCount" parameterType="String" resultType="int">
        SELECT COUNT(1) /* paorder.xml : pacommon.paorder.selectSlipProcCount */
          FROM TPASLIPINFO PS 
         WHERE PS.MAPPING_SEQ 	= #{mappingSeq  , jdbcType=VARCHAR}
    </select>

    <select id="selectPostAreaGb" parameterType="hashMap" resultType="String">
        SELECT PT.AREA_GB  /*paorder.xml : pacommon.paorder.selectPostAreaGb by PaOrderController*/
  		  FROM TPOST PT
 		 WHERE PT.POST_NO  = #{postNo   , jdbcType=VARCHAR}
 		   AND PT.POST_SEQ LIKE '%'|| #{postSeq	, jdbcType=VARCHAR} ||'%'
 		   AND ROWNUM = 1
    </select>
        
    <select id="selectDelyNoAreaGb" parameterType="hashMap" resultType="hashMap">
   		SELECT GD.AREA_GB  /*paorder.xml : pacommon.paorder.selectDelyNoAreaGb by PaOrderController*/
  		  FROM TDELYNOAREA GD
 		 WHERE GOODS_CODE = #{goodsCode  , jdbcType=VARCHAR}
    </select>
    
    <select id="selectOrderGoodsDtName" parameterType="HashMap" resultType="string">
        SELECT /* paorder.xml : pacommon.paorder.selectOrderGoodsDtName by Pa11stAsyncController */
               REPLACE(DECODE(C.GOODSDT_INFO, '없음', '단일상품', C.GOODSDT_INFO), ' ', '') AS GOODSDT_INFO
          FROM TGOODS   B
             , TGOODSDT C
         WHERE B.GOODS_CODE = C.GOODS_CODE
           AND B.SIGN_GB = '80'
           AND B.GOODS_CODE = #{goodsCode, jdbcType=VARCHAR}
           AND C.GOODSDT_CODE = #{goodsDtCode, jdbcType=VARCHAR}
    </select>
    
    <select id="selectOrderGoodsDtDupleCheck" parameterType="HashMap" resultType="int">
        SELECT /* paorder.xml : pacommon.paorder.selectOrderGoodsDtDupleCheck by Pa11stAsyncController */
               COUNT(1)
          FROM TGOODS T
             , TPAGOODSDTMAPPING M
         WHERE T.GOODS_CODE     = M.GOODS_CODE
           AND T.GOODS_CODE     = #{goodsCode, jdbcType=VARCHAR}
           AND M.PA_CODE        = #{paCode, jdbcType=VARCHAR}
           AND M.PA_OPTION_CODE = #{paOptionCode, jdbcType=VARCHAR}
    </select>
	    
	<select id="selectPreoutOrderTargetList" resultType="hashMap">	    
		SELECT /* paorder.xml : pacommon.paorder.selectPreoutOrderTargetList */
			   PM.PA_ORDER_NO
			 , PM.ORDER_NO
		  FROM TPAORDERM PM 
		 WHERE PM.PREOUT_YN = '1'
		   AND PM.POUT_ORDER_NO IS NULL
		   AND PM.PA_ORDER_GB = '10'
		   AND PM.CREATE_YN = '1'
		   AND PM.PRE_CANCEL_YN = '0'
		   AND PM.INSERT_DATE    > TRUNC(SYSDATE)-30
		GROUP BY PM.PA_ORDER_NO, PM.ORDER_NO
	</select>
	
	
	<select id="selectPreoutOrderTargetDtList" parameterType="hashMap" resultType="hashMap">
		SELECT /* paorder.xml : pacommon.paorder.selectPreoutOrderTargetDtList */
			   PM.PA_ORDER_NO
		     , PM.PA_CODE
		     , PM.MAPPING_SEQ
		     , OD.ORDER_NO AS ORG_ORDER_NO
		     , OD.ORDER_G_SEQ AS ORG_ORDER_G_SEQ
		     , OD.ORDER_D_SEQ AS ORG_ORDER_D_SEQ
		     , OD.ORDER_W_SEQ AS ORG_ORDER_W_SEQ
		     , OD.GOODS_CODE
		     , OD.GOODSDT_CODE
		     , OD.SALE_PRICE  AS ORG_SALE_PRICE
		     , OD.REMARK3_N
		     , OD.REMARK4_N
		     , GP.SALE_PRICE
		     , GP.BUY_PRICE
		     , TO_CHAR(GP.APPLY_DATE, 'YYYYMMDDHH24MISS') AS APPLY_DATE
		     , GP.PRICE_SEQ
		     , OD.DC_AMT
		     , OD.CUST_NO
		     , OD.RECEIVER_SEQ
		     , OD.MEDIA_CODE
		     , OD.ORDER_QTY
		     , OD.DC_AMT
         	 , TC.CODE_SNAME AS PROC_USER
         	 , CM.CUST_NAME
		  FROM TPAORDERM   PM
		     , TORDERDT    OD
		     , TGOODSPRICE GP
		     , TCUSTOMER   CM
		     , TCODE       TC
		 WHERE PM.ORDER_NO    = OD.ORDER_NO
		   AND PM.ORDER_G_SEQ = OD.ORDER_G_SEQ
		   AND PM.ORDER_D_SEQ = OD.ORDER_D_SEQ
		   AND PM.ORDER_W_SEQ = OD.ORDER_W_SEQ
		   AND OD.GOODS_CODE  = GP.GOODS_CODE
		   AND OD.CUST_NO	  = CM.CUST_NO
           AND TC.CODE_LGROUP = 'O500'
      	   AND TC.REMARK1 = OD.MEDIA_CODE
		   AND PM.PA_ORDER_GB = '10'
		   AND PM.CREATE_YN   = '1'
		   AND PM.PREOUT_YN   = '1'
		   AND PM.PRE_CANCEL_YN = '0'
		   AND PM.POUT_ORDER_NO IS NULL
		   <!-- 원주문 판매가 기준으로 생성 -->
		   AND GP.APPLY_DATE = (SELECT GP2.APPLY_DATE
						          FROM TGOODSPRICE GP2
						         WHERE GP2.PRICE_SEQ  = OD.PRICE_SEQ
						           AND GP2.GOODS_CODE = GP.GOODS_CODE)
		   <!-- 취소완료 또는 반품완료-->			           
           AND (OD.SYSLAST = 0 OR EXISTS (SELECT '1' 
                                 	        FROM TCLAIMDT CD 
                                    	   WHERE CD.ORDER_NO    = OD.ORDER_NO
                                     	     AND CD.ORDER_G_SEQ = OD.ORDER_G_SEQ
                                    	     AND CD.ORDER_D_SEQ = OD.ORDER_D_SEQ
                                    	     AND CD.CLAIM_GB    = '30'
                                    	     AND CD.CLAIM_QTY   = OD.ORDER_QTY
                                    	     AND CD.SYSLAST     = CD.CLAIM_QTY
                                     	     AND CD.DO_FLAG     = '60'))    
           AND NOT EXISTS (SELECT '1' 
	                         FROM TORDERDT OD2
	                        WHERE OD2.POUT_ORG_ORDER_NO =  OD.ORDER_NO
	                          AND OD2.POUT_ORG_ORDER_NO_G_SEQ = OD.ORDER_G_SEQ
	                          AND OD2.POUT_ORG_ORDER_NO_D_SEQ = OD.ORDER_D_SEQ
	                          AND OD2.POUT_ORG_ORDER_NO_W_SEQ = OD.ORDER_W_SEQ )   
		   AND PM.PA_ORDER_NO = #{paOrderNo, jdbcType=VARCHAR}	 
		   ORDER BY OD.ORDER_G_SEQ
		   
	</select>
	
	<select id="selectReceiverList" parameterType="String" resultType="com.cware.netshopping.domain.model.Receiver">
    	SELECT DISTINCT RC.CUST_NO,            RC.RECEIVER_SEQ,           RC.RECEIVER_GB,
					    RC.DEFAULT_YN,         RC.RECEIVER,               RC.RECEIVER_DDD,
					    RC.RECEIVER_TEL1,      RC.RECEIVER_TEL2,          RC.RECEIVER_TEL3,
					    RC.TEL,                RC.RECEIVER_POST,          RC.RECEIVER_POST_SEQ,
					    RC.RECEIVER_POST_ADDR, RC.RECEIVER_ADDR,          RC.RECEIVER_HP,            RC.RECEIVER_HP1,
					    RC.RECEIVER_HP2,       RC.RECEIVER_HP3,
					    RC.RECEIVER1,          RC.RECEIVER2,              RC.RECEIVER3,
					    RC.USE_YN,             RC.BEFORE_SEQ,
					    RC.ROAD_ADDR_YN,       RC.ROAD_POST_ADDR,         RC.ROAD_ADDR,              RC.ROAD_ADDR_NO,
					    RC.INSERT_ID,          RC.INSERT_DATE,            RC.MODIFY_ID,              RC.MODIFY_DATE,
					    RC.SELECT_ADDR,
					    RC.STD_ROAD_POST,      RC.STD_ROAD_POST_SEQ,      RC.STD_ROAD_POST_ADDR1,    RC.STD_ROAD_POST_ADDR2,     RC.STD_ROAD_POST_LNGX,    RC.STD_ROAD_POST_LATY, 
					    RC.STD_POST,           RC.STD_POST_SEQ,           RC.STD_POST_ADDR1,         RC.STD_POST_ADDR2,          RC.STD_POST_LNGX,         RC.STD_POST_LATY,
					    RC.REFINE_RESULT_CODE 
		  FROM TRECEIVER RC
		     , TORDERDT OD
		 WHERE RC.CUST_NO = OD.CUST_NO
		   AND RC.RECEIVER_SEQ = OD.RECEIVER_SEQ
		   AND RC.CUST_NO =  #{cust_no, jdbcType=VARCHAR}
    </select>
    
    <select id="selectOrderPromoList" parameterType="String" resultType="com.cware.netshopping.domain.model.Orderpromo">
    	SELECT  OP.SEQ
			  , OP.PROMO_NO
			  , OP.DO_TYPE
			  , OP.ORDER_NO
			  , OP.ORDER_G_SEQ
			  , OP.ORDER_D_SEQ
			  , OP.ORDER_W_SEQ
			  , OP.PROC_AMT
			  , OP.CANCEL_AMT
			  , OP.CALIM_AMT
			  , OP.PROC_COST
			  , OP.OWN_PROC_COST
			  , OP.ENTP_PROC_COST
			  , OP.ENTP_CODE
			  , OP.RECEIPT_NO
			  , OP.CANCEL_YN
			  , OP.CANCEL_DATE
			  , OP.CANCEL_ID
			  , OP.REMARK
			  , OP.ALLIANCE_PROC_COST
		   FROM TORDERPROMO OP
		  WHERE OP.ORDER_NO = #{order_no, jdbcType=VARCHAR}
    </select>
    
    <update id="updateCustSystemForOrder" parameterType="com.cware.netshopping.domain.model.Custsystem">
        UPDATE TCUSTSYSTEM /* order.xml : custcenter.order.updateCustSystemForOrder by OrderInput */
           SET LAST_CON_MEDIA = #{lastConMediaCode,jdbcType=VARCHAR},
               LAST_CON_DATE = #{lastConDate,jdbcType=TIMESTAMP},
               MODIFY_DATE   = #{modifyDate,jdbcType=TIMESTAMP},
               MODIFY_ID = #{modifyId,jdbcType=VARCHAR}            
         WHERE CUST_NO = #{custNo,jdbcType=VARCHAR}
    </update>
    
    <update id="updatePreoutPaOrderm" parameterType="hashMap">
        UPDATE TPAORDERM /* paorder.xml : pacommon.paorder.updatePreoutPaOrderm by PaCancelController */
           SET API_RESULT_CODE      = #{resultCode, jdbcType=VARCHAR}
             , API_RESULT_MESSAGE   = #{resultMessage, jdbcType=VARCHAR}
             <if test='createYn == "1"'>
             , POUT_ORDER_NO          = #{poutOrderNo, jdbcType=VARCHAR}
             , POUT_ORDER_G_SEQ       = #{poutOrderGSeq, jdbcType=VARCHAR}
             , POUT_ORDER_D_SEQ       = #{poutOrderDSeq, jdbcType=VARCHAR}
             , POUT_ORDER_W_SEQ       = #{poutOrderWSeq, jdbcType=VARCHAR}
             </if>
         WHERE MAPPING_SEQ = #{mappingSeq, jdbcType=VARCHAR}
    </update>
    
</mapper>
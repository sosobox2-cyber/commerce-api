<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"
        "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">

<mapper namespace="pawemp.goods">
	
	<resultMap id="result-PaWempGoodsInfo" type="com.cware.netshopping.domain.PaWempGoodsVO">
        <result property="goodsCode"           column="GOODS_CODE" />
        <result property="goodsName"           column="GOODS_NAME" />
        <result property="paCode"              column="PA_CODE" />
        <result property="paGroupCode"         column="PA_GROUP_CODE" />
        <result property="entpCode"            column="ENTP_CODE" />
        <result property="paSaleGb"            column="PA_SALE_GB" />
        <result property="productNo"     	   column="PRODUCT_NO" />
        <result property="displayYn"     	   column="DISPLAY_YN" />
        <result property="brandNo"     		   column="BRAND_NO" />
        <result property="makerNo"     		   column="MAKER_NO" />
        <result property="paLmsdKey"     	   column="PA_LMSD_KEY" />
        <result property="paProductGroupNoticeNo"     column="PA_PRODUCT_GROUP_NOTICE_NO" />
        <result property="paSaleStartDate"     column="PA_SALE_START_DATE" />
        <result property="paSaleEndDate"       column="PA_SALE_END_DATE" />
        <result property="transOrderAbleQty"   column="TRANS_ORDER_ABLE_QTY" />
        <result property="originName"          column="ORIGIN_NAME" />
        <result property="paStatus"            column="PA_STATUS" />
        <result property="brandName"           column="BRAND_NAME" />
        <result property="taxYn"               column="TAX_YN" />
        <result property="adultYn"             column="ADULT_YN" />
        <result property="custOrdQtyCheckTerm" column="CUST_ORD_QTY_CHECK_TERM" />
        <result property="custOrdQtyCheckYn"   column="CUST_ORD_QTY_CHECK_YN" />
        <result property="termOrderQty"        column="TERM_ORDER_QTY" />
        <result property="orderMinQty"         column="ORDER_MIN_QTY" />
        <result property="orderMaxQty"         column="ORDER_MAX_QTY" />
        <result property="imageUrl"            column="IMAGE_URL" />
        <result property="imageP"              column="IMAGE_P" />
        <result property="imageAP"             column="IMAGE_AP" />
        <result property="imageBP"             column="IMAGE_BP" />
        <result property="imageCP"             column="IMAGE_CP" />
        <result property="imageDP"             column="IMAGE_DP" />
        <result property="applyDate"           column="APPLY_DATE" />
        <result property="transApplyDate"      column="TRANS_APPLY_DATE" />
        <result property="salePrice"           column="SALE_PRICE" />
        <result property="dcAmt"               column="DC_AMT" /> 
        <result property="shipCostCode"        column="SHIP_COST_CODE" />
        <result property="shipPolicyNo" 	   column="SHIP_POLICY_NO" />
        <result property="csTel"               column="CS_TEL" />
        <result property="describeExt"         column="DESCRIBE_EXT" />
        <result property="installYn"           column="INSTALL_YN" />
        <result property="directShipYn"        column="DIRECT_SHIP_YN" />
        <result property="makecoName"          column="MAKECO_NAME" />
        <result property="saleStartDate"       column="SALE_START_DATE" />
        <result property="saleEndDate"         column="SALE_END_DATE" />
        <result property="lumpSumDcAmt"        column="LUMP_SUM_DC_AMT" />
		<result property="lumpSumOwnDcAmt"     column="LUMP_SUM_OWN_DC_AMT" />
		<result property="lumpSumEntpDcAmt"    column="LUMP_SUM_ENTP_DC_AMT" />
		<result property="collectImage"		   column="COLLECT_IMAGE" />
		<result property="goodsCom"		   	   column="GOODS_COM" />
		<result property="noticeExt"		   column="NOTICE_EXT" />
    </resultMap>    
   
   <select id="selectPaWempGoodsInfo" parameterType="hashMap"  resultMap="result-PaWempGoodsInfo">
		SELECT /* pawempgoods.xml : pawemp.goods.selectPaWempGoodsInfo by PaWempGoodsController-goodsInsert */
				 TG.GOODS_CODE,
				 TG.GOODS_NAME,
				 PG.PA_CODE,
				 PG.PA_GROUP_CODE,
				 TG.ENTP_CODE,
				 CEIL(FUN_GET_ORDER_ABLE_QTY(PG.GOODS_CODE,'%', T.WH_CODE) * TC2.CODE_GROUP) AS TRANS_ORDER_ABLE_QTY,
				 TG.ORIGIN_NAME AS ORIGIN_NAME,
				 PG.PA_STATUS,
				 TG.BRAND_NAME,
				 TG.TAX_YN,
				 TG.ADULT_YN,
				 TG.CUST_ORD_QTY_CHECK_TERM,
				 T.CUST_ORD_QTY_CHECK_YN,
				 T.TERM_ORDER_QTY,
				 TG.ORDER_MIN_QTY,
				 CASE WHEN TG.ORDER_MAX_QTY > 9999 THEN 9999
		               ELSE TG.ORDER_MAX_QTY
		              END AS ORDER_MAX_QTY,
				 TG.SHIP_COST_CODE,
				 GI.IMAGE_URL,
				 GI.IMAGE_G AS IMAGE_P,
				 GI.IMAGE_AG AS IMAGE_AP,
				 GI.IMAGE_BG AS IMAGE_BP,
				 GI.IMAGE_CG AS IMAGE_CP,
				 GI.IMAGE_DG AS IMAGE_DP,
				 PP.APPLY_DATE,
				 TO_CHAR(PP.APPLY_DATE, 'YYYY-MM-DD') AS TRANS_APPLY_DATE,
				 PP.SALE_PRICE,
				 PP.DC_AMT,
				 PSI.PA_SHIP_POLICY_NO AS SHIP_POLICY_NO, /*제휴사주소순*/
				 TC.CODE_NAME AS CS_TEL,
				 (SELECT CODE_NAME
                    FROM TCODE C1
                   WHERE C1.CODE_LGROUP = 'O507'
                     AND C1.CODE_MGROUP = PG.PA_CODE) AS TOP_IMAGE,
                 (SELECT CODE_NAME
                    FROM TCODE C1
                   WHERE C1.CODE_LGROUP = 'O507'
                     AND C1.CODE_MGROUP = DECODE(PG.PA_CODE,'61','63','64')) AS BOTTOM_IMAGE,
                 NVL((SELECT REPLACE (DS.DESCRIBE_EXT, chr(10), '')
                        FROM TDESCRIBE DS
                       WHERE DS.DESCRIBE_CODE ='998'
                         AND DS.GOODS_CODE = TG.GOODS_CODE)
                    ,(SELECT DECODE(DS.WEB_FLAG, '1',  REPLACE(DS.DESCRIBE_EXT, chr(10), ''), DS.DESCRIBE_NOTE)
                        FROM TDESCRIBE DS
                       WHERE DS.DESCRIBE_CODE ='999'
                         AND DS.GOODS_CODE = TG.GOODS_CODE)
                 ) AS DESCRIBE_EXT,
				 T.DIRECT_SHIP_YN,
				 T.INSTALL_YN,
				 DECODE(MC.MAKECO_NAME, '기타', TG.BRAND_NAME, MC.MAKECO_NAME) AS MAKECO_NAME,
		     	 TO_CHAR(T.SALE_START_DATE, 'YYYY-MM-DD HH24:MI') AS SALE_START_DATE,
                 NVL(TO_CHAR(T.SALE_END_DATE, 'YYYY-MM-DD HH24'),'2099-12-31 00')||':00' AS SALE_END_DATE,
                 PG.PRODUCT_NO,
                 PG.DISPLAY_YN,
                 PG.PA_PRODUCT_GROUP_NOTICE_NO,
                 NVL(PG.PA_SALE_START_DATE,TO_CHAR(SYSDATE, 'YYYY-MM-DD HH24')||':00') AS PA_SALE_START_DATE,
                 PG.PA_SALE_END_DATE,
                 PG.BRAND_NO,
                 PG.PA_LMSD_KEY,
		     	 PG.PA_SALE_GB
		     , PP.LUMP_SUM_DC_AMT
             , PP.LUMP_SUM_OWN_DC_AMT
             , PP.LUMP_SUM_ENTP_DC_AMT
             , DECODE(T.COLLECT_YN,'0','',(SELECT CODE_NAME
                                             FROM TCODE C1
                                            WHERE C1.CODE_LGROUP = 'O507'
                                              AND C1.CODE_MGROUP = '99')) AS COLLECT_IMAGE
             , T.COLLECT_YN
             , NVL((SELECT TSB.DESCRIBE_NOTE
			 		  FROM TDESCRIBE TSB
			 		 WHERE TSB.DESCRIBE_CODE = '200'
			 		   AND TSB.GOODS_CODE 	 = TG.GOODS_CODE), '') AS GOODS_COM
			 , NVL((SELECT /*+ INDEX_DESC (TNM IDX_TPANOTICEM_03)*/
             			   TNM.NOTICE_EXT
					  FROM TPANOTICEM TNM
					     , TPANOTICETARGET TNT
					     , TPANOTICEAPPLY TNA
					 WHERE TNM.NOTICE_NO  = TNT.NOTICE_NO
					   AND TNT.GOODS_CODE = TG.GOODS_CODE
					   AND TNM.USE_CODE   = '00'
					   AND INSTR(TNM.PA_GROUP_CODE, PG.PA_GROUP_CODE) > 0
					   AND TNT.NOTICE_NO  = TNA.NOTICE_NO
					   AND TNT.GOODS_CODE = TNA.GOODS_CODE
					   AND TNA.PA_GROUP_CODE = PG.PA_GROUP_CODE
					   AND ROWNUM = 1), '') AS NOTICE_EXT
		     , NVL(PB.LUXURY_YN, '0') AS LUXURY_YN
		  FROM TPAPRODUCT      TG,
		       TPAWEMPGOODS    PG,
		       TGOODSIMAGE     GI,
		       TPAGOODSPRICE   PP,
		       TPAWEMPENTPSLIP PSI,
		       TPAGOODSKINDS   PGK,
		       TCODE           TC,
		       TCODE           TC2,
		       TGOODS          T,
		       TMAKECOMP       MC,
		       TGOODSADDINFO   GA,
		       TPAWEMPBRAND    PB
		 WHERE TG.GOODS_CODE = PG.GOODS_CODE
		   AND TG.GOODS_CODE = T.GOODS_CODE
		   <if test='goodsCode != null and goodsCode != ""'>
		   AND TG.GOODS_CODE = #{goodsCode, jdbcType=VARCHAR}
		   </if>
		   <if test='paCode != null and paCode != ""'>
		   AND PG.PA_CODE = #{paCode, jdbcType=VARCHAR}
		   </if>
		   <if test='modCase == "MODIFY"'>
		      AND (PG.TRANS_TARGET_YN   = '1' OR PP.TRANS_DATE IS NULL)
		      AND PG.PA_STATUS  = '30'
		   </if>
		   <if test='modCase == "INSERT"'>
		   AND PG.PA_STATUS IN ('10', '20')
		   AND TG.SALE_GB IN ('00')
		   </if>
		   AND PG.PA_SALE_GB = '20'
		   AND GI.GOODS_CODE = PG.GOODS_CODE
		   AND PSI.ENTP_CODE        = DECODE(T.COLLECT_YN, '1', '100007', DECODE(T.DELY_TYPE,'10','100001', TG.ENTP_CODE))
		   AND PSI.ENTP_MAN_SEQ     = DECODE(T.COLLECT_YN, '1', '015', DECODE(T.DELY_TYPE,'10','002'	  , TG.RETURN_MAN_SEQ))
		   AND PSI.SHIP_COST_CODE   = DECODE(T.COLLECT_YN, '1', 'FR003', TG.SHIP_COST_CODE)
		   AND PSI.NO_SHIP_ISLAND = NVL((SELECT '1' FROM TDELYNOAREA DA WHERE DA.GOODS_CODE = T.GOODS_CODE AND DA.AREA_GB IN ('20','30') AND ROWNUM = 1), 0)
   		   AND PSI.INSTALL_YN = DECODE(T.INSTALL_YN,'1','1',DECODE(GA.ORDER_CREATE_YN,'1','1','0'))
		   AND PSI.PA_CODE          = PG.PA_CODE
		   AND T.MAKECO_CODE = MC.MAKECO_CODE
		   AND PGK.PA_LMSD_KEY = PG.PA_LMSD_KEY
		   AND PGK.PA_GROUP_CODE = PG.PA_GROUP_CODE
		   AND TC.CODE_LGROUP = 'O509'
		   AND TC.CODE_MGROUP = PG.PA_CODE
		   AND TC2.CODE_LGROUP      = 'O505'
           AND TC2.CODE_MGROUP      = PG.PA_CODE
           AND NVL(T.SALE_END_DATE,SYSDATE+1) > SYSDATE
		   AND PP.GOODS_CODE = PG.GOODS_CODE
		   AND PP.PA_CODE = PG.PA_CODE
		   AND T.GOODS_CODE = GA.GOODS_CODE
		   AND T.BRAND_CODE = PB.BRAND_CODE(+)
		   AND PP.ROWID = (SELECT /*+ INDEX_DESC (GP PK_TPAGOODSPRICE)*/
		                    GP.ROWID
		                     FROM TPAGOODSPRICE GP
		                    WHERE GP.GOODS_CODE = PG.GOODS_CODE
		                      AND GP.APPLY_DATE &lt; SYSDATE
		                      AND GP.PA_CODE = PG.PA_CODE
		                      AND ROWNUM = 1)
    </select>
    
     <select id="selectPaWempEntpSlip" parameterType="hashMap" resultType="com.cware.netshopping.domain.model.PaWempEntpSlip">
        SELECT /* pawempgoods.xml : pawemp.goods.selectPaWempEntpSlip by PaWempGoodsController-goodsInsert */
             DISTINCT PG.PA_CODE
             , TE.ENTP_CODE
             , TE.ENTP_MAN_SEQ 
             , TG.SHIP_COST_CODE
             , NVL((SELECT '1' FROM TDELYNOAREA DA WHERE DA.GOODS_CODE = GD.GOODS_CODE AND DA.AREA_GB IN ('20','30') AND ROWNUM = 1), 0) AS NO_SHIP_ISLAND
             , DECODE(GD.INSTALL_YN,'1','1',DECODE(GA.ORDER_CREATE_YN,'1','1','0')) AS INSTALL_YN
             , TE.ENTP_MAN_GB AS PA_ADDR_GB
          FROM TPAPRODUCT TG
             , TENTPUSER TE
             , TPAWEMPGOODS PG
             , TGOODS GD
             , TGOODSADDINFO GA
         WHERE DECODE(GD.DELY_TYPE,'10','100001',TG.ENTP_CODE) = TE.ENTP_CODE
           AND PG.GOODS_CODE = TG.GOODS_CODE
           AND TG.GOODS_CODE = GD.GOODS_CODE
           AND GD.GOODS_CODE = GA.GOODS_CODE
           <if test ='paAddrGb == "30"'>
           AND DECODE(GD.DELY_TYPE,'10','003',TG.SHIP_MAN_SEQ) = TE.ENTP_MAN_SEQ
           </if>
           <if test ='paAddrGb == "20"'>
           AND DECODE(GD.DELY_TYPE,'10','002',TG.RETURN_MAN_SEQ) = TE.ENTP_MAN_SEQ
           </if>
           <if test ='modCase =="MODIFY"'>
           AND PG.TRANS_TARGET_YN = '1'
           AND PG.PA_STATUS IN ('30','40')
           </if>
           <if test='paCode != null and paCode != ""'>
           AND PG.PA_CODE = #{paCode, jdbcType=VARCHAR}
           </if>
           <if test='goodsCode != null and goodsCode != ""'>
           AND TG.GOODS_CODE = #{goodsCode, jdbcType=VARCHAR}
           </if>
           AND NOT EXISTS ( SELECT 'X'
                              FROM TPAWEMPENTPSLIP PS
                             WHERE PS.PA_CODE = PG.PA_CODE 
                               AND PS.ENTP_CODE = TE.ENTP_CODE
                               AND PS.ENTP_MAN_SEQ = TE.ENTP_MAN_SEQ
                               AND PS.SHIP_COST_CODE = TG.SHIP_COST_CODE
                               AND PS.NO_SHIP_ISLAND = NVL((SELECT '1' FROM TDELYNOAREA DA WHERE DA.GOODS_CODE = GD.GOODS_CODE AND DA.AREA_GB IN ('20','30') AND ROWNUM = 1), 0)
                               AND PS.INSTALL_YN = DECODE(GD.INSTALL_YN,'1','1',DECODE(GA.ORDER_CREATE_YN,'1','1','0'))
                          )
    </select>
    
    <select id="selectPaWempGoodsdtInfoList" parameterType="hashMap" resultType="com.cware.netshopping.domain.model.PaGoodsdtMapping">
        SELECT /* pawempgoods.xml : pawemp.goods.selectPaWempGoodsdtInfoList by PaWempGoodsController-goodsInsert */
               PD.GOODS_CODE 
             , DM.PA_CODE
             , PD.GOODSDT_CODE
             , DECODE(PD.GOODSDT_INFO, '없음', '단일상품', PD.GOODSDT_INFO) AS GOODSDT_INFO
             , DECODE(PD.GOODSDT_INFO_KIND, '없음', '단일상품', PD.GOODSDT_INFO_KIND) AS GOODSDT_INFO_KIND
             , DECODE(DT.SALE_GB, '00', NVL(CEIL(FUN_GET_ORDER_ABLE_QTY(PD.GOODS_CODE, PD.GOODSDT_CODE, GD.WH_CODE) * TC.CODE_GROUP), 0), 0) AS TRANS_ORDER_ABLE_QTY
             , PD.SORT_TYPE 
             , DT.COLOR_NAME
             , DT.SIZE_NAME
             , DT.PATTERN_NAME
             , DT.FORM_NAME
             , DM.PA_OPTION_CODE
             , DM.REMARK1
             , DM.TRANS_TARGET_YN
             , DM.TRANS_STOCK_YN
             , DT.SALE_GB
          FROM TPAPRODUCTOPTION PD
             , TPAGOODSDTMAPPING DM
             , TGOODS GD
             , TCODE TC
             , TGOODSDT DT
         WHERE PD.GOODS_CODE = DM.GOODS_CODE
           AND PD.GOODSDT_CODE = DM.GOODSDT_CODE
           AND PD.GOODS_CODE = GD.GOODS_CODE
           AND TC.CODE_LGROUP = 'O505'
           AND TC.CODE_MGROUP = DM.PA_CODE
           AND DT.GOODS_CODE = PD.GOODS_CODE
           AND DT.GOODSDT_CODE = PD.GOODSDT_CODE
           AND DM.PA_CODE IN ('61','62')
           AND GD.GOODS_CODE = #{goodsCode, jdbcType=VARCHAR}
         ORDER BY PD.GOODS_CODE
                , PD.GOODSDT_CODE
    </select>
    
    <select id="selectPaWempGoodsOfferList" parameterType="hashMap" resultType="com.cware.netshopping.domain.PaGoodsOfferVO">
        SELECT PO.GOODS_CODE
             , PO.PA_GROUP_CODE
             , PO.PA_OFFER_TYPE
             , PO.PA_OFFER_CODE 
             , PO.PA_OFFER_EXT
             , PO.REMARK1
             , PO.REMARK2
             , PC.PA_OFFER_TYPE_NAME
             , PC.PA_OFFER_CODE_NAME
          FROM TPAGOODSOFFER PO
             , TPAOFFERCODE PC
         WHERE PO.PA_GROUP_CODE = PC.PA_GROUP_CODE  
           AND PO.PA_OFFER_TYPE = PC.PA_OFFER_TYPE 
           AND PO.PA_OFFER_CODE = PC.PA_OFFER_CODE  
           AND PO.GOODS_CODE = #{goodsCode, jdbcType=VARCHAR}
           AND PO.PA_GROUP_CODE = #{paGroupCode, jdbcType=VARCHAR}
           AND PO.USE_YN = '1'
    </select>
    
    <update id="updatePaWempGoods"  parameterType="com.cware.netshopping.domain.PaWempGoodsVO">
        UPDATE /* pawempgoods.xml : pawemp.goods.updatePaWempGoods by PaWempGoodsController-goodsInsert */
               TPAWEMPGOODS PG
           SET PG.PRODUCT_NO = #{productNo, jdbcType=VARCHAR}
             , PG.SHIP_POLICY_NO = #{shipPolicyNo, jdbcType=VARCHAR}
             , PG.PA_STATUS = #{paStatus, jdbcType=VARCHAR}
             <if test='brandNo != null and brandNo != ""'>
             , PG.BRAND_NO = #{brandNo, jdbcType=VARCHAR}
             </if>
             <if test='transOrderAbleQty > 0'>
             , PG.TRANS_ORDER_ABLE_QTY = #{transOrderAbleQty, jdbcType=NUMERIC}
             </if>
             , PG.TRANS_TARGET_YN = '0'
             , PG.PA_SALE_START_DATE = #{paSaleStartDate, jdbcType=VARCHAR}
             , PG.PA_SALE_END_DATE = #{paSaleEndDate, jdbcType=VARCHAR}
             , PG.MODIFY_ID = #{modifyId, jdbcType=VARCHAR}
             , PG.MODIFY_DATE = #{modifyDate, jdbcType=TIMESTAMP}
             , PG.RETURN_NOTE = null
         WHERE PG.GOODS_CODE = #{goodsCode, jdbcType=VARCHAR}  
           AND PG.PA_CODE = #{paCode, jdbcType=VARCHAR}  
    </update>
    
    <update id="updatePaWempGoodsdt"  parameterType="com.cware.netshopping.domain.model.PaGoodsdtMapping">
        UPDATE /* pawempgoods.xml : pawemp.goods.updatePaWempGoodsdt by PaWempGoodsController-goodsInsert */
               TPAGOODSDTMAPPING PD
           SET PD.TRANS_ORDER_ABLE_QTY = #{transOrderAbleQty, jdbcType=NUMERIC}
             , PD.TRANS_TARGET_YN = '0'
             , PD.MODIFY_ID = #{modifyId, jdbcType=VARCHAR}
             , PD.MODIFY_DATE = #{modifyDate, jdbcType=TIMESTAMP}
             , PD.PA_OPTION_CODE = #{goodsdtCode, jdbcType=VARCHAR}
         WHERE PD.GOODS_CODE = #{goodsCode, jdbcType=VARCHAR}
           AND PD.GOODSDT_CODE = #{goodsdtCode, jdbcType=VARCHAR}
           AND PD.PA_CODE = #{paCode, jdbcType=VARCHAR}  
    </update>
    
    <update id="updatePaWempGoodsdtOrderAbleQty"  parameterType="com.cware.netshopping.domain.model.PaGoodsdtMapping">
        UPDATE /* pawempgoods.xml : pawemp.goods.updatePaWempGoodsdtOrderAbleQty by PaWempGoodsController-goodsStockModify */
               TPAGOODSDTMAPPING PD
           SET PD.TRANS_ORDER_ABLE_QTY = #{transOrderAbleQty, jdbcType=NUMERIC}
             , PD.MODIFY_ID = #{modifyId, jdbcType=VARCHAR}
             , PD.MODIFY_DATE = #{modifyDate, jdbcType=TIMESTAMP}
             <choose>
                <when test='remark1 == "stopSale" and transStockYn == "1"'>
                , PD.TRANS_STOCK_YN = '1'
                </when>
                <otherwise>
                , PD.TRANS_STOCK_YN = '0'
                </otherwise>
             </choose>
         WHERE PD.GOODS_CODE = #{goodsCode, jdbcType=VARCHAR}
           AND PD.GOODSDT_CODE = #{goodsdtCode, jdbcType=VARCHAR}
           AND PD.PA_CODE = #{paCode, jdbcType=VARCHAR}  
    </update>
    
    <update id="updatePaWempGoodsImage"  parameterType="com.cware.netshopping.domain.PaWempGoodsVO">
        UPDATE /* pawempgoods.xml : pawemp.goods.updatePaWempGoodsImage by PaWempGoodsController-goodsInsert */
               TPAGOODSIMAGE PI
           SET PI.TRANS_TARGET_YN = '0'
             , PI.MODIFY_ID = #{modifyId, jdbcType=VARCHAR}
             , PI.MODIFY_DATE = #{modifyDate, jdbcType=TIMESTAMP}
         WHERE PI.GOODS_CODE = #{goodsCode, jdbcType=VARCHAR}  
           AND PI.PA_GROUP_CODE = #{paGroupCode, jdbcType=VARCHAR}  
    </update>
        
    <update id="updatePaWempGoodsPrice"  parameterType="com.cware.netshopping.domain.PaWempGoodsVO">
        UPDATE /* pawempgoods.xml : pawemp.goods.updatePaWempGoodsPrice by PaWempGoodsController-goodsInsert */
               TPAGOODSPRICE PP
           SET PP.TRANS_ID = #{modifyId}
             , PP.TRANS_DATE = SYSDATE 
             , PP.MODIFY_ID = #{modifyId, jdbcType=VARCHAR}
             , PP.MODIFY_DATE = #{modifyDate, jdbcType=TIMESTAMP}
         WHERE PP.GOODS_CODE = #{goodsCode, jdbcType=VARCHAR}  
           AND PP.PA_CODE = #{paCode, jdbcType=VARCHAR}
           AND PP.APPLY_DATE = #{applyDate, jdbcType=TIMESTAMP}
           AND PP.TRANS_DATE IS NULL
    </update>
    
    <update id="updatePaWempCustShipCost"  parameterType="com.cware.netshopping.domain.PaWempGoodsVO">
        UPDATE /* pawempgoods.xml : pawemp.goods.updatePaWempCustShipCost by PaWempGoodsController-goodsInsert */
               TPACUSTSHIPCOST PS
           SET PS.TRANS_TARGET_YN = '0'
             , PS.MODIFY_ID = #{modifyId, jdbcType=VARCHAR}
             , PS.MODIFY_DATE = #{modifyDate, jdbcType=TIMESTAMP}
         WHERE PS.ENTP_CODE = #{entpCode, jdbcType=VARCHAR}  
           AND PS.PA_CODE = #{paCode, jdbcType=VARCHAR}
           AND PS.SHIP_COST_CODE = #{shipCostCode, jdbcType=VARCHAR}
    </update>
        
    <update id="updatePaWempGoodsOffer"  parameterType="com.cware.netshopping.domain.PaWempGoodsVO">
        UPDATE /* pawempgoods.xml : pawemp.goods.updatePaWempGoodsOffer by PaWempGoodsController-goodsInsert */
               TPAGOODSOFFER PO
           SET PO.TRANS_TARGET_YN = '0'
             , PO.MODIFY_ID = #{modifyId, jdbcType=VARCHAR}
             , PO.MODIFY_DATE = #{modifyDate, jdbcType=TIMESTAMP}
         WHERE PO.GOODS_CODE = #{goodsCode, jdbcType=VARCHAR}  
           AND PO.PA_GROUP_CODE = #{paGroupCode, jdbcType=VARCHAR}
    </update>
    
    <update id="updatePaWempGoodsGroupNoticeNo"  parameterType="hashMap">
        UPDATE /* pawempgoods.xml : pawemp.goods.updatePaWempGoodsGroupNoticeNo by PaWempGoodsController-goodsInfo */
               TPAWEMPGOODS PG
           SET PG.PA_PRODUCT_GROUP_NOTICE_NO = #{productGroupNoticeNo, jdbcType=VARCHAR}
             , PG.MODIFY_ID = #{modifyId, jdbcType=VARCHAR}
             , PG.MODIFY_DATE = #{modifyDate, jdbcType=TIMESTAMP}
         WHERE PG.GOODS_CODE = #{goodsCode, jdbcType=VARCHAR}  
           AND PG.PA_CODE = #{paCode, jdbcType=VARCHAR}  
    </update>
    
    <select id="selectPaWempGoodsSaleStopList" resultType="com.cware.netshopping.domain.PaWempGoodsVO" parameterType="hashMap">
        SELECT /* pawempgoods.xml : pawemp.goods.selectPaWempGoodsSaleStopList by PaWempGoodsController-goodsModify */
               PG.PA_CODE
             , TG.GOODS_CODE
          FROM TPAPRODUCT TG
             , TPAWEMPGOODS PG
         WHERE TG.GOODS_CODE = PG.GOODS_CODE
           AND PG.PRODUCT_NO IS NOT NULL
           AND PG.PA_SALE_GB = '30'
           AND PG.TRANS_SALE_YN = '1'
    </select>
    
    <select id="selectPaWempGoodsSaleRestartList" resultType="com.cware.netshopping.domain.PaWempGoodsVO" parameterType="hashMap">
        SELECT /* pawempgoods.xml : pawemp.pawempgoods.selectPaWempGoodsSaleRestartList by PaWempGoodsController-goodsModify */
               TG.GOODS_CODE
             , PG.PA_CODE
          FROM TPAPRODUCT TG
             , TPAWEMPGOODS PG
         WHERE TG.GOODS_CODE = PG.GOODS_CODE
           AND TG.SALE_GB = '00'
           AND PG.PA_SALE_GB = '20' 
           AND PG.PA_STATUS = '30'
           AND PG.TRANS_SALE_YN = '1'
           AND PG.PRODUCT_NO IS NOT NULL
           AND EXISTS ( SELECT '1'
                          FROM TGOODS GD
                         WHERE TG.GOODS_CODE = GD.GOODS_CODE
                           AND FUN_GET_ORDER_ABLE_QTY(GD.GOODS_CODE,'%',GD.WH_CODE) > 0 
                       )
    </select>   
    
    <select id="selectPaWempGoodsProductNo" parameterType="hashMap" resultType="com.cware.netshopping.domain.PaWempGoodsVO">
        SELECT /* pawempgoods.xml : pawemp.pawempgoods.selectPaWempGoodsProductNo by PaWempGoodsController-goodsSellStopRestart */
               PG.PRODUCT_NO
             , PG.GOODS_CODE
             , PG.PA_CODE
             , PG.PA_SALE_GB
             , PG.PA_STATUS
          FROM TPAPRODUCT TG,
               TPAWEMPGOODS PG
         WHERE PG.GOODS_CODE = TG.GOODS_CODE
           AND PG.GOODS_CODE = #{goodsCode, jdbcType=VARCHAR}           
           AND PG.PA_CODE = #{paCode, jdbcType=VARCHAR}
           AND PG.PA_SALE_GB = #{paSaleGb, jdbcType=VARCHAR}
           AND PG.PA_STATUS IN ('30','90')
           AND PG.TRANS_SALE_YN = '1'
    </select>
    
    <update id="updatePaWempGoodsSellStop"  parameterType="com.cware.netshopping.domain.PaWempGoodsVO">
        UPDATE /* pawempgoods.xml : pawemp.goods.updatePaWempGoodsSellStop by PaWempGoodsController-goodsModify */
               TPAWEMPGOODS PG
           SET PG.PA_SALE_GB = #{paSaleGb, jdbcType=VARCHAR}
             <if test='transSaleYn == null or transSaleYn == ""'>
               , PG.RETURN_NOTE = ''
             </if>
             <if test='transSaleYn == null or transSaleYn == ""'>
               , PG.TRANS_TARGET_YN = '0'
             </if>
             <if test='transSaleYn != null and transSaleYn != ""'>
               , PG.TRANS_SALE_YN = #{transSaleYn, jdbcType=VARCHAR}
             </if>
             , PG.MODIFY_ID = #{modifyId, jdbcType=VARCHAR}
             , PG.MODIFY_DATE = #{modifyDate, jdbcType=TIMESTAMP}
         WHERE PG.GOODS_CODE = #{goodsCode, jdbcType=VARCHAR}  
           AND PG.PA_CODE = #{paCode, jdbcType=VARCHAR}  
    </update>
    
    <select id="selectPaWempGoodsdtMappingStockList" parameterType="hashMap" resultType="com.cware.netshopping.domain.PaWempGoodsdtMappingVO">
        SELECT /* pawempgoods.xml : pawemp.pawempgoods.selectPaWempGoodsdtMappingStockList by PaWempGoodsController-goodsStockModify */
               DISTINCT PD.GOODS_CODE
             , PM.PA_CODE
             , PG.PRODUCT_NO
          FROM TPAPRODUCTOPTION PD
             , TPAGOODSDTMAPPING PM
             , TPAWEMPGOODS PG
             , TGOODS GD
             , TCODE TC
             , TGOODSDT GT
         WHERE PD.GOODS_CODE    = PM.GOODS_CODE
           AND PD.GOODSDT_CODE  = PM.GOODSDT_CODE
           AND PM.GOODS_CODE    = PG.GOODS_CODE
           AND PM.PA_CODE       = PG.PA_CODE
           AND GD.GOODS_CODE    = PG.GOODS_CODE
           AND TC.CODE_LGROUP   = 'O505'
           AND TC.CODE_MGROUP   = PG.PA_CODE
           AND PG.PA_STATUS     = '30'
           AND PG.PRODUCT_NO IS NOT NULL
           AND GT.GOODS_CODE    = PD.GOODS_CODE
           AND GT.GOODSDT_CODE  = PD.GOODSDT_CODE
           AND PM.TRANS_ORDER_ABLE_QTY != DECODE(GT.SALE_GB, 00, CEIL(FUN_GET_ORDER_ABLE_QTY(PD.GOODS_CODE, PD.GOODSDT_CODE, GD.WH_CODE) * TC.CODE_GROUP), 0)
           <if test='goodsCode != null and goodsCode != ""'>
           AND PM.GOODS_CODE    = #{goodsCode, jdbcType=VARCHAR}
           </if>
           <if test='paCode != null and paCode != ""'>
           AND PM.PA_CODE       = #{paCode, jdbcType=VARCHAR}
           </if>
           <if test='goodsCode == null or goodsCode == ""'>
           AND EXISTS ( SELECT 'X'
                         FROM TPAPRODUCT P
                        WHERE P.GOODS_CODE = PG.GOODS_CODE
                          AND P.SALE_GB = '00')
           </if>
    </select>
    
    <select id="selectPaWempGoodsStockList" parameterType="hashMap" resultType="com.cware.netshopping.domain.PaWempGoodsVO">
        SELECT /* pawempgoods.xml : pawemp.pawempgoods.selectPaWempGoodsStockList by PaWempGoodsController-goodsStockSync */
               PG.GOODS_CODE
             , PG.PRODUCT_NO
             , PG.PA_CODE
          FROM TPAWEMPGOODS PG
         WHERE PG.PA_PRODUCT_GROUP_NOTICE_NO IS NULL
           AND PG.PA_STATUS = '30'
           AND PG.PRODUCT_NO IS NOT NULL
           AND PG.PA_CODE IN ('61','62')
           AND PG.TRANS_TARGET_YN = '0'
    </select>
    
    <update id="updatePaGoodsTarget" parameterType="com.cware.netshopping.domain.PaWempGoodsVO">
        UPDATE TPAGOODSTARGET PGT /* pawempgoods.xml : pawemp.pawempgoods.updatePaGoodsTarget by PaWempGoodsController-goodsInsert */
           SET PGT.PA_GOODS_CODE = #{productNo, jdbcType=VARCHAR},
               PGT.PA_SALE_GB = #{paSaleGb, jdbcType=VARCHAR},
               PGT.MODIFY_ID = #{modifyId, jdbcType=VARCHAR},
               PGT.MODIFY_DATE = SYSDATE
         WHERE PGT.PA_CODE = #{paCode, jdbcType=VARCHAR}
           AND PGT.GOODS_CODE = #{goodsCode, jdbcType=VARCHAR}
           AND PGT.PA_GOODS_CODE IS NULL
    </update>
    
    <!-- 프로모션 별 운영관리 기능 효율화(REQ_PRM_040) : S -->
    <!-- 프로모션 조회 
	<select id="selectPaPromoTarget" parameterType="hashMap" resultType="com.cware.netshopping.domain.model.PaPromoTarget">
        SELECT /* pawempgoods.xml : pawemp.pawempgoods.selectPaPromoTarget by PaWempGoodsControlle */
        	   /*+INDEX_DESC (PPMT IDX_TPAPROMOTARGET_02)*/
			   PPMT.PROC_GB
			 , PPMT.PROMO_NO
			 , PPMT.PA_CODE
			 , PPMT.GOODS_CODE
			 , PPMT.SEQ
			 , PPMT.TRANS_DATE
			 , PPMT.DO_AMT AS DO_COST
			 , PPMT.OWN_COST
			 , PPMT.ENTP_COST
			 , PPMT.INSERT_DATE
		  FROM TPAPROMOTARGET PPMT
		      ,TPROMOM PM
		 WHERE PPMT.USE_CODE = '00'
		   AND SYSDATE BETWEEN PPMT.PROMO_BDATE AND PPMT.PROMO_EDATE
		   AND PPMT.GOODS_CODE = #{goodsCode, jdbcType=VARCHAR}
		   AND PPMT.PA_CODE = #{paCode, jdbcType=VARCHAR}
		   AND PPMT.PROMO_NO = PM.PROMO_NO
           AND PM.COUPON_YN = '1'
           AND PM.IMMEDIATELY_YN = '1'
           AND NVL(PM.ALCOUT_PROMO_YN, '0') = '0'    
           AND PPMT.PROC_GB != 'D'
           AND NOT EXISTS (
        		SELECT 1
        		FROM TPAPROMOTARGET PPMT3
        		WHERE PPMT3.PROMO_NO = PPMT.PROMO_NO
        		AND PPMT3.PA_CODE = PPMT.PA_CODE
	            AND PPMT3.GOODS_CODE = PPMT.GOODS_CODE
        		AND PPMT3.INSERT_DATE >= PPMT.INSERT_DATE
        		AND PPMT3.PROC_GB = 'D'
        		)
		   AND ROWNUM = 1
		UNION ALL
        SELECT /*+INDEX_DESC (PPMT IDX_TPAPROMOTARGET_02)*/
			   PPMT.PROC_GB
			 , PPMT.PROMO_NO
			 , PPMT.PA_CODE
			 , PPMT.GOODS_CODE
			 , PPMT.SEQ
			 , PPMT.TRANS_DATE
			 , PPMT.DO_AMT AS DO_COST
			 , PPMT.OWN_COST
			 , PPMT.ENTP_COST
			 , PPMT.INSERT_DATE
		  FROM TPAPROMOTARGET PPMT
		      ,TPROMOM PM
		 WHERE PPMT.USE_CODE = '00'
		   AND SYSDATE BETWEEN PPMT.PROMO_BDATE AND PPMT.PROMO_EDATE
		   AND PPMT.GOODS_CODE = #{goodsCode, jdbcType=VARCHAR}
		   AND PPMT.PA_CODE = #{paCode, jdbcType=VARCHAR}
		   AND PPMT.PROMO_NO = PM.PROMO_NO
           AND PM.COUPON_YN = '1'
           AND PM.IMMEDIATELY_YN = '1'
           AND NVL(PM.ALCOUT_PROMO_YN, '0') = '1'    
           AND PPMT.PROC_GB != 'D'
           AND NOT EXISTS (
        		SELECT 1
        		FROM TPAPROMOTARGET PPMT3
        		WHERE PPMT3.PROMO_NO = PPMT.PROMO_NO
        		AND PPMT3.PA_CODE = PPMT.PA_CODE
	            AND PPMT3.GOODS_CODE = PPMT.GOODS_CODE
        		AND PPMT3.INSERT_DATE >= PPMT.INSERT_DATE
        		AND PPMT3.PROC_GB = 'D'
        		)
		   AND ROWNUM = 1
    </select>
    -->
    <!-- 프로모션 별 운영관리 기능 효율화(REQ_PRM_040) : E -->
    
    <update id="updatePaPromoTarget"  parameterType="com.cware.netshopping.domain.model.PaPromoTarget">
        UPDATE /* pawempgoods.xml : pawemp.pawempgoods.updatePaCopnGoodsOffer by PaWempGoodsControlle */
               TPAPROMOTARGET PPMT
           SET PPMT.MODIFY_ID     = #{modifyId, jdbcType=VARCHAR}
			   <choose>
			   <when test='doCost != null and doCost == 0 '>
			 , PPMT.EXCEPT_REASON =  '마진률 초과  , 연동 예외 시간 : ' || TO_CHAR(SYSDATE , 'YYYY/MM/DD HH24:MI:SS')
			   </when>
			   <otherwise>
			 , PPMT.TRANS_DATE    = SYSDATE
			 , PPMT.EXCEPT_REASON = NULL
			   </otherwise>
			   </choose>  
             , PPMT.MODIFY_DATE   = #{modifyDate, jdbcType=TIMESTAMP}
         WHERE PPMT.PROMO_NO      = #{promoNo, jdbcType=VARCHAR}
           AND PPMT.PA_CODE       = #{paCode, jdbcType=VARCHAR}
           AND PPMT.GOODS_CODE    = #{goodsCode, jdbcType=VARCHAR}
           AND PPMT.SEQ           = #{seq, jdbcType=VARCHAR}
           AND PPMT.TRANS_DATE  IS NULL
    </update>
    
    <select id="selectPaPromoTarget" parameterType="hashMap" resultType="com.cware.netshopping.domain.model.PaPromoTarget">
	   SELECT  /* pawempgoods.xml : pawemp.pawempgoods.selectPaPromoTarget by PaWempGoodsControlle */
	           PROC_GB 
		     , PROMO_NO
		     , PA_CODE
		     , GOODS_CODE
		     , SEQ
		     , TRANS_DATE
		     , DO_COST
		     , OWN_COST
		     , ENTP_COST
		     , INSERT_DATE
		     , ALCOUT_PROMO_YN
		     , PA_GROUP_CODE
         FROM (
		       SELECT PPMT.PROC_GB
		            , PPMT.PROMO_NO
		            , PPMT.PA_CODE
		            , PPMT.GOODS_CODE
		            , PPMT.SEQ
		            , PPMT.TRANS_DATE
		            , PPMT.DO_AMT AS DO_COST
		            , PPMT.OWN_COST
		            , PPMT.ENTP_COST
		            , PPMT.INSERT_DATE
		            , PM.ALCOUT_PROMO_YN
		            , PPMT.PA_GROUP_CODE
		         FROM TPAPROMOTARGET PPMT
		            , TPROMOM PM
		            , TPPROMOTARGET	 PT
		        WHERE PPMT.USE_CODE = '00'
		          AND PT.PROMO_NO 	= PM.PROMO_NO
		          AND PT.GOODS_CODE = PPMT.GOODS_CODE 
		          AND PT.GIFT_AMT	= DECODE(PPMT.AMT_RATE_FLAG ,1, PPMT.DO_AMT , PPMT.DO_RATE) 
		          AND SYSDATE BETWEEN PPMT.PROMO_BDATE AND PPMT.PROMO_EDATE
		          AND SYSDATE BETWEEN PM.PROMO_BDATE   AND PM.PROMO_EDATE
		          AND PPMT.GOODS_CODE 				= #{goodsCode		, jdbcType=VARCHAR}
		          AND PPMT.PA_CODE 					= #{paCode			, jdbcType=VARCHAR}
		          AND PPMT.PROMO_NO 				= PM.PROMO_NO
		          AND PM.COUPON_YN 					= '1'
		          AND PM.IMMEDIATELY_YN 			= '1'
		          AND NVL(PM.ALCOUT_PROMO_YN, '0') 	= #{alcoutPromoYn	, jdbcType=VARCHAR}
		          <if test='promoNo != null and promoNo != ""'>
		          AND PPMT.PROMO_NO			= #{promoNo			, jdbcType=VARCHAR}
		          </if>
		          AND PROC_GB 					   != 'D'         
				  AND PPMT.ROWID    				= (SELECT /*+INDEX_DESC (PTT IDX_TPAPROMOTARGET_02)*/
						          					   		  ROWID 
						          					     FROM TPAPROMOTARGET PTT
						          					    WHERE PTT.PROMO_NO  	= PPMT.PROMO_NO
						          					      AND PTT.PA_CODE  	  = PPMT.PA_CODE
						          					      AND PTT.GOODS_CODE  = PPMT.GOODS_CODE
						          					      AND PTT.PROC_GB    != 'D'
						          					      AND PTT.USE_CODE    = '00'
						          					      AND PTT.DO_AMT  	  > 0
						          					      AND ROWNUM = 1 )
		          AND NOT EXISTS (
					        	   SELECT 'X'
					        		 FROM TPAPROMOTARGET PPMT3
					        	    WHERE PPMT3.PROMO_NO  		= PPMT.PROMO_NO
					        		  AND PPMT3.PA_CODE	 	 	= PPMT.PA_CODE
						              AND PPMT3.GOODS_CODE  	= PPMT.GOODS_CODE
					        	  	  AND PPMT3.INSERT_DATE 	> PPMT.INSERT_DATE
					        		  AND PPMT3.PROC_GB 	  	= 'D')
                  AND NOT EXISTS ( SELECT 1
                   			 		 FROM TPAPROMOTARGETEXCEPT TPE
                  				 	WHERE TPE.TARGET_GB = '00'
			                          AND TPE.TARGET_CODE = PPMT.GOODS_CODE
			                          AND TPE.USE_YN = '1'
			                          AND (TPE.PA_GROUP_CODE_ALL_YN = '1' OR TPE.PA_GROUP_CODE LIKE '%06%'))
   	            ORDER BY PPMT.DO_AMT DESC )
	    WHERE ROWNUM = 1
    </select>
    
    <select id="selectPaPromoDeleteTarget" parameterType="hashMap" resultType="com.cware.netshopping.domain.model.PaPromoTarget">
        SELECT  /* pawempgoods.xml : pawemp.pawempgoods.selectPaPromoDeleteTarget by PaWempGoodsControlle */
               /*+INDEX_DESC (PPMT IDX_TPAPROMOTARGET_02)*/
               PPMT.PROC_GB
             , PPMT.PROMO_NO
             , PPMT.PA_CODE
             , PPMT.GOODS_CODE
             , PPMT.SEQ
             , PPMT.TRANS_DATE
             , PPMT.DO_AMT AS DO_COST
             , PPMT.OWN_COST
             , PPMT.ENTP_COST
             , PPMT.INSERT_DATE
          FROM TPAPROMOTARGET PPMT
             , TPROMOM PM
         WHERE  PPMT.PROC_GB 				= 'D' 
           AND PPMT.TRANS_DATE 				IS NULL
           <!--  AND SYSDATE 						> PPMT.PROMO_EDATE-->
           AND PPMT.PROMO_NO 				= PM.PROMO_NO
           AND PM.COUPON_YN 				= '1'
           AND PM.IMMEDIATELY_YN 			= '1'
           AND NVL(PM.ALCOUT_PROMO_YN, '0') = #{alcoutPromoYn	, jdbcType=VARCHAR}
           AND PPMT.GOODS_CODE 				= #{goodsCode		, jdbcType=VARCHAR}
           AND PPMT.PA_CODE 				= #{paCode			, jdbcType=VARCHAR}
           AND EXISTS 	  ( SELECT /*+INDEX_DESC (PPMT3 IDX_TPAPROMOTARGET_04)*/
          						   'X'
					          FROM TPAPROMOTARGET PPMT3
					         WHERE PPMT3.PROMO_NO  		= PPMT.PROMO_NO
					           AND PPMT3.PA_CODE	 	= PPMT.PA_CODE
						       AND PPMT3.GOODS_CODE     = PPMT.GOODS_CODE
					           AND PPMT3.INSERT_DATE &lt; PPMT.INSERT_DATE
					           AND PPMT3.TRANS_DATE    IS NOT NULL
					           AND PPMT3.PROC_GB 	   != 'D'
					           AND PPMT3.DO_AMT  		> 0
					           AND ROWNUM 				= 1)
           AND ROWNUM = 1
    </select>
    
    <insert id="insertNewPaPromoTarget"  parameterType="com.cware.netshopping.domain.model.PaPromoTarget">
		INSERT INTO /* pawempgoods.xml : pawemp.pawempgoods.insertNewPaPromoTarget by PaWempGoodsControlle */
			   TPAPROMOTARGET PPMT
                             (PPMT.PROMO_NO
                            , PPMT.PA_CODE
                            , PPMT.GOODS_CODE
                            , PPMT.SEQ
                            , PPMT.DO_TYPE
                            , PPMT.COUPON_YN
                            , PPMT.IMMEDIATELY_YN
                            , PPMT.PROMO_BDATE
                            , PPMT.PROMO_EDATE
                            , PPMT.AMT_RATE_FLAG
                            , PPMT.DO_RATE
                            , PPMT.DO_AMT
                            , PPMT.STANDARD_APP_AMT
                            , PPMT.LIMIT_AMT
                            , PPMT.USE_CODE
                            , PPMT.OWN_COST
                            , PPMT.ENTP_COST
                            , PPMT.INSERT_ID
                            , PPMT.MODIFY_ID
                            , PPMT.PROC_GB
                            , PPMT.PA_GROUP_CODE
                            , PPMT.TRANS_DATE
                            , PPMT.INSERT_DATE
                            , PPMT.MODIFY_DATE
                            , PPMT.DO_COST
                            , PPMT.DO_OWN_COST
                            , PPMT.DO_ENTP_COST
                            , PPMT.EXCEPT_REASON
                            )
                         SELECT PM.PROMO_NO
                              , PM.PA_CODE
                              , PM.GOODS_CODE
                              , LPAD((SELECT MAX(PM1.SEQ) + 1 
                              	   FROM TPAPROMOTARGET PM1 
                              	  WHERE PM1.GOODS_CODE 	= #{goodsCode	, jdbcType=VARCHAR}
                              	  	AND PM1.PA_CODE 	= #{paCode		, jdbcType=VARCHAR}
                              	  	AND PM1.PROMO_NO 	= #{promoNo		, jdbcType=VARCHAR}
                              	  	), 4 ,'0')   
                              , PM.DO_TYPE
                              , PM.COUPON_YN
                              , PM.IMMEDIATELY_YN
                              , PM.PROMO_BDATE
                              , PM.PROMO_EDATE
                              , PM.AMT_RATE_FLAG
                              , PM.DO_RATE
                              , DECODE(#{doCost, jdbcType=NUMERIC}, 0 , 0 , PM.DO_AMT)
                              , PM.STANDARD_APP_AMT
                              , PM.LIMIT_AMT
                              , PM.USE_CODE
                              , DECODE(#{doCost, jdbcType=NUMERIC}, 0 , 0 , PM.OWN_COST)
                              , DECODE(#{doCost, jdbcType=NUMERIC}, 0 , 0 , PM.ENTP_COST)
                              , PM.INSERT_ID
                              , 'BATCH'
                              , DECODE(PM.PROC_GB, 'I', 'U', PM.PROC_GB)
                              , PM.PA_GROUP_CODE 
                              , SYSDATE
                              , SYSDATE
                              , SYSDATE
                           	  , DECODE(#{doCost, jdbcType=NUMERIC}, 0 , 0 , PM.DO_COST)
                              , DECODE(#{doCost, jdbcType=NUMERIC}, 0 , 0 , PM.DO_OWN_COST)
                              , DECODE(#{doCost, jdbcType=NUMERIC}, 0 , 0 , PM.DO_ENTP_COST)
                              , DECODE(#{doCost, jdbcType=NUMERIC}, 0 , '마진률 초과  , 연동 예외 시간 : ' || TO_CHAR(SYSDATE , 'YYYY/MM/DD HH24:MI:SS') , '') 
                           FROM TPAPROMOTARGET PM
                          WHERE PM.GOODS_CODE 	= #{goodsCode	, jdbcType=VARCHAR}
						    AND PM.PA_CODE 		= #{paCode		, jdbcType=VARCHAR}
							AND PM.PROMO_NO 	= #{promoNo		, jdbcType=VARCHAR}
					        AND PM.SEQ 			= #{seq			, jdbcType=VARCHAR}
     </insert>
          
     <update id="updateTPapromoTarget4ExceptMemo"  parameterType="com.cware.netshopping.domain.model.PaPromoTarget">
		UPDATE /* pawempgoods.xml : pawemp.pawempgoods.updateTPapromoTarget4ExceptMemo by PaWempGoodsControlle */
			   TPAPROMOTARGET T
		   SET T.EXCEPT_REASON = #{exceptReason	, jdbcType=VARCHAR}
		 WHERE T.PROMO_NO      = #{promoNo		, jdbcType=VARCHAR} 
		   AND T.PA_CODE       = #{paCode		, jdbcType=VARCHAR} 
		   AND T.SEQ		   = #{seq			, jdbcType=VARCHAR} 
		   AND T.GOODS_CODE	   = #{goodsCode	, jdbcType=VARCHAR} 
		   AND T.TRANS_DATE IS NULL
    </update>
         
    <insert id="insertNewPaPromoTargetAmt0"  parameterType="com.cware.netshopping.domain.model.PaPromoTarget">
		INSERT INTO /* pawempgoods.xml : pawemp.pawempgoods.insertNewPaPromoTargetAmt0 by PaWempGoodsControlle */
			   TPAPROMOTARGET PPMT
                             (PPMT.PROMO_NO
                            , PPMT.PA_CODE
                            , PPMT.GOODS_CODE
                            , PPMT.SEQ
                            , PPMT.DO_TYPE
                            , PPMT.COUPON_YN
                            , PPMT.IMMEDIATELY_YN
                            , PPMT.PROMO_BDATE
                            , PPMT.PROMO_EDATE
                            , PPMT.AMT_RATE_FLAG
                            , PPMT.DO_RATE
                            , PPMT.DO_AMT
                            , PPMT.STANDARD_APP_AMT
                            , PPMT.LIMIT_AMT
                            , PPMT.USE_CODE
                            , PPMT.OWN_COST
                            , PPMT.ENTP_COST
                            , PPMT.INSERT_ID
                            , PPMT.MODIFY_ID
                            , PPMT.PROC_GB
                            , PPMT.PA_GROUP_CODE
                            , PPMT.TRANS_DATE
                            , PPMT.INSERT_DATE
                            , PPMT.MODIFY_DATE
                            , PPMT.DO_COST
                            , PPMT.DO_OWN_COST
                            , PPMT.DO_ENTP_COST
                            )
                         SELECT PM.PROMO_NO
                              , PM.PA_CODE
                              , PM.GOODS_CODE
                              , LPAD((SELECT MAX(PM1.SEQ) + 1 
                              	   FROM TPAPROMOTARGET PM1 
                              	  WHERE PM1.GOODS_CODE 	= #{goodsCode	, jdbcType=VARCHAR}
                              	  	AND PM1.PA_CODE 	= #{paCode		, jdbcType=VARCHAR}
                              	  	AND PM1.PROMO_NO 	= #{promoNo		, jdbcType=VARCHAR}
                              	  	), 4 ,'0')   
                              , PM.DO_TYPE
                              , PM.COUPON_YN
                              , PM.IMMEDIATELY_YN
                              , PM.PROMO_BDATE
                              , PM.PROMO_EDATE
                              , PM.AMT_RATE_FLAG
                              , 0
                              , 0
                              , 0
                              , 0
                              , PM.USE_CODE
                              , 0
                              , 0
                              , PM.INSERT_ID
                              , 'BATCH'
                              , 'D'
                              , PM.PA_GROUP_CODE 
                              , SYSDATE
                              , SYSDATE
                              , SYSDATE
                              , 0
                              , 0
                              , 0                                
                           FROM TPAPROMOTARGET PM
                          WHERE PM.GOODS_CODE 	= #{goodsCode	, jdbcType=VARCHAR}
						    AND PM.PA_CODE 		= #{paCode		, jdbcType=VARCHAR}
							AND PM.PROMO_NO 	= #{promoNo		, jdbcType=VARCHAR}
					        AND PM.SEQ 			= #{seq			, jdbcType=VARCHAR}
     </insert>
     
     <select id="selectPaWempGoodsModifyCheck" resultType="int" parameterType="com.cware.netshopping.domain.PaWempGoodsVO">
        SELECT /* pawempgoods.xml : pawemp.pawempgoods.selectPaWempGoodsModifyCheck by PaWempGoodsController */ 
               COUNT(1)
          FROM TPAWEMPGOODS T
         WHERE T.GOODS_CODE = #{goodsCode		, jdbcType=VARCHAR}
           AND T.MODIFY_DATE > #{lastModifyDate, jdbcType=TIMESTAMP}
           AND T.PA_CODE = #{paCode, jdbcType=VARCHAR}
    </select>   
    
     <select id="selectPaWempGoodsTrans" parameterType="hashMap" resultType="hashMap">
        SELECT /* pawempgoods.xml : pawemp.pawempgoods.selectPaWempGoodsTrans*/ 
               TG.GOODS_CODE
             , PG.PA_CODE
          FROM TPAWEMPGOODS  PG
             , TPAPRODUCT    TG
             , TGOODS        GD
             , TCODE         TC
             , TGOODSPRICE   GP
             , TPAGOODSPRICE PP
         WHERE TG.GOODS_CODE  = PG.GOODS_CODE
           AND TG.GOODS_CODE  = GD.GOODS_CODE
           AND TC.CODE_LGROUP = 'O505'
           AND TC.CODE_MGROUP = PG.PA_CODE
           AND GP.GOODS_CODE  = PG.GOODS_CODE
           AND GP.ROWID 	  = (SELECT /*+ INDEX_DESC (Z PK_TGOODSPRICE)*/
                            			Z.ROWID
                             	   FROM TGOODSPRICE Z
                            	  WHERE Z.GOODS_CODE = GP.GOODS_CODE
                              		AND Z.APPLY_DATE &lt;= SYSDATE
                              		AND ROWNUM = 1)
           AND PP.GOODS_CODE  = PG.GOODS_CODE
           AND PP.PA_CODE 	  = PG.PA_CODE
           AND PP.APPLY_DATE  = GP.APPLY_DATE
           AND GD.SIGN_GB 	  = '80'
           AND GD.GIFT_YN 	  = '0'
           AND PG.PA_STATUS   = '10'
           AND PG.PA_SALE_GB  = '20'
           AND GD.INVI_GOODS_TYPE = '00'
           AND PG.INSERT_DATE &lt; SYSDATE - 1/24
           AND PG.INSERT_DATE > SYSDATE - 7
           AND EXISTS ( SELECT '1' 
                      	  FROM TPAGOODSTARGET PGT 
                     	 WHERE PGT.GOODS_CODE = PG.GOODS_CODE
                       	   AND PGT.PA_CODE = PG.PA_CODE)
           AND EXISTS ( SELECT '1' 
                          FROM TDESCRIBE DB 
                         WHERE DB.GOODS_CODE = GD.GOODS_CODE 
                           AND DB.DESCRIBE_CODE IN ('998','999')
                           AND DB.DESCRIBE_EXT IS NOT NULL
                           AND ROWNUM = 1 )  
           AND EXISTS ( SELECT '1'
                          FROM TGOODSIMAGE GI
                         WHERE GI.GOODS_CODE = GD.GOODS_CODE
                           AND NVL(IMAGE_C,IMAGE_G) IS NOT NULL
                           AND ROWNUM = 1 )
		   <if test='massTargetYn != null and massTargetYn != ""'>
		   AND PG.MASS_TARGET_YN = #{massTargetYn, jdbcType=VARCHAR}  
		   </if>
           ORDER BY GOODS_CODE
    </select>
    
    <update id="updatePaWempGoodsFail"  parameterType="hashMap">
        UPDATE TPAWEMPGOODS PG
           SET PG.RETURN_NOTE = #{RETURN_NOTE, jdbcType=VARCHAR}
             , PG.PA_STATUS   = #{PA_STATUS, jdbcType=VARCHAR}
             , PG.MODIFY_ID   = #{MODIFY_ID, jdbcType=VARCHAR}
             , PG.MODIFY_DATE = SYSDATE
         WHERE PG.GOODS_CODE  = #{GOODS_CODE, jdbcType=VARCHAR}  
           AND PG.PA_CODE     = #{PA_CODE, jdbcType=VARCHAR}  
    </update>
    
    <update id="updateMassTargetYn" parameterType="com.cware.netshopping.domain.PaWempGoodsVO">
		UPDATE /* pawempgoods.xml : pawemp.pawempgoods.updateMassTargetYn*/ 
			   TPAWEMPGOODS
		   SET MASS_TARGET_YN 	= #{massTargetYn 	, jdbcType=VARCHAR}
	 	 WHERE PA_CODE    		= #{paCode			, jdbcType=VARCHAR}
	 	   AND GOODS_CODE 		= #{goodsCode		, jdbcType=VARCHAR}
    </update>
    
    <update id="updateMassTargetYnByEpCode" parameterType="hashMap">
		UPDATE /* pawempgoods.xml : pawemp.pawempgoods.updateMassTargetYnByEpCode*/ 
			   TPAWEMPGOODS
		   SET MASS_TARGET_YN 	= #{massTargetYn 	, jdbcType=VARCHAR}
		     , MASS_TARGET_CODE = NULL
	 	 WHERE MASS_TARGET_EP	= #{massTargetEp 	, jdbcType=VARCHAR}
	 	   AND MASS_TARGET_YN  != '9'
    </update>      
    
</mapper>
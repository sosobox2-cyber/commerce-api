<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"
        "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">

<mapper namespace="pagmkt.common">

    <select id="selectBeforeInsertGoodsBaseInfo" resultType="hashMap" parameterType="String">
	    SELECT DECODE(TG.DELY_TYPE,'10','100001',PG.ENTP_CODE) AS ENTP_CODE
	    	 , DECODE(TG.DELY_TYPE,'10','003',PG.SHIP_MAN_SEQ) AS SHIP_MAN_SEQ
	      FROM TPAPRODUCT PG
	      	 , TGOODS TG
	     WHERE PG.GOODS_CODE = TG.GOODS_CODE
	       AND PG.GOODS_CODE = #{goodsCode, jdbcType=VARCHAR}
    </select>
	     
    <!-- 2018.10.31 before goods insert-goodsCode기준 업체출고지정보 select -->
    <select id="selectBeforeInsertGoodsEntp" resultType="hashMap" parameterType="String">
	    SELECT /* pagmktcommon.xml : pagmkt.pagmktcommon.selectBeforeInsertGoodsEntp by PaGmktCommonController-before-insert-goods */
	            DISTINCT X.ENTP_CODE, X.ENTP_MAN_SEQ, X.ENTP_MAN_GB
		  FROM (SELECT EU.ENTP_CODE, EU.ENTP_MAN_SEQ, EU.ENTP_MAN_GB
				  FROM TENTPUSER EU
					 , TPAPRODUCT PG
					 , TPAGMKTGOODS GG
					 , TGOODS GD
				 WHERE EU.ENTP_MAN_GB = '30'
				   AND DECODE(GD.DELY_TYPE,'10','100001',PG.ENTP_CODE) = EU.ENTP_CODE
				   AND DECODE(GD.DELY_TYPE,'10','003',PG.SHIP_MAN_SEQ) = EU.ENTP_MAN_SEQ
				   AND PG.GOODS_CODE = GG.GOODS_CODE
				   AND GG.PA_CODE IN ('20','21','22')
				   AND GG.GOODS_CODE = GD.GOODS_CODE
				   AND PG.GOODS_CODE = #{goodsCode, jdbcType=VARCHAR}
				   AND NOT EXISTS (SELECT 'X'
									 FROM TPAENTPSLIP PL
									WHERE EU.ENTP_CODE = PL.ENTP_CODE
									  AND EU.ENTP_MAN_SEQ = PL.ENTP_MAN_SEQ
									  AND PL.PA_CODE = '21')
			 UNION ALL
				SELECT EU.ENTP_CODE, EU.ENTP_MAN_SEQ, EU.ENTP_MAN_GB
				  FROM TENTPUSER EU
					 , TPAPRODUCT PG
					 , TPAGMKTGOODS GG
					 , TGOODS GD
				 WHERE EU.ENTP_MAN_GB = '20'
				   AND DECODE(GD.DELY_TYPE,'10','100001',PG.ENTP_CODE) = EU.ENTP_CODE
				   AND DECODE(GD.DELY_TYPE,'10','002',PG.RETURN_MAN_SEQ) = EU.ENTP_MAN_SEQ
				   AND PG.GOODS_CODE = GG.GOODS_CODE
				   AND GG.PA_CODE IN ('20','21','22')
				   AND GG.GOODS_CODE = GD.GOODS_CODE
				   AND PG.GOODS_CODE = #{goodsCode, jdbcType=VARCHAR}
				   AND NOT EXISTS (SELECT 'X'
									 FROM TPAENTPSLIP PL
									WHERE EU.ENTP_CODE = PL.ENTP_CODE
									  AND EU.ENTP_MAN_SEQ = PL.ENTP_MAN_SEQ
									  AND PL.PA_CODE = '21')) X
    </select>
    <select id="selectBeforeInsertGoodsEntpModify" resultType="hashMap" >
        SELECT /* pagmktcommon.xml : pagmkt.pagmktcommon.selectBeforeInsertGoodsEntpModify by PaGmktCommonController-before-insert-goods */
                DISTINCT X.ENTP_CODE, X.ENTP_MAN_SEQ, X.ENTP_MAN_GB
          FROM (SELECT EU.ENTP_CODE, EU.ENTP_MAN_SEQ, EU.ENTP_MAN_GB
                  FROM TENTPUSER EU
                     , TPAENTPSLIP PL
                 WHERE EU.ENTP_MAN_GB = '30'
                   AND EU.ENTP_CODE = PL.ENTP_CODE
                   AND EU.ENTP_MAN_SEQ = PL.ENTP_MAN_SEQ
                   AND PL.PA_CODE = '21'
                   AND PL.TRANS_TARGET_YN = '1'
                   <if test = 'entpCode != null and entpCode != "" '>
                   AND PL.ENTP_CODE = #{entpCode	, jdbcType=VARCHAR}
                   </if>
                UNION ALL
                SELECT EU.ENTP_CODE, EU.ENTP_MAN_SEQ, EU.ENTP_MAN_GB
                  FROM TENTPUSER EU
                     , TPAENTPSLIP PL
                 WHERE EU.ENTP_MAN_GB = '20'
                   AND EU.ENTP_CODE = PL.ENTP_CODE
                   AND EU.ENTP_MAN_SEQ = PL.ENTP_MAN_SEQ
                   AND PL.PA_CODE = '21'
                   <if test = 'entpCode != null and entpCode != "" '>
                   AND PL.ENTP_CODE = #{entpCode	, jdbcType=VARCHAR}
                   </if>
                   AND PL.TRANS_TARGET_YN = '1') X
	  ORDER BY ENTP_CODE, ENTP_MAN_SEQ, ENTP_MAN_GB
    </select>
    <!-- 2018.11.01 before goods insert-goodsCode기준 업체출고지(미등록건)정보 select -->
    <select id="selectBeforeInsertGoodsShip" resultType="hashMap">
        SELECT /* pagmktcommon.xml : pagmkt.pagmktcommon.selectBeforeInsertGoodsShip by PaGmktCommonController-before-insert-goods */
               DISTINCT GSM.SHIP_COST_CODE,
		                GSM.ENTP_CODE,
		                GSM.ENTP_MAN_SEQ,
		                PES.PA_ADDR_GB
		  FROM TPAGMKTSHIPCOSTM GSM, TPAENTPSLIP PES
		 WHERE GSM.TRANS_TARGET_YN = '1'
		   AND GSM.GMKT_SHIP_NO IS NULL
		   AND PES.PA_GMKT_SHIP_NO IS NULL
		   AND GSM.ENTP_CODE = PES.ENTP_CODE
		   AND GSM.ENTP_MAN_SEQ = PES.ENTP_MAN_SEQ
		   AND PES.PA_CODE = '21'
		   AND GSM.USE_YN = '1'
        
        
               <!-- PG.SHIP_COST_CODE,
		       PES.ENTP_CODE,
		       PES.ENTP_MAN_SEQ,
		       PES.PA_ADDR_SEQ,
		       PES.PA_ADDR_GB
		  FROM TPAENTPSLIP PES, TPAGOODS PG, TPAGMKTGOODS GG
		 WHERE PES.PA_CODE = '21'
		   AND PES.PA_ADDR_GB = '30'
		   AND PG.GOODS_CODE = GG.GOODS_CODE
		   AND PES.ENTP_CODE = PG.ENTP_CODE
		   AND PES.ENTP_MAN_SEQ = PG.SHIP_MAN_SEQ
		   AND NOT EXISTS  (SELECT 1
					          FROM TPAGMKTSHIPCOSTM GSM
					         WHERE GSM.ENTP_CODE = PES.ENTP_CODE
					           AND GSM.ENTP_MAN_SEQ = PES.ENTP_MAN_SEQ
					           AND GSM.SHIP_COST_CODE = PG.SHIP_COST_CODE) -->
    </select>
    <!-- 2018.11.02 before goods insert-goodsCode기준 업체출고지(수정건)정보 select -->
    <select id="selectBeforeInsertGoodsShipModify" resultType="hashMap">
        SELECT /* pagmktcommon.xml : pagmkt.pagmktcommon.selectBeforeInsertGoodsShipModify by PaGmktCommonController-before-insert-goods */
               /*+ LEADING(GSM) INDEX(GSM (TRANS_TARGET_YN, USE_YN, GMKT_SHIP_NO)) */
               DISTINCT GSM.SHIP_COST_CODE,
		                GSM.ENTP_CODE,
		                GSM.ENTP_MAN_SEQ,
		                PES.PA_ADDR_GB
		  FROM TPAGMKTSHIPCOSTM GSM, TPAENTPSLIP PES
		 WHERE GSM.TRANS_TARGET_YN = '1'
		   AND PES.PA_GMKT_SHIP_NO IS NOT NULL
		   AND GSM.ENTP_CODE = PES.ENTP_CODE
		   AND GSM.ENTP_MAN_SEQ = PES.ENTP_MAN_SEQ
		   AND PES.PA_CODE = '21'
		   AND GSM.USE_YN = '1'
        
               <!-- PG.SHIP_COST_CODE,
               PES.ENTP_CODE,
               PES.ENTP_MAN_SEQ,
               PES.PA_ADDR_SEQ,
               PES.PA_ADDR_GB
          FROM TPAENTPSLIP PES, TPAGOODS PG, TPAGMKTGOODS GG
         WHERE PES.PA_CODE = '21'
           AND PES.PA_ADDR_GB = '30'
           AND PG.GOODS_CODE = GG.GOODS_CODE
           AND PES.ENTP_CODE = PG.ENTP_CODE
           AND PES.ENTP_MAN_SEQ = PG.SHIP_MAN_SEQ
           AND NOT EXISTS  (SELECT 1
                              FROM TPAGMKTSHIPCOSTM GSM
                             WHERE GSM.ENTP_CODE = PES.ENTP_CODE
                               AND GSM.ENTP_MAN_SEQ = PES.ENTP_MAN_SEQ
                               AND PES.PA_CODE = '21'
                               AND GSM.GMKT_SHIP_NO IS NULL
                               AND GSM.SHIP_COST_CODE = PG.SHIP_COST_CODE
                               AND GSM.TRANS_TARGET_YN = '1') -->
    </select>
    <!-- 2018.11.02 before goods insert-출고지 기준 묶음배송번호를 위한 select -->
    <select id="selectBeforeInsertGoodsBundle" resultType="hashMap" parameterType="String">
        SELECT /* pagmktcommon.xml : pagmkt.pagmktcommon.selectBeforeInsertGoodsBundle by PaGmktCommonController-before-insert-goods */
               GSD.GMKT_SHIP_NO,
               GSD.ENTP_CODE,
               GSD.ENTP_MAN_SEQ
		  FROM TPAGMKTSHIPCOSTDT GSD
		 WHERE GSD.BUNDLE_NO IS NULL
		   AND GSD.TRANS_TARGET_YN = '1'
    </select>
    <!-- 2018.11.02 before goods insert-출고지 기준 묶음배송번호 수정을 위한 select -->
    <select id="selectBeforeInsertGoodsBundleModify" resultType="hashMap" parameterType="String">
        SELECT /* pagmktcommon.xml : pagmkt.pagmktcommon.selectBeforeInsertGoodsBundleModify by PaGmktCommonController-before-insert-goods */
               GSD.GMKT_SHIP_NO,
               GSD.ENTP_CODE,
               GSD.ENTP_MAN_SEQ
          FROM TPAGMKTSHIPCOSTDT GSD
         WHERE GSD.BUNDLE_NO IS NOT NULL
           AND GSD.TRANS_TARGET_YN = '1'
    </select>

    <!-- 2018.10.23 판매자주소 등록 조회 thjeon -->
    <select id="selectEntpShipInsertList" resultType="hashMap" parameterType="com.cware.netshopping.domain.model.PaEntpSlip">
        SELECT /* pagmktcommon.xml : pagmkt.pagmktcommon.selectEntpShipInsertList by PaGmktCommonController-postSellerAddr */
               DISTINCT EU.POST_NO
             , EU.POST_SEQ
             , DECODE(EU.SELECT_ADDR, '1', FUN_ADD_POSTADDR(EU.POST_NO, EU.POST_SEQ,
                                                            NULL, EU.ROAD_ADDR_YN) 
                                    , '2', RTRIM(EU.STD_ROAD_POST_ADDR1 ||' '||EU.STD_ROAD_POST_ADDR2)
                                    , '3', RTRIM(EU.STD_POST_ADDR1 ||' '||EU.STD_POST_ADDR2)
                     ) AS POST_ADDR
             , EU.ADDR
             , EU.ROAD_ADDR_YN
             , EU.ROAD_POST_ADDR
             , EU.ROAD_ADDR
             , EU.ENTP_CODE
             , EU.ENTP_MAN_SEQ
             , EU.ENTP_MAN_GB 
             , EU.ENTP_MAN_NAME
             , EU.ENTP_MAN_DDD || '-' || EU.ENTP_MAN_TEL1 || '-' || EU.ENTP_MAN_TEL2 AS ENTP_MAN_TEL
             , EU.ENTP_MAN_HP1 || '-' || EU.ENTP_MAN_HP2 || '-' || EU.ENTP_MAN_HP3 AS ENTP_MAN_HP
             , TO_CHAR(EU.MODIFY_DATE, 'YYYY/MM/DD HH24:MI:SS') MODIFY_DATE
             , REPLACE((SELECT EP.ENTP_NAME FROM TENTERPRISE EP WHERE EP.ENTP_CODE = EU.ENTP_CODE),'&amp;','') ENTP_NAME
          FROM TENTPUSER EU
         WHERE EU.ENTP_MAN_GB = #{paAddrGb, jdbcType=VARCHAR}     
           AND EU.ENTP_CODE  = #{entpCode, jdbcType=VARCHAR}
           AND EU.ENTP_MAN_SEQ = #{entpManSeq, jdbcType=VARCHAR}
           AND NOT EXISTS (SELECT 'X'
                             FROM TPAENTPSLIP PL               
                            WHERE EU.ENTP_CODE = PL.ENTP_CODE
                              AND EU.ENTP_MAN_SEQ = PL.ENTP_MAN_SEQ
                              AND PL.PA_CODE = #{paCode, jdbcType=VARCHAR})
    </select>
    <!-- 2018.10.23 판매자주소 수정 조회 thjeon -->
    <select id="selectEntpShipModifyList" resultType="hashMap" parameterType="com.cware.netshopping.domain.model.PaEntpSlip">
        SELECT /* pagmktcommon.xml : pagmkt.pagmktcommon.selectEntpShipModifyList by PaGmktCommonController-putSellerAddr */
               DISTINCT EU.POST_NO
             , EU.POST_SEQ
             , DECODE(EU.SELECT_ADDR, '1', FUN_ADD_POSTADDR(EU.POST_NO, EU.POST_SEQ,
                                                            NULL, EU.ROAD_ADDR_YN) 
                                    , '2', RTRIM(EU.STD_ROAD_POST_ADDR1 ||' '||EU.STD_ROAD_POST_ADDR2)
                                    , '3', RTRIM(EU.STD_POST_ADDR1 ||' '||EU.STD_POST_ADDR2)
                     ) AS POST_ADDR
             , EU.ADDR
             , EU.ROAD_ADDR_YN
             , EU.ROAD_POST_ADDR
             , EU.ROAD_ADDR
             , EU.ENTP_CODE
             , EU.ENTP_MAN_SEQ
             , EU.ENTP_MAN_GB 
             , EU.ENTP_MAN_NAME
             , EU.ENTP_MAN_DDD || '-' || EU.ENTP_MAN_TEL1 || '-' || EU.ENTP_MAN_TEL2 AS ENTP_MAN_TEL
             , EU.ENTP_MAN_HP1 || '-' || EU.ENTP_MAN_HP2 || '-' || EU.ENTP_MAN_HP3 AS ENTP_MAN_HP
             , TO_CHAR(EU.MODIFY_DATE, 'YYYY/MM/DD HH24:MI:SS') MODIFY_DATE
             , REPLACE((SELECT EP.ENTP_NAME FROM TENTERPRISE EP WHERE EP.ENTP_CODE = EU.ENTP_CODE),'&amp;','') ENTP_NAME
             , PES.PA_ADDR_SEQ
          FROM TENTPUSER EU
             , TPAENTPSLIP PES
         WHERE EU.ENTP_MAN_GB = #{paAddrGb, jdbcType=VARCHAR}
           AND EU.ENTP_CODE  = #{entpCode, jdbcType=VARCHAR}
           AND EU.ENTP_MAN_SEQ = #{entpManSeq, jdbcType=VARCHAR}
           AND PES.ENTP_CODE = EU.ENTP_CODE
		   AND PES.ENTP_MAN_SEQ = EU.ENTP_MAN_SEQ
		   AND PES.PA_ADDR_GB = EU.ENTP_MAN_GB
		   AND PES.PA_CODE = #{paCode, jdbcType=VARCHAR}
		   AND PES.TRANS_TARGET_YN = '1'
    </select>
    
    <!-- 2018.10.31 판매자주소 등록 후 gmktshipcostm insert select-->
    <select id="selectPaGmktShipCostM" resultType="com.cware.netshopping.domain.model.PaGmktShipCostM" parameterType="hashMap">
        SELECT /* pagmktcommon.xml : pagmkt.pagmktcommon.selectPaGmktShipCostM by PaGmktCommonController-putSellerAddr */ 
		       DISTINCT NULL AS GMKT_SHIP_SEQ,
		                (SELECT DISTINCT GSM.GMKT_SHIP_NO
		                   FROM TPAGMKTSHIPCOSTM GSM
		                  WHERE GSM.ENTP_CODE = #{entpCode, jdbcType=VARCHAR}
		                    AND GSM.ENTP_MAN_SEQ = PES.ENTP_MAN_SEQ
		                    AND GSM.GMKT_SHIP_NO IS NOT NULL
		                    AND GSM.USE_YN = '1') AS GMKT_SHIP_NO,
		                X.ENTP_CODE,
		                PES.ENTP_MAN_SEQ,
		                X.SHIP_COST_CODE,
		                X.ORD_COST,
		                X.ISLAND_COST,
		                X.JEJU_COST,
		                '1' AS TRANS_CHECK_YN,
		                NULL AS TRANS_END_DATE,
		                NULL AS APPLY_GMKT_SHIP_SEQ,
		                '0' AS TRANS_TARGET_YN,
		                'PAG' AS INSERT_ID,
		                SYSDATE AS INSERT_DATE,
		                'PAG' AS MODIFY_ID,
		                SYSDATE AS MODIFY_DATE
		  FROM (SELECT CD.ENTP_CODE,
		               CD.SHIP_COST_CODE,
		               SUM(DECODE(CUST_AREA_GB, '10', ORD_COST_AMT, 0)) AS ORD_COST,
		               SUM(DECODE(CUST_AREA_GB, '20', ORD_COST_AMT, 0)) AS ISLAND_COST,
		               SUM(DECODE(CUST_AREA_GB, '30', ORD_COST_AMT, 0)) AS JEJU_COST
		          FROM TSHIPCOSTDT CD
		         WHERE CD.APPLY_DATE =
		               (SELECT MAX(APPLY_DATE)
		                  FROM TSHIPCOSTDT CD1
		                 WHERE CD1.ENTP_CODE = CD.ENTP_CODE
		                   AND CD1.CUST_AREA_GB IN ('10', '20', '30')
		                   AND CD1.SHIP_COST_CODE = CD.SHIP_COST_CODE
		                   AND CD1.APPLY_DATE &lt; SYSDATE)
		           AND CD.ENTP_CODE = #{entpCode, jdbcType=VARCHAR}
		         GROUP BY CD.ENTP_CODE, CD.SHIP_COST_CODE) X,
		       TPAENTPSLIP PES,
		       TPAGMKTGOODS GG,
	           TPAPRODUCT PG
	     WHERE X.ENTP_CODE = PES.ENTP_CODE
	       AND PES.PA_CODE = '21'
	       AND PES.ENTP_MAN_SEQ = #{entpManSeq, jdbcType=VARCHAR}
	       AND GG.PA_CODE IN ('20', '21', '22')
	       AND GG.GOODS_CODE=PG.GOODS_CODE
	       AND PG.ENTP_CODE = PES.ENTP_CODE
	       AND PG.SHIP_MAN_SEQ = PES.ENTP_MAN_SEQ
	       AND X.SHIP_COST_CODE = PG.SHIP_COST_CODE
		 ORDER BY X.ENTP_CODE, PES.ENTP_MAN_SEQ, X.SHIP_COST_CODE
    </select>
    <!--step1 2018.10.31 판매자주소 등록후 gmktshipcostm insert -->
    <insert id="insertPaGmktShipCostM" parameterType="com.cware.netshopping.domain.model.PaGmktShipCostM">
        INSERT INTO TPAGMKTSHIPCOSTM /* pagmktcommon.xml : pagmkt.pagmktcommon.insertPaGmktShipCostM by PaGmktCommonController-putSellerAddr */
			  (GMKT_SHIP_SEQ,
			   GMKT_SHIP_NO,
			   ENTP_CODE,
			   ENTP_MAN_SEQ,
			   SHIP_COST_CODE,
			   ORD_COST,
			   ISLAND_COST,
			   JEJU_COST,
			   TRANS_CHECK_YN,
			   TRANS_END_DATE,
			   APPLY_GMKT_SHIP_SEQ,
			   TRANS_TARGET_YN,
			   INSERT_ID,
			   INSERT_DATE,
			   MODIFY_ID,
			   MODIFY_DATE)
			VALUES
			  (#{gmktShipSeq, jdbcType=VARCHAR},
			   #{gmktShipNo, jdbcType=VARCHAR},
			   #{entpCode, jdbcType=VARCHAR},
			   #{entpManSeq, jdbcType=VARCHAR},
			   #{shipCostCode, jdbcType=VARCHAR},
			   #{ordCost, jdbcType=NUMERIC},
			   #{islandCost, jdbcType=NUMERIC},
			   #{jejuCost, jdbcType=NUMERIC},
			   #{transCheckYn, jdbcType=VARCHAR},
			   #{transEndDate, jdbcType=VARCHAR},
			   #{applyGmktShipSeq, jdbcType=VARCHAR},
			   #{transTargetYn, jdbcType=VARCHAR},
			   #{insertId, jdbcType=VARCHAR},
			   #{insertDate, jdbcType=TIMESTAMP},
			   #{modifyId, jdbcType=VARCHAR},
			   #{modifyDate, jdbcType=TIMESTAMP})
    </insert>
    
    <resultMap type="hashMap" id="pagmktshipcostMmap">
    <result column="GMKT_SHIP_SEQ" property="gmktShipSeq" jdbcType="VARCHAR" />
    <result column="ENTP_CODE" property="entpCode" jdbcType="VARCHAR" />
    <result column="ENTP_MAN_SEQ" property="entpManSeq" jdbcType="VARCHAR" />
    <result column="SHIP_COST_CODE" property="shipCostCode" jdbcType="VARCHAR" />
    <result column="ISLAND_COST" property="islandCost" jdbcType="VARCHAR" />
    <result column="JEJU_COST" property="jejuCost" jdbcType="VARCHAR" />
    </resultMap>
    
    <!--step2 2018.10.31 판매자주소 등록후 gmktshipcostm max select by entpCode,entpManSeq -->
    <select id="selectMaxPaGmktShipCostM" parameterType="com.cware.netshopping.domain.model.PaEntpSlip" resultMap="pagmktshipcostMmap">
        SELECT /* pagmktcommon.xml : pagmkt.pagmktcommon.selectMaxPaGmktShipCostM by PaGmktCommonController-putSellerAddr */ 
               X.GMKT_SHIP_SEQ,
		       X.ENTP_CODE,
		       X.ENTP_MAN_SEQ,
		       X.SHIP_COST_CODE,
		       X.ORD_COST,
		       X.ISLAND_COST,
		       X.JEJU_COST
		  FROM (SELECT A.GMKT_SHIP_SEQ,
		               A.ENTP_CODE,
		               A.ENTP_MAN_SEQ,
		               A.SHIP_COST_CODE,
		               A.ORD_COST,
		               A.ISLAND_COST,
		               A.JEJU_COST
		          FROM TPAGMKTSHIPCOSTM A
		         WHERE A.ENTP_CODE = #{entpCode, jdbcType=VARCHAR}
		           AND A.ENTP_MAN_SEQ = #{entpManSeq, jdbcType=VARCHAR}
		           AND A.TRANS_CHECK_YN = '1'
		           AND A.USE_YN = '1'
		           AND A.ISLAND_COST =
		               (SELECT MAX(B.ISLAND_COST)
		                  FROM TPAGMKTSHIPCOSTM B
		                 WHERE B.ENTP_CODE = A.ENTP_CODE
		                   AND B.ENTP_MAN_SEQ = A.ENTP_MAN_SEQ
		                   AND B.TRANS_CHECK_YN = '1'
		                   AND B.USE_YN = '1')
		         ORDER BY A.ISLAND_COST DESC, A.MODIFY_DATE DESC) X
		 WHERE ROWNUM = 1
    </select>
    
    <!--step2-1 2019.01.02 판매자주소 등록후 gmktshipcostm update max selected check , 출고지 동일 가격 개선 쿼리, NULL체크 필수 -->
    <select id="selectMaxTransEndDateCompare" parameterType="hashMap" resultType="hashMap">
	        SELECT /* pagmktcommon.xml : pagmkt.pagmktcommon.selectMaxTransEndDateCompare by PaGmktCommonController-putSellerAddr */
	               X.GMKT_SHIP_NO,
			       X.ENTP_CODE,
			       X.ENTP_MAN_SEQ,
			       X.SHIP_COST_CODE,
			       X.ISLAND_COST,
			       X.JEJU_COST,
			       COUNT(1) OVER() AS COUNT
			  FROM (
			        SELECT A.GMKT_SHIP_NO,
			               A.ENTP_CODE,
			               A.ENTP_MAN_SEQ,
			               A.SHIP_COST_CODE,
			               A.ISLAND_COST,
			               A.JEJU_COST
			          FROM TPAGMKTSHIPCOSTM A
			         WHERE A.ENTP_CODE = #{entpCode, jdbcType=VARCHAR}
			           AND A.ENTP_MAN_SEQ = #{entpManSeq, jdbcType=VARCHAR}
			           AND A.SHIP_COST_CODE = #{shipCostCode, jdbcType=VARCHAR}
			           AND A.TRANS_END_DATE IS NULL
			           AND A.TRANS_CHECK_YN = '1'
			           AND A.USE_YN = '1'
			        UNION
			        SELECT B.GMKT_SHIP_NO,
			               B.ENTP_CODE,
			               B.ENTP_MAN_SEQ,
			               B.SHIP_COST_CODE,
			               B.ISLAND_COST,
			               B.JEJU_COST
			          FROM TPAGMKTSHIPCOSTM B
			         WHERE B.ENTP_CODE = #{entpCode, jdbcType=VARCHAR}
			           AND B.ENTP_MAN_SEQ = #{entpManSeq, jdbcType=VARCHAR}
			           AND B.USE_YN = '1'
			           AND B.TRANS_END_DATE =
			               (SELECT MAX(C.TRANS_END_DATE)
			                  FROM TPAGMKTSHIPCOSTM C
			                 WHERE C.ENTP_CODE = B.ENTP_CODE
			                   AND C.ENTP_MAN_SEQ = B.ENTP_MAN_SEQ
			                   AND C.USE_YN = '1')) X
    </select>
    
    <!--step3 2018.10.31 판매자주소 등록후 gmktshipcostm update max selected -->
    <update id="updateMaxPaGmktShipCostM" parameterType="hashMap">
        UPDATE TPAGMKTSHIPCOSTM A /* pagmktcommon.xml : pagmkt.pagmktcommon.updateMaxPaGmktShipCostM by PaGmktCommonController-putSellerAddr */
		   SET A.TRANS_TARGET_YN = '1'
		 WHERE A.ENTP_CODE = #{entpCode, jdbcType=VARCHAR}
		   AND A.ENTP_MAN_SEQ = #{entpManSeq, jdbcType=VARCHAR}
		   AND A.SHIP_COST_CODE = #{shipCostCode, jdbcType=VARCHAR}
		   AND A.TRANS_CHECK_YN = '1' 
		   AND A.USE_YN = '1'
    </update>
    <!--step4 2018.10.31 판매자주소 등록후 gmktshipcostm update not max selected -->
    <update id="updateNotMaxPaGmktShipCostM" parameterType="hashMap">
        UPDATE TPAGMKTSHIPCOSTM A /* pagmktcommon.xml : pagmkt.pagmktcommon.updateNotMaxPaGmktShipCostM by PaGmktCommonController-putSellerAddr */ 
		   SET A.TRANS_CHECK_YN = '0', 
		       A.APPLY_GMKT_SHIP_SEQ = #{gmktShipSeq, jdbcType=VARCHAR}
		 WHERE A.ENTP_CODE = #{entpCode, jdbcType=VARCHAR}
		   AND A.ENTP_MAN_SEQ = #{entpManSeq, jdbcType=VARCHAR}
		   AND A.TRANS_CHECK_YN = '1'
		   AND A.USE_YN = '1'
    </update>
    
    
    
    <!-- 2018.10.24 출고지 등록 조회 thjeon -->
    <select id="selectEntpShipCostInsertList" resultType="hashMap" parameterType="com.cware.netshopping.domain.model.PaEntpSlip">
        SELECT DISTINCT /* pagmktcommon.xml : pagmkt.pagmktcommon.selectEntpShipCostInsertList by PaGmktCommonController-postShippingPlaces */ 
	           PES.PA_ADDR_SEQ,
		       PES.ENTP_CODE,
		       PES.ENTP_MAN_SEQ,
		       GSM.SHIP_COST_CODE,
		       GSM.GMKT_SHIP_NO,
		       GSM.ORD_COST,
		       GSM.ISLAND_COST,
		       GSM.JEJU_COST,
		       (SELECT COUNT(1)
	                FROM BMTPARTNER.TPAGMKTSHIPCOSTM A
	               WHERE A.ENTP_CODE = GSM.ENTP_CODE
	                 AND A.ENTP_MAN_SEQ = GSM.ENTP_MAN_SEQ
	                 AND A.TRANS_ERROR_YN = '1'
	                 AND A.USE_YN = '0') AS ERROR_CNT
		  FROM TPAGMKTSHIPCOSTM GSM, TPAENTPSLIP PES
		 WHERE PES.ENTP_CODE = GSM.ENTP_CODE
		   AND PES.ENTP_MAN_SEQ = GSM.ENTP_MAN_SEQ
		   AND PES.PA_CODE = '21'
		   AND GSM.ENTP_CODE = #{entpCode, jdbcType=VARCHAR}
		   AND GSM.ENTP_MAN_SEQ = #{entpManSeq, jdbcType=VARCHAR}
		   AND NOT EXISTS (SELECT 1 FROM TPAGMKTSHIPCOSTDT GSD WHERE GSD.GMKT_SHIP_NO = GSM.GMKT_SHIP_NO)
		   <!-- AND NOT EXISTS (SELECT 1 FROM TPAGMKTSHIPCOSTM GSM2 WHERE GSM2.ENTP_CODE = GSM.ENTP_CODE AND GSM2.ENTP_MAN_SEQ = GSM.ENTP_MAN_SEQ) -->
		   AND GSM.TRANS_TARGET_YN = '1'
		   AND GSM.USE_YN = '1' 
    </select>
    <!-- 2018.10-31 출고지 등록 update1-tpagmktshipcostm -->
    <update id="updatePagmktshipcostmForInsert" parameterType="com.cware.netshopping.domain.model.PaGmktShipCostM">
        UPDATE TPAGMKTSHIPCOSTM GSM /* pagmktcommon.xml : pagmkt.pagmktcommon.updatePagmktshipcostmForInsert by PaGmktCommonController-postShippingPlaces */
		   SET GSM.GMKT_SHIP_NO = #{gmktShipNo, jdbcType=VARCHAR},
	       <!--GSM.ISLAND_COST = #{islandCost, jdbcType=VARCHAR},
               GSM.JEJU_COST = #{jejuCost, jdbcType=VARCHAR}, -->
		       GSM.TRANS_TARGET_YN = '0',
		       GSM.TRANS_END_DATE  = SYSDATE,
		       GSM.MODIFY_ID       = 'PAG',
		       GSM.MODIFY_DATE     = SYSDATE
		 WHERE GSM.ENTP_CODE = #{entpCode, jdbcType=VARCHAR}
		   AND GSM.ENTP_MAN_SEQ = #{entpManSeq, jdbcType=VARCHAR}
		   AND GSM.GMKT_SHIP_NO IS NULL
		   AND GSM.TRANS_TARGET_YN = '1'
		   AND GSM.USE_YN = '1'
    </update>
    <!-- 2018.10-31 출고지 등록 update2-tpaentpslip -->
    <update id="updatePaentpslipForInsert" parameterType="com.cware.netshopping.domain.model.PaGmktShipCostM">
        UPDATE TPAENTPSLIP PES /* pagmktcommon.xml : pagmkt.pagmktcommon.updatePaentpslipForInsert by PaGmktCommonController-postShippingPlaces */
		   SET PES.PA_GMKT_SHIP_NO = #{gmktShipNo, jdbcType=VARCHAR},
		       PES.MODIFY_ID       = 'PAG',
		       PES.MODIFY_DATE     = SYSDATE
		 WHERE PES.PA_CODE = '21'
		   AND PES.ENTP_CODE = #{entpCode, jdbcType=VARCHAR}
		   AND PES.ENTP_MAN_SEQ = #{entpManSeq, jdbcType=VARCHAR}
		   AND PES.PA_GMKT_SHIP_NO IS NULL
    </update>

    <!-- 2018.11.05 출고지 등록후 gmktshipcostdt insert/update를 위한 select -->
    <select id="selectPaGmktShipCostDt" parameterType="com.cware.netshopping.domain.model.PaEntpSlip" resultType="com.cware.netshopping.domain.model.PaGmktShipCostDt">
        SELECT /* pagmktcommon.xml : pagmkt.pagmktcommon.selectPaGmktShipCostDt by PaGmktCommonController-postShippingPlaces */
        distinct
        	   (SELECT PA_GMKT_SHIP_NO FROM TPAENTPSLIP A WHERE A.ENTP_CODE = GSM.ENTP_CODE AND A.ENTP_MAN_SEQ =GSM.ENTP_MAN_SEQ AND A.PA_CODE ='21' AND ROWNUM = 1) as GMKT_SHIP_NO ,
               GSM.ENTP_CODE,
               GSM.ENTP_MAN_SEQ,
               GSM.SHIP_COST_CODE,
               CM.SHIP_COST_BASE_AMT,
               CD.ORD_COST_AMT,
               CASE
				   WHEN CM.SHIP_COST_BASE_AMT = GSD.SHIP_COST_BASE_AMT THEN
				    CASE
				      WHEN CD.ORD_COST_AMT = GSD.ORD_COST_AMT THEN
				       '0'
				      ELSE
				       '1'
				    END
				   ELSE
				    '1'
				 END AS TRANS_TARGET_YN,
               'PAG' AS INSERT_ID,
               SYSDATE AS INSERT_DATE,
               'PAG' AS MODIFY_ID,
               SYSDATE AS MODIFY_DATE,
               (SELECT DISTINCT GSD.BUNDLE_NO
                  FROM TPAGMKTSHIPCOSTDT GSD
                 WHERE GSD.ENTP_CODE     = GSM.ENTP_CODE
                   AND GSD.ENTP_MAN_SEQ = GSM.ENTP_MAN_SEQ
                   AND GSD.SHIP_COST_CODE= GSM.SHIP_COST_CODE
                   AND ROWNUM = 1
                   ) AS BUNDLE_NO
          FROM TPAGMKTSHIPCOSTM GSM, TSHIPCOSTDT CD, TSHIPCOSTM CM, TPAGMKTSHIPCOSTDT GSD
         WHERE GSM.ENTP_CODE = #{entpCode, jdbcType=VARCHAR}
           AND GSM.ENTP_MAN_SEQ = #{entpManSeq, jdbcType=VARCHAR}
           AND GSM.TRANS_CHECK_YN = '0'
           <!--  AND GSM.GMKT_SHIP_NO IS NOT NULL-->
           AND EXISTS (SELECT 'X' FROM TPAENTPSLIP A WHERE A.ENTP_CODE = GSM.ENTP_CODE AND A.ENTP_MAN_SEQ =GSM.ENTP_MAN_SEQ AND A.PA_CODE ='21' AND A.PA_GMKT_SHIP_NO IS NOT NULL)
           
           AND GSM.USE_YN = '1'
           <!-- 
           AND GSM.MODIFY_DATE =
               (SELECT MAX(B.MODIFY_DATE)
                  FROM TPAGMKTSHIPCOSTM B
                 WHERE B.ENTP_CODE = GSM.ENTP_CODE
                   AND B.ENTP_MAN_SEQ = GSM.ENTP_MAN_SEQ
                   AND B.SHIP_COST_CODE = GSM.SHIP_COST_CODE
                   AND B.TRANS_CHECK_YN = GSM.TRANS_CHECK_YN
                   AND B.GMKT_SHIP_NO = GSM.GMKT_SHIP_NO
                   AND B.USE_YN = '1') -->
          AND GSM.ROWID =
               (SELECT XX.ROWID 
                  FROM( SELECT *
                          FROM TPAGMKTSHIPCOSTM B
                         WHERE B.ENTP_CODE = GSM.ENTP_CODE
                           AND B.ENTP_MAN_SEQ = GSM.ENTP_MAN_SEQ
                           AND B.SHIP_COST_CODE = GSM.SHIP_COST_CODE
                           AND B.TRANS_CHECK_YN = GSM.TRANS_CHECK_YN
                           AND B.USE_YN = '1'
                           ORDER BY B.MODIFY_DATE DESC
                           )XX
                 WHERE ROWNUM = 1)
           AND CD.ENTP_CODE = GSM.ENTP_CODE
           AND CD.SHIP_COST_CODE = GSM.SHIP_COST_CODE
           AND CD.CUST_AREA_GB = '10'
           AND CD.APPLY_DATE = (SELECT MAX(APPLY_DATE)
                                  FROM TSHIPCOSTDT CD1
                                 WHERE CD1.ENTP_CODE = CD.ENTP_CODE
                                   AND CD1.CUST_AREA_GB = CD.CUST_AREA_GB
                                   AND CD1.SHIP_COST_CODE = CD.SHIP_COST_CODE
                                   AND CD1.APPLY_DATE &lt; SYSDATE)
           AND CM.ENTP_CODE = CD.ENTP_CODE
           AND CM.SHIP_COST_CODE = CD.SHIP_COST_CODE
           AND GSD.ENTP_CODE(+) = GSM.ENTP_CODE
           AND GSD.ENTP_MAN_SEQ(+) = GSM.ENTP_MAN_SEQ
           AND GSD.SHIP_COST_CODE(+) = GSM.SHIP_COST_CODE
    </select>
    <!-- 2018.11.05 출고지 등록후 gmktshipcostdt update -->
    <update id="updatePaGmktShipCostDt" parameterType="com.cware.netshopping.domain.model.PaGmktShipCostDt">
            UPDATE TPAGMKTSHIPCOSTDT GSD /* pagmktcommon.xml : pagmkt.pagmktcommon.updatePaGmktShipCostDt by PaGmktCommonController-postShippingPlaces */
			   SET GSD.SHIP_COST_BASE_AMT = #{shipCostBaseAmt, jdbcType=VARCHAR},
			       GSD.ORD_COST_AMT = #{ordCostAmt, jdbcType=VARCHAR},
			       GSD.TRANS_TARGET_YN = #{transTargetYn, jdbcType=VARCHAR},
			       GSD.MODIFY_ID       = 'PAG',
			       GSD.MODIFY_DATE     = SYSDATE
			 WHERE GSD.ENTP_CODE = #{entpCode, jdbcType=VARCHAR}
			   AND GSD.ENTP_MAN_SEQ = #{entpManSeq, jdbcType=VARCHAR}
			   AND GSD.BUNDLE_NO = #{bundleNo, jdbcType=VARCHAR}
    </update>
    <!-- 2018.10.31 출고지 등록후 gmktshipcostdt insert -->
    <insert id="insertPaGmktShipCostDt" parameterType="com.cware.netshopping.domain.model.PaGmktShipCostDt">
           INSERT INTO TPAGMKTSHIPCOSTDT /* pagmktcommon.xml : pagmkt.pagmktcommon.insertPaGmktShipCostDt by PaGmktCommonController-postShippingPlaces */
                                          (GMKT_SHIP_NO,
			                               ENTP_CODE,
			                               ENTP_MAN_SEQ,
			                               SHIP_COST_CODE,
			                               SHIP_COST_BASE_AMT,
			                               ORD_COST_AMT,
			                               TRANS_TARGET_YN,
			                               INSERT_ID,
			                               INSERT_DATE,
			                               MODIFY_ID,
			                               MODIFY_DATE,
			                               BUNDLE_NO)
	                               VALUES
										  (#{gmktShipNo, jdbcType=VARCHAR},
										   #{entpCode, jdbcType=VARCHAR},
										   #{entpManSeq, jdbcType=VARCHAR},
										   #{shipCostCode, jdbcType=VARCHAR},
										   #{shipCostBaseAmt, jdbcType=NUMERIC},
										   #{ordCostAmt, jdbcType=NUMERIC},
										   #{transTargetYn, jdbcType=VARCHAR},
										   'PAGMKT',
										   SYSDATE,
										   'PAGMKT',
										   SYSDATE,
										   #{bundleNo, jdbcType=VARCHAR})
    </insert>
    
    <!-- 2018.10.24 출고지 수정 조회 thjeon -->
    <select id="selectEntpShipCostModifyList" resultType="hashMap" parameterType="com.cware.netshopping.domain.model.PaEntpSlip">
        SELECT /* pagmktcommon.xml : pagmkt.pagmktcommon.selectEntpShipCostModifyList by PaGmktCommonController-putShippingPlaces */ 
               PES.PA_ADDR_SEQ,
               PES.ENTP_CODE,
               PES.ENTP_MAN_SEQ,
               PES.PA_GMKT_SHIP_NO AS GMKT_SHIP_NO,
               GSM.ORD_COST,
               GSM.ISLAND_COST,
               GSM.JEJU_COST
          FROM TPAGMKTSHIPCOSTM GSM, TPAENTPSLIP PES
         WHERE PES.ENTP_CODE = GSM.ENTP_CODE
           AND PES.ENTP_MAN_SEQ = GSM.ENTP_MAN_SEQ
           AND PES.PA_CODE = '21'
           AND GSM.ENTP_CODE = #{entpCode, jdbcType=VARCHAR}
           AND GSM.ENTP_MAN_SEQ = #{entpManSeq, jdbcType=VARCHAR}
           AND PES.PA_GMKT_SHIP_NO IS NOT NULL
           AND GSM.TRANS_TARGET_YN = '1'
           AND GSM.USE_YN = '1'
           AND GSM.ROWID = (SELECT XX.ROWID 
                               FROM ( SELECT *
                                        FROM TPAGMKTSHIPCOSTM A
                                       WHERE A.ENTP_CODE    = GSM.ENTP_CODE
                                         AND A.ENTP_MAN_SEQ = GSM.ENTP_MAN_SEQ
                                         ORDER BY A.INSERT_DATE DESC) XX
                               WHERE ROWNUM = 1 )
    </select>
     <!-- 2018.10-31 출고지 수정 update-tpagmktshipcostm -->
    <update id="updatePagmktshipcostmForUpdate" parameterType="com.cware.netshopping.domain.model.PaGmktShipCostM">
        UPDATE TPAGMKTSHIPCOSTM GSM /* pagmktcommon.xml : pagmkt.pagmktcommon.updatePagmktshipcostmForUpdate by PaGmktCommonController-putShippingPlaces */ 
		   SET <!--
		       GSM.ISLAND_COST = #{islandCost, jdbcType=VARCHAR},
		       GSM.JEJU_COST = #{jejuCost, jdbcType=VARCHAR}, -->
		       GSM.TRANS_END_DATE = SYSDATE,
		       GSM.TRANS_TARGET_YN = '0',
		       GSM.TRANS_ERROR_YN  = '0',
		       GSM.MODIFY_ID       = 'PAG',
		       GSM.MODIFY_DATE     = SYSDATE
		 WHERE GSM.ENTP_CODE = #{entpCode, jdbcType=VARCHAR}
		   AND GSM.ENTP_MAN_SEQ = #{entpManSeq, jdbcType=VARCHAR}
		   AND GSM.GMKT_SHIP_NO = #{gmktShipNo, jdbcType=VARCHAR}
		   AND GSM.TRANS_TARGET_YN = '1'
		   AND GSM.USE_YN = '1'
    </update>
    
    <!-- 2018.10.25 묶음배송 등록 대상 조회 -->
    <select id="selectEntpShipPoliciesInsertList" resultType="hashMap" parameterType="String">
        SELECT /* pagmktcommon.xml : pagmkt.pagmktcommon.selectEntpShipPoliciesInsertList by PaGmktCommonController-postShippingPolicies */ 
               A.GMKT_SHIP_NO,
		       A.ENTP_CODE,
		       A.ENTP_MAN_SEQ,
		       A.SHIP_COST_CODE,
		       A.SHIP_COST_BASE_AMT,
		       A.ORD_COST_AMT,
		       A.BUNDLE_NO
		  FROM TPAGMKTSHIPCOSTDT A
		 WHERE A.TRANS_TARGET_YN = '1'
		   AND A.BUNDLE_NO IS NULL
		   AND A.GMKT_SHIP_NO = #{gmktShipNo, jdbcType=VARCHAR}
    </select>
    <!-- 2018.10.30 묶음배송 등록 완료 UPDATE -->
    <update id="updateEntpShipPoliciesInsert" parameterType="hashMap">
        UPDATE TPAGMKTSHIPCOSTDT A /* pagmktcommon.xml : pagmkt.pagmktcommon.updateEntpShipPoliciesInsert by PaGmktCommonController-postShippingPolicies */ 
           SET A.BUNDLE_NO = #{policyNo, jdbcType=VARCHAR},
               A.TRANS_TARGET_YN = '0',
               A.MODIFY_ID = #{modifyId, jdbcType=VARCHAR}, 
               A.MODIFY_DATE = SYSDATE
         WHERE A.GMKT_SHIP_NO = #{placeNo, jdbcType=VARCHAR}
           AND A.ENTP_CODE = #{entpCode, jdbcType=VARCHAR}
		   AND A.ENTP_MAN_SEQ = #{entpManSeq, jdbcType=VARCHAR}
		   AND A.SHIP_COST_CODE = #{shipCostCode, jdbcType=VARCHAR}
           AND A.BUNDLE_NO IS NULL
           AND A.TRANS_TARGET_YN = '1'
    </update>
    <!-- 2018.10.25 묶음배송 수정 대상 조회 -->
    <select id="selectEntpShipPoliciesModifyList" resultType="hashMap" parameterType="String">
        SELECT /* pagmktcommon.xml : pagmkt.pagmktcommon.selectEntpShipPoliciesModifyList by PaGmktCommonController-putShippingPolicies */ 
               A.GMKT_SHIP_NO,
               A.ENTP_CODE,
               A.ENTP_MAN_SEQ,
               A.SHIP_COST_CODE,
               A.SHIP_COST_BASE_AMT,
               A.ORD_COST_AMT,
               A.BUNDLE_NO
          FROM TPAGMKTSHIPCOSTDT A
         WHERE A.TRANS_TARGET_YN = '1'
           AND A.BUNDLE_NO IS NOT NULL
           AND A.GMKT_SHIP_NO = #{gmktShipNo, jdbcType=VARCHAR}
    </select>
    <!-- 2018.10.30 묶음배송 수정 완료 UPDATE -->
    <update id="updateEntpShipPoliciesModify" parameterType="hashMap">
        UPDATE TPAGMKTSHIPCOSTDT A /* pagmktcommon.xml : pagmkt.pagmktcommon.updateEntpShipPoliciesModify by PaGmktCommonController-putShippingPolicies */ 
		   SET A.TRANS_TARGET_YN = '0',
		       A.MODIFY_ID = #{modifyId, jdbcType=VARCHAR}, 
		       A.MODIFY_DATE = SYSDATE
		 WHERE A.GMKT_SHIP_NO = #{placeNo, jdbcType=VARCHAR}
		   AND A.BUNDLE_NO = #{policyNo, jdbcType=VARCHAR}
		   AND A.TRANS_TARGET_YN = '1'
    </update>
    <!-- 발송정책 delete -->
    <delete id="deletePaGmktPolicy" parameterType="com.cware.netshopping.domain.model.PaGmktPolicy">
        DELETE /* pacommon.xml : pacommon.common.deletePaGmktPolicy */ 
          FROM TPAGMKTPOLICY PP 
         WHERE PP.PA_CODE = #{paCode, jdbcType=VARCHAR}
           AND PP.PA_GROUP_CODE = #{paGroupCode, jdbcType=VARCHAR}
    </delete>
    <!-- 발송정책 insert -->
    <insert id="insertPaGmktPolicy" parameterType="com.cware.netshopping.domain.model.PaGmktPolicy">
        INSERT INTO /* pacommon.xml : pacommon.common.insertPaGmktPolicy */ 
               TPAGMKTPOLICY
                  (PA_CODE,
                   POLICY_NO,
                   POLICY_TYPE, 
                   DURATION, 
                   IS_DEFAULT,
                   PA_GROUP_CODE)
               VALUES
                  (#{paCode, jdbcType=VARCHAR},
                  #{policyNo, jdbcType=VARCHAR},
                  #{policyType, jdbcType=VARCHAR},
                  #{duration, jdbcType=VARCHAR},
                  #{isDefault, jdbcType=VARCHAR},
                  #{paGroupCode, jdbcType=VARCHAR}
                  )
    </insert>
    
    
    
    
    <insert id="insertPaGmktEntpSlip" parameterType="com.cware.netshopping.domain.model.PaEntpSlip">
        INSERT /* pagmktcommon.xml : pagmkt.pagmktcommon.insertPaGmktEntpSlip by PaGmktCommonController-insertEntpship */
          INTO TPAENTPSLIP
             ( ENTP_CODE
             , ENTP_MAN_SEQ
             , PA_CODE
             , PA_ADDR_SEQ
             , PA_ADDR_GB
             , PA_BUNDLE_NO
             , TRANS_TARGET_YN
             , LAST_SYNC_DATE
             , INSERT_DATE
             , INSERT_ID
             , MODIFY_DATE
             , MODIFY_ID )
        VALUES 
             ( #{entpCode, jdbcType=VARCHAR}
             , #{entpManSeq, jdbcType=VARCHAR}
             , #{paCode, jdbcType=VARCHAR}
             , #{paAddrSeq, jdbcType=VARCHAR}
             , #{paAddrGb, jdbcType=VARCHAR}
             , #{paBundleNo, jdbcType=VARCHAR}
             , #{transTargetYn, jdbcType=VARCHAR}
             , #{insertDate, jdbcType=TIMESTAMP}
             , #{insertDate, jdbcType=TIMESTAMP}
             , #{insertId, jdbcType=VARCHAR}
             , #{modifyDate, jdbcType=TIMESTAMP}
             , #{modifyId, jdbcType=VARCHAR}
             )  
    </insert>
    
    <update id="updatePaGmktEntpSlip" parameterType="com.cware.netshopping.domain.model.PaEntpSlip">
        UPDATE /* pagmktcommon.xml : pagmkt.pagmktcommon.updatePaGmktEntpSlip by PaGmktCommonController-entpShipUpdate */
               TPAENTPSLIP
           SET TRANS_TARGET_YN = #{transTargetYn, jdbcType=VARCHAR}
             , MODIFY_DATE = #{modifyDate, jdbcType=TIMESTAMP}
             , MODIFY_ID = #{modifyId, jdbcType=VARCHAR}
         WHERE ENTP_CODE = #{entpCode, jdbcType=VARCHAR}
           AND ENTP_MAN_SEQ = #{entpManSeq, jdbcType=VARCHAR}
           AND PA_CODE = #{paCode, jdbcType=VARCHAR}
           AND PA_ADDR_SEQ = #{paAddrSeq, jdbcType=VARCHAR}
    </update>
    
    <insert id="insertPaEsmGoodsKindsList" parameterType="com.cware.netshopping.domain.model.PaEsmGoodsKinds">
        INSERT INTO /* pagmktcommon.xml : pagmkt.common.insertPaEsmGoodsKindsList */
               		TPAESMGOODSKINDS
                   ( LGROUP
            	   , MGROUP
             	   , SGROUP
             	   , DGROUP
	               , NGROUP
	               , LGROUP_NAME
	               , MGROUP_NAME
	               , SGROUP_NAME
	               , DGROUP_NAME
	               , NGROUP_NAME
	               , LMSDN_CODE
	               , DO_NOT_LEAF_YN
	               , INSERT_DATE
	               , INSERT_ID)
     	    VALUES ( #{lgroup, jdbcType=VARCHAR}
              	   , #{mgroup, jdbcType=VARCHAR}
             	   , #{sgroup, jdbcType=VARCHAR}
	               , #{dgroup, jdbcType=VARCHAR}
	               , #{ngroup, jdbcType=VARCHAR}
	               , #{lgroupName, jdbcType=VARCHAR}
	               , #{mgroupName, jdbcType=TIMESTAMP}
	               , #{sgroupName, jdbcType=VARCHAR}
	               , #{dgroupName, jdbcType=VARCHAR}
	               , #{ngroupName, jdbcType=VARCHAR}
	               , #{lmsdnCode, jdbcType=VARCHAR}
	               , #{doNotLeafYn, jdbcType=VARCHAR}
	               , #{insertDate, jdbcType=VARCHAR}
	               , #{insertId, jdbcType=VARCHAR}
	               )
    </insert>

	<update id="updatePaEsmGoodsKindsListGroupName">
		UPDATE /* pagmktcommon.xml : pagmkt.pagmktcommon.updatePaEsmGoodsKindsListGroupName */
			   TPAESMGOODSKINDS A
		   SET A.LGROUP_NAME =
		       (SELECT B.LGROUP_NAME
		          FROM TPAESMGOODSKINDS B
		         WHERE B.LGROUP = A.LGROUP
		           AND B.MGROUP = '0000'
		           AND B.SGROUP = '0000'
		           AND B.DGROUP = '0000'
		           AND B.NGROUP = '0000'),
		       A.MGROUP_NAME =
		       (SELECT B.MGROUP_NAME
		          FROM TPAESMGOODSKINDS B
		         WHERE B.LGROUP = A.LGROUP
		           AND B.MGROUP = A.MGROUP
		           AND B.SGROUP = '0000'
		           AND B.DGROUP = '0000'
		           AND B.NGROUP = '0000'),
		       A.SGROUP_NAME =
		       (SELECT B.SGROUP_NAME
		          FROM TPAESMGOODSKINDS B
		         WHERE B.LGROUP = A.LGROUP
		           AND B.MGROUP = A.MGROUP
		           AND B.SGROUP = A.SGROUP
		           AND B.DGROUP = '0000'
		           AND B.NGROUP = '0000'),
		       A.DGROUP_NAME =
		       (SELECT B.DGROUP_NAME
		          FROM TPAESMGOODSKINDS B
		         WHERE B.LGROUP = A.LGROUP
		           AND B.MGROUP = A.MGROUP
		           AND B.SGROUP = A.SGROUP
		           AND B.DGROUP = A.DGROUP
		           AND B.NGROUP = '0000')
    </update>
    
    <insert id="insertPaSiteGoodsKindsList" parameterType="com.cware.netshopping.domain.model.PaSiteGoodsKinds">
        INSERT INTO /* pagmktcommon.xml : pagmkt.common.insertPaSiteGoodsKindsList */
               		TPASITEGOODSKINDS
                   ( SITE_GB
                   , LGROUP
            	   , MGROUP
             	   , SGROUP
             	   , DGROUP
	               , LGROUP_NAME
	               , MGROUP_NAME
	               , SGROUP_NAME
	               , DGROUP_NAME
	               , LMSD_CODE
	               , DO_NOT_LEAF_YN
	               , INSERT_DATE
	               , INSERT_ID)
     	    VALUES ( #{siteGb, jdbcType=VARCHAR}
              	   , #{lgroup, jdbcType=VARCHAR}
              	   , #{mgroup, jdbcType=VARCHAR}
             	   , #{sgroup, jdbcType=VARCHAR}
	               , #{dgroup, jdbcType=VARCHAR}
	               , #{lgroupName, jdbcType=VARCHAR}
	               , #{mgroupName, jdbcType=TIMESTAMP}
	               , #{sgroupName, jdbcType=VARCHAR}
	               , #{dgroupName, jdbcType=VARCHAR}
	               , #{lmsdCode, jdbcType=VARCHAR}
	               , #{doNotLeafYn, jdbcType=VARCHAR}
	               , #{insertDate, jdbcType=VARCHAR}
	               , #{insertId, jdbcType=VARCHAR}
	               )
    </insert>
    
    <select id="selectLmsdnCodeList" resultType="String">
        SELECT /* pagmktcommon.xml : pagmkt.pagmktcommon.selectLmsdnCodeList */
               PE.LMSDN_CODE
          FROM TPAESMGOODSKINDS PE
         WHERE PE.DO_NOT_LEAF_YN = '1'
    </select>
    
    <delete id="deletePaEsmGoodsKindsList">
        DELETE /* pacommon.xml : pacommon.common.deletePaEsmGoodsKindsList */ 
          FROM TPAESMGOODSKINDS
    </delete>
    
    <insert id="insertPaMatchingGoodsKindsList" parameterType="com.cware.netshopping.domain.model.PaSiteGoodsKinds">
        INSERT INTO /* pagmktcommon.xml : pagmkt.common.insertPaMatchingGoodsKindsList */
               		TPAESMSITEMATCHING
                   ( SITE_GB
                   , LMSDN_CODE
	               , LMSD_CODE
	               , DO_NOT_LEAF_YN
	               , INSERT_DATE
	               , INSERT_ID)
     	    VALUES ( #{siteGb, jdbcType=VARCHAR}
              	   , #{lmsdnCode, jdbcType=VARCHAR}
	               , #{lmsdCode, jdbcType=VARCHAR}
	               , #{doNotLeafYn, jdbcType=VARCHAR}
	               , #{insertDate, jdbcType=VARCHAR}
	               , #{insertId, jdbcType=VARCHAR}
	               )
    </insert>
    
    <delete id="deletePaMatchingGoodsKindsList">
        DELETE /* pacommon.xml : pacommon.common.deletePaMatchingGoodsKindsList */ 
          FROM TPAESMSITEMATCHING
    </delete>
    
    <insert id="insertPaGmktBrandList" parameterType="com.cware.netshopping.domain.model.PaBrand">
        INSERT /* pagmktcommon.xml : pagmkt.pagmktcommon.insertPaGmktBrandList by PaGmktV2CommonController */
          INTO TPABRAND
        SELECT #{paGroupCode, jdbcType=VARCHAR},
        	   #{paBrandNo, jdbcType=VARCHAR},
        	   #{paBrandName, jdbcType=VARCHAR},
        	   '',
        	   '1',
        	   UPPER(#{insertId, jdbcType=VARCHAR}),
        	   #{insertDate, jdbcType=TIMESTAMP},
        	   UPPER(#{modifyId, jdbcType=VARCHAR}),
        	   #{modifyDate, jdbcType=TIMESTAMP}
          FROM DUAL
         WHERE NOT EXISTS (SELECT 'X'
         					 FROM TPABRAND 
         					WHERE PA_BRAND_NO = #{paBrandNo, jdbcType=VARCHAR}
         					  AND PA_GROUP_CODE = #{paGroupCode, jdbcType=VARCHAR})
    </insert>
    
    <insert id="insertPaGmktMakerList" parameterType="com.cware.netshopping.domain.model.PaMaker">
        INSERT /* pagmktcommon.xml : pagmkt.pagmktcommon.insertPaGmktMakerList by PaGmktV2CommonController */
          INTO TPAMAKER
        SELECT #{paGroupCode, jdbcType=VARCHAR},
        	   #{paMakerNo, jdbcType=VARCHAR},
        	   #{paMakerName, jdbcType=VARCHAR},
        	   '',
        	   '1',
        	   UPPER(#{insertId, jdbcType=VARCHAR}),
        	   #{insertDate, jdbcType=TIMESTAMP},
        	   UPPER(#{modifyId, jdbcType=VARCHAR}),
        	   #{modifyDate, jdbcType=TIMESTAMP}
          FROM DUAL
         WHERE NOT EXISTS (SELECT 'X'
         					 FROM TPAMAKER 
         					WHERE PA_MAKER_NO = #{paMakerNo, jdbcType=VARCHAR}
         					  AND PA_GROUP_CODE = #{paGroupCode, jdbcType=VARCHAR})
    </insert>
    
    <delete id="deletePaGmktOriginList">
        DELETE /* pacommon.xml : pacommon.common.deletePaGmktOriginList */ 
          FROM TPAGMKTORIGIN
    </delete>
    
    <insert id="insertPaGmktOriginList" parameterType="com.cware.netshopping.domain.model.PaGmktOrigin">
        INSERT INTO /* pagmktcommon.xml : pagmkt.common.insertPaGmktOriginList by PaGmktV2CommonController */
               		TPAGMKTORIGIN
                   ( ORGN_TYP_CD
                   , ORGN_TYP_DTLS_CD
	               , AREA_NAME
	               , DETAIL_AREA_NAME
	               , INSERT_DATE
	               , INSERT_ID
	               , MODIFY_DATE
	               , MODIFY_ID)
     	    VALUES ( #{orgnTypCd, jdbcType=VARCHAR}
              	   , #{orgnTypDtlsCd, jdbcType=VARCHAR}
	               , #{areaName, jdbcType=VARCHAR}
	               , #{detailAreaName, jdbcType=VARCHAR}
	               , #{insertDate, jdbcType=VARCHAR}
	               , #{insertId, jdbcType=VARCHAR}
	               , #{modifyDate, jdbcType=VARCHAR}
	               , #{modifyId, jdbcType=VARCHAR}
	               )
    </insert>
    
    <delete id="deletePaGmktOfferCodeList" parameterType="String">
        DELETE /* pacommon.xml : pacommon.common.deletePaGmktOfferCodeList */ 
          FROM TPAOFFERCODE
         WHERE PA_GROUP_CODE = #{paGroupCode, jdbcType=VARCHAR}
    </delete>
    
    <insert id="insertPaGmktOfferCodeList" parameterType="com.cware.netshopping.domain.model.PaOfferCode">
        INSERT INTO /* pagmktcommon.xml : pagmkt.common.insertPaGmktOfferCodeList by PaGmktV2CommonController */
               		TPAOFFERCODE
		           ( PA_GROUP_CODE
		           , PA_OFFER_TYPE  
		           , PA_OFFER_CODE 
		           , PA_OFFER_TYPE_NAME 
		           , PA_OFFER_CODE_NAME
		           , REMARK
		           , INSERT_DATE
	               , INSERT_ID
	               , MODIFY_DATE
	               , MODIFY_ID )
		     VALUES 
		           ( #{paGroupCode, jdbcType=VARCHAR}
		           , #{paOfferType, jdbcType=VARCHAR}
		           , #{paOfferCode, jdbcType=VARCHAR}
	               , #{paOfferTypeName, jdbcType=VARCHAR}
		           , #{paOfferCodeName, jdbcType=VARCHAR}
	               , #{remark, jdbcType=VARCHAR}
	               , #{insertDate, jdbcType=VARCHAR}
	               , #{insertId, jdbcType=VARCHAR}
	               , #{modifyDate, jdbcType=VARCHAR}
	               , #{modifyId, jdbcType=VARCHAR}
	               )  
    </insert>
    
    <select id="selectChkPaSitGoodsKinds" parameterType="com.cware.netshopping.domain.model.PaSiteGoodsKinds" resultType="int">
        SELECT /* pagmktcommon.xml : pagmkt.pagmktcommon.selectChkPaSitGoodsKinds by PaGmktCommonController */
               COUNT(1)
          FROM TPASITEGOODSKINDS PSG
         WHERE PSG.LMSD_CODE = #{lmsdCode, jdbcType=VARCHAR}
    </select>
    
    <insert id="insertPaGmktSettleOrder" parameterType="com.cware.netshopping.domain.model.PaGmktSettlement">
        INSERT INTO /* pagmktcommon.xml : pagmkt.common.insertPaGmktSettleOrder by PaGmktV2CommonController */
               		TPAGMKTSETTLEMENT
		           ( GATHER_DATE
		           , SITE_TYPE  
		           , PAY_NO 
		           , CONTR_NO 
		           , GOODS_NO
		           , SITE_GOODS_NO
		           , ORDER_DATE
	               , PAY_DATE
	               , SHIPPING_DATE
	               , SHIPPING_CMPL_DATE
	               , BUY_DECISION_DATE
	               , SETTLE_EXPECT_DATE
	               , SETTLE_EXCEPT_NAME
	               , REMIT_DATE
	               , REFUND_DATE
	               , SETTLE_TYPE
	               , ORDER_UNIT_PRICE
	               , ORDER_QTY
	               , SELL_ORDER_PRICE
	               , OPTION_PRICE
	               , GOODS_COST
	               , OPTION_COST
	               , BASIC_COMMISSION
	               , OPTION_COMMISSION
	               , DEDUCT_TAX_PRICE
	               , TOT_COMMISSION
	               , DEDUCT_NON_TAX_PRICE
	               , SETTLEMENT_PRICE
	               , SERVICE_FEE
	               , CORP_DISCOUNT_TOTAL_PRICE
	               , OVER_PROFIT_DISCOUNT_PRICE
	               , FEE_DISCOUNT_PRICE
	               , SELLER_DISCOUNT_TOTAL_PRICE
	               , BUYER_PAY_AMT
	               , BRANCH_PRICE
	               , BRANCH_CODE
	               , TAX_YN
	               , SELLER_DISCOUNT_PRICE1
	               , SELLER_DISCOUNT_PRICE2
	               , SELLER_DISCOUNT_PRICE 
	               , SELLER_PCS_FEE
	               , DEL_FEE_OVERSEA_AMT
	               , KIND
	               , SETTLEMENT_TYPE
	               , DEL_FEE_AMT
	               , DEL_FEE_NO 
	               , DEL_FEE_PAY_WAY
	               , DELIVERY_GROUP_NO
	               , DEL_FEE_TYPE
	               , REVENUE_BASE_DATE
	               )
		     VALUES 
		           ( TRUNC(#{revenueBaseDate, 		jdbcType=TIMESTAMP})
		           , #{siteType, 					jdbcType=VARCHAR}
		           , #{payNo, 						jdbcType=VARCHAR}
	               , #{contrNo, 					jdbcType=VARCHAR}
		           , #{goodsNo, 					jdbcType=VARCHAR}
	               , #{siteGoodsNo, 				jdbcType=VARCHAR}
	               , #{orderDate, 					jdbcType=TIMESTAMP}
	               , #{payDate, 					jdbcType=TIMESTAMP}
	               , #{shippingDate, 				jdbcType=TIMESTAMP}
	               , #{shippingCmplDate, 			jdbcType=TIMESTAMP}
	               , #{buyDecisionDate, 			jdbcType=TIMESTAMP}
	               , #{settleExpectDate, 			jdbcType=TIMESTAMP}
	               , #{settleExceptName, 			jdbcType=VARCHAR}
	               , #{remitDate, 					jdbcType=TIMESTAMP}
	               , #{refundDate, 					jdbcType=TIMESTAMP}
	               , #{settleType, 					jdbcType=VARCHAR}
	               , #{orderUnitPrice, 				jdbcType=VARCHAR}
	               , #{orderQty, 					jdbcType=VARCHAR}
	               , #{sellOrderPrice, 				jdbcType=VARCHAR}
	               , #{optionPrice, 				jdbcType=VARCHAR}
	               , #{goodsCost, 					jdbcType=VARCHAR}
	               , #{optionCost, 					jdbcType=VARCHAR}
	               , #{basicCommission, 			jdbcType=VARCHAR}
	               , #{optionCommission, 			jdbcType=VARCHAR}
	               , #{deductTaxPrice, 				jdbcType=VARCHAR}
	               , #{totCommission, 				jdbcType=VARCHAR}
	               , #{deductNonTaxPrice, 			jdbcType=VARCHAR}
	               , #{settlementPrice, 			jdbcType=VARCHAR}
	               , #{serviceFee, 					jdbcType=VARCHAR}
	               , #{corpDiscountTotalPrice, 		jdbcType=VARCHAR}
	               , #{overProfitDiscountPrice, 	jdbcType=VARCHAR}
	               , #{feeDiscountPrice, 			jdbcType=VARCHAR}
	               , #{sellerDiscountTotalPrice, 	jdbcType=VARCHAR}
	               , #{buyerPayAmt, 				jdbcType=VARCHAR}
	               , #{branchPrice, 				jdbcType=VARCHAR}
	               , #{branchCode, 					jdbcType=VARCHAR}
	               , #{taxYn, 						jdbcType=VARCHAR}
	               , #{sellerDiscountPrice1, 		jdbcType=VARCHAR}
	               , #{sellerDiscountPrice2, 		jdbcType=VARCHAR}
	               , #{sellerDiscountPrice, 		jdbcType=VARCHAR}
	               , #{sellerPcsFee, 				jdbcType=VARCHAR}
	               , #{delFeeOverseaAmt, 			jdbcType=VARCHAR}
	               , #{kind, 						jdbcType=VARCHAR}
	               , #{settlementType, 				jdbcType=VARCHAR}
	               , #{delFeeAmt, 					jdbcType=VARCHAR}
	               , #{delFeeNo, 					jdbcType=VARCHAR}
	               , #{delFeePayWay, 				jdbcType=VARCHAR}
	               , #{deliveryGroupNo, 			jdbcType=VARCHAR}
	               , #{delFeeType, 					jdbcType=VARCHAR}
	               , #{revenueBaseDate, 			jdbcType=TIMESTAMP}
	               )  
    </insert>
    
    <insert id="insertPaGmktSettleDelivery" parameterType="com.cware.netshopping.domain.model.PaGmktSettlement">
        INSERT INTO /* pagmktcommon.xml : pagmkt.common.insertPaGmktSettleDelivery by PaGmktV2CommonController */
               		TPAGMKTSETTLEMENT
		           ( GATHER_DATE
		           , SITE_TYPE  
		           , PAY_NO
	               , KIND
	               , REMIT_DATE
	               , PAY_DATE
	               , REFUND_DATE
	               , SETTLEMENT_TYPE
	               , DEL_FEE_AMT
	               , DEL_FEE_NO 
	               , DEL_FEE_PAY_WAY
	               , DELIVERY_GROUP_NO
	               , DEL_FEE_TYPE
	               , REVENUE_DATE
	               , DEL_FEE_COMMISSION
	               )
		     VALUES 
		           ( TRUNC(#{remitDate, 			jdbcType=TIMESTAMP})
		           , #{siteType, 					jdbcType=VARCHAR}
		           , #{payNo, 						jdbcType=VARCHAR}
	               , #{kind, 						jdbcType=VARCHAR}
	               , #{remitDate, 					jdbcType=TIMESTAMP}
	               , #{payDate,						jdbcType=TIMESTAMP}
	               , #{refundDate, 					jdbcType=TIMESTAMP}
	               , #{settlementType, 				jdbcType=VARCHAR}
	               , #{delFeeAmt, 					jdbcType=VARCHAR}
	               , #{delFeeNo, 					jdbcType=VARCHAR}
	               , #{delFeePayWay, 				jdbcType=VARCHAR}
	               , #{deliveryGroupNo, 			jdbcType=VARCHAR}
	               , #{delFeeType, 					jdbcType=VARCHAR}
	               , #{revenueDate, 				jdbcType=TIMESTAMP}
	               , #{delFeeCommission, 			jdbcType=VARCHAR}
	               )  
    </insert>
    
    <delete id="deletePaGmktSettlementList" parameterType="String">
        DELETE /* pagmktcommon.xml : pagmkt.pagmktcommon.deletePaGmktSettlementList */ 
          FROM TPAGMKTSETTLEMENT
         WHERE GATHER_DATE = TO_DATE(#{remitDate, jdbcType=VARCHAR},'YYYY/MM/DD')
        <if test = 'paGroupCode != "" and paGroupCode != null '>
		  <choose>
			<when test = 'paGroupCode == "02"'>
		   AND SITE_TYPE = 'G' 
		  	</when>
		  	<when test = 'paGroupCode == "03"'>
		   AND SITE_TYPE = 'A'		
		  	</when>
		  </choose>
		</if>  
    </delete>
    
    <select id="selectChkGmktSettlement" parameterType="com.cware.netshopping.domain.model.PaGmktSettlement" resultType="int">
        SELECT /* pagmktcommon.xml : pagmkt.pagmktcommon.selectChkGmktSettlement by PaGmktCommonController */
               COUNT(1)
          FROM TPAGMKTSETTLEMENT PGS
         WHERE PGS.SITE_TYPE = #{siteType, jdbcType=VARCHAR}
		   AND PGS.PAY_NO 	 = #{payNo, jdbcType=VARCHAR}
		   AND PGS.CONTR_NO  = #{contrNo, jdbcType=VARCHAR}
		   AND PGS.KIND 	 = #{kind, jdbcType=VARCHAR}
		   AND PGS.SETTLEMENT_TYPE = #{settlementType, jdbcType=VARCHAR}
    </select>
    
    <select id="selectChkGmktShipSettlement" parameterType="com.cware.netshopping.domain.model.PaGmktSettlement" resultType="int">
        SELECT /* pagmktcommon.xml : pagmkt.pagmktcommon.selectChkGmktShipSettlement by PaGmktCommonController */
               COUNT(1)
          FROM TPAGMKTSETTLEMENT PGS
         WHERE PGS.SITE_TYPE 		 = #{siteType, jdbcType=VARCHAR}
		   AND PGS.PAY_NO 	 		 = #{payNo, jdbcType=VARCHAR}
		   AND PGS.SETTLEMENT_TYPE	 = #{settlementType, jdbcType=VARCHAR}
		   AND PGS.KIND				 = #{kind, jdbcType=VARCHAR}
		   AND PGS.DELIVERY_GROUP_NO = #{deliveryGroupNo, jdbcType=VARCHAR}
		   AND PGS.DEL_FEE_NO		 = #{delFeeNo, jdbcType=VARCHAR}
		   AND PGS.DEL_FEE_TYPE		 = #{delFeeType, jdbcType=VARCHAR}
		   AND PGS.SETTLEMENT_TYPE	 = #{settlementType, jdbcType=VARCHAR}
    </select>
    
    <!--500에러 출고지 TPAGMKTSHIPCOSTM USE_YN 0처리 -->
    <update id="updatePaGmktShipCostMUseYn" parameterType="com.cware.netshopping.domain.model.PaEntpSlip">
        UPDATE TPAGMKTSHIPCOSTM GSM /* pagmktcommon.xml : pagmkt.pagmktcommon.updatePaGmktShipCostMUseYn by PaGmktCommonController-putShippingPlaces */ 
		   SET GSM.USE_YN = '0',
		   	   GSM.TRANS_ERROR_YN = '1'
		 WHERE GSM.ENTP_CODE = #{entpCode, jdbcType=VARCHAR}
		   AND GSM.ENTP_MAN_SEQ = #{entpManSeq, jdbcType=VARCHAR}
    </update>
    <!--500에러 출고지 재 등록후 신규 gmktShipNo select -->
    <select id="selectPaentpslipGmktShipNo" parameterType="com.cware.netshopping.domain.model.PaEntpSlip" resultType="String">
        SELECT 
  			PES.PA_GMKT_SHIP_NO
		  FROM TPAENTPSLIP PES
		 WHERE PES.ENTP_CODE = #{entpCode, jdbcType=VARCHAR}
		   AND PES.ENTP_MAN_SEQ = #{entpManSeq, jdbcType=VARCHAR}
		   AND PES.PA_CODE = '21'
    </select>
    
    <!--500에러 출고지 TPAGMKTSHIPCOSTM select -->
    <select id="selectPaGmktShipCostMFor500" parameterType="com.cware.netshopping.domain.model.PaGmktShipCostM" resultType="hashMap">
         SELECT 
	          A.GMKT_SHIP_NO,
	          A.ENTP_CODE,
	          A.ENTP_MAN_SEQ,
	          A.TRANS_ERROR_YN
	        FROM TPAGMKTSHIPCOSTM A
	       WHERE A.ENTP_CODE = #{entpCode, jdbcType=VARCHAR}
	         AND A.ENTP_MAN_SEQ = #{entpManSeq, jdbcType=VARCHAR}
	         AND A.TRANS_ERROR_YN = '1'
	         AND A.GMKT_SHIP_SEQ =
	                     (SELECT MAX(B.GMKT_SHIP_SEQ)
	                        FROM TPAGMKTSHIPCOSTM B
	                       WHERE B.ENTP_CODE = A.ENTP_CODE
	                         AND B.ENTP_MAN_SEQ = A.ENTP_MAN_SEQ
	                         AND B.TRANS_ERROR_YN = '1'
	                         AND B.USE_YN = '0')
    </select>
    
    <!--500에러 출고지 재 등록후 gmktshipcostdt gmktShipNo update -->
    <update id="updatePaGmktShipCostDtGmktShipNo" parameterType="com.cware.netshopping.domain.model.PaGmktShipCostDt">
            UPDATE TPAGMKTSHIPCOSTDT GSD /* pagmktcommon.xml : pagmkt.pagmktcommon.updatePaGmktShipCostDtGmktShipNo by PaGmktCommonController-postShippingPlaces */
			   SET GSD.GMKT_SHIP_NO = #{newGmktShipNo, jdbcType=VARCHAR},
			   	   GSD.BUNDLE_NO = NULL
			 WHERE GSD.ENTP_CODE = #{entpCode, jdbcType=VARCHAR}
			   AND GSD.ENTP_MAN_SEQ = #{entpManSeq, jdbcType=VARCHAR}
			   AND GSD.GMKT_SHIP_NO = #{oldGmktShipNo, jdbcType=VARCHAR}
    </update>
     <!-- 500에러 출고지 재 등록후 TPAENTPSLIP gmktShipNo update -->
    <update id="updatePaentpslipForInsert500" parameterType="com.cware.netshopping.domain.model.PaGmktShipCostM">
        UPDATE TPAENTPSLIP PES /* pagmktcommon.xml : pagmkt.pagmktcommon.updatePaentpslipForInsert500 by PaGmktCommonController-postShippingPlaces */
		   SET PES.PA_GMKT_SHIP_NO = #{gmktShipNo, jdbcType=VARCHAR},
		       PES.MODIFY_ID       = 'PAG',
		       PES.MODIFY_DATE     = SYSDATE
		 WHERE PES.PA_CODE = '21'
		   AND PES.ENTP_CODE = #{entpCode, jdbcType=VARCHAR}
		   AND PES.ENTP_MAN_SEQ = #{entpManSeq, jdbcType=VARCHAR}
    </update>
    <!--500에러 출고지 재 등록 후 TPAGMKTSHIPCOSTM TRANS_ERROR_YN 0처리 -->
    <update id="updatePaGmktShipCostMErrorYn" parameterType="com.cware.netshopping.domain.model.PaGmktShipCostM">
        UPDATE TPAGMKTSHIPCOSTM GSM /* pagmktcommon.xml : pagmkt.pagmktcommon.updatePaGmktShipCostMErrorYn by PaGmktCommonController-putShippingPlaces */ 
		   SET GSM.TRANS_ERROR_YN = '0'
		 WHERE GSM.ENTP_CODE = #{entpCode, jdbcType=VARCHAR}
		   AND GSM.ENTP_MAN_SEQ = #{entpManSeq, jdbcType=VARCHAR}
    </update>
    <!-- 500에러 출고지 재 등록 후  gmktshipcostdt TRANS_TARGET_YN 1처리 -->
    <update id="updatePaGmktShipCostDtFor500" parameterType="com.cware.netshopping.domain.model.PaGmktShipCostDt">
            UPDATE TPAGMKTSHIPCOSTDT GSD /* pagmktcommon.xml : pagmkt.pagmktcommon.updatePaGmktShipCostDtFor500 by PaGmktCommonController-postShippingPlaces */
			   SET GSD.SHIP_COST_BASE_AMT = #{shipCostBaseAmt, jdbcType=VARCHAR},
			       GSD.ORD_COST_AMT = #{ordCostAmt, jdbcType=VARCHAR},
			       GSD.TRANS_TARGET_YN = #{transTargetYn, jdbcType=VARCHAR},
			       GSD.MODIFY_ID       = 'PAG',
			       GSD.MODIFY_DATE     = SYSDATE
			 WHERE GSD.ENTP_CODE = #{entpCode, jdbcType=VARCHAR}
			   AND GSD.ENTP_MAN_SEQ = #{entpManSeq, jdbcType=VARCHAR}
			   AND GSD.SHIP_COST_CODE = #{shipCostCode, jdbcType=VARCHAR}
    </update>
    <!-- 500에러 출고지 재 등록 후  gmktshipcostm GMKT_SHIP_NO update -->
    <update id="updatePagmktshipcostmForInsert500" parameterType="com.cware.netshopping.domain.model.PaGmktShipCostM">
        UPDATE TPAGMKTSHIPCOSTM GSM /* pagmktcommon.xml : pagmkt.pagmktcommon.updatePagmktshipcostmForInsert500 by PaGmktCommonController-postShippingPlaces */
		   SET GSM.GMKT_SHIP_NO = #{gmktShipNo, jdbcType=VARCHAR}
		 WHERE GSM.ENTP_CODE = #{entpCode, jdbcType=VARCHAR}
		   AND GSM.ENTP_MAN_SEQ = #{entpManSeq, jdbcType=VARCHAR}
		   AND GSM.GMKT_SHIP_NO IS NULL
		   AND GSM.USE_YN = '1'
    </update>
     <!-- 500에러 출고지 재 등록 후 상품 재연동 리스트 조회 -->
    <select id="selectPaGmtkGoodsTargetList" resultType="hashMap" parameterType="com.cware.netshopping.domain.model.PaEntpSlip">
         SELECT 
        	  A.GOODS_CODE
         	FROM TPAPRODUCT A, TPAGMKTGOODS B, TGOODS C
	       WHERE A.GOODS_CODE = B.GOODS_CODE
	         AND A.GOODS_CODE = C.GOODS_CODE
	         AND DECODE(C.DELY_TYPE,'10','100001',A.ENTP_CODE) = #{entpCode, jdbcType=VARCHAR}
	         AND DECODE(C.DELY_TYPE,'10','003',A.SHIP_MAN_SEQ) = #{entpManSeq, jdbcType=VARCHAR}
	         AND B.PA_SALE_GB = '20'
	         AND B.PA_STATUS = '30'
	         AND B.TRANS_TARGET_YN = '0'
	      ORDER BY A.GOODS_CODE
    </select>
    <!-- 500에러 출고지 재 등록 후 해당 출하지에 속한 상품 TARGET ON -->
    <update id="updatePaGmtkGoodsTargetOn" parameterType="String">
		UPDATE TPAGMKTGOODS PGG  /* pagmktcommon.xml : pagmkt.pagmktcommon.updatePaGmtkGoodsTargetOn by PaGmktCommonController*/
	       SET PGG.TRANS_TARGET_YN = '1',
	           PGG.MODIFY_DATE = SYSDATE + 3
	     WHERE PGG.GOODS_CODE = #{goodsCode, jdbcType=VARCHAR}
	       AND PGG.PA_SALE_GB = '20'
	       AND PGG.PA_STATUS = '30'
	       AND PGG.TRANS_TARGET_YN = '0'
    </update>
    
    
    <!-- 이베이 업체 주소, 출하지 ,묶음배송비 등록/수정 개선  시작~~~~~~~~~~~~~ -->
    <select id="selectNewGoodsEntpTarget" resultType="hashMap" parameterType="hashMap" >
       SELECT /* pagmktcommon.xml : pagmkt.pagmktcommon.selectNewGoodsEntpTarget  by PaGmktCommonController */
       		  DISTINCT
              EU.ENTP_CODE
            , EU.ENTP_MAN_SEQ
            , EU.ENTP_MAN_GB
         FROM TENTPUSER EU
            , TPAPRODUCT PG
            , TPAGMKTGOODS GG
            , TGOODS GD
        WHERE EU.ENTP_MAN_GB IN ('30')
          AND GD.DELY_TYPE   	!= '10'        
          AND PG.ENTP_CODE    	 = EU.ENTP_CODE 
          AND PG.SHIP_MAN_SEQ 	 = EU.ENTP_MAN_SEQ
          AND PG.GOODS_CODE 	 = GG.GOODS_CODE
          AND GG.PA_CODE IN ('20','21','22')
          AND GG.GOODS_CODE 	 = GD.GOODS_CODE
          AND GG.PA_SALE_GB 	 = '20'
          AND GG.PA_STATUS  IN ('10','30')
          <if test = 'entpCode != null and entpCode != "" '>
          AND PG.ENTP_CODE  = #{entpCode, jdbcType=VARCHAR} 
		  </if>
          AND NOT EXISTS (SELECT 'X'
                            FROM TPAENTPSLIP PL
                           WHERE EU.ENTP_CODE    = PL.ENTP_CODE
                             AND EU.ENTP_MAN_SEQ = PL.ENTP_MAN_SEQ
                             AND PL.PA_CODE      = '21')
          UNION
      
       SELECT DISTINCT
              EU.ENTP_CODE
            , EU.ENTP_MAN_SEQ
            , EU.ENTP_MAN_GB
         FROM TENTPUSER EU
            , TPAPRODUCT PG
            , TPAGMKTGOODS GG
            , TGOODS GD
        WHERE EU.ENTP_MAN_GB IN ('20')
          AND GD.DELY_TYPE      != '10'        
          AND PG.ENTP_CODE       = EU.ENTP_CODE 
          AND PG.RETURN_MAN_SEQ  = EU.ENTP_MAN_SEQ
          AND PG.GOODS_CODE 	 = GG.GOODS_CODE
          AND GG.PA_CODE IN ('20','21','22')
          AND GG.GOODS_CODE 	 = GD.GOODS_CODE
          AND GG.PA_SALE_GB 	 = '20'
          AND GG.PA_STATUS  IN ('10','30')
          <if test = 'entpCode != null and entpCode != "" '>
          AND PG.ENTP_CODE  = #{entpCode, jdbcType=VARCHAR} 
		  </if>
          AND NOT EXISTS (SELECT 'X'
                            FROM TPAENTPSLIP PL
                           WHERE EU.ENTP_CODE    = PL.ENTP_CODE
                             AND EU.ENTP_MAN_SEQ = PL.ENTP_MAN_SEQ
                             AND PL.PA_CODE      = '21')
          UNION
          
       SELECT DISTINCT
              EU.ENTP_CODE
            , EU.ENTP_MAN_SEQ
            , EU.ENTP_MAN_GB   
         FROM TENTPUSER EU
        WHERE EU.ENTP_CODE    = '100001'
          AND EU.ENTP_MAN_SEQ IN ('002', '003')
          AND NOT EXISTS (SELECT 'X'
                            FROM TPAENTPSLIP PL
                           WHERE EU.ENTP_CODE = PL.ENTP_CODE                  
                             AND EU.ENTP_MAN_SEQ = PL.ENTP_MAN_SEQ   
                             AND PL.PA_CODE = '21')
    </select>
    
    <select id="selectEntpSlipCost" resultType="hashMap" parameterType="hashMap">
       SELECT /* pagmktcommon.xml : pagmktcommon.selectEntpSlipCost by PaGmktCommonController  */ 
             DISTINCT 
             PCS.ENTP_CODE			AS ENTP_CODE
           , PCS.SHIP_COST_CODE		AS SHIP_COST_CODE
           , PES.ENTP_MAN_SEQ		AS ENTP_MAN_SEQ
           , PCS.SHIP_COST_BASE_AMT AS SHIP_COST_BASE_AMT
           , PCS.ORD_COST			AS ORD_COST_AMT
           , PCS.ISLAND_COST		AS ISLAND_COST
           , PCS.JEJU_COST			AS JEJU_COST
        FROM TPACUSTSHIPCOST PCS
           , TPAENTPSLIP 	 PES
       WHERE PCS.ENTP_CODE	= PES.ENTP_CODE
         AND PCS.PA_CODE IN ('21','22')
         AND PES.PA_CODE	= '21'
         AND PES.ENTP_CODE != '100001'
         <if test = 'entpCode != null and entpCode != "" '>
         AND PES.ENTP_CODE  = #{entpCode, jdbcType=VARCHAR} 
		 </if>
         AND EXISTS (SELECT 'X'
                       FROM TGOODS TG
                          , TPAGMKTGOODS PK
                          , TPAPRODUCT PG
                      WHERE PG.GOODS_CODE		= TG.GOODS_CODE
                        AND PG.GOODS_CODE		= PK.GOODS_CODE
                        AND PG.ENTP_CODE		= PES.ENTP_CODE
                        AND PG.SHIP_MAN_SEQ		= PES.ENTP_MAN_SEQ 
                        AND PCS.SHIP_COST_CODE	= TG.SHIP_COST_CODE
                       <!--   AND PK.PA_SALE_GB 	 	= '20'
                        AND PK.PA_STATUS  		IN ('10','30')-->
                        AND TG.DELY_TYPE       != '10'
                      )
         AND PCS.TRANS_TARGET_YN = '1'
         
         UNION
         
      SELECT DISTINCT 
             PCS.ENTP_CODE			AS ENTP_CODE
           , PCS.SHIP_COST_CODE		AS SHIP_COST_CODE
           , '003'					AS ENTP_MAN_SEQ
           , PCS.SHIP_COST_BASE_AMT AS SHIP_COST_BASE_AMT
           , PCS.ORD_COST			AS ORD_COST_AMT
           , PCS.ISLAND_COST		AS ISLAND_COST
           , PCS.JEJU_COST			AS JEJU_COST
        FROM TPACUSTSHIPCOST PCS
       WHERE PCS.PA_CODE IN ('21','22')
         AND PCS.ENTP_CODE = '100001'
         AND EXISTS (SELECT 'X'
                       FROM TGOODS GD
                          , TPAGMKTGOODS PK
                          , TPAPRODUCT PG
                      WHERE PG.GOODS_CODE		= GD.GOODS_CODE
                        AND PG.GOODS_CODE		= PK.GOODS_CODE
                        <!-- AND PK.PA_SALE_GB 	 	= '20'
                        AND PK.PA_STATUS  		IN ('10','30')  -->           
                        AND GD.DELY_TYPE        = '10'
                      )
         AND PCS.TRANS_TARGET_YN = '1'
    </select>
    
    <select id="selectEntpSlipCostByEntpCodeNSeq" resultType="hashMap" parameterType="hashMap">
       SELECT /* pagmktcommon.xml : pagmktcommon.selectEntpSlipCost by PaGmktCommonController  */ 
             DISTINCT 
             PCS.ENTP_CODE			AS ENTP_CODE
           , PCS.SHIP_COST_CODE		AS SHIP_COST_CODE
           , PES.ENTP_MAN_SEQ		AS ENTP_MAN_SEQ
           , PCS.SHIP_COST_BASE_AMT AS SHIP_COST_BASE_AMT
           , PCS.ORD_COST			AS ORD_COST_AMT
           , PCS.ISLAND_COST		AS ISLAND_COST
           , PCS.JEJU_COST			AS JEJU_COST
        FROM TPACUSTSHIPCOST PCS
           , TPAENTPSLIP 	 PES
       WHERE PCS.ENTP_CODE		= PES.ENTP_CODE
         AND PCS.PA_CODE 		IN ('21','22')
         AND PES.PA_CODE		= '21'
         AND PES.ENTP_CODE	   != '100001'
         AND PES.ENTP_CODE  	= #{entpCode, jdbcType=VARCHAR} 
         AND PES.ENTP_MAN_SEQ	= #{entpManSeq, jdbcType=VARCHAR} 
         AND EXISTS (SELECT 'X'
                       FROM TGOODS TG
                          , TPAGMKTGOODS PK
                          , TPAPRODUCT PG
                      WHERE PG.GOODS_CODE		= TG.GOODS_CODE
                        AND PG.GOODS_CODE		= PK.GOODS_CODE
                        AND PG.ENTP_CODE		= PES.ENTP_CODE
                        AND PG.SHIP_MAN_SEQ		= PES.ENTP_MAN_SEQ 
                        AND PCS.SHIP_COST_CODE	= TG.SHIP_COST_CODE
                        AND PK.PA_SALE_GB 	 	= '20'
                        AND PK.PA_STATUS  		IN ('10','30')                        
                        AND TG.DELY_TYPE       != '10'
                      )
    </select>
    
    
    <select id="selectChkShipDt" parameterType="com.cware.netshopping.domain.model.PaGmktShipCostDt" resultType="int">
        SELECT /* pagmktcommon.xml : pagmkt.pagmktcommon.selectChkShipDt by PaGmktCommonController*/
               COUNT(1)
          FROM TPAGMKTSHIPCOSTDT A
         WHERE A.ENTP_CODE		= #{entpCode	, jdbcType=VARCHAR}
           AND A.ENTP_MAN_SEQ	= #{entpManSeq	, jdbcType=VARCHAR}
           AND A.SHIP_COST_CODE	= #{shipCostCode, jdbcType=VARCHAR}
    </select>
  
    <update id="updateTPaGmktShipCostDt" parameterType="com.cware.netshopping.domain.model.PaGmktShipCostDt">
      UPDATE TPAGMKTSHIPCOSTDT GSD /* pagmktcommon.xml : pagmkt.pagmktcommon.updateTPaGmktShipCostDt by PaGmktCommonController */
         SET GSD.SHIP_COST_BASE_AMT	= #{shipCostBaseAmt , jdbcType=NUMERIC}
           , GSD.ORD_COST_AMT		= #{ordCostAmt		, jdbcType=NUMERIC}
           , GSD.TRANS_TARGET_YN	= #{transTargetYn	, jdbcType=VARCHAR}
           , GSD.MODIFY_ID			= 'PAG'
           , GSD.MODIFY_DATE		= SYSDATE
       WHERE GSD.ENTP_CODE			= #{entpCode		, jdbcType=VARCHAR}
         AND GSD.ENTP_MAN_SEQ		= #{entpManSeq		, jdbcType=VARCHAR}
         AND GSD.SHIP_COST_CODE		= #{shipCostCode	, jdbcType=VARCHAR}
    </update>
    
    <select id="selectGmktShipNo" parameterType="com.cware.netshopping.domain.model.PaGmktShipCostDt" resultType="String">
		SELECT /* pagmktcommon.xml : pagmkt.pagmktcommon.selectGmktShipNo by PaGmktCommonController*/
               PA.PA_GMKT_SHIP_NO
          FROM TPAENTPSLIP PA
         WHERE PA.ENTP_CODE			= #{entpCode	, jdbcType=VARCHAR}
           AND PA.ENTP_MAN_SEQ		= #{entpManSeq	, jdbcType=VARCHAR}
		   AND PA.PA_CODE			= '21'
		   AND ROWNUM				= 1
    </select>
    
    <select id="selectEntpSlipShip4Insert" resultType="hashMap" parameterType="hashMap">
		SELECT /* pagmktcommon.xml : pagmkt.pagmktcommon.selectEntpSlipShip4Insert by PaGmktCommonController*/
		       PES.ENTP_CODE
		     , PES.ENTP_MAN_SEQ
		     , PES.PA_ADDR_SEQ
      	  FROM TPAENTPSLIP PES
		 WHERE PES.PA_GMKT_SHIP_NO	IS NULL
		   AND PES.PA_ADDR_SEQ		IS NOT NULL
           AND PES.PA_CODE          = '21'
       	   AND PES.PA_ADDR_GB       = '30'
		  <if test = 'entpCode != null and entpCode != "" '>
       	   AND PES.ENTP_CODE		= #{entpCode	, jdbcType=VARCHAR}
		  </if>
       	   AND EXISTS (SELECT 'X' 
       	   				 FROM TPAGMKTSHIPCOSTDT GSD
       	   				WHERE GSD.ENTP_CODE			= PES.ENTP_CODE
       	   				  AND GSD.ENTP_MAN_SEQ		= PES.ENTP_MAN_SEQ
       	   				  AND GSD.BUNDLE_NO IS NULL )		
    </select>
    
    <select id="selectEntpSlipShip4Modify" resultType="hashMap" parameterType="hashMap">
		SELECT /* pagmktcommon.xml : pagmkt.pagmktcommon.selectEntpSlipShip4Modify by PaGmktCommonController*/
		       PES.ENTP_CODE
		     , PES.ENTP_MAN_SEQ
		     , PES.PA_ADDR_SEQ
		     , PES.PA_GMKT_SHIP_NO
      	  FROM TPAENTPSLIP PES
		 WHERE PES.PA_GMKT_SHIP_NO	IS NOT NULL
           AND PES.PA_CODE          = '21'
       	   AND PES.PA_ADDR_GB       = '30'
		  <if test = 'entpCode != null and entpCode != "" '>
       	   AND PES.ENTP_CODE		= #{entpCode	, jdbcType=VARCHAR}
		  </if>
       	   AND EXISTS (SELECT 'X' 
       	   				 FROM TPAGMKTSHIPCOSTDT GSD
       	   				WHERE GSD.ENTP_CODE			= PES.ENTP_CODE
       	   				  AND GSD.ENTP_MAN_SEQ		= PES.ENTP_MAN_SEQ
       	   				  AND GSD.TRANS_TARGET_YN	= '1'
       	   				  AND (GSD.BUNDLE_NO IS NULL  OR GSD.BUNDLE_NO NOT IN ('미사용','중단'))
       	   				  )
    </select>
    
    
    <select id="selectMaxShipCostFee" parameterType="hashMap" resultType="hashMap">
		SELECT /* pagmktcommon.xml : pagmkt.pagmktcommon.selectMaxShipCostFee by PaGmktCommonController*/
			   ORD_COST
			 , ISLAND_COST
			 , JEJU_COST
		  FROM (
				SELECT PS.ORD_COST
				     , PS.ISLAND_COST
				     , PS.JEJU_COST
				  FROM TPAGMKTSHIPCOSTDT GS
				     , TPACUSTSHIPCOST   PS
				WHERE PS.PA_CODE IN ('21','22')
				  AND PS.SHIP_COST_CODE  = GS.SHIP_COST_CODE
				  AND PS.ENTP_CODE       = GS.ENTP_CODE
				  AND GS.ENTP_CODE       = #{entpCode	, jdbcType=VARCHAR}
				  AND GS.ENTP_MAN_SEQ    = #{entpManSeq	, jdbcType=VARCHAR}
				  AND PS.ISLAND_COST     = (SELECT MAX(PSS.ISLAND_COST)
				                              FROM TPAGMKTSHIPCOSTDT GSS
				                                 , TPACUSTSHIPCOST   PSS
				                             WHERE PSS.SHIP_COST_CODE  = GSS.SHIP_COST_CODE
				                               AND PSS.ENTP_CODE       = GSS.ENTP_CODE
				                               AND GSS.ENTP_CODE       = GS.ENTP_CODE
				                               AND PSS.PA_CODE IN ('21','22')
				                               AND GSS.ENTP_MAN_SEQ    = GS.ENTP_MAN_SEQ)
				  ORDER BY JEJU_COST DESC)
		 WHERE ROWNUM = 1
  	</select>
  	
  	<update id="updatePaEntpSlipGmktShipNo" parameterType="com.cware.netshopping.domain.model.PaGmktShipCostM">
		UPDATE TPAENTPSLIP /* pagmktcommon.xml : pagmkt.pagmktcommon.updatePaEntpSlipGmktShipNo by PaGmktCommonController */
		   SET PA_GMKT_SHIP_NO	= #{gmktShipNo	, jdbcType=VARCHAR}
		     , MODIFY_ID		= 'PAG'
		     , MODIFY_DATE		= SYSDATE
		 WHERE ENTP_CODE 		= #{entpCode	, jdbcType=VARCHAR}
		   AND ENTP_MAN_SEQ		= #{entpManSeq	, jdbcType=VARCHAR}
		   AND PA_CODE			= '21'
		   AND PA_ADDR_GB		= '30'
  	</update>
    
    <update id="updatePaGmktShipCostGmktShipNo" parameterType="com.cware.netshopping.domain.model.PaGmktShipCostM">
		UPDATE TPAGMKTSHIPCOSTDT /* pagmktcommon.xml : pagmkt.pagmktcommon.updatePaGmktShipCostGmktShipNo by PaGmktCommonController */
		   SET GMKT_SHIP_NO		= #{gmktShipNo	, jdbcType=VARCHAR}
		     , ISLAND_COST		= #{islandCost	, jdbcType=NUMERIC}
		     , JEJU_COST		= #{jejuCost	, jdbcType=NUMERIC}
		     , MODIFY_ID		= 'PAG'
		     , MODIFY_DATE		= SYSDATE
		 WHERE ENTP_CODE 		= #{entpCode	, jdbcType=VARCHAR}
		   AND ENTP_MAN_SEQ		= #{entpManSeq	, jdbcType=VARCHAR}
  	</update>
  	
  	<select id="selectPaGmktShipCostTargetList" resultType="hashMap" parameterType="hashMap">
        SELECT /* pagmktcommon.xml : pagmkt.pagmktcommon."selectPaGmktShipCostTargetList" by PaGmktCommonController*/
               DISTINCT 
               GSD.GMKT_SHIP_NO
             , GSD.ENTP_CODE
             , GSD.ENTP_MAN_SEQ
          FROM TPAGMKTSHIPCOSTDT GSD
         WHERE GSD.TRANS_TARGET_YN = '1'
           <if test = 'entpCode != null and entpCode != "" '>
           AND GSD.ENTP_CODE = #{entpCode	, jdbcType=VARCHAR}
           </if>
           AND GMKT_SHIP_NO	IS NOT NULL
    </select>
  	
  	<select id="selectPaGmktShipCostDtTargetList" resultType="hashMap" parameterType="hashMap">
        SELECT /* pagmktcommon.xml : pagmkt.pagmktcommon.selectPaGmktShipCostDtTargetList by PaGmktCommonController */ 
               GSD.GMKT_SHIP_NO
             , GSD.ENTP_CODE
             , GSD.ENTP_MAN_SEQ
             , GSD.SHIP_COST_CODE
             , GSD.SHIP_COST_BASE_AMT
             , GSD.ORD_COST_AMT
             , GSD.BUNDLE_NO
          FROM TPAGMKTSHIPCOSTDT GSD
         WHERE GSD.TRANS_TARGET_YN = '1'
           AND GSD.ENTP_CODE 		= #{entpCode	, jdbcType=VARCHAR}
           AND GSD.ENTP_MAN_SEQ		= #{entpManSeq	, jdbcType=VARCHAR}
           AND GMKT_SHIP_NO	IS NOT NULL
    </select>
    
    <update id="updatePaGmktShipCostGmktBundleNo" parameterType="hashMap">
		UPDATE TPAGMKTSHIPCOSTDT /* pagmktcommon.xml : pagmkt.pagmktcommon.updatePaGmktShipCostGmktBundleNo by PaGmktCommonController */
		   SET 
		   	  TRANS_TARGET_YN	= '0'
		     <if test = 'gmktShipNo != "" and gmktShipNo != null '>
		     , GMKT_SHIP_NO		= #{gmktShipNo		, jdbcType=VARCHAR}
		     </if>
		     <if test = 'bundleNo != "" and bundleNo != null '>
		   	 , BUNDLE_NO		= #{bundleNo		, jdbcType=VARCHAR}
		     </if>
		     <if test = 'remark1V != "" and remark1V != null '>
		     , REMARK1_V   		= #{remark1V		, jdbcType=VARCHAR}
		     </if>
		     , MODIFY_ID		= 'PAG'
		     , MODIFY_DATE		= SYSDATE
		 WHERE ENTP_CODE 		= #{entpCode		, jdbcType=VARCHAR}
		   AND ENTP_MAN_SEQ		= #{entpManSeq		, jdbcType=VARCHAR}
		   AND SHIP_COST_CODE	= #{shipCostCode	, jdbcType=VARCHAR}
		   AND TRANS_TARGET_YN	= '1'
  	</update>
    
    <update id="updatePaCustShipCost" parameterType="hashMap">
    	UPDATE TPACUSTSHIPCOST /* pagmktcommon.xml : pagmkt.pagmktcommon."updatePaCustShipCost" by PaGmktCommonController */
		   SET TRANS_TARGET_YN 		= '0'
			 , MODIFY_ID        	= 'PAG'
		     , MODIFY_DATE     		= SYSDATE
         WHERE ENTP_CODE      		= #{entpCode,		jdbcType=VARCHAR}
           AND SHIP_COST_CODE 		= #{shipCostCode,	jdbcType=VARCHAR}
           AND PA_CODE        		IN ('21','22')
    </update>
    
    <select id="selectTConfigVal" resultType="String" parameterType="String">
        SELECT /* pagmktcommon.xml : pagmkt.pagmktcommon.selectTConfigVal */
               CO.VAL
          FROM TCONFIG CO
         WHERE CO.ITEM = #{item, jdbcType=VARCHAR}
    </select>
    
    
</mapper>